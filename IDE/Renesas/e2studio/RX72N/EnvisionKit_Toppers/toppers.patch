diff -cr --new-file asp/MANIFEST 1.9.1_update/MANIFEST
*** asp/MANIFEST	Sat Jan 11 22:46:24 2014
--- 1.9.1_update/MANIFEST	Thu Jan  1 09:00:00 1970
***************
*** 1,112 ****
- PACKAGE asp
- VERSION 1.9.1
- 
- configure
- MANIFEST
- README.txt
- 
- doc/asp_spec.txt
- doc/configurator.txt
- doc/design.txt
- doc/extension.txt
- doc/porting.txt
- doc/user.txt
- doc/version.txt
- 
- include/histogram.h
- include/itron.h
- include/kernel.h
- include/log_output.h
- include/queue.h
- include/sil.h
- include/t_stddef.h
- include/t_stdlib.h
- include/t_syslog.h
- include/test_lib.h
- 
- kernel/Makefile.kernel
- kernel/alarm.c
- kernel/alarm.h
- kernel/allfunc.h
- kernel/check.h
- kernel/cyclic.c
- kernel/cyclic.h
- kernel/dataqueue.c
- kernel/dataqueue.h
- kernel/eventflag.c
- kernel/eventflag.h
- kernel/exception.c
- kernel/exception.h
- kernel/genoffset.tf
- kernel/interrupt.c
- kernel/interrupt.h
- kernel/kernel.tf
- kernel/kernel_api.csv
- kernel/kernel_check.tf
- kernel/kernel_def.csv
- kernel/kernel_impl.h
- kernel/kernel_int.h
- kernel/kernel_rename.def
- kernel/kernel_rename.h
- kernel/kernel_unrename.h
- kernel/mailbox.c
- kernel/mailbox.h
- kernel/mempfix.c
- kernel/mempfix.h
- kernel/pridataq.c
- kernel/pridataq.h
- kernel/semaphore.c
- kernel/semaphore.h
- kernel/startup.c
- kernel/sys_manage.c
- kernel/task.c
- kernel/task.h
- kernel/task_except.c
- kernel/task_manage.c
- kernel/task_refer.c
- kernel/task_sync.c
- kernel/time_event.c
- kernel/time_event.h
- kernel/time_manage.c
- kernel/wait.c
- kernel/wait.h
- 
- library/histogram.c
- library/log_output.c
- library/strerror.c
- library/t_perror.c
- library/test_lib.c
- library/vasyslog.c
- 
- sample/Makefile
- sample/sample1.c
- sample/sample1.cfg
- sample/sample1.h
- 
- syssvc/banner.c
- syssvc/banner.cfg
- syssvc/banner.h
- syssvc/logtask.c
- syssvc/logtask.cfg
- syssvc/logtask.h
- syssvc/serial.c
- syssvc/serial.cfg
- syssvc/serial.h
- syssvc/syslog.c
- syssvc/syslog.cfg
- syssvc/syslog.h
- 
- utils/applyrename
- utils/genoffset
- utils/genrename
- utils/gentest
- utils/makedep
- utils/makerelease
- 
- INCLUDE target/dve68k_gcc/MANIFEST
- INCLUDE arch/m68k_gcc/MANIFEST
- INCLUDE arch/gcc/MANIFEST
- INCLUDE arch/logtrace/MANIFEST
- INCLUDE pdic/upd72001/MANIFEST
- INCLUDE test/MANIFEST
- INCLUDE extension/MANIFEST
--- 0 ----
diff -cr --new-file asp/README.txt 1.9.1_update/README.txt
*** asp/README.txt	Sat Jan 11 22:46:17 2014
--- 1.9.1_update/README.txt	Thu Jan  1 09:00:00 1970
***************
*** 1,47 ****
- 
- 	TOPPERS/ASP Kernel（Release 1.9.1）
- 		Toyohashi Open Platform for Embedded Real-Time Systems/
- 		Advanced Standard Profile Kernel
- 
- TOPPERS/ASPカーネル（以下，ASPカーネル）は，TOPPERS新世代カーネルの基盤
- となるものとして，TOPPERSプロジェクトにおいて開発したリアルタイムカーネ
- ルです．μITRON4.0仕様のスタンダードプロファイル準拠のリアルタイムカー
- ネルであるTOPPERS/JSPカーネルを拡張・改良する形で開発しました．
- 
- 【最初に読むべきドキュメント】
- 
- ASPカーネルのユーザーズマニュアルが，doc/user.txtにあります．ASPカーネ
- ルを使用する場合には，まずはこのドキュメントからお読み下さい．
- 
- 【ファイルの閲覧にあたって】
- 
- ASPカーネルのドキュメント（プレーンテキストファイル）およびソースファイ
- ルを読む際には，TABを4に設定してください．
- 
- 【利用条件】
- 
- ASPカーネルの利用条件は，各ファイルの先頭に表示されているTOPPERSライセ
- ンスです．TOPPERSライセンスに関するFAQが，以下のページにあります．
- 
- 	http://www.toppers.jp/faq/faq_ct12.html
- 
- 【質問・バグレポート・意見等の送付先】
- 
- ASPカーネルをより良いものにするためのご意見等を歓迎します．ASPカーネル
- に関する質問やバグレポート，ご意見等は，TOPPERSプロジェクトの会員は
- TOPPERS開発者メーリングリスト（dev@toppers.jp）宛またはASPカーネルのバ
- グトラッキングシステム（Trac）に，その他の方はTOPPERSユーザーズメーリン
- グリスト（users@toppers.jp）宛にお願いします．
- 
- TOPPERSユーザーズメーリングリストへの登録方法については，以下のページに
- 説明があります．
- 
- 	http://www.toppers.jp/community.html
- 
- 【ポーティングにあたって】
- 
- ASPカーネルを，TOPPERSプロジェクトからオープンソースにすることを前提に，
- 未サポートのターゲットにポーティングされる場合には，あらかじめご相談く
- ださると幸いです．
- 
- 以上
--- 0 ----
diff -cr --new-file asp/arch/rx_gcc/rx72n/MANIFEST 1.9.1_update/arch/rx_gcc/rx72n/MANIFEST
*** asp/arch/rx_gcc/rx72n/MANIFEST	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/arch/rx_gcc/rx72n/MANIFEST	Thu Dec 15 16:31:36 2022
***************
*** 0 ****
--- 1,34 ----
+ PACKAGE asp_arch_rx_rxc
+ VERSION 1.6.1
+ 
+ MANIFEST
+ genoffset.bat
+ makeoffset.c
+ offset.exe
+ prc.tf
+ prc_asm_config.tf
+ prc_cfg1_out.h
+ prc_check.tf
+ prc_config.c
+ prc_config.h
+ prc_def.csv
+ prc_insn.h
+ prc_kernel.h
+ prc_rename.def
+ prc_rename.h
+ prc_sil.h
+ prc_stddef.h
+ prc_support.src
+ prc_test.h
+ prc_test.src
+ prc_unrename.h
+ prc_user.txt
+ RX72n.h
+ RX72n.tf
+ RX72n_config.c
+ RX72n_config.h
+ start.src
+ 
+ INCLUDE ../../target/rsk_rx_hew/MANIFEST
+ INCLUDE ../rxc/MANIFEST
+ INCLUDE ../../pdic/rx600/MANIFEST
diff -cr --new-file asp/arch/rx_gcc/rx72n/Makefile.prc 1.9.1_update/arch/rx_gcc/rx72n/Makefile.prc
*** asp/arch/rx_gcc/rx72n/Makefile.prc	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/arch/rx_gcc/rx72n/Makefile.prc	Thu Dec 15 13:49:08 2022
***************
*** 0 ****
--- 1,69 ----
+ #
+ #		Makefile のchip依存部（rx用）
+ #
+ 
+ #
+ #  チップ依存部ディレクトリ名の定義
+ #
+ ARCH_SYS_DIR = $(SRCDIR)/arch/rx_$(TOOL)/$(PRC)
+ 
+ #
+ # include Makefile of arch_common
+ #
+ include $(SRCDIR)/arch/rx_$(TOOL)/rx_common/Makefile.prc_common
+ 
+ #
+ #  コンパイルオプション
+ #
+ INCLUDES := $(INCLUDES) -I$(ARCH_SYS_DIR)
+ CDEFS := $(CDEFS) 
+ COPTS := $(COPTS)
+ 
+ #
+ #  カーネルに関する定義
+ #
+ KERNEL_DIR := $(KERNEL_DIR) $(ARCH_SYS_DIR)
+ KERNEL_ASMOBJS := $(KERNEL_ASMOBJS)
+ KERNEL_COBJS := $(KERNEL_COBJS) rx72n_config.o rx72n_support.o
+ 
+ #
+ #  システムサービスに関する定義
+ #
+ SYSSVC_DIR := $(SYSSVC_DIR)
+ SYSSVC_COBJS := $(SYSSVC_COBJS)
+ 
+ #
+ #  トレースログに関する設定
+ #
+ ifeq ($(ENABLE_TRACE),true)
+ 	COPTS := $(COPTS) -DTOPPERS_ENABLE_TRACE
+ 	KERNEL_DIR := $(KERNEL_DIR) $(SRCDIR)/arch/logtrace
+ 	KERNEL_COBJS := $(KERNEL_COBJS) trace_config.o trace_dump.o
+ endif
+ 
+ #
+ #  依存関係の定義
+ #
+ kernel_cfg.timestamp: $(ARCH_SYS_DIR)/rx72n.tf $(ARCH_SYS_DIR)/prc.tf
+ #kernel_cfg.timestamp: $(ARCH_COM_DIR)/prc.tf
+ 
+ 
+ #
+ #  オフセットファイル生成のための定義
+ #
+ OFFSET_TF = $(TARGETDIR)/target_offset.tf
+ 
+ 
+ #
+ #  ツール依存部ディレクトリ名の定義
+ #
+ TOOLDIR = $(SRCDIR)/arch/$(TOOL)
+ 
+ #
+ #  コンパイルオプション
+ #
+ COPTS := $(COPTS)
+ INCLUDES := $(INCLUDES) -I$(TOOLDIR)
+ LDFLAGS := -nostdlib $(LDFLAGS)
+ CDEFS := $(CDEFS)
+ LIBS := $(LIBS)  -lgcc
diff -cr --new-file asp/arch/rx_gcc/rx72n/asm_config.h 1.9.1_update/arch/rx_gcc/rx72n/asm_config.h
*** asp/arch/rx_gcc/rx72n/asm_config.h	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/arch/rx_gcc/rx72n/asm_config.h	Thu Dec 15 13:49:08 2022
***************
*** 0 ****
--- 1,16 ----
+ 
+ #define TIPM_LOCK	 -15 
+ #define IPL_LOCK  117440512 
+ #define PSW_I_MASK 65536 
+ #define PSW_IPL_MASK 117440512 
+ #define EXC_GET_PSW_OFFSET 80 
+ 
+ 
+ #define LOG_INH_ENTER 0 
+ #define LOG_INH_LEAVE 0 
+ #define LOG_EXC_ENTER 0 
+ #define LOG_EXC_LEAVE 0 
+ #define LOG_DSP_ENTER 0 
+ #define LOG_DSP_LEAVE 0 
+ #define SIL_DLY_TIM1 69 
+ #define SIL_DLY_TIM2 50 
diff -cr --new-file asp/arch/rx_gcc/rx72n/prc.tf 1.9.1_update/arch/rx_gcc/rx72n/prc.tf
*** asp/arch/rx_gcc/rx72n/prc.tf	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/arch/rx_gcc/rx72n/prc.tf	Thu Dec 15 18:35:57 2022
***************
*** 0 ****
--- 1,360 ----
+ $ 
+ $  TOPPERS/ASP Kernel
+ $      Toyohashi Open Platform for Embedded Real-Time Systems/
+ $      Advanced Standard Profile Kernel
+ $ 
+ $  Copyright (C) 2008-2010 by Witz Corporation, JAPAN
+ $ 
+ $  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
+ $  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
+ $  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
+ $  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+ $      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+ $      スコード中に含まれていること．
+ $  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
+ $      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
+ $      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
+ $      の無保証規定を掲載すること．
+ $  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
+ $      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
+ $      と．
+ $    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
+ $        作権表示，この利用条件および下記の無保証規定を掲載すること．
+ $    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
+ $        報告すること．
+ $  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+ $      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
+ $      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
+ $      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
+ $      免責すること．
+ $ 
+ $  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
+ $  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
+ $  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
+ $  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
+ $  の責任を負わない．
+ $ 
+ $ 
+ 
+ $ 
+ $  アーキテクチャ依存テンプレート（RX72n用）from rx63n
+ $ 
+ 
+ 
+ 
+ $ 
+ $  ATT_ISRで使用できる割込み番号とそれに対応する割込みハンドラ番号
+ $ 
+ 
+ $INTNO_ATTISR_VALID = INTNO_VALID$
+ $INHNO_ATTISR_VALID = INHNO_VALID$
+ 
+ 
+ $ 
+ $  DEF_INT／DEF_EXCで使用できる割込みハンドラ番号／CPU例外ハンドラ番号
+ $ 
+ 
+ $INHNO_DEFINH_VALID = INHNO_VALID$
+ $EXCNO_DEFEXC_VALID = EXCNO_VALID$
+ 
+ 
+ $ 
+ $  CFG_INTで使用できる割込み番号と割込み優先度
+ $ 
+ 
+ $INTNO_CFGINT_VALID = INHNO_VALID$
+ $INTPRI_CFGINT_VALID = { -15, -14,...,-1 }$
+ 
+ 
+ $ 
+ $  ターゲット非依存部に含まれる標準の割込み管理機能/例外管理機能の初期化処理を使用する
+ $ 
+ 
+ $OMIT_INITIALIZE_INTERRUPT = 0$
+ $OMIT_INITIALIZE_EXCEPTION = 0$
+ 
+ 
+ $ 
+ $  スタックサイズのチェック方法指定
+ $ 
+ 
+ $CHECK_STKSZ_ALIGN = 4$
+ 
+ 
+ $ 
+ $  タスクスタックサイズの最小値
+ $ 
+ $  タスク起動時に4byte,
+ $  割込み入口処理にて48byte, CPU例外入口処理にて84byte,
+ $  であるため, 最小値は88byteとする.
+ $ 
+ 
+ $TARGET_MIN_STKSZ = 88$
+ 
+ 
+ $ 
+ $  定数定義
+ $ 
+ 
+ $TA_POSEDGE = TA_EDGE$
+ 
+ 
+ $ 
+ $ ターゲット依存の割込み属性の定義
+ $ 
+ 
+ $TARGET_INTATR = TA_POSEDGE | TA_NEGEDGE | TA_BOTHEDGE | TA_LOWLEVEL$
+ 
+ 
+ $ 
+ $ ターゲット依存の割込みハンドラ属性の定義
+ $ 
+ 
+ $TARGET_INHATR = TA_NONKERNEL$
+ 
+ 
+ $ 
+ $ カーネル管理外割込みハンドラは固定させないため,
+ $ INTNO_FIX_KERNEL
+ $ INHNO_FIX_KERNEL
+ $ INHNO_FIX_NONKERNEL
+ $ INHNO_FIX_NONKERNEL
+ $ を定義しない.
+ $ 
+ 
+ 
+ $ 
+ $  標準テンプレートファイルのインクルード
+ $ 
+ $INCLUDE "kernel/kernel.tf"$
+ 
+ 
+ 
+ $ 
+ $  CFG_INTのターゲット依存のエラーチェック
+ $ 
+ 
+ $FOREACH intno INT.ORDER_LIST$
+ $ IRQ割込み番号かどうかをチェック
+ 	$IF ( LENGTH( FIND( INTNO_INT, INT.INTNO[intno] ) ) != 0 )$
+ 
+ $   TA_POSEDGEとTA_NEGEDGEが同時に設定されている場合
+ 		$IF ((INT.INTATR[intno] & ( TA_POSEDGE | TA_NEGEDGE )) == ( TA_POSEDGE | TA_NEGEDGE ))$
+ 			$ERROR$ INT.TEXT_LINE[intno]:$FORMAT(_("illegal %1% `%2%\' of `%3%\' in %4%"), "intatr", INT.INTATR[intno], INT.INTNO[intno], "CFG_INT")$$END$
+ 		$END$
+ 
+ $   TA_POSEDGEとTA_BOTHEDGEが同時に設定されている場合
+ 		$IF ((INT.INTATR[intno] & ( TA_POSEDGE | TA_BOTHEDGE )) == ( TA_POSEDGE | TA_BOTHEDGE ))$
+ 			$ERROR$ INT.TEXT_LINE[intno]:$FORMAT(_("illegal %1% `%2%\' of `%3%\' in %4%"), "intatr", INT.INTATR[intno], INT.INTNO[intno], "CFG_INT")$$END$
+ 		$END$
+ 
+ $   TA_NEGEDGEとTA_BOTHEDGEが同時に設定されている場合
+ 		$IF ((INT.INTATR[intno] & ( TA_NEGEDGE | TA_BOTHEDGE )) == ( TA_NEGEDGE | TA_BOTHEDGE ))$
+ 			$ERROR$ INT.TEXT_LINE[intno]:$FORMAT(_("illegal %1% `%2%\' of `%3%\' in %4%"), "intatr", INT.INTATR[intno], INT.INTNO[intno], "CFG_INT")$$END$
+ 		$END$
+ 
+ $   TA_POSEDGEとTA_NEGEDGEとTA_BOTHEDGEが同時に設定されている場合
+ 		$IF ((INT.INTATR[intno] & ( TA_POSEDGE | TA_NEGEDGE | TA_BOTHEDGE )) == ( TA_POSEDGE | TA_NEGEDGE | TA_BOTHEDGE ))$
+ 			$ERROR$ INT.TEXT_LINE[intno]:$FORMAT(_("illegal %1% `%2%\' of `%3%\' in %4%"), "intatr", INT.INTATR[intno], INT.INTNO[intno], "CFG_INT")$$END$
+ 		$END$
+ 
+ 	$ELSE$
+ 
+ $   IRQ割込み以外の割込みに対して割込み属性が指定されている場合
+ 		$IF (INT.INTATR[intno] & (~( TA_ENAINT | TA_EDGE ))) != 0$
+ 			$ERROR$ INT.TEXT_LINE[intno]: $FORMAT(_("illegal %1% `%2%\' of `%3%\' in %4%"), "intatr", INT.INTATR[intno], INT.INTNO[intno], "CFG_INT")$$END$
+ 		$END$
+ 
+ 	$END$
+ 
+ $END$
+ 
+ 
+ 
+ $ 
+ $ 割込み番号から割込み優先度及び属性を取り出すテーブル
+ $ 
+ 
+ /*$NL$
+ $SPC$*$SPC$$SPC$Interrupt Level and Attribute Table$NL$
+ $SPC$*/$NL$
+ const CFG_INT_INFO _kernel_cfg_int_table[$LENGTH(INTNO_RANGE)$] = {$NL$
+ $FOREACH intno INTNO_RANGE$
+ $ 割込み優先度を取得
+ 	$IF LENGTH(INT.INTNO[intno])$
+ 		$intpri = -INT.INTPRI[intno]$
+ 		$intatr = INT.INTATR[intno]$
+ 	$ELSE$
+ 		$intpri = "0"$
+ 		$intatr = "0xFFFFFFFF"$
+ 	$END$
+ 
+ $ テーブルの中身を出力
+ 	$TAB$$FORMAT("{ %2d, %08x }, /* %02u */", intpri, intatr, +intno)$$NL$
+ $END$
+ };$NL$$NL$
+ 
+ 
+ $ 
+ $  アセンブラ出力ファイル
+ $ 
+ 
+ $FILE "kernel_cfg_asm.S"$
+ 
+ ;$NL$
+ ;  RX72Nアーキテクチャ依存出力ファイル$NL$
+ ;$NL$
+ ;  割込みベクタ及び割込みハンドラ定義$NL$
+ ;$NL$
+ $NL$$NL$
+ 
+ 
+ $ 
+ $  割込み入口処理
+ $ 
+ 
+ $ 
+ $  共通関数の宣言
+ $ 
+ 
+ $TAB$.text$NL$
+ $TAB$.extern$TAB$_kernel_interrupt$NL$
+ $TAB$.extern$TAB$__kernel_default_int_handler$NL$
+ $TAB$.extern$TAB$__kernel_default_exc_handler$NL$$NL$$NL$
+ 
+ 
+ $ 
+ $  割込みハンドラの出力
+ $ 
+ 
+ $FOREACH inhno INHNO_RANGE$
+ 	$IF LENGTH(INH.INHNO[inhno])$
+ 		$IF ((INH.INHATR[inhno] & TA_NONKERNEL) == 0)$
+ 			$TAB$.extern	_$INH.INTHDR[inhno]$$NL$
+ 			$TAB$.global	__kernel_$INH.INTHDR[inhno]$_$+INH.INHNO[inhno]$_entry$NL$
+ 			__kernel_$INH.INTHDR[inhno]$_$+INH.INHNO[inhno]$_entry:$NL$
+ 			$TAB$pushm	r1-r5						; スクラッチレジスタをタスクスタックへ退避 $NL$
+ 			$TAB$mov.l	#$+INH.INHNO[inhno]$, r1	; 割込みハンドラ番号をr1へ $NL$
+ 			$TAB$mov.l	#_$INH.INTHDR[inhno]$, r2	; ハンドラのアドレスをr2へ $NL$
+ 			$TAB$bra.a	_kernel_interrupt			; 共通ルーチンへ $NL$$NL$$NL$
+ 		$END$
+ 	$END$
+ $END$
+ 
+ 
+ $ 未登録割込みハンドラ入口処理
+ 
+ $FOREACH inhno INHNO_RANGE$
+   $TAB$.extern$TAB$__kernel_default_int_handler_entry_$inhno$$NL$
+   __kernel_default_int_handler_entry_$inhno$:$NL$
+   $TAB$pushm	r1-r5								; スクラッチレジスタをタスクスタックへ退避 $NL$
+   $TAB$mov.l	#$+inhno$, r1						; 割込みハンドラ番号をr1へ $NL$
+   $TAB$mov.l	#__kernel_default_int_handler, r2	; ハンドラのアドレスをr2へ $NL$
+   $TAB$bra.a	_kernel_interrupt					; 共通ルーチンへ $NL$$NL$$NL$
+ $END$
+ 
+ 
+ $ 
+ $  CPU例外ハンドラ入口処理
+ $ 
+ 
+ $TAB$.extern	_kernel_exception$NL$$NL$
+ 
+ $FOREACH excno EXCNO_RANGE$
+ 	$IF LENGTH(EXC.EXCNO[excno])$
+ 		$TAB$.extern	_$EXC.EXCHDR[excno]$$NL$
+ 		$TAB$.global	__kernel_$EXC.EXCHDR[excno]$_$+EXC.EXCNO[excno]$_entry$NL$
+ 		__kernel_$EXC.EXCHDR[excno]$_$+EXC.EXCNO[excno]$_entry:$NL$
+ 		$TAB$pushm	r1-r5						; スクラッチレジスタをタスクスタックへ退避 $NL$
+ 		$TAB$mov.l	#$+EXC.EXCNO[excno]$, r1	; CPU例外ハンドラ番号をr1へ $NL$
+ 		$TAB$mov.l	#_$EXC.EXCHDR[excno]$, r2	; ハンドラのアドレスをr2へ $NL$
+ 		$TAB$bra.a	_kernel_exception			; 共通ルーチンへ $NL$$NL$$NL$
+ 	$END$
+ $END$
+ 
+ 
+ $ 未登録CPU例外ハンドラ入口処理
+ $TAB$.extern$TAB$__kernel_default_exc_handler_entry$NL$
+ __kernel_default_exc_handler_entry:$NL$
+ $TAB$pushm	r1-r5								; スクラッチレジスタをタスクスタックへ退避 $NL$
+ $TAB$mov.l	#0FFFFFFFFH, r1						; CPU例外ハンドラ番号をr1へ $NL$
+ $TAB$mov.l	#__kernel_default_exc_handler, r2	; ハンドラのアドレスをr2へ $NL$
+ $TAB$bra.a	_kernel_exception					; 共通ルーチンへ $NL$$NL$$NL$
+ 
+ 
+ $ 
+ $  可変ベクタテーブル
+ $ 
+ 
+ ;$NL$
+ ;  可変ベクタテーブル$NL$
+ ;$NL$
+ $NL$
+ 
+ $TAB$.extern $TAB$ _startw$NL$$NL$
+ 
+ $FOREACH inhno INH.ORDER_LIST$
+ 	$IF ((INH.INHATR[inhno] & TA_NONKERNEL) != 0)$
+ 		$TAB$.global $TAB$ _$INH.INTHDR[inhno]$ $NL$
+ 	$END$
+ $END$
+ $NL$
+ 
+ $TAB$.section C$$VECT$NL$$NL$
+ $TAB$.glb __vvector_table$NL$$NL$
+ __vvector_table:$NL$
+ $FOREACH inhno INHNO_RANGE$
+ 	$IF LENGTH(INH.INHNO[inhno])$
+ 		$IF ((INH.INHATR[inhno] & TA_NONKERNEL) == 0)$
+ 			$inhhdr = CONCAT(CONCAT("_kernel_" , CONCAT(INH.INTHDR[inhno] , "_")) , CONCAT(+INH.INHNO[inhno] , "_entry"))$
+ 		$ELSE$
+ 			$inhhdr = INH.INTHDR[inhno]$
+ 		$END$
+ 	$ELSE$
+ 		$inhhdr = CONCAT("_kernel_default_int_handler_entry_", inhno)$
+ 	$END$
+ 
+ 	$TAB$.word$TAB$_$inhhdr$ $TAB$ $TAB$ $FORMAT("; %02d" , inhno)$ $NL$
+ $END$
+ 
+ 
+ $ 
+ $  固定ベクタテーブル
+ $ 
+ $FOREACH excno EXCNO_RANGE$
+ 	$IF LENGTH(EXC.EXCNO[excno])$
+ 		$EXCHDR[excno] = CONCAT(CONCAT("_kernel_" , CONCAT(EXC.EXCHDR[excno] , "_")) , CONCAT(+EXC.EXCNO[excno] , "_entry"))$
+ 	$ELSE$
+ 		$EXCHDR[excno] = "_kernel_default_exc_handler_entry"$
+ 	$END$
+ $END$
+ 
+ $NL$
+ ;$NL$
+ ;  固定ベクタテーブル$NL$
+ ;$NL$
+ $NL$
+ 
+ $TAB$ .section .fvect,ROMDATA,align=4 $NL$
+ $TAB$ .glb fvector_table $NL$
+ fvector_table:$NL$$NL$
+ $TAB$ .space$TAB$ 0x1c$NL$
+ $TAB$ .word$TAB$ 0xFFFFFFFF $TAB$ ; ROMコード(0xFFFFFF9C)$NL$
+ $TAB$ .word$TAB$ 0xFFFFFFFF $TAB$ ; 制御コード(0xFFFFFFA0), IDコード1 - 3$NL$
+ $TAB$ .word$TAB$ 0xFFFFFFFF $TAB$ ; IDコード4 - 7$NL$
+ $TAB$ .word$TAB$ 0xFFFFFFFF $TAB$ ; IDコード8 - 11$NL$
+ $TAB$ .word$TAB$ 0xFFFFFFFF $TAB$ ; IDコード12 - 15$NL$
+ $TAB$ .space$TAB$ 0x20$NL$
+ $TAB$ .word$TAB$ _$EXCHDR[20]$ $TAB$ $TAB$ ;$SPC$ 20:特権命令例外 $SPC$$NL$
+ $TAB$ .space$TAB$ 0x8$NL$
+ $TAB$ .word$TAB$ _$EXCHDR[23]$ $TAB$ $TAB$ ;$SPC$ 23:未定義命令例外 $SPC$$NL$
+ $TAB$ .space$TAB$ 0x4$NL$
+ $TAB$ .word$TAB$ _$EXCHDR[25]$ $TAB$ $TAB$ ;$SPC$ 25:浮動小数点例外 $SPC$$NL$
+ $TAB$ .space$TAB$ 0x10$NL$
+ $TAB$ .word$TAB$ _$EXCHDR[30]$ $TAB$ $TAB$ ;$SPC$ 30:ノンマスカブル例外 $SPC$$NL$
+ ;$TAB$ .word$TAB$ _startw $TAB$ $TAB$ $TAB$ $TAB$ ;$SPC$ 31:リセット $SPC$$NL$
+ ;wata
+ $NL$ $NL$
+ 
+ 	$TAB$.end
+ $NL$
diff -cr --new-file asp/arch/rx_gcc/rx72n/prc_stddef.h 1.9.1_update/arch/rx_gcc/rx72n/prc_stddef.h
*** asp/arch/rx_gcc/rx72n/prc_stddef.h	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/arch/rx_gcc/rx72n/prc_stddef.h	Thu Dec 15 13:53:29 2022
***************
*** 0 ****
--- 1,55 ----
+ /*
+  *  TOPPERS Software
+  *      Toyohashi Open Platform for Embedded Real-Time Systems
+  * 
+  *  Copyright (C) 2008-2010 by Witz Corporation, JAPAN
+  *  Copyright (C) 2015 by Hisashi Hata, JAPAN
+  * 
+  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
+  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
+  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
+  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+  *      スコード中に含まれていること．
+  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
+  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
+  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
+  *      の無保証規定を掲載すること．
+  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
+  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
+  *      と．
+  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
+  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
+  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
+  *        報告すること．
+  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
+  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
+  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
+  *      免責すること．
+  * 
+  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
+  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
+  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
+  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
+  *  の責任を負わない．
+  * 
+  */
+ 
+ /*
+  *		t_stddef.hのプロセッサ依存部（RX72n用）from RX62n
+  *
+  *  このインクルードファイルは，target_stddef.h（または，そこからインク
+  *  ルードされるファイル）のみからインクルードされる．他のファイルから
+  *  直接インクルードしてはならない．
+  */
+ 
+ #ifndef TOPPERS_PRC_STDDEF_H
+ #define TOPPERS_PRC_STDDEF_H
+ 
+ /*
+  *  ターゲットを識別するためのマクロの定義
+  */
+ #define TOPPERS_RX72N				/* プロセッサ略称 */
+ 
+ #endif /* TOPPERS_PRC_STDDEF_H */
diff -cr --new-file asp/arch/rx_gcc/rx72n/rx72n.h 1.9.1_update/arch/rx_gcc/rx72n/rx72n.h
*** asp/arch/rx_gcc/rx72n/rx72n.h	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/arch/rx_gcc/rx72n/rx72n.h	Thu Dec 15 18:36:11 2022
***************
*** 0 ****
--- 1,2039 ----
+ /*
+  *  TOPPERS/ASP Kernel
+  *      Toyohashi Open Platform for Embedded Real-Time Systems/
+  *      Advanced Standard Profile Kernel
+  *
+  *  Copyright (C) 2008-2010 by Witz Corporation, JAPAN
+  *
+  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
+  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
+  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
+  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+  *      スコード中に含まれていること．
+  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
+  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
+  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
+  *      の無保証規定を掲載すること．
+  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
+  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
+  *      と．
+  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
+  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
+  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
+  *        報告すること．
+  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
+  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
+  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
+  *      免責すること．
+  *
+  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
+  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
+  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
+  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
+  *  の責任を負わない．
+  *
+  */
+ 
+ /*
+  *  RX72nに依存する定義
+  */
+ #ifndef TOPPERS_RX72n_H
+ #define TOPPERS_RX72n_H
+ 
+ #include <sil.h>
+ 
+ /*
+  *  CPU例外ハンドラ番号の定義(固定ベクタテーブル)
+  *
+  *  番号の範囲は0 - 31
+  */
+ #define INT_PRIVILEGED_INSTRUNCTION		20		/* 特権命令例外 */
+ #define INT_UNDEF_INSTRUNCTION			23		/* 未定義命令例外 */
+ #define INT_FLOATINGPOINT_INSTRUCTION	25		/* 浮動小数点例外 */
+ #define INT_NMI							30		/* ノンマスカブル割り込み */
+ #define INT_RESET						31		/* リセット */
+ 
+ /*
+  *  割込み番号の定義(可変ベクタテーブル)
+  */
+ 
+ #define INT_BUSERR			16
+ #define INT_FCU_FCUERR		21
+ #define INT_FCU_FRDYI		23
+ #define INT_ICU_SWINT       27
+ #define INT_CMT0_CMI0		28
+ #define INT_CMT1_CMI1		29
+ #define INT_CMT2_CMI2		128
+ #define INT_CMT3_CMI3		31
+ #define INT_ETHER_EINT      32
+ #define INT_USB0_D0FIFO0    33
+ #define INT_USB0_D1FIFO0    34
+ #define INT_USB0_USBI0      35
+ #define INT_USB1_D0FIFO1    36
+ #define INT_USB1_D1FIFO1    37
+ #define INT_USB1_USBI1      38
+ #define INT_RSPI0_SPRI0     39
+ #define INT_RSPI0_SPTI0     40
+ #define INT_RSPI0_SPII0     41
+ #define INT_RSPI1_SPRI1     42
+ #define INT_RSPI1_SPTI1     43
+ #define INT_RSPI1_SPII1     44
+ #define INT_RSPI2_SPRI2     45
+ #define INT_RSPI2_SPTI2     46
+ #define INT_RSPI2_SPII2     47
+ #define INT_CAN0_RXF0       48
+ #define INT_CAN0_TXF0       49
+ #define INT_CAN0_RXM0       50
+ #define INT_CAN0_TXM0       51
+ #define INT_CAN1_RXF1       52
+ #define INT_CAN1_TXF1       53
+ #define INT_CAN1_RXM1       54
+ #define INT_CAN1_TXM1       55
+ #define INT_CAN2_RXF2       56
+ #define INT_CAN2_TXF2       57
+ #define INT_CAN2_RXM2       58
+ #define INT_CAN2_TXM2       59
+ #define INT_RTC_CUP         62
+ #define INT_IRQ0			64
+ #define INT_IRQ1			65
+ #define INT_IRQ2			66
+ #define INT_IRQ3			67
+ #define INT_IRQ4			68
+ #define INT_IRQ5			69
+ #define INT_IRQ6			70
+ #define INT_IRQ7			71
+ #define INT_IRQ8			72
+ #define INT_IRQ9			73
+ #define INT_IRQ10			74
+ #define INT_IRQ11			75
+ #define INT_IRQ12			76
+ #define INT_IRQ13			77
+ #define INT_IRQ14			78
+ #define INT_IRQ15			79
+ #define INT_USB_USBR0       90
+ #define INT_USB_USBR1       91
+ #define INT_RTC_ALM         92
+ #define INT_RTC_PRD         93
+ #define INT_AD_ADI0         98
+ #define INT_S12AD_S12ADI0   102
+ #define INT_ICU_GROUP0      106
+ #define INT_ICU_GROUP1      107
+ #define INT_ICU_GROUP2      108
+ #define INT_ICU_GROUP3      109
+ #define INT_ICU_GROUP4      110
+ #define INT_ICU_GROUP5      111
+ #define INT_ICU_GROUP6      112
+ #define INT_EDMAC0  113
+ 
+ #define INT_ICU_GROUP12     114
+ #define INT_SCI12_SCIX0     122
+ #define INT_SCI12_SCIX1     123
+ #define INT_SCI12_SCIX2     124
+ #define INT_SCI12_SCIX3     125
+ //TPU and MTU are sheared irq.
+ //TPU define
+ #define INT_TPU0_TGI0A		126
+ #define INT_TPU0_TGI0B		127
+ #define INT_TPU0_TGI0C		30
+ #define INT_TPU0_TGI0D		129
+ #define INT_TPU1_TGI1A		130
+ #define INT_TPU1_TGI1B		131
+ #define INT_TPU2_TGI2A		132
+ #define INT_TPU2_TGI2B		133
+ #define INT_TPU3_TGI3A		134
+ #define INT_TPU3_TGI3B		135
+ #define INT_TPU3_TGI3C		136
+ #define INT_TPU3_TGI3D		137
+ #define INT_TPU4_TGI4A		138
+ #define INT_TPU4_TGI4B		139
+ #define INT_TPU5_TGI5A		140
+ #define INT_TPU5_TGI5B		141
+ #define INT_TPU6_TGI6A		142
+ #define INT_TPU6_TGI6B		143
+ #define INT_TPU6_TGI6C		144
+ #define INT_TPU7_TGI7A		148
+ #define INT_TPU7_TGI7B		149
+ #define INT_TPU8_TGI8A		150
+ #define INT_TPU8_TGI8B		151
+ #define INT_TPU9_TGI9A		152
+ #define INT_TPU9_TGI9B		153
+ #define INT_TPU9_TGI9C		154
+ #define INT_TPU9_TGI9D		155
+ #define INT_TPU10_TGI10A	156
+ #define INT_TPU10_TGI10B	157
+ #define INT_TPU11_TGI11A	164
+ #define INT_TPU11_TGI11B	165
+ //MTU define
+ #define INT_MTU0_TGIA0      142
+ #define INT_MTU0_TGIB0      143
+ #define INT_MTU0_TGIC0      144
+ #define INT_MTU0_TGID0      145
+ #define INT_MTU0_TGIE0      146
+ #define INT_MTU0_TGIF0      147
+ #define INT_MTU1_TGIA1      148
+ #define INT_MTU1_TGIB1      149
+ #define INT_MTU2_TGIA2      150
+ #define INT_MTU2_TGIB2      151
+ #define INT_MTU3_TGIA3      152
+ #define INT_MTU3_TGIB3      153
+ #define INT_MTU3_TGIC3      154
+ #define INT_MTU3_TGID3      155
+ #define INT_MTU4_TGIA4      156
+ #define INT_MTU4_TGIB4      157
+ #define INT_MTU4_TGIC4      158
+ #define INT_MTU4_TGID4      159
+ #define INT_MTU4_TGIV4      160
+ #define INT_MTU5_TGIU5      161
+ #define INT_MTU5_TGIV5      162
+ #define INT_MTU5_TGIW5      163
+ #define INT_POE_OEI1        166
+ #define INT_POE_OEI2        167
+ #define INT_TMR0_CMIA0		170
+ #define INT_TMR0_CMIB0		171
+ #define INT_TMR0_OVI0		172
+ #define INT_TMR1_CMIA1		173
+ #define INT_TMR1_CMIB1		174
+ #define INT_TMR1_OVI1		175
+ #define INT_TMR2_CMIA2		176
+ #define INT_TMR2_CMIB2		177
+ #define INT_TMR2_OVI2		178
+ #define INT_TMR3_CMIA3		179
+ #define INT_TMR3_CMIB3		180
+ #define INT_TMR3_OVI3		181
+ #define INT_RIIC0_EEI0      182
+ #define INT_RIIC0_RXI0      183
+ #define INT_RIIC0_TXI0      184
+ #define INT_RIIC0_TEI0      185
+ #define INT_RIIC1_EEI1      186
+ #define INT_RIIC1_RXI1      187
+ #define INT_RIIC1_TXI1      188
+ #define INT_RIIC1_TEI1      189
+ #define INT_RIIC2_EEI2      190
+ #define INT_RIIC2_RXI2      191
+ #define INT_RIIC2_TXI2      192
+ #define INT_RIIC2_TEI2      193
+ #define INT_RIIC3_EEI3      194
+ #define INT_RIIC3_RXI3      195
+ #define INT_RIIC3_TXI3      196
+ #define INT_RIIC3_TEI3      197
+ #define INT_DMAC_DMAC0I     198
+ #define INT_DMAC_DMAC1I     199
+ #define INT_DMAC_DMAC2I     200
+ #define INT_DMAC_DMAC3I     201
+ #define INT_EXDMAC_EXDMAC0I 202
+ #define INT_EXDMAC_EXDMAC1I 203
+ #define INT_DEU_DEU0        206
+ #define INT_DEU_DEU1        207
+ #define INT_PDC_PCDFI       208
+ #define INT_PDC_PCFEI       209
+ #define INT_PDC_PCERI       210
+ #define INT_SCI0_RXI0		214
+ #define INT_SCI0_TXI0		215
+ #define INT_SCI0_TEI0		216
+ #define INT_SCI1_RXI1		217
+ #define INT_SCI1_TXI1		218
+ #define INT_SCI1_TEI1		219
+ #define INT_SCI2_RXI2		220
+ #define INT_SCI2_TXI2		221
+ #define INT_SCI2_TEI2		222
+ #define INT_SCI3_RXI3		223
+ #define INT_SCI3_TXI3		224
+ #define INT_SCI3_TEI3		225
+ #define INT_SCI4_RXI4		226
+ #define INT_SCI4_TXI4		227
+ #define INT_SCI4_TEI4		228
+ #define INT_SCI5_RXI5		229
+ #define INT_SCI5_TXI5		230
+ #define INT_SCI5_TEI5		231
+ #define INT_SCI6_RXI6		232
+ #define INT_SCI6_TXI6		233
+ #define INT_SCI6_TEI6		234
+ #define INT_SCI7_RXI7		235
+ #define INT_SCI7_TXI7		236
+ #define INT_SCI7_TEI7		237
+ #define INT_SCI8_RXI8		238
+ #define INT_SCI8_TXI8		239
+ #define INT_SCI8_TEI8		240
+ #define INT_SCI9_RXI9		241
+ #define INT_SCI9_TXI9		242
+ #define INT_SCI9_TEI9		243
+ #define INT_SCI10_RXI10		244
+ #define INT_SCI10_TXI10		245
+ #define INT_SCI10_TEI10		246
+ #define INT_SCI11_RXI11		247
+ #define INT_SCI11_TXI11		248
+ #define INT_SCI11_TEI11		249
+ #define INT_SCI12_RXI12		250
+ #define INT_SCI12_TXI12		251
+ #define INT_SCI12_TEI12		252
+ #define INT_IEB_IEBINT		253
+ 
+ 
+ /*
+  *  各モジュールのレジスタ及び設定ビット情報
+  */
+ 
+ /*
+  *  Register write protection
+  */
+ #define SYSTEM_PRCR_ADDR ( 0x000803FE )
+ #define SYSTEM_PRKEY  0xA500
+ #define SYSTEM_PRC0	( 1UL << 0U )
+ #define SYSTEM_PRC1	( 1UL << 1U )
+ #define SYSTEM_PRC3	( 1UL << 3U )
+ 
+ /*
+  * Clock generater
+  */
+ //SCKCR define
+ #define CKG_SCKCR_ADDR ( ( volatile uint32_t *)0x00080020 )
+ #define CKG_SCKCR_RESERVE 0x11
+ #define CKG_SCKCR_PB_DIV01 ( 0UL << 8 )
+ #define CKG_SCKCR_PB_DIV02 ( 1UL << 8 )
+ #define CKG_SCKCR_PB_DIV04 ( 2UL << 8 )
+ #define CKG_SCKCR_PB_DIV08 ( 3UL << 8 )
+ #define CKG_SCKCR_PB_DIV16 ( 4UL << 8 )
+ #define CKG_SCKCR_PB_DIV32 ( 5UL << 8 )
+ #define CKG_SCKCR_PB_DIV64 ( 6UL << 8 )
+ #define CKG_SCKCR_PA_DIV01 ( 0UL << 12 )
+ #define CKG_SCKCR_PA_DIV02 ( 1UL << 12 )
+ #define CKG_SCKCR_PA_DIV04 ( 2UL << 12 )
+ #define CKG_SCKCR_PA_DIV08 ( 3UL << 12 )
+ #define CKG_SCKCR_PA_DIV16 ( 4UL << 12 )
+ #define CKG_SCKCR_PA_DIV32 ( 5UL << 12 )
+ #define CKG_SCKCR_PA_DIV64 ( 6UL << 12 )
+ #define CKG_SCKCR_BCK_DIV01 ( 0UL << 16 )
+ #define CKG_SCKCR_BCK_DIV02 ( 1UL << 16 )
+ #define CKG_SCKCR_BCK_DIV04 ( 2UL << 16 )
+ #define CKG_SCKCR_BCK_DIV08 ( 3UL << 16 )
+ #define CKG_SCKCR_BCK_DIV16 ( 4UL << 16 )
+ #define CKG_SCKCR_BCK_DIV32 ( 5UL << 16 )
+ #define CKG_SCKCR_BCK_DIV64 ( 6UL << 16 )
+ #define CKG_SCKCR_PSTOP0 ( 1UL << 22 )
+ #define CKG_SCKCR_PSTOP1 ( 1UL << 23 )
+ #define CKG_SCKCR_ICK_DIV01  ( 0UL << 24 )
+ #define CKG_SCKCR_ICK_DIV02  ( 1UL << 24 )
+ #define CKG_SCKCR_ICK_DIV04  ( 2UL << 24 )
+ #define CKG_SCKCR_ICK_DIV08  ( 3UL << 24 )
+ #define CKG_SCKCR_ICK_DIV16  ( 4UL << 24 )
+ #define CKG_SCKCR_ICK_DIV32  ( 5UL << 24 )
+ #define CKG_SCKCR_ICK_DIV64  ( 6UL << 24 )
+ #define CKG_SCKCR_FCK_DIV01  ( 0UL << 28 )
+ #define CKG_SCKCR_FCK_DIV02  ( 1UL << 28 )
+ #define CKG_SCKCR_FCK_DIV04  ( 2UL << 28 )
+ #define CKG_SCKCR_FCK_DIV08  ( 3UL << 28 )
+ #define CKG_SCKCR_FCK_DIV16  ( 4UL << 28 )
+ #define CKG_SCKCR_FCK_DIV32  ( 5UL << 28 )
+ #define CKG_SCKCR_FCK_DIV64  ( 6UL << 28 )
+ 
+ #define CKG_SCKCR2_ADDR ( ( volatile uint16_t *)0x00080024 )
+ #define CKG_SCKCR2_IEBCK_DIV2   1UL
+ #define CKG_SCKCR2_IEBCK_DIV4   2UL
+ #define CKG_SCKCR2_IEBCK_DIV8   3UL
+ #define CKG_SCKCR2_IEBCK_DIV16  4UL
+ #define CKG_SCKCR2_IEBCK_DIV32  5UL
+ #define CKG_SCKCR2_IEBCK_DIV64  6UL
+ #define CKG_SCKCR2_IEBCK_DIV6   12UL
+ #define CKG_SCKCR2_UCK_NOT_USE (1UL << 4)
+ #define CKG_SCKCR2_UCK_DIV3 (2UL << 4)
+ #define CKG_SCKCR2_UCK_DIV4 (3UL << 4)
+ 
+ 
+ //CLock Select register
+ #define CKG_SCKCR3_ADDR ( ( volatile uint16_t *)0x00080026 )
+ #define CKG_SCKCR3_LOCO ( 0UL << 8 )
+ #define CKG_SCKCR3_HOCO ( 1UL << 8 )
+ #define CKG_SCKCR3_MAIN ( 2UL << 8 )
+ #define CKG_SCKCR3_SUB ( 3UL << 8 )
+ #define CKG_SCKCR3_PLL ( 4UL << 8 )
+ //PLL freq setting
+ #define CKG_PLLCR_ADDR ( ( volatile uint16_t *)0x00080028 )
+ #define CKG_PLLCR_PLIDIV1 ( 0UL << 0U )
+ #define CKG_PLLCR_PLIDIV2 ( 1UL << 0U )
+ #define CKG_PLLCR_PLIDIV4 ( 2UL << 0U )
+ #define CKG_PLLCR_STC8  ( 0x07UL << 8U )
+ #define CKG_PLLCR_STC10 ( 0x09UL << 8U )
+ #define CKG_PLLCR_STC12 ( 0x0BUL << 8U )
+ #define CKG_PLLCR_STC16 ( 0x0FUL << 8U )
+ #define CKG_PLLCR_STC20 ( 0x13UL << 8U )
+ #define CKG_PLLCR_STC24 ( 0x17UL << 8U )
+ #define CKG_PLLCR_STC25 ( 0x18UL << 8U )
+ #define CKG_PLLCR_STC50 ( 0x19UL << 8U )
+ //Clock enable setting
+ #define CKG_PLLCR2_ADDR ( ( volatile uint16_t *)0x0008002A )
+ #define CKG_MOSCCR_ADDR ( ( volatile uint8_t *)0x00080032 )
+ #define CKG_SOSCCR_ADDR ( ( volatile uint8_t *)0x00080033 )
+ #define CKG_LOSCCR_ADDR ( ( volatile uint8_t *)0x00080034 )
+ #define CKG_ILOCOCR_ADDR ( ( volatile uint8_t *)0x00080035 )
+ #define CKG_HOCOCR_ADDR ( ( volatile uint8_t *)0x00080036 )
+ 
+ #define CKG_CLOCK_ENABLE  0UL
+ #define CKG_COCCK_DISABLE 1UL
+ 
+ 
+ 
+ 
+ /*
+  * モジュールストップコントロールレジスタA（MSTPCRA）
+  */
+ 
+ #define SYSTEM_MSTPCRA_ADDR			( ( volatile uint32_t  * )0x00080010 )
+ #define SYSTEM_MSTPCRA_MSTPA4_TMR3_2	( 1UL << 4U )
+ #define SYSTEM_MSTPCRA_MSTPA5_TMR1_0	( 1UL << 5U )
+ #define SYSTEM_MSTPCRA_MSTPA9_MTU	( 1UL << 9U )
+ #define SYSTEM_MSTPCRA_MSTPA10_PPG1	( 1UL << 10U )
+ #define SYSTEM_MSTPCRA_MSTPA11_PPG0	( 1UL << 11U )
+ #define SYSTEM_MSTPCRA_MSTPA12_TPU_U1	( 1UL << 12U )
+ #define SYSTEM_MSTPCRA_MSTPA13_TPU_U0	( 1UL << 13U )
+ #define SYSTEM_MSTPCRA_MSTPA14_CMT_U1	( 1UL << 14U )
+ #define SYSTEM_MSTPCRA_MSTPA15_CMT_U0	( 1UL << 15U )
+ #define SYSTEM_MSTPCRA_MSTPA17_S12AD	( 1UL << 17U )
+ #define SYSTEM_MSTPCRA_MSTPA19_DA	( 1UL << 19U )
+ #define SYSTEM_MSTPCRA_MSTPA23_AD	( 1UL << 23U )
+ #define SYSTEM_MSTPCRA_MSTPA24_BIT	( 1UL << 24U )
+ #define SYSTEM_MSTPCRA_MSTPA27_BIT	( 1UL << 27U )
+ #define SYSTEM_MSTPCRA_MSTPA28_DMAC_DTC	( 1UL << 28U )
+ #define SYSTEM_MSTPCRA_MSTPA29_EXDMAC	( 1UL << 29U )
+ #define SYSTEM_MSTPCRA_ACSE		( 1UL << 31U)
+ 
+ 
+ /*
+  * モジュールストップコントロールレジスタB（MSTPCRB）
+  */
+ 
+ 
+ #define SYSTEM_MSTPCRB_ADDR			( ( volatile uint32_t  * )0x00080014 )
+ #define SYSTEM_MSTPCRB_MSTPB0_CAN0	( 1UL << 0U )
+ #define SYSTEM_MSTPCRB_MSTPB1_CAN1	( 1UL << 1U )
+ #define SYSTEM_MSTPCRB_MSTPB2_CAN2	( 1UL << 2U )
+ #define SYSTEM_MSTPCRB_MSTPB4_SCId	( 1UL << 4U )
+ #define SYSTEM_MSTPCRB_MSTPB8_THERMO	( 1UL << 8U )
+ #define SYSTEM_MSTPCRB_MSTPB15_EDMAC	( 1UL << 15U )
+ #define SYSTEM_MSTPCRB_MSTPB16_RSPI1	( 1UL << 16U )
+ #define SYSTEM_MSTPCRB_MSTPB17_RSPI0	( 1UL << 17U )
+ #define SYSTEM_MSTPCRB_MSTPB18_USB1	( 1UL << 18U )
+ #define SYSTEM_MSTPCRB_MSTPB19_USB0	( 1UL << 19U )
+ #define SYSTEM_MSTPCRB_MSTPB20_RIIC1	( 1UL << 20U )
+ #define SYSTEM_MSTPCRB_MSTPB21_RIIC0	( 1UL << 21U )
+ #define SYSTEM_MSTPCRB_MSTPB22_PDC	( 1UL << 22U )
+ #define SYSTEM_MSTPCRB_MSTPB23_CRC	( 1UL << 23U )
+ #define SYSTEM_MSTPCRB_MSTPB24_SCI7	( 1UL << 24U )
+ #define SYSTEM_MSTPCRB_MSTPB25_SCI6	( 1UL << 25U )
+ #define SYSTEM_MSTPCRB_MSTPB26_SCI5	( 1UL << 26U )
+ #define SYSTEM_MSTPCRB_MSTPB27_SCI4	( 1UL << 27U )
+ #define SYSTEM_MSTPCRB_MSTPB28_SCI3	( 1UL << 28U )
+ #define SYSTEM_MSTPCRB_MSTPB29_SCI2	( 1UL << 29U )
+ #define SYSTEM_MSTPCRB_MSTPB30_SCI1 ( 1UL << 30U )
+ #define SYSTEM_MSTPCRB_MSTPB31_SCI0 ( 1UL << 31U )
+ 
+ /*
+  * モジュールストップコントロールレジスタC（MSTPCRC）
+  */
+ 
+ #define SYSTEM_MSTPCRC_ADDR			( ( volatile uint32_t  * )0x00080018 )
+ #define SYSTEM_MSTPCRC_MSTPC0_RAM0 ( 1UL << 0U )
+ #define SYSTEM_MSTPCRC_MSTPC1_RAM1 ( 1UL << 1U )
+ #define SYSTEM_MSTPCRC_MSTPC16_RIIC3 ( 1UL << 16U )
+ #define SYSTEM_MSTPCRC_MSTPC17_RIIC2 ( 1UL << 17U )
+ #define SYSTEM_MSTPCRC_MSTPC18_IEBUS ( 1UL << 18U )
+ #define SYSTEM_MSTPCRC_MSTPC19_MCK ( 1UL << 19U )
+ #define SYSTEM_MSTPCRC_MSTPC22_RSPI2 ( 1UL << 22U )
+ #define SYSTEM_MSTPCRC_MSTPC24_SCI11 ( 1UL << 24U )
+ #define SYSTEM_MSTPCRC_MSTPC25_SCI10	( 1UL << 25U )
+ #define SYSTEM_MSTPCRC_MSTPC26_SCI9	( 1UL << 26U )
+ #define SYSTEM_MSTPCRC_MSTPC27_SCI8	( 1UL << 27U )
+ 
+ 
+ #define SYSTEM_MSTPCRD_ADDR			( ( volatile uint32_t  * )0x0008001C )
+ #define SYSTEM_MSTPCRD_MSTPD31_BIT	( 1UL << 31U )
+ 
+ /*
+  * clock wait control register
+  */
+ #define SYSTEM_MOSCWTR_ADDR         ( ( volatile uint32_t  * )0x000800A2 )
+ #define SYSTEM_PLLWTCR_ADDR         ( ( volatile uint32_t  * )0x000800A6 )
+ #define SYSTEM_CLKWAIT_H0   0x0
+ #define SYSTEM_CLKWAIT_H1   0x1
+ #define SYSTEM_CLKWAIT_H2   0x2
+ #define SYSTEM_CLKWAIT_H3   0x3
+ #define SYSTEM_CLKWAIT_H4   0x4
+ #define SYSTEM_CLKWAIT_H5   0x5
+ #define SYSTEM_CLKWAIT_H6   0x6
+ #define SYSTEM_CLKWAIT_H7   0x7
+ #define SYSTEM_CLKWAIT_H8   0x8
+ #define SYSTEM_CLKWAIT_H9   0x9
+ #define SYSTEM_CLKWAIT_HA   0xA
+ #define SYSTEM_CLKWAIT_HB   0xB
+ #define SYSTEM_CLKWAIT_HC   0xC
+ #define SYSTEM_CLKWAIT_HD   0xD
+ #define SYSTEM_CLKWAIT_HE   0xE
+ #define SYSTEM_CLKWAIT_HF   0xF
+ 
+ /*
+  * BUS Register
+  */
+ //CSn control register
+ #define BUS_CS0CR_ADDR ((volatile uint16_t*)0x00083802)
+ #define BUS_CS1CR_ADDR ((volatile uint16_t*)0x00083812)
+ #define BUS_CS2CR_ADDR ((volatile uint16_t*)0x00083822)
+ #define BUS_CS3CR_ADDR ((volatile uint16_t*)0x00083832)
+ #define BUS_CS4CR_ADDR ((volatile uint16_t*)0x00083842)
+ #define BUS_CS5CR_ADDR ((volatile uint16_t*)0x00083852)
+ #define BUS_CS6CR_ADDR ((volatile uint16_t*)0x00083862)
+ #define BUS_CS7CR_ADDR ((volatile uint16_t*)0x00083872)
+ #define BUS_CSNCR_EXENB_EN 0x1
+ #define BUS_CSNCR_EXENB_DIS 0x0
+ #define BUS_CSNCR_BSIZE_16 0x00
+ #define BUS_CSNCR_BSIZE_32 0x10
+ #define BUS_CSNCR_BSIZE_8 0x30
+ #define BUS_CSNCR_EMODE_DIF 0x100
+ #define BUS_CSNCR_EMODE_SAME 0x000
+ #define BUS_CSNCR_MPXEN_ENABLE 0x0x1000
+ #define BUS_CSNCR_MPXEN_DISABLE 0x0x0000
+ //CSn recovery cycle control register
+ #define BUS_CS0REC_ADDR ((volatile uint16_t*)0x0008380A)
+ #define BUS_CS1REC_ADDR ((volatile uint16_t*)0x0008381A)
+ #define BUS_CS2REC_ADDR ((volatile uint16_t*)0x0008382A)
+ #define BUS_CS3REC_ADDR ((volatile uint16_t*)0x0008383A)
+ #define BUS_CS4REC_ADDR ((volatile uint16_t*)0x0008384A)
+ #define BUS_CS5REC_ADDR ((volatile uint16_t*)0x0008385A)
+ #define BUS_CS6REC_ADDR ((volatile uint16_t*)0x0008386A)
+ #define BUS_CS7REC_ADDR ((volatile uint16_t*)0x0008387A)
+ #define BUS_CSNREC_RRCV_0 0x0
+ #define BUS_CSNREC_RRCV_1 0x1
+ #define BUS_CSNREC_RRCV_2 0x2
+ #define BUS_CSNREC_RRCV_3 0x3
+ #define BUS_CSNREC_RRCV_4 0x4
+ #define BUS_CSNREC_RRCV_5 0x5
+ #define BUS_CSNREC_RRCV_6 0x6
+ #define BUS_CSNREC_RRCV_7 0x7
+ #define BUS_CSNREC_RRCV_8 0x8
+ #define BUS_CSNREC_RRCV_9 0x9
+ #define BUS_CSNREC_RRCV_10 0xA
+ #define BUS_CSNREC_RRCV_11 0xB
+ #define BUS_CSNREC_RRCV_12 0xC
+ #define BUS_CSNREC_RRCV_13 0xD
+ #define BUS_CSNREC_RRCV_14 0xE
+ #define BUS_CSNREC_RRCV_15 0xF
+ #define BUS_CSNREC_WRCV_0 0x000
+ #define BUS_CSNREC_WRCV_1 0x100
+ #define BUS_CSNREC_WRCV_2 0x200
+ #define BUS_CSNREC_WRCV_3 0x300
+ #define BUS_CSNREC_WRCV_4 0x400
+ #define BUS_CSNREC_WRCV_5 0x500
+ #define BUS_CSNREC_WRCV_6 0x600
+ #define BUS_CSNREC_WRCV_7 0x700
+ #define BUS_CSNREC_WRCV_8 0x800
+ #define BUS_CSNREC_WRCV_9 0x900
+ #define BUS_CSNREC_WRCV_10 0xA00
+ #define BUS_CSNREC_WRCV_11 0xB00
+ #define BUS_CSNREC_WRCV_12 0xC00
+ #define BUS_CSNREC_WRCV_13 0xD00
+ #define BUS_CSNREC_WRCV_14 0xE00
+ #define BUS_CSNREC_WRCV_15 0xF00
+ //CS recovery cycle insert enable
+ #define BUS_CSRECEN_ADDR ((volatile uint16_t)0x00083880)
+ #define BUS_CSRECEN_RCVEN0 0x1
+ #define BUS_CSRECEN_RCVEN1 0x2
+ #define BUS_CSRECEN_RCVEN2 0x3
+ #define BUS_CSRECEN_RCVEN3 0x4
+ #define BUS_CSRECEN_RCVEN4 0x10
+ #define BUS_CSRECEN_RCVEN5 0x20
+ #define BUS_CSRECEN_RCVEN6 0x40
+ #define BUS_CSRECEN_RCVEN7 0x80
+ #define BUS_CSRECEN_RCVENM0 0x100
+ #define BUS_CSRECEN_RCVENM1 0x200
+ #define BUS_CSRECEN_RCVENM2 0x400
+ #define BUS_CSRECEN_RCVENM3 0x800
+ #define BUS_CSRECEN_RCVENM4 0x1000
+ #define BUS_CSRECEN_RCVENM5 0x2000
+ #define BUS_CSRECEN_RCVENM6 0x4000
+ #define BUS_CSRECEN_RCVENM7 0x8000
+ //CSn mode register
+ #define BUS_CS0MOD_ADDR ((volatile uint16_t*)0x00083002)
+ #define BUS_CS1MOD_ADDR ((volatile uint16_t*)0x00083012)
+ #define BUS_CS2MOD_ADDR ((volatile uint16_t*)0x00083022)
+ #define BUS_CS3MOD_ADDR ((volatile uint16_t*)0x00083032)
+ #define BUS_CS4MOD_ADDR ((volatile uint16_t*)0x00083042)
+ #define BUS_CS5MOD_ADDR ((volatile uint16_t*)0x00083052)
+ #define BUS_CS6MOD_ADDR ((volatile uint16_t*)0x00083062)
+ #define BUS_CS7MOD_ADDR ((volatile uint16_t*)0x00083072)
+ #define BUS_CSNMOD_WRMOD_BYTEST 0x0
+ #define BUS_CSNMOD_WRMOD_1WRST 0x1
+ #define BUS_CSNMOD_EWENB_EN 0x8
+ #define BUS_CSNMOD_EWENB_DIS 0x0
+ #define BUS_CSNMOD_PRENB_EN 0x100
+ #define BUS_CSNMOD_PRENB_DIS 0x0
+ #define BUS_CSNMOD_PWENB_EN 0x200
+ #define BUS_CSNMOD_PWENB_DIS 0x0
+ #define BUS_CSNMOD_PRMOD_NOMAL 0x0
+ #define BUS_CSNMOD_PRMOD_EXSEQ 0x8000
+ 
+ #define BUS_CS0WCR1_ADDR ((volatile uint32_t*)0x00083004)
+ #define BUS_CS1WCR1_ADDR ((volatile uint32_t*)0x00083014)
+ #define BUS_CS2WCR1_ADDR ((volatile uint32_t*)0x00083024)
+ #define BUS_CS3WCR1_ADDR ((volatile uint32_t*)0x00083034)
+ #define BUS_CS4WCR1_ADDR ((volatile uint32_t*)0x00083044)
+ #define BUS_CS5WCR1_ADDR ((volatile uint32_t*)0x00083054)
+ #define BUS_CS6WCR1_ADDR ((volatile uint32_t*)0x00083064)
+ #define BUS_CS7WCR1_ADDR ((volatile uint32_t*)0x00083074)
+ #define BUS_CSNWCR1_CSPWWAIT_0 0x0
+ #define BUS_CSNWCR1_CSPWWAIT_1 0x1
+ #define BUS_CSNWCR1_CSPWWAIT_2 0x2
+ #define BUS_CSNWCR1_CSPWWAIT_3 0x3
+ #define BUS_CSNWCR1_CSPWWAIT_4 0x4
+ #define BUS_CSNWCR1_CSPWWAIT_5 0x5
+ #define BUS_CSNWCR1_CSPWWAIT_6 0x6
+ #define BUS_CSNWCR1_CSPWWAIT_7 0x7
+ #define BUS_CSNWCR1_CSPRWAIT_0 0x000
+ #define BUS_CSNWCR1_CSPRWAIT_1 0x100
+ #define BUS_CSNWCR1_CSPRWAIT_2 0x200
+ #define BUS_CSNWCR1_CSPRWAIT_3 0x300
+ #define BUS_CSNWCR1_CSPRWAIT_4 0x400
+ #define BUS_CSNWCR1_CSPRWAIT_5 0x500
+ #define BUS_CSNWCR1_CSPRWAIT_6 0x600
+ #define BUS_CSNWCR1_CSPRWAIT_7 0x700
+ 
+ #define BUS_CSNWCR1_CSWWAIT_0 0x00000
+ #define BUS_CSNWCR1_CSWWAIT_1 0x10000
+ #define BUS_CSNWCR1_CSWWAIT_2 0x20000
+ #define BUS_CSNWCR1_CSWWAIT_3 0x30000
+ #define BUS_CSNWCR1_CSWWAIT_4 0x40000
+ #define BUS_CSNWCR1_CSWWAIT_5 0x50000
+ #define BUS_CSNWCR1_CSWWAIT_6 0x60000
+ #define BUS_CSNWCR1_CSWWAIT_7 0x70000
+ #define BUS_CSNWCR1_CSWWAIT_8 0x80000
+ #define BUS_CSNWCR1_CSWWAIT_9 0x90000
+ #define BUS_CSNWCR1_CSWWAIT_10 0xA0000
+ #define BUS_CSNWCR1_CSWWAIT_11 0xB0000
+ #define BUS_CSNWCR1_CSWWAIT_12 0xC0000
+ #define BUS_CSNWCR1_CSWWAIT_13 0xD0000
+ #define BUS_CSNWCR1_CSWWAIT_14 0xE0000
+ #define BUS_CSNWCR1_CSWWAIT_15 0xF0000
+ #define BUS_CSNWCR1_CSWWAIT_16 0x100000
+ #define BUS_CSNWCR1_CSWWAIT_17 0x110000
+ #define BUS_CSNWCR1_CSWWAIT_18 0x120000
+ #define BUS_CSNWCR1_CSWWAIT_19 0x130000
+ #define BUS_CSNWCR1_CSWWAIT_20 0x140000
+ #define BUS_CSNWCR1_CSWWAIT_21 0x150000
+ #define BUS_CSNWCR1_CSWWAIT_22 0x160000
+ #define BUS_CSNWCR1_CSWWAIT_23 0x170000
+ #define BUS_CSNWCR1_CSWWAIT_24 0x180000
+ #define BUS_CSNWCR1_CSWWAIT_25 0x190000
+ #define BUS_CSNWCR1_CSWWAIT_26 0x1A0000
+ #define BUS_CSNWCR1_CSWWAIT_27 0x1B0000
+ #define BUS_CSNWCR1_CSWWAIT_28 0x1C0000
+ #define BUS_CSNWCR1_CSWWAIT_29 0x1D0000
+ #define BUS_CSNWCR1_CSWWAIT_30 0x1E0000
+ #define BUS_CSNWCR1_CSWWAIT_31 0x1F0000
+ 
+ #define BUS_CSNWCR1_CSRWAIT_0 0x0000000
+ #define BUS_CSNWCR1_CSRWAIT_1 0x1000000
+ #define BUS_CSNWCR1_CSRWAIT_2 0x2000000
+ #define BUS_CSNWCR1_CSRWAIT_3 0x3000000
+ #define BUS_CSNWCR1_CSRWAIT_4 0x4000000
+ #define BUS_CSNWCR1_CSRWAIT_5 0x5000000
+ #define BUS_CSNWCR1_CSRWAIT_6 0x6000000
+ #define BUS_CSNWCR1_CSRWAIT_7 0x7000000
+ #define BUS_CSNWCR1_CSRWAIT_8 0x8000000
+ #define BUS_CSNWCR1_CSRWAIT_9 0x9000000
+ #define BUS_CSNWCR1_CSRWAIT_10 0xA000000
+ #define BUS_CSNWCR1_CSRWAIT_11 0xB000000
+ #define BUS_CSNWCR1_CSRWAIT_12 0xC000000
+ #define BUS_CSNWCR1_CSRWAIT_13 0xD000000
+ #define BUS_CSNWCR1_CSRWAIT_14 0xE000000
+ #define BUS_CSNWCR1_CSRWAIT_15 0xF000000
+ #define BUS_CSNWCR1_CSRWAIT_16 0x10000000
+ #define BUS_CSNWCR1_CSRWAIT_17 0x11000000
+ #define BUS_CSNWCR1_CSRWAIT_18 0x12000000
+ #define BUS_CSNWCR1_CSRWAIT_19 0x13000000
+ #define BUS_CSNWCR1_CSRWAIT_20 0x14000000
+ #define BUS_CSNWCR1_CSRWAIT_21 0x15000000
+ #define BUS_CSNWCR1_CSRWAIT_22 0x16000000
+ #define BUS_CSNWCR1_CSRWAIT_23 0x17000000
+ #define BUS_CSNWCR1_CSRWAIT_24 0x18000000
+ #define BUS_CSNWCR1_CSRWAIT_25 0x19000000
+ #define BUS_CSNWCR1_CSRWAIT_26 0x1A000000
+ #define BUS_CSNWCR1_CSRWAIT_27 0x1B000000
+ #define BUS_CSNWCR1_CSRWAIT_28 0x1C000000
+ #define BUS_CSNWCR1_CSRWAIT_29 0x1D000000
+ #define BUS_CSNWCR1_CSRWAIT_30 0x1E000000
+ #define BUS_CSNWCR1_CSRWAIT_31 0x1F000000
+ 
+ #define BUS_CS0WCR2_ADDR ((volatile uint32_t*)0x00083008)
+ #define BUS_CS1WCR2_ADDR ((volatile uint32_t*)0x00083018)
+ #define BUS_CS2WCR2_ADDR ((volatile uint32_t*)0x00083028)
+ #define BUS_CS3WCR2_ADDR ((volatile uint32_t*)0x00083038)
+ #define BUS_CS4WCR2_ADDR ((volatile uint32_t*)0x00083048)
+ #define BUS_CS5WCR2_ADDR ((volatile uint32_t*)0x00083058)
+ #define BUS_CS6WCR2_ADDR ((volatile uint32_t*)0x00083068)
+ #define BUS_CS7WCR2_ADDR ((volatile uint32_t*)0x00083078)
+ #define BUS_CSNWCR2_CSROFF_0 0x0
+ #define BUS_CSNWCR2_CSROFF_1 0x1
+ #define BUS_CSNWCR2_CSROFF_2 0x2
+ #define BUS_CSNWCR2_CSROFF_3 0x3
+ #define BUS_CSNWCR2_CSROFF_4 0x4
+ #define BUS_CSNWCR2_CSROFF_5 0x5
+ #define BUS_CSNWCR2_CSROFF_6 0x6
+ #define BUS_CSNWCR2_CSROFF_7 0x7
+ #define BUS_CSNWCR2_CSWOFF_0 0x0
+ #define BUS_CSNWCR2_CSWOFF_1 0x10
+ #define BUS_CSNWCR2_CSWOFF_2 0x20
+ #define BUS_CSNWCR2_CSWOFF_3 0x30
+ #define BUS_CSNWCR2_CSWOFF_4 0x40
+ #define BUS_CSNWCR2_CSWOFF_5 0x50
+ #define BUS_CSNWCR2_CSWOFF_6 0x60
+ #define BUS_CSNWCR2_CSWOFF_7 0x70
+ #define BUS_CSNWCR2_WDOFF_0 0x000
+ #define BUS_CSNWCR2_WDOFF_1 0x100
+ #define BUS_CSNWCR2_WDOFF_2 0x200
+ #define BUS_CSNWCR2_WDOFF_3 0x300
+ #define BUS_CSNWCR2_WDOFF_4 0x400
+ #define BUS_CSNWCR2_WDOFF_5 0x500
+ #define BUS_CSNWCR2_WDOFF_6 0x600
+ #define BUS_CSNWCR2_WDOFF_7 0x700
+ #define BUS_CSNWCR2_AWAIT_0 0x0000
+ #define BUS_CSNWCR2_AWAIT_1 0x1000
+ #define BUS_CSNWCR2_AWAIT_2 0x2000
+ #define BUS_CSNWCR2_AWAIT_3 0x3000
+ #define BUS_CSNWCR2_RDON_0 0x00000
+ #define BUS_CSNWCR2_RDON_1 0x10000
+ #define BUS_CSNWCR2_RDON_2 0x20000
+ #define BUS_CSNWCR2_RDON_3 0x30000
+ #define BUS_CSNWCR2_RDON_4 0x40000
+ #define BUS_CSNWCR2_RDON_5 0x50000
+ #define BUS_CSNWCR2_RDON_6 0x60000
+ #define BUS_CSNWCR2_RDON_7 0x70000
+ #define BUS_CSNWCR2_WRON_0 0x000000
+ #define BUS_CSNWCR2_WRON_1 0x100000
+ #define BUS_CSNWCR2_WRON_2 0x200000
+ #define BUS_CSNWCR2_WRON_3 0x300000
+ #define BUS_CSNWCR2_WRON_4 0x400000
+ #define BUS_CSNWCR2_WRON_5 0x500000
+ #define BUS_CSNWCR2_WRON_6 0x600000
+ #define BUS_CSNWCR2_WRON_7 0x700000
+ #define BUS_CSNWCR2_WDON_0 0x0000000
+ #define BUS_CSNWCR2_WDON_1 0x1000000
+ #define BUS_CSNWCR2_WDON_2 0x2000000
+ #define BUS_CSNWCR2_WDON_3 0x3000000
+ #define BUS_CSNWCR2_WDON_4 0x4000000
+ #define BUS_CSNWCR2_WDON_5 0x5000000
+ #define BUS_CSNWCR2_WDON_6 0x6000000
+ #define BUS_CSNWCR2_WDON_7 0x7000000
+ #define BUS_CSNWCR2_CSON_0 0x00000000
+ #define BUS_CSNWCR2_CSON_1 0x10000000
+ #define BUS_CSNWCR2_CSON_2 0x20000000
+ #define BUS_CSNWCR2_CSON_3 0x30000000
+ #define BUS_CSNWCR2_CSON_4 0x40000000
+ #define BUS_CSNWCR2_CSON_5 0x50000000
+ #define BUS_CSNWCR2_CSON_6 0x60000000
+ #define BUS_CSNWCR2_CSON_7 0x70000000
+ //SDC control register
+ #define BUS_SDCCR_ADDR ((volatile uint8_t*)0x00083C00)
+ #define BUS_SDCCR_EXENB_EN 0x1
+ #define BUS_SDCCR_EXENB_DIS 0x0
+ #define BUS_SDCCR_BSIZE_16 0x00
+ #define BUS_SDCCR_BSIZE_16 0x00
+ #define BUS_SDCCR_BSIZE_32 0x10
+ #define BUS_SDCCR_BSIZE_8 0x20
+ //SDC mode register
+ #define BUS_SDCMOD_ADDR ((volatile uint8_t*)0x00083C01)
+ #define BUS_SDCMOD_EMODE_SAME 0x0
+ #define BUS_SDCMOD_EMODE_DIFF 0x1
+ //SDRAM access mode register
+ #define BUS_SDAMOD_ADDR ((volatile uint8_t*)0x00083C02)
+ #define BUS_SDAMOD_BE_DIS 0x0
+ #define BUS_SDAMOD_BE_EN 0x1
+ //SDRAM self refresh control register
+ #define BUS_ADSELF_ADDR ((volatile uint8_t*)0x00083C10)
+ #define BUS_SDAMOD_SFEN_DIS 0x0
+ #define BUS_SDAMOD_SFEN_EN 0x1
+ //SDRAM refresh control register
+ #define BUS_SFRFCR_ADDR ((volatile uint16_t*)0x00083C14)
+ #define BUS_SFRFCR_REFW_1 0x0000
+ #define BUS_SFRFCR_REFW_2 0x1000
+ #define BUS_SFRFCR_REFW_3 0x2000
+ #define BUS_SFRFCR_REFW_4 0x3000
+ #define BUS_SFRFCR_REFW_5 0x4000
+ #define BUS_SFRFCR_REFW_6 0x5000
+ #define BUS_SFRFCR_REFW_7 0x6000
+ #define BUS_SFRFCR_REFW_8 0x7000
+ #define BUS_SFRFCR_REFW_9 0x8000
+ #define BUS_SFRFCR_REFW_10 0x9000
+ #define BUS_SFRFCR_REFW_11 0xA000
+ #define BUS_SFRFCR_REFW_12 0xB000
+ #define BUS_SFRFCR_REFW_13 0xC000
+ #define BUS_SFRFCR_REFW_14 0xD000
+ #define BUS_SFRFCR_REFW_15 0xE000
+ #define BUS_SFRFCR_REFW_16 0xF000
+ //SDRAM auto refresh control register
+ #define BUS_SDREFEN_ADDR ((volatile uint8_t*)0x00083C16)
+ #define BUS_SDREFEN_RFEN_DIS 0x0
+ #define BUS_SDREFEN_RFEN_EN 0x1
+ //SDRAM initialize sequence control regiset
+ #define BUS_SDICR_ADDR ((volatile uint8_t*)0x00083C20)
+ #define BUS_SDICR_INIRQ_START 0x1
+ //SDRAM initialize register
+ #define BUS_SDIR_ADDR ((volatile uint16_t*)0x00083C24)
+ #define BUS_SDIR_ARFI_3 0x0
+ #define BUS_SDIR_ARFI_4 0x1
+ #define BUS_SDIR_ARFI_5 0x2
+ #define BUS_SDIR_ARFI_6 0x3
+ #define BUS_SDIR_ARFI_7 0x4
+ #define BUS_SDIR_ARFI_8 0x5
+ #define BUS_SDIR_ARFI_9 0x6
+ #define BUS_SDIR_ARFI_10 0x7
+ #define BUS_SDIR_ARFI_11 0x8
+ #define BUS_SDIR_ARFI_12 0x9
+ #define BUS_SDIR_ARFI_13 0xA
+ #define BUS_SDIR_ARFI_14 0xB
+ #define BUS_SDIR_ARFI_15 0xC
+ #define BUS_SDIR_ARFI_16 0xD
+ #define BUS_SDIR_ARFI_17 0xE
+ #define BUS_SDIR_ARFI_18 0xF
+ #define BUS_SDIR_ARFC_1 0x10
+ #define BUS_SDIR_ARFC_2 0x20
+ #define BUS_SDIR_ARFC_3 0x30
+ #define BUS_SDIR_ARFC_4 0x40
+ #define BUS_SDIR_ARFC_5 0x50
+ #define BUS_SDIR_ARFC_6 0x60
+ #define BUS_SDIR_ARFC_7 0x70
+ #define BUS_SDIR_ARFC_8 0x80
+ #define BUS_SDIR_ARFC_9 0x90
+ #define BUS_SDIR_ARFC_10 0xA0
+ #define BUS_SDIR_ARFC_11 0xB0
+ #define BUS_SDIR_ARFC_12 0xC0
+ #define BUS_SDIR_ARFC_13 0xD0
+ #define BUS_SDIR_ARFC_14 0xE0
+ #define BUS_SDIR_ARFC_15 0xF0
+ #define BUS_SDIR_PRC_3 0x000
+ #define BUS_SDIR_PRC_4 0x100
+ #define BUS_SDIR_PRC_5 0x200
+ #define BUS_SDIR_PRC_6 0x300
+ #define BUS_SDIR_PRC_7 0x400
+ #define BUS_SDIR_PRC_8 0x500
+ #define BUS_SDIR_PRC_9 0x600
+ #define BUS_SDIR_PRC_10 0x700
+ //SDRAM address register
+ #define BUS_SDADR_ADDR ((volatile uint8_t*)0x00083C40)
+ #define BUS_SDADR_MXC_8 0x0
+ #define BUS_SDADR_MXC_9 0x1
+ #define BUS_SDADR_MXC_10 0x2
+ #define BUS_SDADR_MXC_11 0x3
+ //SDRAM timing register
+ #define BUS_SDTR_ADDR ((volatile uint32_t*)0x00083C44)
+ #define BUS_SDTR_CL_1 0x1
+ #define BUS_SDTR_CL_2 0x2
+ #define BUS_SDTR_CL_3 0x3
+ #define BUS_SDTR_WR_1 0x0
+ #define BUS_SDTR_WR_2 0x100
+ #define BUS_SDTR_RP_1  0x000
+ #define BUS_SDTR_RP_2  0x200
+ #define BUS_SDTR_RP_3  0x400
+ #define BUS_SDTR_RP_4  0x600
+ #define BUS_SDTR_RP_5  0x800
+ #define BUS_SDTR_RP_6  0xA00
+ #define BUS_SDTR_RP_7  0xC00
+ #define BUS_SDTR_RP_8  0xE00
+ #define BUS_SDTR_RCD_1 0x0000
+ #define BUS_SDTR_RCD_2 0x1000
+ #define BUS_SDTR_RCD_3 0x2000
+ #define BUS_SDTR_RCD_4 0x3000
+ #define BUS_SDTR_RAS_1 0x00000
+ #define BUS_SDTR_RAS_2 0x10000
+ #define BUS_SDTR_RAS_3 0x20000
+ #define BUS_SDTR_RAS_4 0x30000
+ #define BUS_SDTR_RAS_5 0x40000
+ #define BUS_SDTR_RAS_6 0x50000
+ #define BUS_SDTR_RAS_7 0x60000
+ //SDRAM mode register
+ #define BUS_SDMOD_ADDR ((volatile uint16_t*)0x00083C48)
+ //SDRAM status register
+ #define BUS_SDSR_ADDR ((volatile uint8_t*)0x00083C50)
+ #define BUS_SDSR_MRSST 0x1
+ #define BUS_SDSR_INIST 0x10
+ #define BUS_SDSR_SRFST 0x20
+ //bus error status clear register
+ #define BUS_BERCLR_ADDR ((volatile uint8_t*)0x00081300)
+ #define BUS_BERCLR_STSCLR 0x1
+ //bus error moniter enable register
+ #define BUS_BEREN_ADDR ((volatile uint8_t*)0x00081304)
+ #define BUS_BEREN_IGAEN_EN 0x1
+ #define BUS_BEREN_IGAEN_DIS 0x0
+ #define BUS_BEREN_TOEN_EN 0x2
+ #define BUS_BEREN_TOEN_DIS 0x0
+ //bus error status register 1
+ #define BUS_BERSR1_ADDR ((volatile uint8_t*)0x00081308)
+ #define BUS_BERSR1_IA 0x1
+ #define BUS_BERSR1_TO 0x2
+ #define BUS_BERSR1_MST_MASK 0x70
+ #define BUS_BERSR1_MST_CPU 0x00
+ #define BUS_BERSR1_MST_DTC_DMAC 0x30
+ #define BUS_BERSR1_MST_EDMAC 0x60
+ #define BUS_BERSR1_MST_EXDMAC 0x70
+ //bus error status register2
+ 
+ /*
+  * BUS Register
+  */
+ //CSn control register
+ #define BUS_CS0CR_ADDR ((volatile uint16_t*)0x00083802)
+ #define BUS_CS1CR_ADDR ((volatile uint16_t*)0x00083812)
+ #define BUS_CS2CR_ADDR ((volatile uint16_t*)0x00083822)
+ #define BUS_CS3CR_ADDR ((volatile uint16_t*)0x00083832)
+ #define BUS_CS4CR_ADDR ((volatile uint16_t*)0x00083842)
+ #define BUS_CS5CR_ADDR ((volatile uint16_t*)0x00083852)
+ #define BUS_CS6CR_ADDR ((volatile uint16_t*)0x00083862)
+ #define BUS_CS7CR_ADDR ((volatile uint16_t*)0x00083872)
+ #define BUS_CSNCR_EXENB_EN 0x1
+ #define BUS_CSNCR_EXENB_DIS 0x0
+ #define BUS_CSNCR_BSIZE_16 0x00
+ #define BUS_CSNCR_BSIZE_32 0x10
+ #define BUS_CSNCR_BSIZE_8 0x30
+ #define BUS_CSNCR_EMODE_DIF 0x100
+ #define BUS_CSNCR_EMODE_SAME 0x000
+ #define BUS_CSNCR_MPXEN_ENABLE 0x0x1000
+ #define BUS_CSNCR_MPXEN_DISABLE 0x0x0000
+ //CSn recovery cycle control register
+ #define BUS_CS0REC_ADDR ((volatile uint16_t*)0x0008380A)
+ #define BUS_CS1REC_ADDR ((volatile uint16_t*)0x0008381A)
+ #define BUS_CS2REC_ADDR ((volatile uint16_t*)0x0008382A)
+ #define BUS_CS3REC_ADDR ((volatile uint16_t*)0x0008383A)
+ #define BUS_CS4REC_ADDR ((volatile uint16_t*)0x0008384A)
+ #define BUS_CS5REC_ADDR ((volatile uint16_t*)0x0008385A)
+ #define BUS_CS6REC_ADDR ((volatile uint16_t*)0x0008386A)
+ #define BUS_CS7REC_ADDR ((volatile uint16_t*)0x0008387A)
+ #define BUS_CSNREC_RRCV_0 0x0
+ #define BUS_CSNREC_RRCV_1 0x1
+ #define BUS_CSNREC_RRCV_2 0x2
+ #define BUS_CSNREC_RRCV_3 0x3
+ #define BUS_CSNREC_RRCV_4 0x4
+ #define BUS_CSNREC_RRCV_5 0x5
+ #define BUS_CSNREC_RRCV_6 0x6
+ #define BUS_CSNREC_RRCV_7 0x7
+ #define BUS_CSNREC_RRCV_8 0x8
+ #define BUS_CSNREC_RRCV_9 0x9
+ #define BUS_CSNREC_RRCV_10 0xA
+ #define BUS_CSNREC_RRCV_11 0xB
+ #define BUS_CSNREC_RRCV_12 0xC
+ #define BUS_CSNREC_RRCV_13 0xD
+ #define BUS_CSNREC_RRCV_14 0xE
+ #define BUS_CSNREC_RRCV_15 0xF
+ #define BUS_CSNREC_WRCV_0 0x000
+ #define BUS_CSNREC_WRCV_1 0x100
+ #define BUS_CSNREC_WRCV_2 0x200
+ #define BUS_CSNREC_WRCV_3 0x300
+ #define BUS_CSNREC_WRCV_4 0x400
+ #define BUS_CSNREC_WRCV_5 0x500
+ #define BUS_CSNREC_WRCV_6 0x600
+ #define BUS_CSNREC_WRCV_7 0x700
+ #define BUS_CSNREC_WRCV_8 0x800
+ #define BUS_CSNREC_WRCV_9 0x900
+ #define BUS_CSNREC_WRCV_10 0xA00
+ #define BUS_CSNREC_WRCV_11 0xB00
+ #define BUS_CSNREC_WRCV_12 0xC00
+ #define BUS_CSNREC_WRCV_13 0xD00
+ #define BUS_CSNREC_WRCV_14 0xE00
+ #define BUS_CSNREC_WRCV_15 0xF00
+ //CS recovery cycle insert enable
+ #define BUS_CSRECEN_ADDR ((volatile uint16_t)0x00083880)
+ #define BUS_CSRECEN_RCVEN0 0x1
+ #define BUS_CSRECEN_RCVEN1 0x2
+ #define BUS_CSRECEN_RCVEN2 0x3
+ #define BUS_CSRECEN_RCVEN3 0x4
+ #define BUS_CSRECEN_RCVEN4 0x10
+ #define BUS_CSRECEN_RCVEN5 0x20
+ #define BUS_CSRECEN_RCVEN6 0x40
+ #define BUS_CSRECEN_RCVEN7 0x80
+ #define BUS_CSRECEN_RCVENM0 0x100
+ #define BUS_CSRECEN_RCVENM1 0x200
+ #define BUS_CSRECEN_RCVENM2 0x400
+ #define BUS_CSRECEN_RCVENM3 0x800
+ #define BUS_CSRECEN_RCVENM4 0x1000
+ #define BUS_CSRECEN_RCVENM5 0x2000
+ #define BUS_CSRECEN_RCVENM6 0x4000
+ #define BUS_CSRECEN_RCVENM7 0x8000
+ //CSn mode register
+ #define BUS_CS0MOD_ADDR ((volatile uint16_t*)0x00083002)
+ #define BUS_CS1MOD_ADDR ((volatile uint16_t*)0x00083012)
+ #define BUS_CS2MOD_ADDR ((volatile uint16_t*)0x00083022)
+ #define BUS_CS3MOD_ADDR ((volatile uint16_t*)0x00083032)
+ #define BUS_CS4MOD_ADDR ((volatile uint16_t*)0x00083042)
+ #define BUS_CS5MOD_ADDR ((volatile uint16_t*)0x00083052)
+ #define BUS_CS6MOD_ADDR ((volatile uint16_t*)0x00083062)
+ #define BUS_CS7MOD_ADDR ((volatile uint16_t*)0x00083072)
+ #define BUS_CSNMOD_WRMOD_BYTEST 0x0
+ #define BUS_CSNMOD_WRMOD_1WRST 0x1
+ #define BUS_CSNMOD_EWENB_EN 0x8
+ #define BUS_CSNMOD_EWENB_DIS 0x0
+ #define BUS_CSNMOD_PRENB_EN 0x100
+ #define BUS_CSNMOD_PRENB_DIS 0x0
+ #define BUS_CSNMOD_PWENB_EN 0x200
+ #define BUS_CSNMOD_PWENB_DIS 0x0
+ #define BUS_CSNMOD_PRMOD_NOMAL 0x0
+ #define BUS_CSNMOD_PRMOD_EXSEQ 0x8000
+ 
+ #define BUS_CS0WCR1_ADDR ((volatile uint32_t*)0x00083004)
+ #define BUS_CS1WCR1_ADDR ((volatile uint32_t*)0x00083014)
+ #define BUS_CS2WCR1_ADDR ((volatile uint32_t*)0x00083024)
+ #define BUS_CS3WCR1_ADDR ((volatile uint32_t*)0x00083034)
+ #define BUS_CS4WCR1_ADDR ((volatile uint32_t*)0x00083044)
+ #define BUS_CS5WCR1_ADDR ((volatile uint32_t*)0x00083054)
+ #define BUS_CS6WCR1_ADDR ((volatile uint32_t*)0x00083064)
+ #define BUS_CS7WCR1_ADDR ((volatile uint32_t*)0x00083074)
+ #define BUS_CSNWCR1_CSPWWAIT_0 0x0
+ #define BUS_CSNWCR1_CSPWWAIT_1 0x1
+ #define BUS_CSNWCR1_CSPWWAIT_2 0x2
+ #define BUS_CSNWCR1_CSPWWAIT_3 0x3
+ #define BUS_CSNWCR1_CSPWWAIT_4 0x4
+ #define BUS_CSNWCR1_CSPWWAIT_5 0x5
+ #define BUS_CSNWCR1_CSPWWAIT_6 0x6
+ #define BUS_CSNWCR1_CSPWWAIT_7 0x7
+ #define BUS_CSNWCR1_CSPRWAIT_0 0x000
+ #define BUS_CSNWCR1_CSPRWAIT_1 0x100
+ #define BUS_CSNWCR1_CSPRWAIT_2 0x200
+ #define BUS_CSNWCR1_CSPRWAIT_3 0x300
+ #define BUS_CSNWCR1_CSPRWAIT_4 0x400
+ #define BUS_CSNWCR1_CSPRWAIT_5 0x500
+ #define BUS_CSNWCR1_CSPRWAIT_6 0x600
+ #define BUS_CSNWCR1_CSPRWAIT_7 0x700
+ 
+ #define BUS_CSNWCR1_CSWWAIT_0 0x00000
+ #define BUS_CSNWCR1_CSWWAIT_1 0x10000
+ #define BUS_CSNWCR1_CSWWAIT_2 0x20000
+ #define BUS_CSNWCR1_CSWWAIT_3 0x30000
+ #define BUS_CSNWCR1_CSWWAIT_4 0x40000
+ #define BUS_CSNWCR1_CSWWAIT_5 0x50000
+ #define BUS_CSNWCR1_CSWWAIT_6 0x60000
+ #define BUS_CSNWCR1_CSWWAIT_7 0x70000
+ #define BUS_CSNWCR1_CSWWAIT_8 0x80000
+ #define BUS_CSNWCR1_CSWWAIT_9 0x90000
+ #define BUS_CSNWCR1_CSWWAIT_10 0xA0000
+ #define BUS_CSNWCR1_CSWWAIT_11 0xB0000
+ #define BUS_CSNWCR1_CSWWAIT_12 0xC0000
+ #define BUS_CSNWCR1_CSWWAIT_13 0xD0000
+ #define BUS_CSNWCR1_CSWWAIT_14 0xE0000
+ #define BUS_CSNWCR1_CSWWAIT_15 0xF0000
+ #define BUS_CSNWCR1_CSWWAIT_16 0x100000
+ #define BUS_CSNWCR1_CSWWAIT_17 0x110000
+ #define BUS_CSNWCR1_CSWWAIT_18 0x120000
+ #define BUS_CSNWCR1_CSWWAIT_19 0x130000
+ #define BUS_CSNWCR1_CSWWAIT_20 0x140000
+ #define BUS_CSNWCR1_CSWWAIT_21 0x150000
+ #define BUS_CSNWCR1_CSWWAIT_22 0x160000
+ #define BUS_CSNWCR1_CSWWAIT_23 0x170000
+ #define BUS_CSNWCR1_CSWWAIT_24 0x180000
+ #define BUS_CSNWCR1_CSWWAIT_25 0x190000
+ #define BUS_CSNWCR1_CSWWAIT_26 0x1A0000
+ #define BUS_CSNWCR1_CSWWAIT_27 0x1B0000
+ #define BUS_CSNWCR1_CSWWAIT_28 0x1C0000
+ #define BUS_CSNWCR1_CSWWAIT_29 0x1D0000
+ #define BUS_CSNWCR1_CSWWAIT_30 0x1E0000
+ #define BUS_CSNWCR1_CSWWAIT_31 0x1F0000
+ 
+ #define BUS_CSNWCR1_CSRWAIT_0 0x0000000
+ #define BUS_CSNWCR1_CSRWAIT_1 0x1000000
+ #define BUS_CSNWCR1_CSRWAIT_2 0x2000000
+ #define BUS_CSNWCR1_CSRWAIT_3 0x3000000
+ #define BUS_CSNWCR1_CSRWAIT_4 0x4000000
+ #define BUS_CSNWCR1_CSRWAIT_5 0x5000000
+ #define BUS_CSNWCR1_CSRWAIT_6 0x6000000
+ #define BUS_CSNWCR1_CSRWAIT_7 0x7000000
+ #define BUS_CSNWCR1_CSRWAIT_8 0x8000000
+ #define BUS_CSNWCR1_CSRWAIT_9 0x9000000
+ #define BUS_CSNWCR1_CSRWAIT_10 0xA000000
+ #define BUS_CSNWCR1_CSRWAIT_11 0xB000000
+ #define BUS_CSNWCR1_CSRWAIT_12 0xC000000
+ #define BUS_CSNWCR1_CSRWAIT_13 0xD000000
+ #define BUS_CSNWCR1_CSRWAIT_14 0xE000000
+ #define BUS_CSNWCR1_CSRWAIT_15 0xF000000
+ #define BUS_CSNWCR1_CSRWAIT_16 0x10000000
+ #define BUS_CSNWCR1_CSRWAIT_17 0x11000000
+ #define BUS_CSNWCR1_CSRWAIT_18 0x12000000
+ #define BUS_CSNWCR1_CSRWAIT_19 0x13000000
+ #define BUS_CSNWCR1_CSRWAIT_20 0x14000000
+ #define BUS_CSNWCR1_CSRWAIT_21 0x15000000
+ #define BUS_CSNWCR1_CSRWAIT_22 0x16000000
+ #define BUS_CSNWCR1_CSRWAIT_23 0x17000000
+ #define BUS_CSNWCR1_CSRWAIT_24 0x18000000
+ #define BUS_CSNWCR1_CSRWAIT_25 0x19000000
+ #define BUS_CSNWCR1_CSRWAIT_26 0x1A000000
+ #define BUS_CSNWCR1_CSRWAIT_27 0x1B000000
+ #define BUS_CSNWCR1_CSRWAIT_28 0x1C000000
+ #define BUS_CSNWCR1_CSRWAIT_29 0x1D000000
+ #define BUS_CSNWCR1_CSRWAIT_30 0x1E000000
+ #define BUS_CSNWCR1_CSRWAIT_31 0x1F000000
+ 
+ #define BUS_CS0WCR2_ADDR ((volatile uint32_t*)0x00083008)
+ #define BUS_CS1WCR2_ADDR ((volatile uint32_t*)0x00083018)
+ #define BUS_CS2WCR2_ADDR ((volatile uint32_t*)0x00083028)
+ #define BUS_CS3WCR2_ADDR ((volatile uint32_t*)0x00083038)
+ #define BUS_CS4WCR2_ADDR ((volatile uint32_t*)0x00083048)
+ #define BUS_CS5WCR2_ADDR ((volatile uint32_t*)0x00083058)
+ #define BUS_CS6WCR2_ADDR ((volatile uint32_t*)0x00083068)
+ #define BUS_CS7WCR2_ADDR ((volatile uint32_t*)0x00083078)
+ #define BUS_CSNWCR2_CSROFF_0 0x0
+ #define BUS_CSNWCR2_CSROFF_1 0x1
+ #define BUS_CSNWCR2_CSROFF_2 0x2
+ #define BUS_CSNWCR2_CSROFF_3 0x3
+ #define BUS_CSNWCR2_CSROFF_4 0x4
+ #define BUS_CSNWCR2_CSROFF_5 0x5
+ #define BUS_CSNWCR2_CSROFF_6 0x6
+ #define BUS_CSNWCR2_CSROFF_7 0x7
+ #define BUS_CSNWCR2_CSWOFF_0 0x0
+ #define BUS_CSNWCR2_CSWOFF_1 0x10
+ #define BUS_CSNWCR2_CSWOFF_2 0x20
+ #define BUS_CSNWCR2_CSWOFF_3 0x30
+ #define BUS_CSNWCR2_CSWOFF_4 0x40
+ #define BUS_CSNWCR2_CSWOFF_5 0x50
+ #define BUS_CSNWCR2_CSWOFF_6 0x60
+ #define BUS_CSNWCR2_CSWOFF_7 0x70
+ #define BUS_CSNWCR2_WDOFF_0 0x000
+ #define BUS_CSNWCR2_WDOFF_1 0x100
+ #define BUS_CSNWCR2_WDOFF_2 0x200
+ #define BUS_CSNWCR2_WDOFF_3 0x300
+ #define BUS_CSNWCR2_WDOFF_4 0x400
+ #define BUS_CSNWCR2_WDOFF_5 0x500
+ #define BUS_CSNWCR2_WDOFF_6 0x600
+ #define BUS_CSNWCR2_WDOFF_7 0x700
+ #define BUS_CSNWCR2_AWAIT_0 0x0000
+ #define BUS_CSNWCR2_AWAIT_1 0x1000
+ #define BUS_CSNWCR2_AWAIT_2 0x2000
+ #define BUS_CSNWCR2_AWAIT_3 0x3000
+ #define BUS_CSNWCR2_RDON_0 0x00000
+ #define BUS_CSNWCR2_RDON_1 0x10000
+ #define BUS_CSNWCR2_RDON_2 0x20000
+ #define BUS_CSNWCR2_RDON_3 0x30000
+ #define BUS_CSNWCR2_RDON_4 0x40000
+ #define BUS_CSNWCR2_RDON_5 0x50000
+ #define BUS_CSNWCR2_RDON_6 0x60000
+ #define BUS_CSNWCR2_RDON_7 0x70000
+ #define BUS_CSNWCR2_WRON_0 0x000000
+ #define BUS_CSNWCR2_WRON_1 0x100000
+ #define BUS_CSNWCR2_WRON_2 0x200000
+ #define BUS_CSNWCR2_WRON_3 0x300000
+ #define BUS_CSNWCR2_WRON_4 0x400000
+ #define BUS_CSNWCR2_WRON_5 0x500000
+ #define BUS_CSNWCR2_WRON_6 0x600000
+ #define BUS_CSNWCR2_WRON_7 0x700000
+ #define BUS_CSNWCR2_WDON_0 0x0000000
+ #define BUS_CSNWCR2_WDON_1 0x1000000
+ #define BUS_CSNWCR2_WDON_2 0x2000000
+ #define BUS_CSNWCR2_WDON_3 0x3000000
+ #define BUS_CSNWCR2_WDON_4 0x4000000
+ #define BUS_CSNWCR2_WDON_5 0x5000000
+ #define BUS_CSNWCR2_WDON_6 0x6000000
+ #define BUS_CSNWCR2_WDON_7 0x7000000
+ #define BUS_CSNWCR2_CSON_0 0x00000000
+ #define BUS_CSNWCR2_CSON_1 0x10000000
+ #define BUS_CSNWCR2_CSON_2 0x20000000
+ #define BUS_CSNWCR2_CSON_3 0x30000000
+ #define BUS_CSNWCR2_CSON_4 0x40000000
+ #define BUS_CSNWCR2_CSON_5 0x50000000
+ #define BUS_CSNWCR2_CSON_6 0x60000000
+ #define BUS_CSNWCR2_CSON_7 0x70000000
+ //SDC control register
+ #define BUS_SDCCR_ADDR ((volatile uint8_t*)0x00083C00)
+ #define BUS_SDCCR_EXENB_EN 0x1
+ #define BUS_SDCCR_EXENB_DIS 0x0
+ #define BUS_SDCCR_BSIZE_16 0x00
+ #define BUS_SDCCR_BSIZE_16 0x00
+ #define BUS_SDCCR_BSIZE_32 0x10
+ #define BUS_SDCCR_BSIZE_8 0x20
+ //SDC mode register
+ #define BUS_SDCMOD_ADDR ((volatile uint8_t*)0x00083C01)
+ #define BUS_SDCMOD_EMODE_SAME 0x0
+ #define BUS_SDCMOD_EMODE_DIFF 0x1
+ //SDRAM access mode register
+ #define BUS_SDAMOD_ADDR ((volatile uint8_t*)0x00083C02)
+ #define BUS_SDAMOD_BE_DIS 0x0
+ #define BUS_SDAMOD_BE_EN 0x1
+ //SDRAM self refresh control register
+ #define BUS_ADSELF_ADDR ((volatile uint8_t*)0x00083C10)
+ #define BUS_SDAMOD_SFEN_DIS 0x0
+ #define BUS_SDAMOD_SFEN_EN 0x1
+ //SDRAM refresh control register
+ #define BUS_SFRFCR_ADDR ((volatile uint16_t*)0x00083C14)
+ #define BUS_SFRFCR_REFW_1 0x0000
+ #define BUS_SFRFCR_REFW_2 0x1000
+ #define BUS_SFRFCR_REFW_3 0x2000
+ #define BUS_SFRFCR_REFW_4 0x3000
+ #define BUS_SFRFCR_REFW_5 0x4000
+ #define BUS_SFRFCR_REFW_6 0x5000
+ #define BUS_SFRFCR_REFW_7 0x6000
+ #define BUS_SFRFCR_REFW_8 0x7000
+ #define BUS_SFRFCR_REFW_9 0x8000
+ #define BUS_SFRFCR_REFW_10 0x9000
+ #define BUS_SFRFCR_REFW_11 0xA000
+ #define BUS_SFRFCR_REFW_12 0xB000
+ #define BUS_SFRFCR_REFW_13 0xC000
+ #define BUS_SFRFCR_REFW_14 0xD000
+ #define BUS_SFRFCR_REFW_15 0xE000
+ #define BUS_SFRFCR_REFW_16 0xF000
+ //SDRAM auto refresh control register
+ #define BUS_SDREFEN_ADDR ((volatile uint8_t*)0x00083C16)
+ #define BUS_SDREFEN_RFEN_DIS 0x0
+ #define BUS_SDREFEN_RFEN_EN 0x1
+ //SDRAM initialize sequence control regiset
+ #define BUS_SDICR_ADDR ((volatile uint8_t*)0x00083C20)
+ #define BUS_SDICR_INIRQ_START 0x1
+ //SDRAM initialize register
+ #define BUS_SDIR_ADDR ((volatile uint16_t*)0x00083C24)
+ #define BUS_SDIR_ARFI_3 0x0
+ #define BUS_SDIR_ARFI_4 0x1
+ #define BUS_SDIR_ARFI_5 0x2
+ #define BUS_SDIR_ARFI_6 0x3
+ #define BUS_SDIR_ARFI_7 0x4
+ #define BUS_SDIR_ARFI_8 0x5
+ #define BUS_SDIR_ARFI_9 0x6
+ #define BUS_SDIR_ARFI_10 0x7
+ #define BUS_SDIR_ARFI_11 0x8
+ #define BUS_SDIR_ARFI_12 0x9
+ #define BUS_SDIR_ARFI_13 0xA
+ #define BUS_SDIR_ARFI_14 0xB
+ #define BUS_SDIR_ARFI_15 0xC
+ #define BUS_SDIR_ARFI_16 0xD
+ #define BUS_SDIR_ARFI_17 0xE
+ #define BUS_SDIR_ARFI_18 0xF
+ #define BUS_SDIR_ARFC_1 0x10
+ #define BUS_SDIR_ARFC_2 0x20
+ #define BUS_SDIR_ARFC_3 0x30
+ #define BUS_SDIR_ARFC_4 0x40
+ #define BUS_SDIR_ARFC_5 0x50
+ #define BUS_SDIR_ARFC_6 0x60
+ #define BUS_SDIR_ARFC_7 0x70
+ #define BUS_SDIR_ARFC_8 0x80
+ #define BUS_SDIR_ARFC_9 0x90
+ #define BUS_SDIR_ARFC_10 0xA0
+ #define BUS_SDIR_ARFC_11 0xB0
+ #define BUS_SDIR_ARFC_12 0xC0
+ #define BUS_SDIR_ARFC_13 0xD0
+ #define BUS_SDIR_ARFC_14 0xE0
+ #define BUS_SDIR_ARFC_15 0xF0
+ #define BUS_SDIR_PRC_3 0x000
+ #define BUS_SDIR_PRC_4 0x100
+ #define BUS_SDIR_PRC_5 0x200
+ #define BUS_SDIR_PRC_6 0x300
+ #define BUS_SDIR_PRC_7 0x400
+ #define BUS_SDIR_PRC_8 0x500
+ #define BUS_SDIR_PRC_9 0x600
+ #define BUS_SDIR_PRC_10 0x700
+ //SDRAM address register
+ #define BUS_SDADR_ADDR ((volatile uint8_t*)0x00083C40)
+ #define BUS_SDADR_MXC_8 0x0
+ #define BUS_SDADR_MXC_9 0x1
+ #define BUS_SDADR_MXC_10 0x2
+ #define BUS_SDADR_MXC_11 0x3
+ //SDRAM timing register
+ #define BUS_SDTR_ADDR ((volatile uint32_t*)0x00083C44)
+ #define BUS_SDTR_CL_1 0x1
+ #define BUS_SDTR_CL_2 0x2
+ #define BUS_SDTR_CL_3 0x3
+ #define BUS_SDTR_WR_1 0x0
+ #define BUS_SDTR_WR_2 0x100
+ #define BUS_SDTR_RP_1  0x000
+ #define BUS_SDTR_RP_2  0x200
+ #define BUS_SDTR_RP_3  0x400
+ #define BUS_SDTR_RP_4  0x600
+ #define BUS_SDTR_RP_5  0x800
+ #define BUS_SDTR_RP_6  0xA00
+ #define BUS_SDTR_RP_7  0xC00
+ #define BUS_SDTR_RP_8  0xE00
+ #define BUS_SDTR_RCD_1 0x0000
+ #define BUS_SDTR_RCD_2 0x1000
+ #define BUS_SDTR_RCD_3 0x2000
+ #define BUS_SDTR_RCD_4 0x3000
+ #define BUS_SDTR_RAS_1 0x00000
+ #define BUS_SDTR_RAS_2 0x10000
+ #define BUS_SDTR_RAS_3 0x20000
+ #define BUS_SDTR_RAS_4 0x30000
+ #define BUS_SDTR_RAS_5 0x40000
+ #define BUS_SDTR_RAS_6 0x50000
+ #define BUS_SDTR_RAS_7 0x60000
+ //SDRAM mode register
+ #define BUS_SDMOD_ADDR ((volatile uint16_t*)0x00083C48)
+ //SDRAM status register
+ #define BUS_SDSR_ADDR ((volatile uint8_t*)0x00083C50)
+ #define BUS_SDSR_MRSST 0x1
+ #define BUS_SDSR_INIST 0x10
+ #define BUS_SDSR_SRFST 0x20
+ //bus error status clear register
+ #define BUS_BERCLR_ADDR ((volatile uint8_t*)0x00081300)
+ #define BUS_BERCLR_STSCLR 0x1
+ //bus error moniter enable register
+ #define BUS_BEREN_ADDR ((volatile uint8_t*)0x00081304)
+ #define BUS_BEREN_IGAEN_EN 0x1
+ #define BUS_BEREN_IGAEN_DIS 0x0
+ #define BUS_BEREN_TOEN_EN 0x2
+ #define BUS_BEREN_TOEN_DIS 0x0
+ //bus error status register 1
+ #define BUS_BERSR1_ADDR ((volatile uint8_t*)0x00081308)
+ #define BUS_BERSR1_IA 0x1
+ #define BUS_BERSR1_TO 0x2
+ #define BUS_BERSR1_MST_MASK 0x70
+ #define BUS_BERSR1_MST_CPU 0x00
+ #define BUS_BERSR1_MST_DTC_DMAC 0x30
+ #define BUS_BERSR1_MST_EDMAC 0x60
+ #define BUS_BERSR1_MST_EXDMAC 0x70
+ //bus error status register2
+ #define BUS_ADDR_ADDR ((volatile uint16_t*)0x0008130A)
+ //bus priority control register
+ #define BUS_BUSPRI_ADDR ((volatile uint16_t*)0x00081310)
+ #define BUS_BUSPRI_BPRA_CONST 0x0
+ #define BUS_BUSPRI_BPRA_TOGGL 0x1
+ #define BUS_BUSPRI_BPRO_CONST 0x0
+ #define BUS_BUSPRI_BPRO_TOGGL 0x4
+ #define BUS_BUSPRI_BPIB_CONST 0x00
+ #define BUS_BUSPRI_BPIB_TOGGL 0x10
+ #define BUS_BUSPRI_BPGB_CONST 0x00
+ #define BUS_BUSPRI_BPGB_TOGGL 0x40
+ #define BUS_BUSPRI_BPHB_CONST 0x000
+ #define BUS_BUSPRI_BPHB_TOGGL 0x100
+ #define BUS_BUSPRI_BPFB_CONST 0x000
+ #define BUS_BUSPRI_BPFB_TOGGL 0x400
+ #define BUS_BUSPRI_BPEB_CONST 0x0000
+ #define BUS_BUSPRI_BPEB_TOGGL 0x1000
+ 
+ /*
+  * 割り込み要求レジスタ
+  */
+ 
+ #define ICU_IR_BASE 0x00087000
+ #define ICU_IR_BIT				( 1U << 0U )
+ 
+ 
+ /*
+  * 割り込み要求許可レジスタ
+  */
+ #define ICU_IER_BASE 0x00087200
+ 
+ 
+ /*
+  * 割り込み要因プライオリティレジスタi(i=00h?8Fh)の設定
+  */
+ #define ICU_IPR_BASE  0x00087300
+ #define ICU_IPR00_OFFSET 0
+ #define ICU_IPR01_OFFSET 1
+ #define ICU_IPR02_OFFSET 2
+ #define ICU_IPR03_OFFSET 3
+ #define ICU_IPR04_OFFSET 4
+ #define ICU_IPR05_OFFSET 5
+ #define ICU_IPR06_OFFSET 6
+ #define ICU_IPR07_OFFSET 7
+ #define ICU_IPR08_OFFSET 8
+ #define ICU_IPR09_OFFSET 9
+ #define ICU_IPR0A_OFFSET 10
+ #define ICU_IPR0B_OFFSET 11
+ #define ICU_IPR0C_OFFSET 12
+ #define ICU_IPR0D_OFFSET 13
+ #define ICU_IPR0E_OFFSET 14
+ #define ICU_IPR0F_OFFSET 15
+ #define ICU_IPR10_OFFSET 16
+ #define ICU_IPR11_OFFSET 17
+ #define ICU_IPR12_OFFSET 18
+ #define ICU_IPR13_OFFSET 19
+ #define ICU_IPR14_OFFSET 20
+ #define ICU_IPR15_OFFSET 21
+ #define ICU_IPR16_OFFSET 22
+ #define ICU_IPR17_OFFSET 23
+ #define ICU_IPR18_OFFSET 24
+ #define ICU_IPR19_OFFSET 25
+ #define ICU_IPR1A_OFFSET 26
+ #define ICU_IPR1B_OFFSET 27
+ #define ICU_IPR1C_OFFSET 28
+ #define ICU_IPR1D_OFFSET 29
+ #define ICU_IPR1E_OFFSET 30
+ #define ICU_IPR1F_OFFSET 31
+ #define ICU_IPR20_OFFSET 32
+ #define ICU_IPR21_OFFSET 33
+ #define ICU_IPR22_OFFSET 34
+ #define ICU_IPR23_OFFSET 35
+ #define ICU_IPR24_OFFSET 36
+ #define ICU_IPR25_OFFSET 37
+ #define ICU_IPR26_OFFSET 38
+ #define ICU_IPR27_OFFSET 39
+ #define ICU_IPR28_OFFSET 40
+ #define ICU_IPR29_OFFSET 41
+ #define ICU_IPR2A_OFFSET 42
+ #define ICU_IPR2B_OFFSET 43
+ #define ICU_IPR2C_OFFSET 44
+ #define ICU_IPR2D_OFFSET 45
+ #define ICU_IPR2E_OFFSET 46
+ #define ICU_IPR2F_OFFSET 47
+ #define ICU_IPR30_OFFSET 48
+ #define ICU_IPR31_OFFSET 49
+ #define ICU_IPR32_OFFSET 50
+ #define ICU_IPR33_OFFSET 51
+ #define ICU_IPR34_OFFSET 52
+ #define ICU_IPR35_OFFSET 53
+ #define ICU_IPR36_OFFSET 54
+ #define ICU_IPR37_OFFSET 55
+ #define ICU_IPR38_OFFSET 56
+ #define ICU_IPR39_OFFSET 57
+ #define ICU_IPR3A_OFFSET 58
+ #define ICU_IPR3B_OFFSET 59
+ #define ICU_IPR3C_OFFSET 60
+ #define ICU_IPR3D_OFFSET 61
+ #define ICU_IPR3E_OFFSET 62
+ #define ICU_IPR3F_OFFSET 63
+ #define ICU_IPR40_OFFSET 64
+ #define ICU_IPR41_OFFSET 65
+ #define ICU_IPR42_OFFSET 66
+ #define ICU_IPR43_OFFSET 67
+ #define ICU_IPR44_OFFSET 68
+ #define ICU_IPR45_OFFSET 69
+ #define ICU_IPR46_OFFSET 70
+ #define ICU_IPR47_OFFSET 71
+ #define ICU_IPR48_OFFSET 72
+ #define ICU_IPR49_OFFSET 73
+ #define ICU_IPR4A_OFFSET 74
+ #define ICU_IPR4B_OFFSET 75
+ #define ICU_IPR4C_OFFSET 76
+ #define ICU_IPR4D_OFFSET 77
+ #define ICU_IPR4E_OFFSET 78
+ #define ICU_IPR4F_OFFSET 79
+ #define ICU_IPR50_OFFSET 80
+ #define ICU_IPR51_OFFSET 81
+ #define ICU_IPR52_OFFSET 82
+ #define ICU_IPR53_OFFSET 83
+ #define ICU_IPR54_OFFSET 84
+ #define ICU_IPR55_OFFSET 85
+ #define ICU_IPR56_OFFSET 86
+ #define ICU_IPR57_OFFSET 87
+ #define ICU_IPR58_OFFSET 88
+ #define ICU_IPR59_OFFSET 89
+ #define ICU_IPR5A_OFFSET 90
+ #define ICU_IPR5B_OFFSET 91
+ #define ICU_IPR5C_OFFSET 92
+ #define ICU_IPR5D_OFFSET 93
+ #define ICU_IPR5E_OFFSET 94
+ #define ICU_IPR5F_OFFSET 95
+ #define ICU_IPR60_OFFSET 96
+ #define ICU_IPR61_OFFSET 97
+ #define ICU_IPR62_OFFSET 98
+ #define ICU_IPR63_OFFSET 99
+ #define ICU_IPR64_OFFSET 100
+ #define ICU_IPR65_OFFSET 101
+ #define ICU_IPR66_OFFSET 102
+ #define ICU_IPR67_OFFSET 103
+ #define ICU_IPR68_OFFSET 104
+ #define ICU_IPR69_OFFSET 105
+ #define ICU_IPR6A_OFFSET 106
+ #define ICU_IPR6B_OFFSET 107
+ #define ICU_IPR6C_OFFSET 108
+ #define ICU_IPR6D_OFFSET 109
+ #define ICU_IPR6E_OFFSET 110
+ #define ICU_IPR6F_OFFSET 111
+ #define ICU_IPR70_OFFSET 112
+ #define ICU_IPR71_OFFSET 113
+ #define ICU_IPR72_OFFSET 114
+ #define ICU_IPR73_OFFSET 115
+ #define ICU_IPR74_OFFSET 116
+ #define ICU_IPR75_OFFSET 117
+ #define ICU_IPR76_OFFSET 118
+ #define ICU_IPR77_OFFSET 119
+ #define ICU_IPR78_OFFSET 120
+ #define ICU_IPR79_OFFSET 121
+ #define ICU_IPR7A_OFFSET 122
+ #define ICU_IPR7B_OFFSET 123
+ #define ICU_IPR7C_OFFSET 124
+ #define ICU_IPR7D_OFFSET 125
+ #define ICU_IPR7E_OFFSET 126
+ #define ICU_IPR7F_OFFSET 127
+ #define ICU_IPR80_OFFSET 128
+ #define ICU_IPR81_OFFSET 129
+ #define ICU_IPR82_OFFSET 130
+ #define ICU_IPR83_OFFSET 131
+ #define ICU_IPR84_OFFSET 132
+ #define ICU_IPR85_OFFSET 133
+ #define ICU_IPR86_OFFSET 134
+ #define ICU_IPR87_OFFSET 135
+ #define ICU_IPR88_OFFSET 136
+ #define ICU_IPR89_OFFSET 137
+ #define ICU_IPR8A_OFFSET 138
+ #define ICU_IPR8B_OFFSET 139
+ #define ICU_IPR8C_OFFSET 140
+ #define ICU_IPR8D_OFFSET 141
+ #define ICU_IPR8E_OFFSET 142
+ #define ICU_IPR8F_OFFSET 143
+ #define ICU_IPR90_OFFSET 144
+ #define ICU_IPR91_OFFSET 145
+ #define ICU_IPR92_OFFSET 146
+ #define ICU_IPR93_OFFSET 147
+ #define ICU_IPR94_OFFSET 148
+ #define ICU_IPR95_OFFSET 149
+ #define ICU_IPR96_OFFSET 150
+ #define ICU_IPR97_OFFSET 151
+ #define ICU_IPR98_OFFSET 152
+ #define ICU_IPR99_OFFSET 153
+ #define ICU_IPR9A_OFFSET 154
+ #define ICU_IPR9B_OFFSET 155
+ #define ICU_IPR9C_OFFSET 156
+ #define ICU_IPR9D_OFFSET 157
+ #define ICU_IPR9E_OFFSET 158
+ #define ICU_IPR9F_OFFSET 159
+ #define ICU_IPRA0_OFFSET 160
+ #define ICU_IPRA1_OFFSET 161
+ #define ICU_IPRA2_OFFSET 162
+ #define ICU_IPRA3_OFFSET 163
+ #define ICU_IPRA4_OFFSET 164
+ #define ICU_IPRA5_OFFSET 165
+ #define ICU_IPRA6_OFFSET 166
+ #define ICU_IPRA7_OFFSET 167
+ #define ICU_IPRA8_OFFSET 168
+ #define ICU_IPRA9_OFFSET 169
+ #define ICU_IPRAA_OFFSET 170
+ #define ICU_IPRAB_OFFSET 171
+ #define ICU_IPRAC_OFFSET 172
+ #define ICU_IPRAD_OFFSET 173
+ #define ICU_IPRAE_OFFSET 174
+ #define ICU_IPRAF_OFFSET 175
+ #define ICU_IPRB0_OFFSET 176
+ #define ICU_IPRB1_OFFSET 177
+ #define ICU_IPRB2_OFFSET 178
+ #define ICU_IPRB3_OFFSET 179
+ #define ICU_IPRB4_OFFSET 180
+ #define ICU_IPRB5_OFFSET 181
+ #define ICU_IPRB6_OFFSET 182
+ #define ICU_IPRB7_OFFSET 183
+ #define ICU_IPRB8_OFFSET 184
+ #define ICU_IPRB9_OFFSET 185
+ #define ICU_IPRBA_OFFSET 186
+ #define ICU_IPRBB_OFFSET 187
+ #define ICU_IPRBC_OFFSET 188
+ #define ICU_IPRBD_OFFSET 189
+ #define ICU_IPRBE_OFFSET 190
+ #define ICU_IPRBF_OFFSET 191
+ #define ICU_IPRC0_OFFSET 192
+ #define ICU_IPRC1_OFFSET 193
+ #define ICU_IPRC2_OFFSET 194
+ #define ICU_IPRC3_OFFSET 195
+ #define ICU_IPRC4_OFFSET 196
+ #define ICU_IPRC5_OFFSET 197
+ #define ICU_IPRC6_OFFSET 198
+ #define ICU_IPRC7_OFFSET 199
+ #define ICU_IPRC8_OFFSET 200
+ #define ICU_IPRC9_OFFSET 201
+ #define ICU_IPRCA_OFFSET 202
+ #define ICU_IPRCB_OFFSET 203
+ #define ICU_IPRCC_OFFSET 204
+ #define ICU_IPRCD_OFFSET 205
+ #define ICU_IPRCE_OFFSET 206
+ #define ICU_IPRCF_OFFSET 207
+ #define ICU_IPRD0_OFFSET 208
+ #define ICU_IPRD1_OFFSET 209
+ #define ICU_IPRD2_OFFSET 210
+ #define ICU_IPRD3_OFFSET 211
+ #define ICU_IPRD4_OFFSET 212
+ #define ICU_IPRD5_OFFSET 213
+ #define ICU_IPRD6_OFFSET 214
+ #define ICU_IPRD7_OFFSET 215
+ #define ICU_IPRD8_OFFSET 216
+ #define ICU_IPRD9_OFFSET 217
+ #define ICU_IPRDA_OFFSET 218
+ #define ICU_IPRDB_OFFSET 219
+ #define ICU_IPRDC_OFFSET 220
+ #define ICU_IPRDD_OFFSET 221
+ #define ICU_IPRDE_OFFSET 222
+ #define ICU_IPRDF_OFFSET 223
+ #define ICU_IPRE0_OFFSET 224
+ #define ICU_IPRE1_OFFSET 225
+ #define ICU_IPRE2_OFFSET 226
+ #define ICU_IPRE3_OFFSET 227
+ #define ICU_IPRE4_OFFSET 228
+ #define ICU_IPRE5_OFFSET 229
+ #define ICU_IPRE6_OFFSET 230
+ #define ICU_IPRE7_OFFSET 231
+ #define ICU_IPRE8_OFFSET 232
+ #define ICU_IPRE9_OFFSET 233
+ #define ICU_IPREA_OFFSET 234
+ #define ICU_IPREB_OFFSET 235
+ #define ICU_IPREC_OFFSET 236
+ #define ICU_IPRED_OFFSET 237
+ #define ICU_IPREE_OFFSET 238
+ #define ICU_IPREF_OFFSET 239
+ #define ICU_IPRF0_OFFSET 240
+ #define ICU_IPRF1_OFFSET 241
+ #define ICU_IPRF2_OFFSET 242
+ #define ICU_IPRF3_OFFSET 243
+ #define ICU_IPRF4_OFFSET 244
+ #define ICU_IPRF5_OFFSET 245
+ #define ICU_IPRF6_OFFSET 246
+ #define ICU_IPRF7_OFFSET 247
+ #define ICU_IPRF8_OFFSET 248
+ #define ICU_IPRF9_OFFSET 249
+ #define ICU_IPRFA_OFFSET 250
+ #define ICU_IPRFB_OFFSET 251
+ #define ICU_IPRFC_OFFSET 252
+ #define ICU_IPRFD_OFFSET 253
+ #define ICU_IPRFE_OFFSET 254
+ #define ICU_IPRFF_OFFSET 255
+ #define ICU_IPR_BIT				( 7U << 0U )
+ 
+ /*
+  * DTCER Register
+  */
+ #define ICU_DTCER_BASE 0x00087100
+ #define EN_ICU_DTCER_BIT 0x1
+ #define DIS_ICU_DTCER_BIT 0x0
+ 
+ #ifndef TOPPERS_MACRO_ONLY
+ #define ENABLE_ICU_DTCER(intno)  (*((volatile uint8_t *)(ICU_DTCER_BASE + intno)) = EN_ICU_DTCER_BIT)
+ 
+ #define DISABLE_ICU_DTCER(intno) (*((volatile uint8_t *)(ICU_DTCER_BASE + intno)) = DIS_ICU_DTCER_BIT)
+ #endif
+ 
+ 
+ #define ICU_IRQCR_BASE 0x00087500
+ #define SET_ICU_IRQCR(intno, sel_edge) (*((volatile uint8_t *)(ICU_IRQCR_BASE | intno)) = sel_edge)
+ 
+ /*
+  * DTCa address define
+  */
+ 
+ #define DTCA_BASE_ADDR 0x00082400
+ 
+ /*
+  *  各チャンネルのレジスタ及び設定ビット情報
+  */
+ 
+ #define CMT_CMSTR0_ADDR			( ( volatile uint16_t  * )0x00088000 )
+ #define CMT_CMSTR0_STR0_BIT		( 1U << 0U )
+ #define CMT_CMSTR0_STR1_BIT		( 1U << 1U )
+ #define CMT_CMSTR1_ADDR			( ( volatile uint16_t  * )0x00088010 )
+ #define CMT_CMSTR1_STR2_BIT		( 1U << 0U )
+ #define CMT_CMSTR1_STR3_BIT		( 1U << 1U )
+ #define CMT0_CMCR_ADDR			( ( volatile uint16_t  * )0x00088002 )
+ #define CMT0_CMCR_CKS_BIT		( 3U )
+ #define CMT0_CMCR_CMIE_BIT		( 1U << 6U )
+ #define CMT1_CMCR_ADDR			( ( volatile uint16_t  * )0x00088008 )
+ #define CMT1_CMCR_CKS_BIT		( 3U )
+ #define CMT1_CMCR_CMIE_BIT		( 1U << 6U )
+ #define CMT2_CMCR_ADDR			( ( volatile uint16_t  * )0x00088012 )
+ #define CMT2_CMCR_CKS_BIT		( 3U)
+ #define CMT2_CMCR_CMIE_BIT		( 1U << 6U )
+ #define CMT3_CMCR_ADDR			( ( volatile uint16_t  * )0x00088018 )
+ #define CMT3_CMCR_CKS_BIT		( 3U )
+ #define CMT3_CMCR_CMIE_BIT		( 1U << 6U )
+ #define CMT0_CMCNT_ADDR			( ( volatile uint16_t  * )0x00088004 )
+ #define CMT1_CMCNT_ADDR			( ( volatile uint16_t  * )0x0008800A )
+ #define CMT2_CMCNT_ADDR			( ( volatile uint16_t  * )0x00088014 )
+ #define CMT3_CMCNT_ADDR			( ( volatile uint16_t  * )0x0008801A )
+ #define CMT0_CMCOR_ADDR			( ( volatile uint16_t  * )0x00088006 )
+ #define CMT1_CMCOR_ADDR			( ( volatile uint16_t  * )0x0008800C )
+ #define CMT2_CMCOR_ADDR			( ( volatile uint16_t  * )0x00088016 )
+ #define CMT3_CMCOR_ADDR			( ( volatile uint16_t  * )0x0008801C )
+ 
+ #define SCI0_SMR_ADDR			( ( volatile uint8_t  * )0x0008A000 )
+ #define SCI0_BRR_ADDR			( ( volatile uint8_t  * )0x0008A001 )
+ #define SCI0_SCR_ADDR			( ( volatile uint8_t  * )0x0008A002 )
+ #define SCI0_TDR_ADDR			( ( volatile uint8_t  * )0x0008A003 )
+ #define SCI0_SSR_ADDR			( ( volatile uint8_t  * )0x0008A004 )
+ #define SCI0_RDR_ADDR			( ( volatile uint8_t  * )0x0008A005 )
+ #define SCI0_SCMR_ADDR			( ( volatile uint8_t  * )0x0008A006 )
+ #define SCI0_SEMR_ADDR			( ( volatile uint8_t  * )0x0008A007 )
+ #define SCI1_SMR_ADDR			( ( volatile uint8_t  * )0x0008A020 )
+ #define SCI1_BRR_ADDR			( ( volatile uint8_t  * )0x0008A021 )
+ #define SCI1_SCR_ADDR			( ( volatile uint8_t  * )0x0008A022 )
+ #define SCI1_TDR_ADDR			( ( volatile uint8_t  * )0x0008A023 )
+ #define SCI1_SSR_ADDR			( ( volatile uint8_t  * )0x0008A024 )
+ #define SCI1_RDR_ADDR			( ( volatile uint8_t  * )0x0008A025 )
+ #define SCI1_SCMR_ADDR			( ( volatile uint8_t  * )0x0008A026 )
+ #define SCI1_SEMR_ADDR			( ( volatile uint8_t  * )0x0008A027 )
+ #define SCI2_SMR_ADDR			( ( volatile uint8_t  * )0x0008A040 )
+ #define SCI2_BRR_ADDR			( ( volatile uint8_t  * )0x0008A041 )
+ #define SCI2_SCR_ADDR			( ( volatile uint8_t  * )0x0008A042 )
+ #define SCI2_TDR_ADDR			( ( volatile uint8_t  * )0x0008A043 )
+ #define SCI2_SSR_ADDR			( ( volatile uint8_t  * )0x0008A044 )
+ #define SCI2_RDR_ADDR			( ( volatile uint8_t  * )0x0008A045 )
+ #define SCI2_SCMR_ADDR			( ( volatile uint8_t  * )0x0008A046 )
+ #define SCI2_SEMR_ADDR			( ( volatile uint8_t  * )0x0008A047 )
+ #define SCI3_SMR_ADDR			( ( volatile uint8_t  * )0x0008A060 )
+ #define SCI3_BRR_ADDR			( ( volatile uint8_t  * )0x0008A061 )
+ #define SCI3_SCR_ADDR			( ( volatile uint8_t  * )0x0008A062 )
+ #define SCI3_TDR_ADDR			( ( volatile uint8_t  * )0x0008A063 )
+ #define SCI3_SSR_ADDR			( ( volatile uint8_t  * )0x0008A064 )
+ #define SCI3_RDR_ADDR			( ( volatile uint8_t  * )0x0008A065 )
+ #define SCI3_SCMR_ADDR			( ( volatile uint8_t  * )0x0008A066 )
+ #define SCI3_SEMR_ADDR			( ( volatile uint8_t  * )0x0008A067 )
+ #define SCI4_SMR_ADDR			( ( volatile uint8_t  * )0x0008A080 )
+ #define SCI4_BRR_ADDR			( ( volatile uint8_t  * )0x0008A081 )
+ #define SCI4_SCR_ADDR			( ( volatile uint8_t  * )0x0008A082 )
+ #define SCI4_TDR_ADDR			( ( volatile uint8_t  * )0x0008A083 )
+ #define SCI4_SSR_ADDR			( ( volatile uint8_t  * )0x0008A084 )
+ #define SCI4_RDR_ADDR			( ( volatile uint8_t  * )0x0008A085 )
+ #define SCI4_SCMR_ADDR			( ( volatile uint8_t  * )0x0008A086 )
+ #define SCI4_SEMR_ADDR			( ( volatile uint8_t  * )0x0008A087 )
+ #define SCI5_SMR_ADDR			( ( volatile uint8_t  * )0x0008A0A0 )
+ #define SCI5_BRR_ADDR			( ( volatile uint8_t  * )0x0008A0A1 )
+ #define SCI5_SCR_ADDR			( ( volatile uint8_t  * )0x0008A0A2 )
+ #define SCI5_TDR_ADDR			( ( volatile uint8_t  * )0x0008A0A3 )
+ #define SCI5_SSR_ADDR			( ( volatile uint8_t  * )0x0008A0A4 )
+ #define SCI5_RDR_ADDR			( ( volatile uint8_t  * )0x0008A0A5 )
+ #define SCI5_SCMR_ADDR			( ( volatile uint8_t  * )0x0008A0A6 )
+ #define SCI5_SEMR_ADDR			( ( volatile uint8_t  * )0x0008A0A7 )
+ #define SCI6_SMR_ADDR			( ( volatile uint8_t  * )0x0008A0C0 )
+ #define SCI6_BRR_ADDR			( ( volatile uint8_t  * )0x0008A0C1 )
+ #define SCI6_SCR_ADDR			( ( volatile uint8_t  * )0x0008A0C2 )
+ #define SCI6_TDR_ADDR			( ( volatile uint8_t  * )0x0008A0C3 )
+ #define SCI6_SSR_ADDR			( ( volatile uint8_t  * )0x0008A0C4 )
+ #define SCI6_RDR_ADDR			( ( volatile uint8_t  * )0x0008A0C5 )
+ #define SCI6_SCMR_ADDR			( ( volatile uint8_t  * )0x0008A0C6 )
+ #define SCI6_SEMR_ADDR			( ( volatile uint8_t  * )0x0008A0C7 )
+ #define SCI7_SMR_ADDR			( ( volatile uint8_t  * )0x0008A0E0 )
+ #define SCI7_BRR_ADDR			( ( volatile uint8_t  * )0x0008A0E1 )
+ #define SCI7_SCR_ADDR			( ( volatile uint8_t  * )0x0008A0E2 )
+ #define SCI7_TDR_ADDR			( ( volatile uint8_t  * )0x0008A0E3 )
+ #define SCI7_SSR_ADDR			( ( volatile uint8_t  * )0x0008A0E4 )
+ #define SCI7_RDR_ADDR			( ( volatile uint8_t  * )0x0008A0E5 )
+ #define SCI7_SCMR_ADDR			( ( volatile uint8_t  * )0x0008A0E6 )
+ #define SCI7_SEMR_ADDR			( ( volatile uint8_t  * )0x0008A0E7 )
+ #define SCI8_SMR_ADDR			( ( volatile uint8_t  * )0x0008A100 )
+ #define SCI8_BRR_ADDR			( ( volatile uint8_t  * )0x0008A101 )
+ #define SCI8_SCR_ADDR			( ( volatile uint8_t  * )0x0008A102 )
+ #define SCI8_TDR_ADDR			( ( volatile uint8_t  * )0x0008A103 )
+ #define SCI8_SSR_ADDR			( ( volatile uint8_t  * )0x0008A104 )
+ #define SCI8_RDR_ADDR			( ( volatile uint8_t  * )0x0008A105 )
+ #define SCI8_SCMR_ADDR			( ( volatile uint8_t  * )0x0008A106 )
+ #define SCI8_SEMR_ADDR			( ( volatile uint8_t  * )0x0008A107 )
+ #define SCI9_SMR_ADDR			( ( volatile uint8_t  * )0x0008A120 )
+ #define SCI9_BRR_ADDR			( ( volatile uint8_t  * )0x0008A121 )
+ #define SCI9_SCR_ADDR			( ( volatile uint8_t  * )0x0008A122 )
+ #define SCI9_TDR_ADDR			( ( volatile uint8_t  * )0x0008A123 )
+ #define SCI9_SSR_ADDR			( ( volatile uint8_t  * )0x0008A124 )
+ #define SCI9_RDR_ADDR			( ( volatile uint8_t  * )0x0008A125 )
+ #define SCI9_SCMR_ADDR			( ( volatile uint8_t  * )0x0008A126 )
+ #define SCI9_SEMR_ADDR			( ( volatile uint8_t  * )0x0008A127 )
+ #define SCI10_SMR_ADDR			( ( volatile uint8_t  * )0x0008A140 )
+ #define SCI10_BRR_ADDR			( ( volatile uint8_t  * )0x0008A141 )
+ #define SCI10_SCR_ADDR			( ( volatile uint8_t  * )0x0008A142 )
+ #define SCI10_TDR_ADDR			( ( volatile uint8_t  * )0x0008A143 )
+ #define SCI10_SSR_ADDR			( ( volatile uint8_t  * )0x0008A144 )
+ #define SCI10_RDR_ADDR			( ( volatile uint8_t  * )0x0008A145 )
+ #define SCI10_SCMR_ADDR			( ( volatile uint8_t  * )0x0008A146 )
+ #define SCI10_SEMR_ADDR			( ( volatile uint8_t  * )0x0008A147 )
+ #define SCI11_SMR_ADDR			( ( volatile uint8_t  * )0x0008A160 )
+ #define SCI11_BRR_ADDR			( ( volatile uint8_t  * )0x0008A161 )
+ #define SCI11_SCR_ADDR			( ( volatile uint8_t  * )0x0008A162 )
+ #define SCI11_TDR_ADDR			( ( volatile uint8_t  * )0x0008A163 )
+ #define SCI11_SSR_ADDR			( ( volatile uint8_t  * )0x0008A164 )
+ #define SCI11_RDR_ADDR			( ( volatile uint8_t  * )0x0008A165 )
+ #define SCI11_SCMR_ADDR			( ( volatile uint8_t  * )0x0008A166 )
+ #define SCI11_SEMR_ADDR			( ( volatile uint8_t  * )0x0008A167 )
+ #define SCI_SMR_CKS_BIT			( 3U << 0U )
+ #define SCI_SMR_MP_BIT	        ( 1U << 2U )
+ #define SCI_SMR_STOP_BIT		( 1U << 3U )
+ #define SCI_SMR_PM_BIT			( 1U << 4U )
+ #define SCI_SMR_PE_BIT			( 1U << 5U )
+ #define SCI_SMR_CHR_BIT			( 1U << 6U )
+ #define SCI_SMR_CM_BIT			( 1U << 7U )
+ #define SCI_SCR_CKE_BIT			( 3U << 0U )
+ #define SCI_SCR_TEIE_BIT		( 1U << 2U )
+ #define SCI_SCR_MPIE_BIT		( 1U << 3U )
+ #define SCI_SCR_RE_BIT			( 1U << 4U )
+ #define SCI_SCR_TE_BIT			( 1U << 5U )
+ #define SCI_SCR_RIE_BIT			( 1U << 6U )
+ #define SCI_SCR_TIE_BIT			( 1U << 7U )
+ #define SCI_SSR_MPBT_BIT		( 1U << 0U )
+ #define SCI_SSR_MPB_BIT 		( 1U << 1U )
+ #define SCI_SSR_TEND_BIT		( 1U << 2U )
+ #define SCI_SSR_PER_BIT			( 1U << 3U )
+ #define SCI_SSR_FER_BIT			( 1U << 4U )
+ #define SCI_SSR_ORER_BIT		( 1U << 5U )
+ #define SCI_SCMR_SMIF_BIT		( 1U << 0U )
+ #define SCI_SCMR_SINV_BIT		( 1U << 2U )
+ #define SCI_SCMR_SDIR_BIT		( 1U << 3U )
+ #define SCI_SCMR_BCP2_BIT		( 1U << 7U )
+ #define SCI_SEMR_ACS0_BIT		( 1U << 0U )
+ #define SCI_SEMR_ABCS_BIT		( 1U << 4U )
+ #define SCI_SEMR_NFEN_BIT		( 1U << 5U )
+ 
+ /*
+  * Multi function Pin Controler configration define
+  */
+ #define MPC_PWPR_ADDR          ( ( volatile uint8_t  * )0x0008C11F )
+ #define MPC_PWPR_PFSWE_BIT     ( 1U << 6 )
+ #define MPC_PWPR_B0WI_BIT      ( 1U << 7 )
+ #define MPC_PWPR_PFSW_CLEAR    0U
+ 
+ #define MPC_P00PFS_ADDR        ( ( volatile uint8_t  * )0x0008C140 )
+ #define MPC_P01PFS_ADDR        ( ( volatile uint8_t  * )0x0008C141 )
+ #define MPC_P02PFS_ADDR        ( ( volatile uint8_t  * )0x0008C142 )
+ #define MPC_P03PFS_ADDR        ( ( volatile uint8_t  * )0x0008C143 )
+ #define MPC_P05PFS_ADDR        ( ( volatile uint8_t  * )0x0008C145 )
+ #define MPC_P07PFS_ADDR        ( ( volatile uint8_t  * )0x0008C147 )
+ #define MPC_P10PFS_ADDR        ( ( volatile uint8_t  * )0x0008C148 )
+ #define MPC_P11PFS_ADDR        ( ( volatile uint8_t  * )0x0008C149 )
+ #define MPC_P12PFS_ADDR        ( ( volatile uint8_t  * )0x0008C14A )
+ #define MPC_P13PFS_ADDR        ( ( volatile uint8_t  * )0x0008C14B )
+ #define MPC_P14PFS_ADDR        ( ( volatile uint8_t  * )0x0008C14C )
+ #define MPC_P15PFS_ADDR        ( ( volatile uint8_t  * )0x0008C14D )
+ #define MPC_P16PFS_ADDR        ( ( volatile uint8_t  * )0x0008C14E )
+ #define MPC_P17PFS_ADDR        ( ( volatile uint8_t  * )0x0008C14F )
+ #define MPC_P20PFS_ADDR        ( ( volatile uint8_t  * )0x0008C150 )
+ #define MPC_P21PFS_ADDR        ( ( volatile uint8_t  * )0x0008C151 )
+ #define MPC_P22PFS_ADDR        ( ( volatile uint8_t  * )0x0008C152 )
+ #define MPC_P23PFS_ADDR        ( ( volatile uint8_t  * )0x0008C153 )
+ #define MPC_P24PFS_ADDR        ( ( volatile uint8_t  * )0x0008C154 )
+ #define MPC_P25PFS_ADDR        ( ( volatile uint8_t  * )0x0008C155 )
+ #define MPC_P26PFS_ADDR        ( ( volatile uint8_t  * )0x0008C156 )
+ #define MPC_P27PFS_ADDR        ( ( volatile uint8_t  * )0x0008C157 )
+ #define MPC_P30PFS_ADDR        ( ( volatile uint8_t  * )0x0008C158 )
+ #define MPC_P31PFS_ADDR        ( ( volatile uint8_t  * )0x0008C159 )
+ #define MPC_P32PFS_ADDR        ( ( volatile uint8_t  * )0x0008C15A )
+ #define MPC_P33PFS_ADDR        ( ( volatile uint8_t  * )0x0008C15B )
+ #define MPC_P34PFS_ADDR        ( ( volatile uint8_t  * )0x0008C15C )
+ #define MPC_P40PFS_ADDR        ( ( volatile uint8_t  * )0x0008C160 )
+ #define MPC_P41PFS_ADDR        ( ( volatile uint8_t  * )0x0008C161 )
+ #define MPC_P42PFS_ADDR        ( ( volatile uint8_t  * )0x0008C162 )
+ #define MPC_P43PFS_ADDR        ( ( volatile uint8_t  * )0x0008C163 )
+ #define MPC_P44PFS_ADDR        ( ( volatile uint8_t  * )0x0008C164 )
+ #define MPC_P45PFS_ADDR        ( ( volatile uint8_t  * )0x0008C165 )
+ #define MPC_P46PFS_ADDR        ( ( volatile uint8_t  * )0x0008C166 )
+ #define MPC_P47PFS_ADDR        ( ( volatile uint8_t  * )0x0008C167 )
+ #define MPC_P50PFS_ADDR        ( ( volatile uint8_t  * )0x0008C168 )
+ #define MPC_P51PFS_ADDR        ( ( volatile uint8_t  * )0x0008C169 )
+ #define MPC_P52PFS_ADDR        ( ( volatile uint8_t  * )0x0008C16A )
+ #define MPC_P54PFS_ADDR        ( ( volatile uint8_t  * )0x0008C16C )
+ #define MPC_P55PFS_ADDR        ( ( volatile uint8_t  * )0x0008C16D )
+ #define MPC_P56PFS_ADDR        ( ( volatile uint8_t  * )0x0008C16E )
+ #define MPC_P57PFS_ADDR        ( ( volatile uint8_t  * )0x0008C16F )
+ #define MPC_P60PFS_ADDR        ( ( volatile uint8_t  * )0x0008C170 )
+ #define MPC_P61PFS_ADDR        ( ( volatile uint8_t  * )0x0008C171 )
+ #define MPC_P66PFS_ADDR        ( ( volatile uint8_t  * )0x0008C176 )
+ #define MPC_P67PFS_ADDR        ( ( volatile uint8_t  * )0x0008C177 )
+ #define MPC_P70PFS_ADDR        ( ( volatile uint8_t  * )0x0008C178 )
+ #define MPC_P71PFS_ADDR        ( ( volatile uint8_t  * )0x0008C179 )
+ #define MPC_P72PFS_ADDR        ( ( volatile uint8_t  * )0x0008C17A )
+ #define MPC_P73PFS_ADDR        ( ( volatile uint8_t  * )0x0008C17B )
+ #define MPC_P74PFS_ADDR        ( ( volatile uint8_t  * )0x0008C17C )
+ #define MPC_P75PFS_ADDR        ( ( volatile uint8_t  * )0x0008C17D )
+ #define MPC_P76PFS_ADDR        ( ( volatile uint8_t  * )0x0008C17E )
+ #define MPC_P77PFS_ADDR        ( ( volatile uint8_t  * )0x0008C17F )
+ #define MPC_P80PFS_ADDR        ( ( volatile uint8_t  * )0x0008C180 )
+ #define MPC_P81PFS_ADDR        ( ( volatile uint8_t  * )0x0008C181 )
+ #define MPC_P82PFS_ADDR        ( ( volatile uint8_t  * )0x0008C182 )
+ #define MPC_P83PFS_ADDR        ( ( volatile uint8_t  * )0x0008C183 )
+ #define MPC_P86PFS_ADDR        ( ( volatile uint8_t  * )0x0008C186 )
+ #define MPC_P87PFS_ADDR        ( ( volatile uint8_t  * )0x0008C187 )
+ #define MPC_P90PFS_ADDR        ( ( volatile uint8_t  * )0x0008C188 )
+ #define MPC_P91PFS_ADDR        ( ( volatile uint8_t  * )0x0008C189 )
+ #define MPC_P92PFS_ADDR        ( ( volatile uint8_t  * )0x0008C18A )
+ #define MPC_P93PFS_ADDR        ( ( volatile uint8_t  * )0x0008C18B )
+ #define MPC_PA0PFS_ADDR        ( ( volatile uint8_t  * )0x0008C190 )
+ #define MPC_PA1PFS_ADDR        ( ( volatile uint8_t  * )0x0008C191 )
+ #define MPC_PA2PFS_ADDR        ( ( volatile uint8_t  * )0x0008C192 )
+ #define MPC_PA3PFS_ADDR        ( ( volatile uint8_t  * )0x0008C193 )
+ #define MPC_PA4PFS_ADDR        ( ( volatile uint8_t  * )0x0008C194 )
+ #define MPC_PA5PFS_ADDR        ( ( volatile uint8_t  * )0x0008C195 )
+ #define MPC_PA6PFS_ADDR        ( ( volatile uint8_t  * )0x0008C196 )
+ #define MPC_PA7PFS_ADDR        ( ( volatile uint8_t  * )0x0008C197 )
+ #define MPC_PB0PFS_ADDR        ( ( volatile uint8_t  * )0x0008C198 )
+ #define MPC_PB1PFS_ADDR        ( ( volatile uint8_t  * )0x0008C199 )
+ #define MPC_PB2PFS_ADDR        ( ( volatile uint8_t  * )0x0008C19A )
+ #define MPC_PB3PFS_ADDR        ( ( volatile uint8_t  * )0x0008C19B )
+ #define MPC_PB4PFS_ADDR        ( ( volatile uint8_t  * )0x0008C19C )
+ #define MPC_PB5PFS_ADDR        ( ( volatile uint8_t  * )0x0008C19D )
+ #define MPC_PB6PFS_ADDR        ( ( volatile uint8_t  * )0x0008C19E )
+ #define MPC_PB7PFS_ADDR        ( ( volatile uint8_t  * )0x0008C19F )
+ #define MPC_PC0PFS_ADDR        ( ( volatile uint8_t  * )0x0008C1A0 )
+ #define MPC_PC1PFS_ADDR        ( ( volatile uint8_t  * )0x0008C1A1 )
+ #define MPC_PC2PFS_ADDR        ( ( volatile uint8_t  * )0x0008C1A2 )
+ #define MPC_PC3PFS_ADDR        ( ( volatile uint8_t  * )0x0008C1A3 )
+ #define MPC_PC4PFS_ADDR        ( ( volatile uint8_t  * )0x0008C1A4 )
+ #define MPC_PC5PFS_ADDR        ( ( volatile uint8_t  * )0x0008C1A5 )
+ #define MPC_PC6PFS_ADDR        ( ( volatile uint8_t  * )0x0008C1A6 )
+ #define MPC_PC7PFS_ADDR        ( ( volatile uint8_t  * )0x0008C1A7 )
+ #define MPC_PD0PFS_ADDR        ( ( volatile uint8_t  * )0x0008C1A8 )
+ #define MPC_PD1PFS_ADDR        ( ( volatile uint8_t  * )0x0008C1A9 )
+ #define MPC_PD2PFS_ADDR        ( ( volatile uint8_t  * )0x0008C1AA )
+ #define MPC_PD3PFS_ADDR        ( ( volatile uint8_t  * )0x0008C1AB )
+ #define MPC_PD4PFS_ADDR        ( ( volatile uint8_t  * )0x0008C1AC )
+ #define MPC_PD5PFS_ADDR        ( ( volatile uint8_t  * )0x0008C1AD )
+ #define MPC_PD6PFS_ADDR        ( ( volatile uint8_t  * )0x0008C1AE )
+ #define MPC_PD7PFS_ADDR        ( ( volatile uint8_t  * )0x0008C1BF )
+ #define MPC_PE0PFS_ADDR        ( ( volatile uint8_t  * )0x0008C1B0 )
+ #define MPC_PE1PFS_ADDR        ( ( volatile uint8_t  * )0x0008C1B1 )
+ #define MPC_PE2PFS_ADDR        ( ( volatile uint8_t  * )0x0008C1B2 )
+ #define MPC_PE3PFS_ADDR        ( ( volatile uint8_t  * )0x0008C1B3 )
+ #define MPC_PE4PFS_ADDR        ( ( volatile uint8_t  * )0x0008C1B4 )
+ #define MPC_PE5PFS_ADDR        ( ( volatile uint8_t  * )0x0008C1B5 )
+ #define MPC_PE6PFS_ADDR        ( ( volatile uint8_t  * )0x0008C1B6 )
+ #define MPC_PE7PFS_ADDR        ( ( volatile uint8_t  * )0x0008C1B7 )
+ #define MPC_PF0PFS_ADDR        ( ( volatile uint8_t  * )0x0008C1B8 )
+ #define MPC_PF1PFS_ADDR        ( ( volatile uint8_t  * )0x0008C1B9 )
+ #define MPC_PF2PFS_ADDR        ( ( volatile uint8_t  * )0x0008C1BA )
+ #define MPC_PF5PFS_ADDR        ( ( volatile uint8_t  * )0x0008C1BD )
+ #define MPC_PFS_PSEL0          0x0
+ #define MPC_PFS_PSEL1          0x1
+ #define MPC_PFS_PSEL2          0x2
+ #define MPC_PFS_PSEL3          0x3
+ #define MPC_PFS_PSEL4          0x4
+ #define MPC_PFS_PSEL5          0x5
+ #define MPC_PFS_PSEL6          0x6
+ #define MPC_PFS_PSEL7          0x7
+ #define MPC_PFS_PSEL8          0x8
+ #define MPC_PFS_PSEL9          0x9
+ #define MPC_PFS_PSELA          0xA
+ #define MPC_PFS_PSELB          0xB
+ #define MPC_PFS_PSELC          0xC
+ #define MPC_PFS_PSELD          0xD
+ #define MPC_PFS_PSELE          0xE
+ #define MPC_PFS_PSELF          0xF
+ #define MPC_PFS_ISEL           ( 1U << 6 )
+ #define MPC_PFS_ASEL           ( 1U << 7 )
+ 
+ /*
+  *  I/Oポートのレジスタ及び設定ビット情報
+  */
+ #define PORT0_PDR_ADDR			( ( volatile uint8_t  * )0x0008C000 )
+ #define PORT1_PDR_ADDR			( ( volatile uint8_t  * )0x0008C001 )
+ #define PORT2_PDR_ADDR			( ( volatile uint8_t  * )0x0008C002 )
+ #define PORT3_PDR_ADDR			( ( volatile uint8_t  * )0x0008C003 )
+ #define PORT4_PDR_ADDR			( ( volatile uint8_t  * )0x0008C004 )
+ #define PORT5_PDR_ADDR			( ( volatile uint8_t  * )0x0008C005 )
+ #define PORT6_PDR_ADDR			( ( volatile uint8_t  * )0x0008C006 )
+ #define PORT7_PDR_ADDR			( ( volatile uint8_t  * )0x0008C007 )
+ #define PORT8_PDR_ADDR			( ( volatile uint8_t  * )0x0008C008 )
+ #define PORT9_PDR_ADDR			( ( volatile uint8_t  * )0x0008C009 )
+ #define PORTA_PDR_ADDR			( ( volatile uint8_t  * )0x0008C00A )
+ #define PORTB_PDR_ADDR			( ( volatile uint8_t  * )0x0008C00B )
+ #define PORTC_PDR_ADDR			( ( volatile uint8_t  * )0x0008C00C )
+ #define PORTD_PDR_ADDR			( ( volatile uint8_t  * )0x0008C00D )
+ #define PORTE_PDR_ADDR			( ( volatile uint8_t  * )0x0008C00E )
+ #define PORTF_PDR_ADDR			( ( volatile uint8_t  * )0x0008C00F )
+ #define PORTG_PDR_ADDR			( ( volatile uint8_t  * )0x0008C010 )
+ #define PORTJ_PDR_ADDR			( ( volatile uint8_t  * )0x0008C012 )
+ #define PORT_PDR_B0_BIT			( 0x01U << 0U )
+ #define PORT_PDR_B1_BIT			( 0x01U << 1U )
+ #define PORT_PDR_B2_BIT			( 0x01U << 2U )
+ #define PORT_PDR_B3_BIT			( 0x01U << 3U )
+ #define PORT_PDR_B4_BIT			( 0x01U << 4U )
+ #define PORT_PDR_B5_BIT			( 0x01U << 5U )
+ #define PORT_PDR_B6_BIT			( 0x01U << 6U )
+ #define PORT_PDR_B7_BIT			( 0x01U << 7U )
+ #define PORT0_PODR_ADDR			( ( volatile uint8_t  * )0x0008C020 )
+ #define PORT1_PODR_ADDR			( ( volatile uint8_t  * )0x0008C021 )
+ #define PORT2_PODR_ADDR			( ( volatile uint8_t  * )0x0008C022 )
+ #define PORT3_PODR_ADDR			( ( volatile uint8_t  * )0x0008C023 )
+ #define PORT4_PODR_ADDR			( ( volatile uint8_t  * )0x0008C024 )
+ #define PORT5_PODR_ADDR			( ( volatile uint8_t  * )0x0008C025 )
+ #define PORT6_PODR_ADDR			( ( volatile uint8_t  * )0x0008C026 )
+ #define PORT7_PODR_ADDR			( ( volatile uint8_t  * )0x0008C027 )
+ #define PORT8_PODR_ADDR			( ( volatile uint8_t  * )0x0008C028 )
+ #define PORT9_PODR_ADDR			( ( volatile uint8_t  * )0x0008C029 )
+ #define PORTA_PODR_ADDR			( ( volatile uint8_t  * )0x0008C02A )
+ #define PORTB_PODR_ADDR			( ( volatile uint8_t  * )0x0008C02B )
+ #define PORTC_PODR_ADDR			( ( volatile uint8_t  * )0x0008C02C )
+ #define PORTD_PODR_ADDR			( ( volatile uint8_t  * )0x0008C02D )
+ #define PORTE_PODR_ADDR			( ( volatile uint8_t  * )0x0008C02E )
+ #define PORTF_PODR_ADDR			( ( volatile uint8_t  * )0x0008C02F )
+ #define PORTG_PODR_ADDR			( ( volatile uint8_t  * )0x0008C030 )
+ #define PORTH_PODR_ADDR			( ( volatile uint8_t  * )0x0008C032 )
+ #define PORT_PODR_B0_BIT			( 0x01U << 0U )
+ #define PORT_PODR_B1_BIT			( 0x01U << 1U )
+ #define PORT_PODR_B2_BIT			( 0x01U << 2U )
+ #define PORT_PODR_B3_BIT			( 0x01U << 3U )
+ #define PORT_PODR_B4_BIT			( 0x01U << 4U )
+ #define PORT_PODR_B5_BIT			( 0x01U << 5U )
+ #define PORT_PODR_B6_BIT			( 0x01U << 6U )
+ #define PORT_PODR_B7_BIT			( 0x01U << 7U )
+ #define PORT0_PIDR_ADDR			( ( volatile uint8_t  * )0x0008C040 )
+ #define PORT1_PIDR_ADDR			( ( volatile uint8_t  * )0x0008C041 )
+ #define PORT2_PIDR_ADDR			( ( volatile uint8_t  * )0x0008C042 )
+ #define PORT3_PIDR_ADDR			( ( volatile uint8_t  * )0x0008C043 )
+ #define PORT4_PIDR_ADDR			( ( volatile uint8_t  * )0x0008C044 )
+ #define PORT5_PIDR_ADDR			( ( volatile uint8_t  * )0x0008C045 )
+ #define PORT6_PIDR_ADDR			( ( volatile uint8_t  * )0x0008C046 )
+ #define PORT7_PIDR_ADDR			( ( volatile uint8_t  * )0x0008C047 )
+ #define PORT8_PIDR_ADDR			( ( volatile uint8_t  * )0x0008C048 )
+ #define PORT9_PIDR_ADDR			( ( volatile uint8_t  * )0x0008C049 )
+ #define PORTA_PIDR_ADDR			( ( volatile uint8_t  * )0x0008C04A )
+ #define PORTB_PIDR_ADDR			( ( volatile uint8_t  * )0x0008C04B )
+ #define PORTC_PIDR_ADDR			( ( volatile uint8_t  * )0x0008C04C )
+ #define PORTD_PIDR_ADDR			( ( volatile uint8_t  * )0x0008C04D )
+ #define PORTE_PIDR_ADDR			( ( volatile uint8_t  * )0x0008C04E )
+ #define PORTF_PIDR_ADDR			( ( volatile uint8_t  * )0x0008C04F )
+ #define PORTG_PIDR_ADDR			( ( volatile uint8_t  * )0x0008C050 )
+ #define PORTJ_PIDR_ADDR			( ( volatile uint8_t  * )0x0008C052 )
+ #define PORT_PIDR_B0_BIT			( 0x01U << 0U )
+ #define PORT_PIDR_B1_BIT			( 0x01U << 1U )
+ #define PORT_PIDR_B2_BIT			( 0x01U << 2U )
+ #define PORT_PIDR_B3_BIT			( 0x01U << 3U )
+ #define PORT_PIDR_B4_BIT			( 0x01U << 4U )
+ #define PORT_PIDR_B5_BIT			( 0x01U << 5U )
+ #define PORT_PIDR_B6_BIT			( 0x01U << 6U )
+ #define PORT_PIDR_B7_BIT			( 0x01U << 7U )
+ #define PORT0_PMR_ADDR			( ( volatile uint8_t  * )0x0008C060 )
+ #define PORT1_PMR_ADDR			( ( volatile uint8_t  * )0x0008C061 )
+ #define PORT2_PMR_ADDR			( ( volatile uint8_t  * )0x0008C062 )
+ #define PORT3_PMR_ADDR			( ( volatile uint8_t  * )0x0008C063 )
+ #define PORT4_PMR_ADDR			( ( volatile uint8_t  * )0x0008C064 )
+ #define PORT5_PMR_ADDR			( ( volatile uint8_t  * )0x0008C065 )
+ #define PORT6_PMR_ADDR			( ( volatile uint8_t  * )0x0008C066 )
+ #define PORT7_PMR_ADDR			( ( volatile uint8_t  * )0x0008C067 )
+ #define PORT8_PMR_ADDR			( ( volatile uint8_t  * )0x0008C068 )
+ #define PORT9_PMR_ADDR			( ( volatile uint8_t  * )0x0008C068 )
+ #define PORTA_PMR_ADDR			( ( volatile uint8_t  * )0x0008C06A )
+ #define PORTB_PMR_ADDR			( ( volatile uint8_t  * )0x0008C06B )
+ #define PORTC_PMR_ADDR			( ( volatile uint8_t  * )0x0008C06C )
+ #define PORTD_PMR_ADDR			( ( volatile uint8_t  * )0x0008C06D )
+ #define PORTE_PMR_ADDR			( ( volatile uint8_t  * )0x0008C06E )
+ #define PORTF_PMR_ADDR			( ( volatile uint8_t  * )0x0008C06F )
+ #define PORTG_PMR_ADDR			( ( volatile uint8_t  * )0x0008C070 )
+ #define PORTJ_PMR_ADDR			( ( volatile uint8_t  * )0x0008C072 )
+ #define PORT_PMR_B0_BIT			( 0x01U << 0U )
+ #define PORT_PMR_B1_BIT			( 0x01U << 1U )
+ #define PORT_PMR_B2_BIT			( 0x01U << 2U )
+ #define PORT_PMR_B3_BIT			( 0x01U << 3U )
+ #define PORT_PMR_B4_BIT			( 0x01U << 4U )
+ #define PORT_PMR_B5_BIT			( 0x01U << 5U )
+ #define PORT_PMR_B6_BIT			( 0x01U << 6U )
+ #define PORT_PMR_B7_BIT			( 0x01U << 7U )
+ #define PORT0_PCR_ADDR      ( ( volatile uint8_t  * )0x0008C0C0 )
+ #define PORT1_PCR_ADDR      ( ( volatile uint8_t  * )0x0008C0C1 )
+ #define PORT2_PCR_ADDR      ( ( volatile uint8_t  * )0x0008C0C2 )
+ #define PORT3_PCR_ADDR      ( ( volatile uint8_t  * )0x0008C0C3 )
+ #define PORT4_PCR_ADDR      ( ( volatile uint8_t  * )0x0008C0C4 )
+ #define PORT5_PCR_ADDR      ( ( volatile uint8_t  * )0x0008C0C5 )
+ #define PORT6_PCR_ADDR      ( ( volatile uint8_t  * )0x0008C0C6 )
+ #define PORT7_PCR_ADDR      ( ( volatile uint8_t  * )0x0008C0C7 )
+ #define PORT8_PCR_ADDR      ( ( volatile uint8_t  * )0x0008C0C8 )
+ #define PORT9_PCR_ADDR      ( ( volatile uint8_t  * )0x0008C0C8 )
+ #define PORTA_PCR_ADDR      ( ( volatile uint8_t  * )0x0008C0CA )
+ #define PORTB_PCR_ADDR      ( ( volatile uint8_t  * )0x0008C0CB )
+ #define PORTC_PCR_ADDR      ( ( volatile uint8_t  * )0x0008C0CC )
+ #define PORTD_PCR_ADDR      ( ( volatile uint8_t  * )0x0008C0CD )
+ #define PORTE_PCR_ADDR      ( ( volatile uint8_t  * )0x0008C0CE )
+ #define PORTF_PCR_ADDR      ( ( volatile uint8_t  * )0x0008C0CF )
+ #define PORTG_PCR_ADDR      ( ( volatile uint8_t  * )0x0008C0D0 )
+ #define PORTJ_PCR_ADDR      ( ( volatile uint8_t  * )0x0008C0D2 )
+ #define PORT_PCR_B0_BIT      ( 0x01U << 0U )
+ #define PORT_PCR_B1_BIT      ( 0x01U << 1U )
+ #define PORT_PCR_B2_BIT      ( 0x01U << 2U )
+ #define PORT_PCR_B3_BIT      ( 0x01U << 3U )
+ #define PORT_PCR_B4_BIT      ( 0x01U << 4U )
+ #define PORT_PCR_B5_BIT      ( 0x01U << 5U )
+ #define PORT_PCR_B6_BIT      ( 0x01U << 6U )
+ #define PORT_PCR_B7_BIT      ( 0x01U << 7U )
+ 
+ /*
+  *  UART関連の定義
+  *
+  */
+ /*
+  *  シリアルI/Oの個数
+  */
+ 
+ #define TNUM_SIOP			( 7 )
+ 
+ //Ethernte device address
+ //Ethernet mac base address
+ #define ETHERC_BASE_ADDR 0x000C0100
+ 
+ //Ethernet DMAC base address
+ #define EDMAC_BASE_ADDR  0x000C0000
+ #endif	/* TOPPERS_RX72n_H */
+ 
diff -cr --new-file asp/arch/rx_gcc/rx72n/rx72n.tf 1.9.1_update/arch/rx_gcc/rx72n/rx72n.tf
*** asp/arch/rx_gcc/rx72n/rx72n.tf	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/arch/rx_gcc/rx72n/rx72n.tf	Thu Dec 15 18:40:51 2022
***************
*** 0 ****
--- 1,51 ----
+ $ 
+ $		アーキテクチャ依存テンプレート（RX72n用）
+ $ 
+ 
+ 
+ 
+ /*$NL$
+ $SPC$*  Architecture-dependent Definitions (RX72n)$NL$
+ $SPC$*/$NL$
+ $NL$
+ 
+ $ 
+ $  割込み番号と割込みハンドラ番号の定義
+ $ 
+ $  RX72Nでは割込み番号と割込みハンドラ番号が1対1で対応する割り込みと設定を必要とする割り込みが存在する．
+ $ 
+ 
+ $INTNO_VALID = { 16, 21, 23 ; 27, 28,...,59 ; 62 ; 64, 65,...,79 ; 90, 91,...,93 ; 98 , 102 ; 106, 107,...,113 ; 114; 122, 123,...,167 ; 170, 171,...,203 ; 206, 207,...,210 ; 214, 215,...,253 }$
+ $INHNO_VALID = INTNO_VALID$
+ 
+ $ 
+ $  例外番号の定義
+ $ 
+ $  固定ベクタテーブルのベクタテーブルアドレスの小さい順番に例外番号を割振る．
+ $  (予約領域も含む)
+ $ 
+ 
+ $EXCNO_VALID = { 20, 23, 25, 30, 31 }$
+ 
+ $ 
+ $  INT割込みの番号
+ $ 
+ 
+ $INTNO_INT = { 64, 65,...,79 }$
+ 
+ $ 
+ $  割込み番号，割込みハンドラ番号，例外番号の範囲
+ $ 
+ $ (予約領域も含む)
+ $ 
+ 
+ $INTNO_RANGE = { 0, 1,...,255 }$
+ $INHNO_RANGE = INTNO_RANGE$
+ $EXCNO_RANGE = { 0, 1,...,31 }$
+ 
+ $ 
+ $  プロセッサ依存のテンプレートファイルのインクルード
+ $ 
+ 
+ $INCLUDE"rx_gcc/RX72n/prc.tf"$
+ 
diff -cr --new-file asp/arch/rx_gcc/rx72n/rx72n_config.c 1.9.1_update/arch/rx_gcc/rx72n/rx72n_config.c
*** asp/arch/rx_gcc/rx72n/rx72n_config.c	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/arch/rx_gcc/rx72n/rx72n_config.c	Thu Dec 15 13:53:29 2022
***************
*** 0 ****
--- 1,270 ----
+ /*
+  *  TOPPERS/ASP Kernel
+  *      Toyohashi Open Platform for Embedded Real-Time Systems/
+  *      Advanced Standard Profile Kernel
+  * 
+  *  Copyright (C) 2010 by Witz Corporation, JAPAN
+  *  Copyright (C) 2015- by Hisashi Hata, JAPAN
+  * 
+  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
+  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
+  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
+  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+  *      スコード中に含まれていること．
+  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
+  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
+  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
+  *      の無保証規定を掲載すること．
+  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
+  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
+  *      と．
+  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
+  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
+  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
+  *        報告すること．
+  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
+  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
+  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
+  *      免責すること．
+  * 
+  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
+  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
+  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
+  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
+  *  の責任を負わない．
+  * 
+  */
+ 
+ #include <kernel_impl.h>
+ 
+ /*
+  *		プロセッサ依存モジュール（RX72n用）
+  */
+ 
+ #define NULL_OFF 0 //reserved IPR 
+ 
+ volatile uint8_t const ipr_reg_offset[ INHNO_MAX ] = {
+ 	NULL_OFF, NULL_OFF, NULL_OFF, NULL_OFF, NULL_OFF,	/* No.0 - 4   予約 */
+ 	NULL_OFF, NULL_OFF, NULL_OFF, NULL_OFF, NULL_OFF,	/* No.5 - 9   予約 */
+ 	NULL_OFF, NULL_OFF, NULL_OFF, NULL_OFF, NULL_OFF,	/* No.10 - 14 予約 */
+ 	NULL_OFF,							/* No.15  予約 */
+ 	ICU_IPR00_OFFSET,					/* No.16   バスエラー BUSERR  */
+ 	NULL_OFF, NULL_OFF, NULL_OFF, NULL_OFF,			/* No.17 - 20 予約 */
+ 	ICU_IPR01_OFFSET,					/* No.21   FCU FIFERR  */
+ 	NULL_OFF,							/* No.22  予約 */
+ 	ICU_IPR02_OFFSET,					/* No.23   FCU FRDYI  */
+ 	NULL_OFF, NULL_OFF, NULL_OFF,		        /* No.24 -26  予約 */
+ 	ICU_IPR03_OFFSET,                 /* No.27  ICU SWINT  */
+ 	ICU_IPR04_OFFSET,					/* No.28   CMTユニット0 CMT0  */
+ 	ICU_IPR05_OFFSET,					/* No.29   CMTユニット0 CMT1  */
+ 	ICU_IPR06_OFFSET,					/* No.30   CMTユニット1 CMT2  */
+ 	ICU_IPR07_OFFSET,					/* No.31   CMTユニット1 CMT3  */
+ 	ICU_IPR20_OFFSET,                 /* No.32   Ether EINT  */
+ 	ICU_IPR21_OFFSET,                 /* No.33   USB D0FIFO0  */
+ 	ICU_IPR22_OFFSET,                 /* No.34   USB D1FIFO0  */
+ 	ICU_IPR23_OFFSET,                 /* No.35   USB USBI0  */
+ 	ICU_IPR24_OFFSET,                 /* No.36   USB D0FIFO1  */
+ 	ICU_IPR25_OFFSET,                 /* No.37   USB D1FIFO1  */
+ 	ICU_IPR26_OFFSET,                 /* No.38   USB USBI1  */
+ 	ICU_IPR27_OFFSET,                 /* No.39   RSPI0 SPRI0  */
+ 	ICU_IPR27_OFFSET,                 /* No.40   RSPI0 SPTI0  */
+ 	ICU_IPR27_OFFSET,                 /* No.41   RSPI0 SPII0  */
+ 	ICU_IPR2A_OFFSET,                 /* No.42   RSPI1 SPRI0  */
+ 	ICU_IPR2A_OFFSET,                 /* No.43   RSPI1 SPTI0  */
+ 	ICU_IPR2A_OFFSET,                 /* No.44   RSPI1 SPII0  */
+ 	ICU_IPR2D_OFFSET,                 /* No.45   RSPI1 SPRI0  */
+ 	ICU_IPR2D_OFFSET,                 /* No.46   RSPI1 SPTI0  */
+ 	ICU_IPR2D_OFFSET,                 /* No.47   RSPI1 SPII0  */
+ 	ICU_IPR30_OFFSET,                 /* NO.48  CAN0 RXF0*/
+ 	ICU_IPR30_OFFSET,                 /* NO.49  CAN0 TXF0*/
+ 	ICU_IPR30_OFFSET,                 /* NO.50  CAN0 RXM0*/
+ 	ICU_IPR30_OFFSET,                 /* NO.51  CAN0 TXM0*/
+ 	ICU_IPR34_OFFSET,                 /* NO.52  CAN1 RXF1*/
+ 	ICU_IPR34_OFFSET,                 /* NO.53  CAN1 TXF1*/
+ 	ICU_IPR34_OFFSET,                 /* NO.54  CAN1 RXM1*/
+ 	ICU_IPR34_OFFSET,                 /* NO.55  CAN1 TXM1*/
+ 	ICU_IPR38_OFFSET,                 /* NO.56  CAN2 RXF2*/
+ 	ICU_IPR38_OFFSET,                 /* NO.57  CAN2 TXF2*/
+ 	ICU_IPR38_OFFSET,                 /* NO.58  CAN2 RXM2*/
+ 	ICU_IPR38_OFFSET,                 /* NO.59  CAN2 TXM2*/
+ 	NULL_OFF, NULL_OFF,                     /* No.60 - 61 予約 */
+ 	ICU_IPR3E_OFFSET,                 /* NO 62 RTC CUP */
+ 	NULL_OFF,						    /* No.63 予約 */
+ 	ICU_IPR40_OFFSET,					/* No.64   外部端子 IRQ0  */
+ 	ICU_IPR41_OFFSET,					/* No.65   外部端子 IRQ1  */
+ 	ICU_IPR42_OFFSET,					/* No.66   外部端子 IRQ2  */
+ 	ICU_IPR43_OFFSET,					/* No.67   外部端子 IRQ3  */
+ 	ICU_IPR44_OFFSET,					/* No.68   外部端子 IRQ4  */
+ 	ICU_IPR45_OFFSET,					/* No.69   外部端子 IRQ5  */
+ 	ICU_IPR46_OFFSET,					/* No.70   外部端子 IRQ6  */
+ 	ICU_IPR47_OFFSET,					/* No.71   外部端子 IRQ7  */
+ 	ICU_IPR48_OFFSET,					/* No.72   外部端子 IRQ8  */
+ 	ICU_IPR49_OFFSET,					/* No.73   外部端子 IRQ9  */
+ 	ICU_IPR4A_OFFSET,					/* No.74   外部端子 IRQ10  */
+ 	ICU_IPR4B_OFFSET,					/* No.75   外部端子 IRQ11  */
+ 	ICU_IPR4C_OFFSET,					/* No.76   外部端子 IRQ12  */
+ 	ICU_IPR4D_OFFSET,					/* No.77   外部端子 IRQ13  */
+ 	ICU_IPR4E_OFFSET,					/* No.78   外部端子 IRQ14  */
+ 	ICU_IPR4F_OFFSET,					/* No.79   外部端子 IRQ15  */
+ 	NULL_OFF, NULL_OFF, NULL_OFF, NULL_OFF, NULL_OFF,	/* No.80 - 84 予約 */
+ 	NULL_OFF, NULL_OFF, NULL_OFF, NULL_OFF, NULL_OFF,	/* No.85 - 89 予約 */
+     ICU_IPR5A_OFFSET,                 /* No.90  USB USBR0  */
+ 	ICU_IPR5B_OFFSET,                 /* No.91  USB USBR1  */
+ 	ICU_IPR5C_OFFSET,                 /* No.92  RTC ALM  */
+ 	ICU_IPR5D_OFFSET,                 /* No.93  RTC PRD  */
+ 	NULL_OFF, NULL_OFF, NULL_OFF, NULL_OFF,         /* No.94 - 97  予約 */
+ 	ICU_IPR62_OFFSET,					/* No.98   AD0 ADI0  */
+     NULL_OFF, NULL_OFF, NULL_OFF,               /* No.99 - 101 予約 */
+ 	ICU_IPR66_OFFSET,					/* No.102  S12AD S12ADI0  */
+ 	NULL_OFF, NULL_OFF, NULL_OFF,               /* No.103 - 105 予約 */
+ 	ICU_IPR6A_OFFSET,					/* No.106  ICU GROUP0  */
+ 	ICU_IPR6B_OFFSET,					/* No.107  ICU GROUP1  */
+ 	ICU_IPR6C_OFFSET,					/* No.108  ICU GROUP2  */
+ 	ICU_IPR6D_OFFSET,					/* No.109  ICU GROUP3  */
+ 	ICU_IPR6E_OFFSET,					/* No.110  ICU GROUP4  */
+ 	ICU_IPR6F_OFFSET,					/* No.111  ICU GROUP5  */
+ 	ICU_IPR70_OFFSET,					/* No.112  ICU GROUP6  */
+ 	ICU_IPR71_OFFSET,                           /* No.113 予約 */
+ 	ICU_IPR72_OFFSET,                 /* No.114  ICU Group12  */
+ 	NULL_OFF, NULL_OFF, NULL_OFF, NULL_OFF, NULL_OFF,   /* No.115 - 119 予約 */
+ 	NULL_OFF, NULL_OFF,                     /* No.120 - 121 予約 */
+ 	ICU_IPR7A_OFFSET,                 /* No.122  SCI12 SCIX0  */
+ 	ICU_IPR7A_OFFSET,                 /* No.123  SCI12 SCIX1  */
+ 	ICU_IPR7A_OFFSET,                 /* No.124  SCI12 SCIX2  */
+ 	ICU_IPR7A_OFFSET,                 /* No.125  SCI12 SCIX3  */
+ 	ICU_IPR7E_OFFSET,                 /* No.126  TPU0 TGI0A  */
+ 	ICU_IPR7E_OFFSET,                 /* No.127  TPU0 TGI0B  */
+ 	ICU_IPR7E_OFFSET,                 /* No.128  TPU0 TGI0C  */
+ 	ICU_IPR7E_OFFSET,                 /* No.129  TPU0 TGI0D  */
+ 	ICU_IPR82_OFFSET,                 /* No.130  TPU1 TGI1A  */
+ 	ICU_IPR82_OFFSET,                 /* No.131  TPU1 TGI1B  */
+     ICU_IPR84_OFFSET,                 /* No.132  TPU2 TGI2A  */
+     ICU_IPR84_OFFSET,                 /* No.133  TPU2 TGI2B  */
+     ICU_IPR86_OFFSET,                 /* No.134  TPU3 TGI3A  */
+     ICU_IPR86_OFFSET,                 /* No.135  TPU3 TGI3B  */
+     ICU_IPR86_OFFSET,                 /* No.136  TPU3 TGI3C  */
+     ICU_IPR86_OFFSET,                 /* No.137  TPU3 TGI3D  */
+     ICU_IPR8A_OFFSET,                 /* No.138  TPU4 TGI4A  */
+     ICU_IPR8A_OFFSET,                 /* No.139  TPU4 TGI4B  */
+     ICU_IPR8C_OFFSET,                 /* No.140  TPU5 TGI5A  */
+     ICU_IPR8C_OFFSET,                 /* No.141  TPU5 TGI5B  */
+     ICU_IPR8E_OFFSET,                 /* No.142  TPU6 TGI6A, MTU0 TGIA0  */
+     ICU_IPR8E_OFFSET,                 /* No.143  TPU6 TGI6B, MTU0 TGIB0  */
+     ICU_IPR8E_OFFSET,                 /* No.144  TPU6 TGI6C, MTU0 TGIC0  */
+     ICU_IPR8E_OFFSET,                 /* No.145  TPU6 TGI6D, MTU0 TGID0  */
+     ICU_IPR92_OFFSET,                 /* No.146  MTU0 TGIE0  */
+     ICU_IPR92_OFFSET,                 /* No.147  MTU0 TGIF0  */
+     ICU_IPR94_OFFSET,                 /* No.148  TPU7 TGI7A, MTU1 TGIA1  */
+     ICU_IPR94_OFFSET,                 /* No.149  TPU7 TGI7B, MTU1 TGIB1  */
+     ICU_IPR96_OFFSET,                 /* No.150  TPU8 TGI8A, MTU2 TGIA2  */
+     ICU_IPR96_OFFSET,                 /* No.151  TPU8 TGI8B, MTU2 TGIB2  */
+     ICU_IPR98_OFFSET,                 /* No.152  TPU9 TGI9A, MTU3 TGIA3  */
+     ICU_IPR98_OFFSET,                 /* No.153  TPU9 TGI9B, MTU3 TGIB3  */
+     ICU_IPR98_OFFSET,                 /* No.154  TPU9 TGI9C, MTU3 TGIC3  */
+     ICU_IPR98_OFFSET,                 /* No.155  TPU9 TGI9D, MTU3 TGID3  */
+     ICU_IPR9C_OFFSET,                 /* No.156  TPU10 TGI10A, MTU4 TGIA4  */
+     ICU_IPR9C_OFFSET,                 /* No.157  TPU10 TGI10B, MTU4 TGIB4  */
+     ICU_IPR9C_OFFSET,                 /* No.158  MTU4 TGIC4  */
+     ICU_IPR9C_OFFSET,                 /* No.159  MTU4 TGID4  */
+     ICU_IPRA0_OFFSET,                 /* No.160  MTU4 TGIV4  */
+     ICU_IPRA1_OFFSET,                 /* No.161  MTU5 TGIU5  */
+     ICU_IPRA1_OFFSET,                 /* No.162  MTU5 TGIV5  */
+     ICU_IPRA1_OFFSET,                 /* No.163  MTU5 TGIW5  */
+     ICU_IPRA4_OFFSET,                 /* No.164  TPU11 TGI11A  */
+     ICU_IPRA4_OFFSET,                 /* No.165  TPU11 TGI11B  */
+     ICU_IPRA6_OFFSET,                 /* No.166  POE OEI1  */
+     ICU_IPRA6_OFFSET,                 /* No.167  POE OEI2  */
+ 	NULL_OFF, NULL_OFF,                     /* No.168 - 169 予約 */
+     ICU_IPRAA_OFFSET,                 /* No.170  TMR0 CMIA0  */
+     ICU_IPRAA_OFFSET,                 /* No.171  TMR0 CMIB0  */
+     ICU_IPRAA_OFFSET,                 /* No.172  TMR0 OVI0  */
+     ICU_IPRAD_OFFSET,                 /* No.173  TMR1 CMIA1  */
+     ICU_IPRAD_OFFSET,                 /* No.174  TMR1 CMIB1  */
+     ICU_IPRAD_OFFSET,                 /* No.175  TMR1 OVI1  */
+     ICU_IPRB0_OFFSET,                 /* No.176  TMR2 CMIA2  */
+     ICU_IPRB0_OFFSET,                 /* No.177  TMR2 CMIB2  */
+     ICU_IPRB0_OFFSET,                 /* No.178  TMR2 OVI2  */
+     ICU_IPRB3_OFFSET,                 /* No.179  TMR3 CMIA3  */
+     ICU_IPRB3_OFFSET,                 /* No.180  TMR3 CMIB3  */
+     ICU_IPRB3_OFFSET,                 /* No.181  TMR3 OVI3  */
+     ICU_IPRB6_OFFSET,                 /* No.182  RIIC0 EEI0  */
+     ICU_IPRB7_OFFSET,                 /* No.183  RIIC0 RXI0  */
+     ICU_IPRB8_OFFSET,                 /* No.184  RIIC0 TXI0  */
+     ICU_IPRB9_OFFSET,                 /* No.185  RIIC0 TEI0  */
+     ICU_IPRBA_OFFSET,                 /* No.186  RIIC1 EEI1  */
+     ICU_IPRBB_OFFSET,                 /* No.187  RIIC1 RXI1  */
+     ICU_IPRBC_OFFSET,                 /* No.188  RIIC1 TXI1  */
+     ICU_IPRBD_OFFSET,                 /* No.189  RIIC1 TEI1  */
+     ICU_IPRBE_OFFSET,                 /* No.190  RIIC2 EEI2  */
+     ICU_IPRBF_OFFSET,                 /* No.191  RIIC2 RXI2  */
+     ICU_IPRC0_OFFSET,                 /* No.192  RIIC2 TXI2  */
+     ICU_IPRC1_OFFSET,                 /* No.193  RIIC2 TEI2  */
+     ICU_IPRC2_OFFSET,                 /* No.194  RIIC3 EEI3  */
+     ICU_IPRC3_OFFSET,                 /* No.195  RIIC3 RXI3  */
+     ICU_IPRC4_OFFSET,                 /* No.196  RIIC3 TXI3  */
+     ICU_IPRC5_OFFSET,                 /* No.197  RIIC3 TEI3  */
+     ICU_IPRC6_OFFSET,                 /* No.198  DMAC DMAC0I  */
+     ICU_IPRC7_OFFSET,                 /* No.199  DMAC DMAC1I  */
+     ICU_IPRC8_OFFSET,                 /* No.200  DMAC DMAC2I  */
+     ICU_IPRC9_OFFSET,                 /* No.201  DMAC DMAC3I  */
+     ICU_IPRCA_OFFSET,                 /* No.202  EXDMAC EXDMAC0I  */
+     ICU_IPRCB_OFFSET,                 /* No.203  EXDMAC EXDMAC1I  */
+ 	NULL_OFF, NULL_OFF,                     /* No.204 - 205 予約 */
+     ICU_IPRCE_OFFSET,                 /* No.206  DEU DEU0  */
+     ICU_IPRCF_OFFSET,                 /* No.207  DEU DEU0  */
+     ICU_IPRD0_OFFSET,                 /* No.208  PDC PCDFI  */
+     ICU_IPRD1_OFFSET,                 /* No.209  PDC PCFEI  */
+     ICU_IPRD2_OFFSET,                 /* No.210  PDC PCERI  */
+ 	NULL_OFF, NULL_OFF, NULL_OFF,               /* No.211 - 213 予約 */
+     ICU_IPRD6_OFFSET,                 /* No.214  SCI0 RXI0  */
+     ICU_IPRD6_OFFSET,                 /* No.215  SCI0 TXI0  */
+     ICU_IPRD6_OFFSET,                 /* No.216  SCI0 TEI0  */
+     ICU_IPRD9_OFFSET,                 /* No.217  SCI1 RXI1  */
+     ICU_IPRD9_OFFSET,                 /* No.218  SCI1 TXI1  */
+     ICU_IPRD9_OFFSET,                 /* No.219  SCI1 TEI1  */
+     ICU_IPRDC_OFFSET,                 /* No.220  SCI2 RXI2  */
+     ICU_IPRDC_OFFSET,                 /* No.221  SCI2 TXI2  */
+     ICU_IPRDC_OFFSET,                 /* No.222  SCI2 TEI2  */
+     ICU_IPRDF_OFFSET,                 /* No.223  SCI3 RXI3  */
+     ICU_IPRDF_OFFSET,                 /* No.224  SCI3 TXI3  */
+     ICU_IPRDF_OFFSET,                 /* No.225  SCI3 TEI3  */
+     ICU_IPRE2_OFFSET,                 /* No.226  SCI4 RXI4  */
+     ICU_IPRE2_OFFSET,                 /* No.227  SCI4 TXI4  */
+     ICU_IPRE2_OFFSET,                 /* No.228  SCI4 TEI4  */
+     ICU_IPRE5_OFFSET,                 /* No.229  SCI5 RXI5  */
+     ICU_IPRE5_OFFSET,                 /* No.230  SCI5 TXI5  */
+     ICU_IPRE5_OFFSET,                 /* No.231  SCI5 TEI5  */
+     ICU_IPRE8_OFFSET,                 /* No.232  SCI6 RXI6  */
+     ICU_IPRE8_OFFSET,                 /* No.233  SCI6 TXI6  */
+     ICU_IPRE8_OFFSET,                 /* No.234  SCI6 TEI6  */
+     ICU_IPREB_OFFSET,                 /* No.235  SCI7 RXI7  */
+     ICU_IPREB_OFFSET,                 /* No.236  SCI7 TXI7  */
+     ICU_IPREB_OFFSET,                 /* No.237  SCI7 TEI7  */
+     ICU_IPREE_OFFSET,                 /* No.238  SCI8 RXI8  */
+     ICU_IPREE_OFFSET,                 /* No.239  SCI8 TXI8  */
+     ICU_IPREE_OFFSET,                 /* No.240  SCI8 TEI8  */
+     ICU_IPRF1_OFFSET,                 /* No.241  SCI9 RXI9  */
+     ICU_IPRF1_OFFSET,                 /* No.242  SCI9 TXI9  */
+     ICU_IPRF1_OFFSET,                 /* No.243  SCI9 TEI9  */
+     ICU_IPRF4_OFFSET,                 /* No.244  SCI10 RXI10  */
+     ICU_IPRF4_OFFSET,                 /* No.245  SCI10 TXI10  */
+     ICU_IPRF4_OFFSET,                 /* No.246  SCI10 TEI10  */
+     ICU_IPRF7_OFFSET,                 /* No.247  SCI11 RXI11  */
+     ICU_IPRF7_OFFSET,                 /* No.248  SCI11 TXI11  */
+     ICU_IPRF7_OFFSET,                 /* No.249  SCI11 TEI11  */
+     ICU_IPRFA_OFFSET,                 /* No.250  SCI12 RXI12  */
+     ICU_IPRFA_OFFSET,                 /* No.251  SCI12 TXI12  */
+     ICU_IPRFA_OFFSET,                 /* No.252  SCI12 TEI12  */
+     ICU_IPRFD_OFFSET,                 /* No.253  IEB IEBINT  */
+ 	NULL_OFF, NULL_OFF,						/* No.254 - 255 予約 */
+ };
+ 
+ /*
+  * set interrupt priority register
+  */
+ 
+ void set_icu_ipr(INTNO intno, uint8_t pri_num){
+   *((volatile uint8_t *)(ICU_IPR_BASE + ipr_reg_offset[intno])) = pri_num;
+ }
diff -cr --new-file asp/arch/rx_gcc/rx72n/rx72n_config.h 1.9.1_update/arch/rx_gcc/rx72n/rx72n_config.h
*** asp/arch/rx_gcc/rx72n/rx72n_config.h	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/arch/rx_gcc/rx72n/rx72n_config.h	Thu Dec 15 13:53:29 2022
***************
*** 0 ****
--- 1,79 ----
+ /*
+  *  TOPPERS/ASP Kernel
+  *      Toyohashi Open Platform for Embedded Real-Time Systems/
+  *      Advanced Standard Profile Kernel
+  *
+  *  Copyright (C) 2008-2010 by Witz Corporation, JAPAN
+  *
+  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
+  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
+  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
+  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+  *      スコード中に含まれていること．
+  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
+  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
+  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
+  *      の無保証規定を掲載すること．
+  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
+  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
+  *      と．
+  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
+  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
+  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
+  *        報告すること．
+  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
+  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
+  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
+  *      免責すること．
+  *
+  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
+  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
+  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
+  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
+  *  の責任を負わない．
+  *
+  */
+ 
+ /*
+  *		プロセッサ依存モジュール（RX72n用）
+  *
+  *  このインクルードファイルは，target_config.h（または，そこからインク
+  *  ルードされるファイル）のみからインクルードされる．他のファイルから
+  *  直接インクルードしてはならない．
+  */
+ 
+ 
+ #ifndef TOPPERS_RX72n_CONFIG_H
+ #define TOPPERS_RX72n_CONFIG_H
+ 
+ #define ARCH_RENESAS_RX72n
+ 
+ /*
+  *  割込み要因数
+  */
+ #define	INHNO_MAX	UINT_C( 256 )
+ 
+ 
+ /*
+  *  割込み制御用定義
+  */
+ #define	INVALID_OFFSET				( 0xFFU )
+ #define	INTNO_IRQ( intno )			( ( 64U <= ( intno ) ) && ( ( intno ) <= 79U ) )
+ #define	INTNO_IRQ_OFFSET( intno )	( ( intno ) - 64U )
+ #define	IRQ_MAX						UINT_C( 16 )
+ 
+ #ifndef TOPPERS_MACRO_ONLY
+ 
+ void set_icu_ipr(INTNO, uint8_t);
+ 
+ #endif
+ 
+ /*
+  *  プロセッサ依存モジュール（RX72n用）
+  */
+ #include "rx_gcc/rx_common/prc_config.h"
+ 
+ #endif	/* TOPPERS_RX72n_CONFIG_H */
+ 
diff -cr --new-file asp/arch/rx_gcc/rx72n/rx72n_elf.ld 1.9.1_update/arch/rx_gcc/rx72n/rx72n_elf.ld
*** asp/arch/rx_gcc/rx72n/rx72n_elf.ld	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/arch/rx_gcc/rx72n/rx72n_elf.ld	Thu Dec 15 13:49:08 2022
***************
*** 0 ****
--- 1,80 ----
+ MEMORY
+ {
+     FLASH (rx) : ORIGIN = 0xFFF00000, LENGTH = 1024K
+     SRAM (rwx) : ORIGIN = 0x00000000, LENGTH = 64K
+ }
+ 
+ PROVIDE(hardware_init_hook = 0);
+ PROVIDE(software_init_hook = 0);
+ PROVIDE(software_term_hook = 0);
+ STARTUP(start.o)
+ 
+ SECTIONS
+ {
+ 
+ 	.text :
+ 	{
+ 		__text = .;
+ 		*(.vector)
+ 		*(.text)
+ 		*(.text.*)
+ 		*(P)
+ 	} > FLASH
+ 	_etext = .;
+ 	PROVIDE(etext = .);
+ 
+ 	.rodata :
+ 	{
+ 		*(.rodata)
+ 		*(.rodata.*)
+ 		*(C_1)
+ 		*(C_2)
+ 		*(C)
+ 		*(C$VECT)
+ 	} > FLASH
+     __rodata_end = .;
+ 	__exidx_start = .;
+ 	__exidx_end = .;
+ 
+ 	. = 0x0; /*SRAM START ADDRES*/
+ 	.bss : 
+ 	{
+ 		__bss_start  = .;
+         *(DTCA_VECTOR_SEC)
+         __dtca_start = .;
+ 		*(.bss)
+ 		*(.bss.*)
+ 		*(COMMON)
+ 		*(B)
+ 		*(B_1)
+ 		*(B_2)
+ 		*(SI) /* SI is kernel stack section*/
+ 	    __bss_end = .;
+ 	} > SRAM
+ 
+     . = __rodata_end;
+ 	. = ALIGN(4);
+ 	__idata_start = .;
+ 	.data : 
+ 	{
+ 		__data_start = .;
+ 		*(.data)
+ 		*(.data.*)
+ 		*(D)
+ 		*(D_1)
+ 		*(D_2)
+ 	    __data_end = .;
+ 	} > SRAM AT> FLASH
+     
+ 	__idata_end = __idata_start + SIZEOF(.data);
+ 	_edata = .;
+ 	PROVIDE(edata = .);
+     
+ 	. = ALIGN(4);
+     .fvectors 0xFFFFFF80 :
+    {
+       *(.fvect)
+     } > FLASH
+ 	_end = .;
+ 	PROVIDE(end = .);
+ }
diff -cr --new-file asp/arch/rx_gcc/rx72n/rx72n_support.c 1.9.1_update/arch/rx_gcc/rx72n/rx72n_support.c
*** asp/arch/rx_gcc/rx72n/rx72n_support.c	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/arch/rx_gcc/rx72n/rx72n_support.c	Thu Dec 15 13:53:29 2022
***************
*** 0 ****
--- 1,55 ----
+ /*
+  *  TOPPERS/ASP Kernel
+  *      Toyohashi Open Platform for Embedded Real-Time Systems/
+  *      Advanced Standard Profile Kernel
+  *
+  *  Copyright (C) 2010 by Witz Corporation, JAPAN
+  *  Copyright (C) 2016- by Hisashi Hata, JAPAN
+  *
+  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
+  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
+  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
+  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+  *      スコード中に含まれていること．
+  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
+  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
+  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
+  *      の無保証規定を掲載すること．
+  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
+  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
+  *      と．
+  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
+  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
+  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
+  *        報告すること．
+  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
+  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
+  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
+  *      免責すること．
+  *
+  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
+  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
+  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
+  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
+  *  の責任を負わない．
+  *
+  */
+ #include <kernel.h>
+ #include <RX72n.h>
+ 
+ void set_init_moudlestop_setting(){
+     /* power management setting*/
+ 	/* unlock register access */
+ 	sil_wrh_mem((void *)(SYSTEM_PRCR_ADDR), SYSTEM_PRKEY | SYSTEM_PRC1);
+ 
+ 	//enable RSPI0
+ 	sil_wrw_mem((void*)SYSTEM_MSTPCRA_ADDR, 0x46FFFFFF); //reset MSTPCRA
+ 	sil_wrw_mem((void*)SYSTEM_MSTPCRB_ADDR, 0xFFFFFFFF); //reset MSTPCRB
+ 	sil_wrw_mem((void*)SYSTEM_MSTPCRC_ADDR, 0xFFFF0000); //reset MSTPCRC
+ 
+ 	//lock register access
+ 	sil_wrh_mem((void *)(SYSTEM_PRCR_ADDR), SYSTEM_PRKEY );
+ 	/* end power management setting */
+ }
diff -cr --new-file asp/arch/rx_gcc/rx72n/rx72n_support.h 1.9.1_update/arch/rx_gcc/rx72n/rx72n_support.h
*** asp/arch/rx_gcc/rx72n/rx72n_support.h	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/arch/rx_gcc/rx72n/rx72n_support.h	Thu Dec 15 13:53:29 2022
***************
*** 0 ****
--- 1,40 ----
+ /*
+  *  TOPPERS/ASP Kernel
+  *      Toyohashi Open Platform for Embedded Real-Time Systems/
+  *      Advanced Standard Profile Kernel
+  * 
+  *  Copyright (C) 2010 by Witz Corporation, JAPAN
+  *  Copyright (C) 2016- by Hisashi Hata, JAPAN
+  * 
+  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
+  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
+  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
+  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+  *      スコード中に含まれていること．
+  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
+  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
+  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
+  *      の無保証規定を掲載すること．
+  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
+  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
+  *      と．
+  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
+  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
+  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
+  *        報告すること．
+  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
+  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
+  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
+  *      免責すること．
+  * 
+  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
+  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
+  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
+  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
+  *  の責任を負わない．
+  * 
+  */
+ 
+ void set_init_moudlestop_setting();
diff -cr --new-file asp/arch/rx_gcc/rx72n/start.S 1.9.1_update/arch/rx_gcc/rx72n/start.S
*** asp/arch/rx_gcc/rx72n/start.S	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/arch/rx_gcc/rx72n/start.S	Thu Dec 15 14:25:05 2022
***************
*** 0 ****
--- 1,93 ----
+ ;*
+ ;*  TOPPERS/ASP Kernel
+ ;*      Toyohashi Open Platform for Embedded Real-Time Systems/
+ ;*      Advanced Standard Profile Kernel
+ ;* 
+ ;*  Copyright (C) 2000-2003 by Embedded and Real-Time Systems Laboratory
+ ;*                              Toyohashi Univ. of Technology, JAPAN
+ ;*  Copyright (C) 2005,2006 by Embedded and Real-Time Systems Laboratory
+ ;*              Graduate School of Information Science, Nagoya Univ., JAPAN
+ ;*  Copyright (C) 2008-2010 by Witz Corporation, JAPAN
+ ;*  Copyright (C) 2015 by Hisashi Hata, JAPAN
+ ;* 
+ ;*  上記著作権者は，Free Software Foundation によって公表されている 
+ ;*  GNU General Public License の Version 2 に記述されている条件か，以
+ ;*  下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェア（本ソフトウェ
+ ;*  アを改変したものを含む．以下同じ）を使用・複製・改変・再配布（以下，
+ ;*  利用と呼ぶ）することを無償で許諾する．
+ ;*  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+ ;*      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+ ;*      スコード中に含まれていること．
+ ;*  (2) 本ソフトウェアを再利用可能なバイナリコード（リロケータブルオブ
+ ;*      ジェクトファイルやライブラリなど）の形で利用する場合には，利用
+ ;*      に伴うドキュメント（利用者マニュアルなど）に，上記の著作権表示，
+ ;*      この利用条件および下記の無保証規定を掲載すること．
+ ;*  (3) 本ソフトウェアを再利用不可能なバイナリコードの形または機器に組
+ ;*      み込んだ形で利用する場合には，次のいずれかの条件を満たすこと．
+ ;*    (a) 利用に伴うドキュメント（利用者マニュアルなど）に，上記の著作
+ ;*        権表示，この利用条件および下記の無保証規定を掲載すること．
+ ;*    (b) 利用の形態を，別に定める方法によって，上記著作権者に報告する
+ ;*        こと．
+ ;*  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+ ;*      害からも，上記著作権者を免責すること．
+ ;* 
+ ;*  本ソフトウェアは，無保証で提供されているものである．上記著作権者は，
+ ;*  本ソフトウェアに関して，その適用可能性も含めて，いかなる保証も行わ
+ ;*  ない．また，本ソフトウェアの利用により直接的または間接的に生じたい
+ ;*  かなる損害に関しても，その責任を負わない．
+ ;* 
+ 
+ #if 1
+ #define TOPPERS_MACRO_ONLY
+ #define UINT_C(val)		(val)		/* uint_t型の定数を作るマクロ */
+ #define ULONG_C(val)	(val)		/* ulong_t型の定数を作るマクロ */
+ #define CAST(type, val)	(val)		/* 型キャストを行うマクロ */
+ #include "kernel_impl.h"
+ 
+ .text
+ .balign 4
+ .global _start
+ 		
+ _start:
+ 
+ 	;  可変ベクタテーブルの設定
+ 	;
+ 	mvtc	#__vvector_table, intb			; ベクタテーブルの設定
+ 
+ 	;
+ 	;  ハードウェア固有の初期化ルーチンの呼出し
+ 	;
+ 	mov.l	#_hardware_init_hook, r5
+ 	cmp		#0, r5
+ 	beq.b	init_D
+ 	jsr		r5
+ 
+ 	;
+ 	;  初期値あり変数領域の初期化
+ 	;
+ init_D:
+ 	;
+ 	;  初期値なし変数領域の初期化
+ 	;
+ clear_B:
+ 
+ 	;
+ 	;  software_init_hook を呼出し（0 でない場合）
+ 	;
+ 	;  ソフトウェア環境（特にライブラリ）に依存して必要な初期化処理
+ 	;  がある場合は，software_init_hook という関数を用意すればよい.
+ 	;
+ 	mov.l	#_software_init_hook, r5
+ 	cmp		#0, r5
+ 	beq.b	kernel_link
+ 	jsr		r5
+ 
+ 	;
+ 	;  カーネルスタート
+ 	;
+ kernel_link:
+ 	bra.a	_sta_ker					; --> _sta_ker()
+ 
+ 
+ .end
+ #endif
diff -cr --new-file asp/arch/rx_gcc/rx_common/Makefile.prc_common 1.9.1_update/arch/rx_gcc/rx_common/Makefile.prc_common
*** asp/arch/rx_gcc/rx_common/Makefile.prc_common	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/arch/rx_gcc/rx_common/Makefile.prc_common	Thu Dec 15 13:49:08 2022
***************
*** 0 ****
--- 1,53 ----
+ #
+ #		Makefile のcpu依存部（rx用）
+ #
+ 
+ # 
+ #  CPU依存部ディレクトリ名の定義 
+ # 
+ ARCH_COM_DIR = $(SRCDIR)/arch/rx_$(TOOL)/rx_common
+ 
+ #  コンパイルオプション
+ #
+ INCLUDES := $(INCLUDES) -I$(ARCH_COM_DIR)
+ CDEFS := $(CDEFS)
+ COPTS := $(COPTS)
+ 
+ #
+ #  カーネルに関する定義
+ #
+ KERNEL_DIR := $(KERNEL_DIR) $(ARCH_COM_DIR)
+ KERNEL_ASMOBJS := $(KERNEL_ASMOBJS) prc_test.o
+ KERNEL_COBJS := $(KERNEL_COBJS) 
+ 
+ #
+ #  システムサービスに関する定義
+ #
+ SYSSVC_DIR := $(SYSSVC_DIR)
+ SYSSVC_COBJS := $(SYSSVC_COBJS)
+ 
+ #
+ #  依存関係の定義
+ #
+ $(OBJFILE): $(ARCH_COM_DIR)/prc_check.tf
+ 
+ #
+ #		Makefile のプロセッサ依存部（RX用）
+ #
+ 
+ #
+ #  カーネルに関する定義
+ #
+ KERNEL_DIR := $(KERNEL_DIR) $(COREDIR)
+ KERNEL_ASMOBJS := $(KERNEL_ASMOBJS) prc_support.o
+ KERNEL_COBJS := $(KERNEL_COBJS) prc_config.o
+ 
+ #
+ #  依存関係の定義
+ #
+ cfg1_out.c: $(ARCH_COM_DIR)/prc_def.csv
+ 
+ #
+ #  コンフィギュレータ関係の変数の定義
+ #
+ CFG_TABS := $(CFG_TABS) --cfg1-def-table $(ARCH_COM_DIR)/prc_def.csv  
diff -cr --new-file asp/arch/rx_gcc/rx_common/core_offset.tf 1.9.1_update/arch/rx_gcc/rx_common/core_offset.tf
*** asp/arch/rx_gcc/rx_common/core_offset.tf	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/arch/rx_gcc/rx_common/core_offset.tf	Thu Dec 15 13:49:08 2022
***************
*** 0 ****
--- 1,18 ----
+ $
+ $       オフセットファイル生成用テンプレートファイル (RX用）
+ $
+ 
+ 
+ $
+ $  標準テンプレートファイルのインクルード
+ $
+ 
+ $DEFINE("TCB_tinib", offsetof_TCB_p_tinib)$
+ $DEFINE("TCB_pc", offsetof_TCB_pc)$
+ $DEFINE("TCB_sp", offsetof_TCB_sp)$
+ $DEFINE("TCB_texptn", offsetof_TCB_texptn)$
+ $DEFINE("TINIB_exinf", offsetof_TINIB_exinf)$
+ $DEFINE("TINIB_task", offsetof_TINIB_task)$
+ 
+ $DEFINE_BIT("TCB_enatex", sizeof_TCB,"B")$
+ 
diff -cr --new-file asp/arch/rx_gcc/rx_common/prc_asm_config.tf 1.9.1_update/arch/rx_gcc/rx_common/prc_asm_config.tf
*** asp/arch/rx_gcc/rx_common/prc_asm_config.tf	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/arch/rx_gcc/rx_common/prc_asm_config.tf	Thu Dec 15 13:49:08 2022
***************
*** 0 ****
--- 1,13 ----
+ $
+ $     asm_config.inc 生成用
+ $     パス2のアーキテクチャ依存テンプレート（rx用）
+ $
+ 
+ $FILE "asm_config.inc"$
+ 
+ 
+ #define TIPM_LOCK $TAB$$TAB$ $TAB$ $+TIPM_LOCK$ $NL$
+ #define IPL_LOCK $TAB$$TAB$ $TAB$ $+IPL_LOCK$ $NL$
+ #define PSW_I_MASK $TAB$$TAB$ $TAB$ $+PSW_I_MASK$ $NL$
+ #define PSW_IPL_MASK $TAB$$TAB$ $TAB$ $+PSW_IPL_MASK$ $NL$
+ #define EXC_GET_PSW_OFFSET $TAB$$TAB$ $TAB$ $+EXC_GET_PSW_OFFSET$ $NL$
diff -cr --new-file asp/arch/rx_gcc/rx_common/prc_cfg1_out.h 1.9.1_update/arch/rx_gcc/rx_common/prc_cfg1_out.h
*** asp/arch/rx_gcc/rx_common/prc_cfg1_out.h	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/arch/rx_gcc/rx_common/prc_cfg1_out.h	Thu Dec 15 13:49:08 2022
***************
*** 0 ****
--- 1,49 ----
+ /*
+  *		cfg1_out.cのリンクに必要なスタブの定義
+  */
+ 
+ void sta_ker( void )
+ {
+ }
+ 
+ STK_T *const	_kernel_istkpt = 0x00;
+ 
+ void hardware_init_hook( void )
+ {
+ }
+ 
+ void software_init_hook( void )
+ {
+ }
+ 
+ const SIZE		_kernel_istksz = 0;
+ 
+ STK_T *const	_kernel_istk = NULL;
+ 
+ uint32_t *const _vvector_table = 0x00;
+ 
+ /* 
+  *  オフセットファイルを生成するための定義 
+  */ 
+ const uint8_t   MAGIC_1 = 0x12; 
+ const uint16_t  MAGIC_2 = 0x1234; 
+ const uint32_t  MAGIC_4 = 0x12345678;
+ 
+ const TCB	TCB_enatex = {
+ 	{ NULL, NULL },			/* task_queue */
+ 	NULL,					/* p_tinib */
+ 	0U,						/* tstat */
+ #ifdef TOPPERS_SUPPORT_MUTEX
+ 	0U,						/* bpriority */
+ #endif /* TOPPERS_SUPPORT_MUTEX */
+ 	0U,						/* priority */
+ 	false,					/* acqeue */
+ 	false,					/* wupque */
+ 	true,					/* enatex */
+ 	0U,						/* texprn */
+ 	NULL,					/* p_winifo */
+ #ifdef TOPPERS_SUPPORT_MUTEX
+ 	{ NULL, NULL },			/* mutex_queue */
+ #endif /* TOPPERS_SUPPORT_MUTEX */
+ 	{ NULL, NULL }			/* tskctxb */
+ };
diff -cr --new-file asp/arch/rx_gcc/rx_common/prc_check.tf 1.9.1_update/arch/rx_gcc/rx_common/prc_check.tf
*** asp/arch/rx_gcc/rx_common/prc_check.tf	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/arch/rx_gcc/rx_common/prc_check.tf	Thu Dec 15 13:53:29 2022
***************
*** 0 ****
--- 1,56 ----
+ $ 
+ $  TOPPERS/ASP Kernel
+ $      Toyohashi Open Platform for Embedded Real-Time Systems/
+ $      Advanced Standard Profile Kernel
+ $ 
+ $  Copyright (C) 2008-2010 by Witz Corporation, JAPAN
+ $  Copyright (C) 2015-  by Hisashi Hata, JAPAN
+ $ 
+ $  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
+ $  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
+ $  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
+ $  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+ $      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+ $      スコード中に含まれていること．
+ $  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
+ $      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
+ $      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
+ $      の無保証規定を掲載すること．
+ $  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
+ $      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
+ $      と．
+ $    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
+ $        作権表示，この利用条件および下記の無保証規定を掲載すること．
+ $    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
+ $        報告すること．
+ $  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+ $      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
+ $      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
+ $      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
+ $      免責すること．
+ $ 
+ $  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
+ $  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
+ $  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
+ $  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
+ $  の責任を負わない．
+ $ 
+ 
+ $ 
+ $ 		パス3のプロセッサ依存テンプレート（RX用）
+ $ 
+ 
+ $ 
+ $  チェック方法の指定
+ $ 
+ $CHECK_FUNC_ALIGN = 1$
+ $CHECK_FUNC_NONNULL = 1$
+ $CHECK_STACK_ALIGN = 4$
+ $CHECK_STACK_NONNULL = 1$
+ $CHECK_MPF_ALIGN = 4$
+ $CHECK_MPF_NONNULL = 1$
+ 
+ $ 
+ $  標準テンプレートファイルのインクルード
+ $ 
+ $INCLUDE "kernel/kernel_check.tf"$
diff -cr --new-file asp/arch/rx_gcc/rx_common/prc_config.c 1.9.1_update/arch/rx_gcc/rx_common/prc_config.c
*** asp/arch/rx_gcc/rx_common/prc_config.c	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/arch/rx_gcc/rx_common/prc_config.c	Thu Dec 15 18:41:47 2022
***************
*** 0 ****
--- 1,235 ----
+ /*
+  *  TOPPERS/ASP Kernel
+  *      Toyohashi Open Platform for Embedded Real-Time Systems/
+  *      Advanced Standard Profile Kernel
+  * 
+  *  Copyright (C) 2000-2003 by Embedded and Real-Time Systems Laboratory
+  *                              Toyohashi Univ. of Technology, JAPAN
+  *  Copyright (C) 2005,2006 by Embedded and Real-Time Systems Laboratory
+  *              Graduate School of Information Science, Nagoya Univ., JAPAN
+  *  Copyright (C) 2008-2010 by Witz Corporation, JAPAN
+  *  Copyright (C) 2015 by Hisashi Hata, JAPAN
+  * 
+  *  上記著作権者は，以下の (1)〜(4) の条件か，Free Software Foundation 
+  *  によって公表されている GNU General Public License の Version 2 に記
+  *  述されている条件を満たす場合に限り，本ソフトウェア（本ソフトウェア
+  *  を改変したものを含む．以下同じ）を使用・複製・改変・再配布（以下，
+  *  利用と呼ぶ）することを無償で許諾する．
+  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+  *      スコード中に含まれていること．
+  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
+  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
+  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
+  *      の無保証規定を掲載すること．
+  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
+  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
+  *      と．
+  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
+  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
+  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
+  *        報告すること．
+  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
+  * 
+  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
+  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，その適用可能性も
+  *  含めて，いかなる保証も行わない．また，本ソフトウェアの利用により直
+  *  接的または間接的に生じたいかなる損害に関しても，その責任を負わない．
+  * 
+  */
+ 
+ /*
+  *		プロセッサ依存モジュール（RX72N用）
+  */
+ 
+ #include "kernel_impl.h"
+ 
+ 
+ /*
+  *  割込み発生回数を保存する変数
+  */
+ uint16_t	intnest;
+ 
+ /*
+  *  CPUロックフラグ実現のための変数
+  */
+ #if TIPM_LOCK != -15
+ bool_t		lock_flag;		/* CPUロックフラグの値を保持する変数 */
+ uint32_t	saved_ipl;		/* 割込み優先度レベルを保存する変数 */
+ #endif	/* TIPM_LOCK != -15	*/
+ 
+ uint32_t	saved_psw;
+ /*
+  *  プロセッサ依存の初期化
+  */
+ void
+ prc_initialize( void )
+ {
+ 	/*
+ 	 *  割込み発生回数の初期化
+ 	 *
+ 	 *  スタートアップは全割込みロック状態 & 非タスクコンテキスト
+ 	 *  にて動作するため, 非タスクコンテキストに偽装する.
+ 	 */
+ 	intnest = 1U;
+ 
+ #if TIPM_LOCK != -15
+ 	/*
+ 	 *  CPUロックフラグ実現のための変数の初期化
+ 	 */
+ 	lock_flag = true;
+ 	saved_ipl = IPL_ENAALL;
+ #endif	/* TIPM_LOCK != -15	*/
+ }
+ 
+ 
+ /*
+  *  プロセッサ依存の終了処理
+  */
+ void
+ prc_terminate( void )
+ {
+ 	/*
+ 	 *  特に必要な処理はない
+ 	 */
+ }
+ 
+ 
+ /*
+  *  CPU例外の発生状況のログ出力
+  *
+  *  CPU例外ハンドラの中から，CPU例外情報ポインタ（p_excinf）を引数とし
+  *  て呼び出すことで，CPU例外の発生状況をシステムログに出力する．
+  */
+ #ifdef SUPPORT_XLOG_SYS
+ void
+ xlog_sys( void *p_excinf )
+ {
+ 	syslog(LOG_ERROR , "r1 = %u") , *((uint32_t*)((intptr_t)p_excinf + 14));
+ 	syslog(LOG_ERROR , "r2 = %u") , *((uint32_t*)((intptr_t)p_excinf + 15));
+ 	syslog(LOG_ERROR , "r3 = %u") , *((uint32_t*)((intptr_t)p_excinf + 16));
+ 	syslog(LOG_ERROR , "r4 = %u") , *((uint32_t*)((intptr_t)p_excinf + 17));
+ 	syslog(LOG_ERROR , "r5 = %u") , *((uint32_t*)((intptr_t)p_excinf + 18));
+ 	syslog(LOG_ERROR , "r6 = %u") , *((uint32_t*)((intptr_t)p_excinf + 1));
+ 	syslog(LOG_ERROR , "r7 = %u") , *((uint32_t*)((intptr_t)p_excinf + 2));
+ 	syslog(LOG_ERROR , "r8 = %u") , *((uint32_t*)((intptr_t)p_excinf + 3));
+ 	syslog(LOG_ERROR , "r9 = %u") , *((uint32_t*)((intptr_t)p_excinf + 4));
+ 	syslog(LOG_ERROR , "r10 = %u") , *((uint32_t*)((intptr_t)p_excinf + 5));
+ 	syslog(LOG_ERROR , "r11 = %u") , *((uint32_t*)((intptr_t)p_excinf + 6));
+ 	syslog(LOG_ERROR , "r12 = %u") , *((uint32_t*)((intptr_t)p_excinf + 7));
+ 	syslog(LOG_ERROR , "r13 = %u") , *((uint32_t*)((intptr_t)p_excinf + 8));
+ 	syslog(LOG_ERROR , "r14 = %u") , *((uint32_t*)((intptr_t)p_excinf + 12));
+ 	syslog(LOG_ERROR , "r15 = %u") , *((uint32_t*)((intptr_t)p_excinf + 13));
+ 	syslog(LOG_ERROR , "fpsw = %u") , *((uint32_t*)((intptr_t)p_excinf + 11));
+ 	syslog(LOG_ERROR , "acclo = %u") , *((uint32_t*)((intptr_t)p_excinf + 10));
+ 	syslog(LOG_ERROR , "acchi = %u") , *((uint32_t*)((intptr_t)p_excinf + 9));
+ 	syslog(LOG_ERROR , "pc = %x") , *((uint32_t*)((intptr_t)p_excinf + 19));
+ 	syslog(LOG_ERROR , "psw = %x") , *((uint32_t*)((intptr_t)p_excinf + 20));
+ }
+ #endif /* SUPPORT_XLOG_SYS */
+ 
+ 
+ /*
+  *  割込み要求ラインの属性の設定
+  *
+  *  ASPカーネルでの利用を想定して，パラメータエラーはアサーションでチェッ
+  *  クしている．cfg_intサービスコールを設ける場合には，エラーを返すよう
+  *  にすべきであろう．
+  */
+ void
+ x_config_int( INTNO intno, ATR intatr, PRI intpri )
+ {
+ 	uint8_t		irq_offset;
+ 	uint8_t		irq_val;
+ 
+ 	assert( VALID_INTNO_CFGINT(intno) );
+ 
+ 	assert( ( -15 <= intpri ) && ( intpri <= TMAX_INTPRI ) );
+ #if TIPM_LOCK != -15
+ 	if( intatr == TA_NONKERNEL ){
+ 		assert( intpri < TMIN_INTPRI );
+  	}
+ 	else{
+ 		assert( TMIN_INTPRI <= intpri ); 
+ 	}
+ #endif
+ 
+ 	/*
+ 	 *  割込みのマスク
+ 	 *
+ 	 *  割込みを受け付けたまま，レベルトリガ／エッジトリガの設定や，割
+ 	 *  込み優先度の設定を行うのは危険なため，割込み属性にかかわらず，
+ 	 *  一旦マスクする．
+ 	 */
+ 	( void )x_disable_int( intno );
+ 
+ 	/*
+ 	 *  レベルトリガ/エッジトリガの設定
+ 	 *
+ 	 *  IRQのみサポートする
+ 	 */
+ 	if( INTNO_IRQ( intno ) != 0U ){
+ 		irq_offset = INTNO_IRQ_OFFSET( intno );
+ 
+ 		if( ( intatr & TA_POSEDGE ) != 0U ){
+ 			irq_val = IRQ_POSEDGE;
+ 		}
+ 		else if( ( intatr & TA_NEGEDGE ) != 0U ){
+ 			irq_val = IRQ_NEGEDGE;
+ 		}
+ 		else if( ( intatr & TA_BOTHEDGE ) != 0U ){
+ 			irq_val = IRQ_BOTHEDGE;
+ 		}
+ 		else if( ( intatr & TA_LOWLEVEL ) != 0U ){
+ 			irq_val = IRQ_LOWLEVEL;
+ 		}
+ 		else{
+ 			/*
+ 			 *  コンフィギュレータにてチェックしているため,
+ 			 *  ここへくることはありえない.
+ 			 */
+ 			irq_val = 0U;
+ 		}
+ 
+ 		SET_ICU_IRQCR(irq_offset, irq_val);
+ 	}
+ 
+ 	/*
+ 	 *  割込みレベルの設定
+ 	 *
+ 	 *  割込み番号に対応したIPR値を設定する.
+ 	 */
+     set_icu_ipr(intno, cfg_int_table[intno].intpri);
+ 
+ 	/*
+ 	 *  割込みのマスク解除
+  	 */
+ 	if( ( intatr & TA_ENAINT ) != 0U ){
+ 		( void )x_enable_int( intno );
+ 	}
+ }
+ 
+ 
+ #ifndef OMIT_DEFAULT_INT_HANDLER
+ /*
+  *  未登録の割込みが発生した場合に呼び出される
+  */
+ void
+ default_int_handler( uint32_t intno )
+ {
+   syslog(LOG_EMERG, "Unregistered Interrupt occurs. No %d", intno);
+ }
+ #endif /* OMIT_DEFAULT_INT_HANDLER */
+ 
+ #ifndef OMIT_DEFAULT_EXC_HANDLER
+ /*
+  *  未登録の例外が発生した場合に呼び出される
+  */
+ void
+ default_exc_handler( void )
+ {
+ 	syslog(LOG_EMERG, "Unregistered Expevt error occurs.");
+ }
+ #endif /* OMIT_DEFAULT_EXC_HANDLER */
+ 
diff -cr --new-file asp/arch/rx_gcc/rx_common/prc_config.h 1.9.1_update/arch/rx_gcc/rx_common/prc_config.h
*** asp/arch/rx_gcc/rx_common/prc_config.h	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/arch/rx_gcc/rx_common/prc_config.h	Thu Dec 15 18:37:16 2022
***************
*** 0 ****
--- 1,698 ----
+ /*
+  *  TOPPERS/ASP Kernel
+  *      Toyohashi Open Platform for Embedded Real-Time Systems/
+  *      Advanced Standard Profile Kernel
+  * 
+  *  Copyright (C) 2000-2003 by Embedded and Real-Time Systems Laboratory
+  *                              Toyohashi Univ. of Technology, JAPAN
+  *  Copyright (C) 2005,2006 by Embedded and Real-Time Systems Laboratory
+  *              Graduate School of Information Science, Nagoya Univ., JAPAN
+  *  Copyright (C) 2008-2010 by Witz Corporation, JAPAN
+  *  Copyright (C) 205 by Hisashi Hata, JAPAN
+  * 
+  *  上記著作権者は，以下の (1)〜(4) の条件か，Free Software Foundation 
+  *  によって公表されている GNU General Public License の Version 2 に記
+  *  述されている条件を満たす場合に限り，本ソフトウェア（本ソフトウェア
+  *  を改変したものを含む．以下同じ）を使用・複製・改変・再配布（以下，
+  *  利用と呼ぶ）することを無償で許諾する．
+  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+  *      スコード中に含まれていること．
+  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
+  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
+  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
+  *      の無保証規定を掲載すること．
+  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
+  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
+  *      と．
+  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
+  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
+  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
+  *        報告すること．
+  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
+  * 
+  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
+  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，その適用可能性も
+  *  含めて，いかなる保証も行わない．また，本ソフトウェアの利用により直
+  *  接的または間接的に生じたいかなる損害に関しても，その責任を負わない．
+  * 
+  */
+ 
+ /*
+  *		プロセッサ依存モジュール（RX用）
+  *
+  *  このインクルードファイルは，target_config.h（または，そこからインク
+  *  ルードされるファイル）のみからインクルードされる．他のファイルから
+  *  直接インクルードしてはならない．
+  */
+ 
+ #ifndef TOPPERS_PRC_CONFIG_H
+ #define TOPPERS_PRC_CONFIG_H
+ 
+ #ifndef TOPPERS_MACRO_ONLY
+ 
+ /*
+  *  プロセッサの特殊命令のインライン関数定義
+  */
+ #include "prc_insn.h"
+ 
+ /*
+  *  非タスクコンテキスト用のスタック初期値
+  */
+ 
+ #define TOPPERS_ISTKPT( istk, istksz ) (( STK_T * )(( char * )( istk ) + ( istksz )))
+ 
+ 
+ /*
+  *  タスクコンテキストブロックの定義
+  */
+ typedef struct task_context_block {
+ 	void	*sp;		/* スタックポインタ */
+ 	FP		pc;			/* プログラムカウンタ */
+ } TSKCTXB;
+ 
+ 
+ /*
+  *  割込み発生回数を保存する変数
+  */
+ extern uint16_t intnest;
+ 
+ 
+ /*
+  *  CPUロック状態での割込み優先度マスク
+  *
+  *  TIPM_LOCKは，CPUロック状態での割込み優先度マスク，すなわち，カーネ
+  *  ル管理外のものを除くすべての割込み要求をマスクする値に定義する．
+  *
+  *  TMIN_INTPRI変更することで管理外割込みの有無を決定する．
+  *  例えばTMIN_INTPRIを-14に設定すると，レベル15の割込みがカーネル管理外と
+  *  なる．TMIN_INTPRIを-15に設定すると，NMI以外にカーネル管理外の割込みを
+  *  設けないことになる（この場合には-15に設定することを推奨する）．
+  */
+ #ifndef TIPM_LOCK
+ #define TIPM_LOCK	TMIN_INTPRI
+ #endif /* TIPM_LOCK */
+ 
+ 
+ /*
+  *  TOPPERS標準割込み処理モデルの実現
+  */
+ /*
+  *  コンテキストの参照
+  *
+  *  RXでは，割込みの戻り先がタスクかどうかを判断するために intnest
+  *  を使用している．これを用いてコンテキストを判断する．
+  */
+ Inline bool_t
+ sense_context( void )
+ {
+ 	/*  ネストカウンタ0より大なら非タスクコンテキスト  */
+ 	return ( intnest > 0U );
+ }
+ 
+ 
+ /*
+  *  CPUロックフラグ実現のための変数
+  *
+  *  これらの変数は，CPUロック状態の時のみ書き換えてよいものとする．
+  */
+ #if TIPM_LOCK != -15
+ extern bool_t	lock_flag;		/* CPUロックフラグの値を保持する変数 */
+ extern uint32_t	saved_ipl;		/* 割込み優先度レベルを保存する変数 */
+ #endif	/* TIPM_LOCK != -15	*/
+ 
+ #endif /* TOPPERS_MACRO_ONLY */
+ 
+ 
+ /*
+  *  割込み優先度マスクの外部表現と内部表現の変換
+  *
+  *  RX72Nでは，プロセッサステータスワードレジスタ（PSW）の下から
+  *  24?26ビット目の3ビットに割込み優先度レベル（IPL）が置かれている．
+  *  カーネル管理外割込みを実装する場合にIPLを使用した制御を行う．
+  *  カーネルは割込み優先度マスク（-1から連続した負の値）で管理されて
+  *  いるためIPLとの変換が必要となる．
+  */
+ #define IPL_TO_IPM( ipl )	(-(( PRI )(( ipl ) >> 24U )))		/* IPLをIPMに	*/
+ #define IPM_TO_IPL( ipm )	((( uint32_t )(-( ipm ))) << 24U )	/* IPMをIPLに	*/
+ 
+ 
+ /*
+  *  CPUロック状態での割込み優先度マスクのIPL
+  */
+ #define IPL_LOCK		( IPM_TO_IPL( TIPM_LOCK ) )
+ 
+ /*
+  *  TIPM_ENAALL（割込み優先度マスク全解除）のIPL
+  */
+ #define IPL_ENAALL		( IPM_TO_IPL( TIPM_ENAALL ) )
+ 
+ 
+ #ifndef TOPPERS_MACRO_ONLY
+ 
+ /*
+  *  割込み要因毎のレベル & 属性定義テーブル
+  *  (テンプレートファイルによる出力)
+  */
+ typedef struct cfg_int_info {
+ 	PRI		intpri;
+ 	ATR		intatr;
+ } CFG_INT_INFO;
+ 
+ extern const CFG_INT_INFO cfg_int_table[];
+ 
+ 
+ /*
+  *  割込み番号の範囲の判定
+  *
+  *  割込み番号が有効な値か厳密にチェックするため,
+  *  コンフィギュレータ出力テーブルを参照する.
+  */
+ #define VALID_INTNO( intno )	\
+  				( cfg_int_table[( intno )].intpri > 0 )
+ #define VALID_INTNO_DISINT( intno )	VALID_INTNO( intno )
+ #define VALID_INTNO_CFGINT( intno )	VALID_INTNO( intno )
+ 
+ 
+ /*
+  *  割込み制御レジスタ関連の定義
+  */
+ #define	IRQ_POSEDGE			( 0x08U )
+ #define	IRQ_NEGEDGE			( 0x04U )
+ #define	IRQ_BOTHEDGE		( 0x0CU )
+ #define	IRQ_LOWLEVEL		( 0x00U )
+ 
+ 
+ /*
+  *  CPUロック状態への移行
+  *
+  *  IPM（ハードウェアの割込み優先度マスク）を，saved_iipmに保存し，カー
+  *  ネル管理外のものを除くすべての割込み要求をマスクする値（TIPM_LOCK）
+  *  に設定する．また，lock_flagをTRUEにする．
+  *
+  *  IPMが，最初からTIPM_LOCKと同じかそれより高い場合には，それを
+  *  saved_iipmに保存するのみで，TIPM_LOCKには設定しない．これは，モデル
+  *  上の割込み優先度マスクが，TIPM_LOCKと同じかそれより高いレベルに設定
+  *  されている状態にあたる．
+  *
+  *  この関数は，CPUロック状態（lock_flagがTRUEの状態）で呼ばれることは
+  *  ないものと想定している．
+  */
+ Inline void
+ x_lock_cpu( void )
+ {
+ #if TIPM_LOCK == -15
+ 	disint();
+ #else	/* TIPM_LOCK == -15	*/
+ 	uint32_t	ipl;
+ 
+ 	/*
+ 	 *  current_ipl()の返り値を直接saved_iplに保存せず，一時変数ipl
+ 	 *  を用いているのは，current_ipl()を呼んだ直後に割込みが発生し，
+ 	 *  起動された割込み処理でsaved_iplが変更される可能性があるためで
+ 	 *  ある．
+ 	 */
+ 	ipl = current_ipl();
+ 	if( IPL_LOCK > ipl ){
+ 		set_ipl( IPL_LOCK );
+ 	}
+ 
+ 	saved_ipl = ipl;
+ 	lock_flag = true;
+ #endif	/* TIPM_LOCK == -15	*/
+ }
+ 
+ #define t_lock_cpu()	x_lock_cpu()
+ #define i_lock_cpu()	x_lock_cpu()
+ 
+ 
+ /*
+  *  CPUロック状態の解除
+  *
+  *  lock_flagをFALSEにし，IPM（ハードウェアの割込み優先度マスク）を，
+  *  saved_iipmに保存した値に戻す．
+  *
+  *  この関数は，CPUロック状態（lock_flagがtrueの状態）でのみ呼ばれるも
+  *  のと想定している．
+  */
+ Inline void
+ x_unlock_cpu( void )
+ {
+ #if TIPM_LOCK == -15
+ 	enaint();
+ #else	/* TIPM_LOCK == -15	*/
+ 	lock_flag = false;
+ 	set_ipl( saved_ipl );
+ #endif	/* TIPM_LOCK == -15	*/
+ }
+ 
+ #define t_unlock_cpu()	x_unlock_cpu()
+ #define i_unlock_cpu()	x_unlock_cpu()
+ 
+ 
+ /*
+  *  CPUロック状態の参照
+  */
+ Inline bool_t
+ x_sense_lock( void )
+ {
+ #if TIPM_LOCK == -15
+ 	return (( bool_t )(( current_psw() & PSW_I_MASK) == 0 ));
+ #else	/* TIPM_LOCK == -15	*/
+ 	return lock_flag;
+ #endif	/* TIPM_LOCK == -15	*/
+ }
+ 
+ #define t_sense_lock()	x_sense_lock()
+ #define i_sense_lock()	x_sense_lock()
+ 
+ 
+ /*
+  * （モデル上の）割込み優先度マスクの設定
+  *
+  *  CPUロックフラグがクリアされている時は，ハードウェアの割込み優先度マ
+  *  スクを設定する．CPUロックフラグがセットされている時は，saved_iipm
+  *  を設定し，さらに，ハードウェアの割込み優先度マスクを，設定しようと
+  *  した（モデル上の）割込み優先度マスクとTIPM_LOCKの高い方に設定する．
+  */
+ Inline void
+ x_set_ipm( PRI intpri )
+ {
+ 	uint32_t	ipl = IPM_TO_IPL( intpri );
+ #if TIPM_LOCK == -15
+ 	set_ipl(ipl);
+ #else	/* TIPM_LOCK == -15	*/
+ 	if( !lock_flag ){
+ 		set_ipl(ipl);
+ 	}
+ 	else {
+ 		saved_ipl = ipl;
+ 		set_ipl(ipl > IPL_LOCK ? ipl : IPL_LOCK);
+     }
+ #endif	/* TIPM_LOCK == -15	*/
+ }
+ 
+ #define t_set_ipm( intpri )	x_set_ipm( intpri )
+ #define i_set_ipm( intpri )	x_set_ipm( intpri )
+ 
+ 
+ /*
+  * （モデル上の）割込み優先度マスクの参照
+  *
+  *  CPUロックフラグがクリアされている時はハードウェアの割込み優先度マ
+  *  スクを，セットされている時はsaved_iipmを参照する．
+  */
+ Inline PRI
+ x_get_ipm( void )
+ {
+ 	uint32_t	ipl;
+ #if TIPM_LOCK == -15
+ 	ipl = current_ipl();
+ #else	/* TIPM_LOCK == -15	*/
+ 	if (!lock_flag) {
+ 		ipl = current_ipl();
+ 	}
+ 	else {
+ 		ipl = saved_ipl;
+ 	}
+ #endif	/* TIPM_LOCK == -15	*/
+ 	return IPL_TO_IPM( ipl );
+ }
+ 
+ #define t_get_ipm()		x_get_ipm()
+ #define i_get_ipm()		x_get_ipm()
+ 
+ 
+ /*
+  *  割込み要求禁止フラグのセット
+  *
+  *  割込み属性が設定されていない割込み要求ラインに対して割込み要求禁止
+  *  フラグをセットしようとした場合には，FALSEを返す．
+  */
+ Inline bool_t
+ x_disable_int( INTNO intno )
+ {
+ 	/*
+ 	 *  レベル定義が0である場合はCFG_INTされていない
+ 	 */
+ 	if( cfg_int_table[intno].intpri == 0 ){
+ 		return ( false );
+ 	}
+ 
+     *((volatile uint8_t *)(ICU_IER_BASE+(intno>>3))) &= ~(1 << (intno & 0x7));
+ 
+ 	return ( true );
+ }
+ 
+ #define t_disable_int( intno )	x_disable_int( intno )
+ #define i_disable_int( intno )	x_disable_int( intno )
+ 
+ 
+ /*
+  *  割込み要求禁止フラグのクリア
+  *
+  *  割込み属性が設定されていない割込み要求ラインに対して割込み要求禁止
+  *  フラグをクリアしようとした場合には，FALSEを返す．
+  */
+ Inline bool_t
+ x_enable_int( INTNO intno )
+ {
+ 	/*
+ 	 *  レベル定義が0である場合はCFG_INTされていない
+ 	 */
+ 	if( cfg_int_table[intno].intpri == 0 ){
+ 		return ( false );
+ 	}
+ 
+     *((volatile uint8_t *)(ICU_IER_BASE+(intno>>3))) |= (1 << (intno & 0x7));
+ 
+ 	return ( true );
+ }
+ 
+ #define t_enable_int( intno )	x_enable_int( intno )
+ #define i_enable_int( intno )	x_enable_int( intno )
+ 
+ 
+ /*
+  *  割込み要求のクリア
+  */
+ Inline void
+ x_clear_int( INTNO intno )
+ {
+   *((volatile uint8_t *)(ICU_IR_BASE + intno)) = 0U;
+ }
+ 
+ #define t_clear_int( intno )	x_clear_int( intno )
+ #define i_clear_int( intno )	x_clear_int( intno )
+ 
+ 
+ /*
+  *  割込み要求のチェック
+  */
+ Inline bool_t
+ x_probe_int( INTNO intno )
+ {
+ 	/*
+ 	 *  割込み要求レジスタは0 or 1でしかないため,
+ 	 *  そのままの値を返す.
+ 	 */
+ 	return ( *((volatile uint8_t *)(ICU_IR_BASE + intno)) );
+ }
+ 
+ #define t_probe_int( intno )	x_probe_int( intno )
+ #define i_probe_int( intno )	x_probe_int( intno )
+ 
+ 
+ /*
+  *  割込み要求ラインの属性の設定
+  */
+ extern void	x_config_int( INTNO intno, ATR intatr, PRI intpri );
+ 
+ 
+ /*
+  *  割込みハンドラの入口で必要なIRC操作
+  *
+  */
+ Inline void
+ i_begin_int( INTNO intno )
+ {
+ 	volatile uint8_t	reg;
+ 
+ 	/*
+ 	 *  レベル検出の割込みに対しては割込みステータス
+ 	 *  フラグをクリアする.
+ 	 */
+ 	if( ( cfg_int_table[intno].intatr & TA_LOWLEVEL ) > 0 ){
+ 		if( *((volatile uint8_t *)(ICU_IR_BASE + intno)) > 0U ){
+ 			/*
+ 			 *  外部割込みの場合, IRQ端子がHighに戻っている
+ 			 *  ことを確認する旨が記載されているが, 省略する.
+ 			 */
+ 			*((volatile uint8_t *)(ICU_IR_BASE + intno)) = 0U;
+ 
+ 			/*
+ 			 *  ハードウェアマニュアルに0になったことを
+ 			 *  確認する旨が記載あるため, レジスタ値を読み出す.
+ 			 */
+ 			reg = *((volatile uint8_t *)(ICU_IR_BASE + intno));
+ 		}
+ 	}
+ }
+ 
+ 
+ /*
+  *  割込みハンドラの出口で必要なIRC操作
+  *
+  */
+ Inline void
+ i_end_int( INTNO intno )
+ {
+ 	/* 特に行うべき処理はない */
+ }
+ 
+ 
+ /*
+  *  最高優先順位タスクへのディスパッチ（prc_support.a30）
+  *
+  *  dispatchは，タスクコンテキストから呼び出されたサービスコール処理か
+  *  ら呼び出すべきもので，タスクコンテキスト・CPUロック状態・ディスパッ
+  *  チ許可状態・（モデル上の）割込み優先度マスク全解除状態で呼び出さな
+  *  ければならない．
+  */
+ extern void	dispatch( void );
+ 
+ /*
+  *  ディスパッチャの動作開始（prc_support.a30）
+  *
+  *  start_dispatchは，カーネル起動時に呼び出すべきもので，すべての割込
+  *  みを禁止した状態（全割込みロック状態と同等の状態）で呼び出さなければ
+  *  ならない．
+  */
+ extern void	start_dispatch( void ) NoReturn;
+ 
+ /*
+  *  現在のコンテキストを捨ててディスパッチ（prc_support.a30）
+  *
+  *  exit_and_dispatchは，ext_tskから呼び出すべきもので，タスクコンテキ
+  *  スト・CPUロック状態・ディスパッチ許可状態・（モデル上の）割込み優先
+  *  度マスク全解除状態で呼び出さなければならない．
+  */
+ #define _kernel_exit_and_dispatch();	\
+ 	_exit_and_dispatch();		\
+ 	ercd = E_SYS;
+ 
+ extern void	_exit_and_dispatch( void ) NoReturn;
+ 
+ /*
+  *  カーネルの終了処理の呼出し（prc_support.a30）
+  *
+  *  call_exit_kernelは，カーネルの終了時に呼び出すべきもので，非タスク
+  *  コンテキストに切り換えて，カーネルの終了処理（exit_kernel）を呼び出
+  *  す．
+  */
+ extern void call_exit_kernel( void ) NoReturn;
+ 
+ /*
+  *  タスクコンテキストの初期化
+  *
+  *  タスクが休止状態から実行できる状態に移行する時に呼ばれる．この時点
+  *  でスタック領域を使ってはならない．
+  *
+  *  activate_contextを，インライン関数ではなくマクロ定義としているのは，
+  *  この時点ではTCBが定義されていないためである．
+  */
+ extern void	start_r( void );
+ 
+ #define activate_context( p_tcb )														\
+ {																						\
+ 	{																					\
+ 																						\
+ 		/*  スタックポインタ初期値の設定  */											\
+ 		( p_tcb )->tskctxb.sp = ( void * )((( uint32_t ) ( p_tcb )->p_tinib->stk ) + 	\
+ 								( p_tcb )->p_tinib->stksz );							\
+ 		/* 起動番地の設定 */															\
+ 		( p_tcb )->tskctxb.pc = ( FP ) start_r;											\
+ 	}																					\
+ }
+ 
+ 
+ /*
+  *  calltexは使用しない
+  */
+ #define OMIT_CALLTEX
+ 
+ 
+ /*
+  *  割込みハンドラの設定
+  *
+  */
+ Inline void
+ x_define_inh( INHNO inhno, FP inthdr )
+ {
+ }
+ 
+ 
+ /*
+  *  CPU例外ハンドラの設定
+  *
+  */
+ Inline void
+ x_define_exc( EXCNO excno, FP exchdr )
+ {
+ }
+ 
+ 
+ /*
+  *  割込み/例外ハンドラの入口処理の生成マクロ
+  *
+  *  テンプレートファイルにより生成するため空マクロとする．
+  */
+ #define HDR_ENTRY(hdr, intexc_num , tobejmp)
+ 
+ /*
+  *  割込みハンドラの入口処理の生成マクロ
+  */
+ #define _INT_ENTRY(inhno, inthdr)				_kernel_##inthdr##_##inhno##_entry
+ #define INT_ENTRY(inhno, inthdr)				_INT_ENTRY(inhno , inthdr)
+ 
+ #define _INTHDR_ENTRY(inhno, inhno_num ,inthdr)	\
+ 		extern void _kernel_##inthdr##_##inhno##_entry(void);
+ #define INTHDR_ENTRY(inhno, inhno_num ,inthdr)	_INTHDR_ENTRY(inhno, inhno_num ,inthdr)
+ 
+ 
+ /*
+  *  CPU例外ハンドラの入口処理の生成マクロ
+  */
+ #define _EXC_ENTRY(excno , exchdr)					_kernel_##exchdr##_##excno##_entry
+ #define EXC_ENTRY(excno , exchdr)					_EXC_ENTRY(excno , exchdr)
+ 
+ #define _EXCHDR_ENTRY(excno , excno_num , exchdr)	\
+ 		extern _kernel_##exchdr##_##excno##_entry(void);
+ #define EXCHDR_ENTRY(excno , excno_num , exchdr)	_EXCHDR_ENTRY(excno , excno_num , exchdr)
+ 
+ 
+ /*
+  *  CPU例外の発生した時のコンテキストの参照
+  *
+  *  CPU例外の発生した時のコンテキストが，タスクコンテキストの時にFALSE，
+  *  そうでない時にtrueを返す．
+  */
+ Inline bool_t
+ exc_sense_context( void *p_excinf )
+ {
+ 	/* 
+ 	 *  ネストカウンタが1より大なら非タスクコンテキスト
+ 	 */
+ 	return( intnest > 1U );
+ }
+ 
+ 
+ /*
+  *  CPU例外情報 p_excinf から PSW の値を取得するためのオフセット値
+  *  EXCNO + ACC + FPSW + R1?R15 + PC
+  */
+ #define EXC_GET_PSW_OFFSET	(4+8+4+60+4)
+ 
+ /*
+  *  CPU例外の発生した時のIPLの参照
+  */
+ Inline uint32_t
+ exc_get_ipl(void *p_excinf)
+ {
+ 	return((*((uint32_t *)((uintptr_t)p_excinf+EXC_GET_PSW_OFFSET)))
+ 			& PSW_IPL_MASK);
+ }
+ 
+ Inline bool_t
+ exc_sense_i(void *p_excinf)
+ {
+ 	return((*(((uint32_t *)((uintptr_t)p_excinf+EXC_GET_PSW_OFFSET)))
+ 			 & PSW_I_MASK) != 0u);
+ }
+ 
+ 
+ /*
+  *  CPU例外の発生した時のコンテキストと割込みのマスク状態の参照
+  *
+  *  CPU例外の発生した時のシステム状態が，カーネル実行中でなく，タスクコ
+  *  ンテキストであり，全割込みロック状態でなく，CPUロック状態でなく，（モ
+  *  デル上の）割込み優先度マスク全解除状態である時にtrue，そうでない時
+  *  にFALSEを返す（CPU例外がカーネル管理外の割込み処理中で発生した場合
+  *  にもFALSEを返す）．
+  *  
+  *  カーネル実行中でない→ (TIPM_LOCK== -15) Iフラグ == 1
+  *                         (else)           IPL < IPL_LOCK
+  *  タスクコンテキストである→intnest == 0
+  *  全割込みロックでない→ Iフラグ == 1
+  *  割込み優先度マスクが全解除→IPL == 0
+  *  
+  *  
+  */
+ Inline bool_t
+ exc_sense_intmask(void *p_excinf)
+ {
+ 	return((!exc_sense_context(p_excinf))
+ 			&& exc_sense_i(p_excinf)
+ 			&& (exc_get_ipl(p_excinf) == IPL_ENAALL));
+ }
+ 
+ /*
+  *  CPU例外の発生した時のコンテキストと割込み／CPUロック状態の参照
+  *
+  *  CPU例外の発生した時のシステム状態が，カーネル実行中でなく，タスクコ
+  *  ンテキストであり，全割込みロック状態でなく，CPUロック状態でない時に
+  *  true，そうでない時にfalseを返す（CPU例外がカーネル管理外の割込み処
+  *  理中で発生した場合にもfalseを返す）．
+  *  
+  *  カーネル実行中でない→ (TIPM_LOCK== -15) Iフラグ == 1
+  *                         (else)           IPL < TIPM_LOCK
+  *  タスクコンテキストである→intnest < 1 
+  *  全割込みロックでない→ Iフラグ == 1
+  *  CPUロック状態でない→(TIPM_LOCK== -15) Iフラグ == 1
+  *                         (else)           IPL < TIPM_LOCK
+  */
+ Inline bool_t
+ exc_sense_unlock(void *p_excinf)
+ {
+ #if TIPM_LOCK == -15
+ 	return((!exc_sense_context(p_excinf))
+ 			&& exc_sense_i(p_excinf));
+ #else
+ 	return((!exc_sense_context(p_excinf))
+ 			&& exc_sense_i(p_excinf)
+ 			&& exc_get_ipl(p_excinf) < IPL_LOCK);
+ #endif
+ }
+ 
+ 
+ /*
+  *  プロセッサ依存の初期化
+  */
+ extern void	prc_initialize( void );
+ 
+ /*
+  *  プロセッサ依存の終了時処理
+  */
+ extern void	prc_terminate( void );
+ 
+ 
+ #ifndef OMIT_DEFAULT_INT_HANDLER
+ /*
+  *  未登録の割込みが発生した場合に呼び出される
+  */
+ void default_int_handler( uint32_t intno );
+ #endif /* OMIT_DEFAULT_INT_HANDLER */
+ 
+ #ifndef OMIT_DEFAULT_EXC_HANDLER
+ /*
+  *  未登録の例外が発生した場合に呼び出される
+  */
+ void default_exc_handler( void );
+ #endif /* OMIT_DEFAULT_EXC_HANDLER */
+ 
+ 
+ #endif /* TOPPERS_MACRO_ONLY */
+ 
+ #endif /* TOPPERS_PRC_CONFIG_H */
+ 
diff -cr --new-file asp/arch/rx_gcc/rx_common/prc_def.csv 1.9.1_update/arch/rx_gcc/rx_common/prc_def.csv
*** asp/arch/rx_gcc/rx_common/prc_def.csv	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/arch/rx_gcc/rx_common/prc_def.csv	Thu Dec 15 13:49:08 2022
***************
*** 0 ****
--- 1,13 ----
+ TA_LOWLEVEL,TA_LOWLEVEL
+ TA_BOTHEDGE,TA_BOTHEDGE
+ TA_NEGEDGE,TA_NEGEDGE
+ TIPM_LOCK,TIPM_LOCK,signed
+ IPL_LOCK,IPL_LOCK
+ PSW_I_MASK,PSW_I_MASK
+ PSW_IPL_MASK,PSW_IPL_MASK
+ EXC_GET_PSW_OFFSET,EXC_GET_PSW_OFFSET
+ sizeof_TCB,sizeof(TCB)
+ offsetof_TCB_p_tinib,"offsetof(TCB,p_tinib)"
+ offsetof_TCB_texptn,"offsetof(TCB,texptn)"
+ offsetof_TCB_sp,"offsetof(TCB,tskctxb.sp)"
+ offsetof_TCB_pc,"offsetof(TCB,tskctxb.pc)"
diff -cr --new-file asp/arch/rx_gcc/rx_common/prc_insn.h 1.9.1_update/arch/rx_gcc/rx_common/prc_insn.h
*** asp/arch/rx_gcc/rx_common/prc_insn.h	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/arch/rx_gcc/rx_common/prc_insn.h	Thu Dec 15 13:53:29 2022
***************
*** 0 ****
--- 1,150 ----
+ /*
+  *  TOPPERS/ASP Kernel
+  *      Toyohashi Open Platform for Embedded Real-Time Systems/
+  *      Advanced Standard Profile Kernel
+  *
+  *  Copyright (C) 2000-2003 by Embedded and Real-Time Systems Laboratory
+  *                              Toyohashi Univ. of Technology, JAPAN
+  *  Copyright (C) 2005,2006 by Embedded and Real-Time Systems Laboratory
+  *              Graduate School of Information Science, Nagoya Univ., JAPAN
+  *  Copyright (C) 2008-2010 by Witz Corporation, JAPAN
+  *  Copyright (C) 2015 by Hisashi Hata, JAPAN
+  *
+  *  上記著作権者は，以下の (1)〜(4) の条件か，Free Software Foundation
+  *  によって公表されている GNU General Public License の Version 2 に記
+  *  述されている条件を満たす場合に限り，本ソフトウェア（本ソフトウェア
+  *  を改変したものを含む．以下同じ）を使用・複製・改変・再配布（以下，
+  *  利用と呼ぶ）することを無償で許諾する．
+  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+  *      スコード中に含まれていること．
+  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
+  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
+  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
+  *      の無保証規定を掲載すること．
+  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
+  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
+  *      と．
+  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
+  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
+  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
+  *        報告すること．
+  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
+  *
+  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
+  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，その適用可能性も
+  *  含めて，いかなる保証も行わない．また，本ソフトウェアの利用により直
+  *  接的または間接的に生じたいかなる損害に関しても，その責任を負わない．
+  *
+  */
+ 
+ /*
+  *		プロセッサの特殊命令のインライン関数定義（RX用）
+  */
+ 
+ #ifndef	TOPPERS_PRC_INSN_H
+ #define	TOPPERS_PRC_INSN_H
+ 
+ 
+ static uint32_t current_psw( void );
+ static void set_psw( uint32_t psw );
+ Inline uint32_t current_ipl( void );
+ Inline void set_ipl( uint32_t ipl );
+ static void disint( void );
+ static void enaint( void );
+ static uint16_t rev_endian_uint16( uint16_t data );
+ static uint32_t rev_endian_uint32( uint32_t data );
+ 
+ 
+ /*
+  *  Iフラグ, IPLを取得するためのマクロ定義
+  */
+ #define PSW_I_MASK		( 0x00010000UL )
+ #define PSW_IPL_MASK	( 0x0F000000UL )
+ 
+ 
+ /*
+  *  プロセッサステータスレジスタ(PSW)の現在値の読出し
+  */
+ static uint32_t
+ current_psw( void )
+ {
+   uint32_t load_psw;
+   __asm__("mvfc	psw, %0" : "=r"(load_psw) :);
+   return load_psw;
+ }
+ 
+ 
+ /*
+  *  プロセッサステータスレジスタ(PSW)へ設定
+  */
+ static void
+ set_psw( uint32_t psw )
+ {
+   __asm__("mvtc	%0, psw"::"r"(psw));
+ }
+ 
+ 
+ /*
+  *  IPLの現在値の読出し
+  */
+ Inline uint32_t
+ current_ipl( void )
+ {
+ 	return ( uint32_t )( current_psw() & PSW_IPL_MASK );
+ }
+ 
+ 
+ /*
+  *  IPLへ設定
+  */
+ Inline void
+ set_ipl( uint32_t ipl )
+ {
+ 	set_psw( ( current_psw() & ( ~PSW_IPL_MASK ) ) | ipl );
+ }
+ 
+ 
+ /*
+  *  NMIを除くすべての割込みの禁止
+  */
+ static void
+ disint( void )
+ {
+   __asm__("clrpsw	I");
+ }
+ 
+ 
+ /*
+  *  NMIを除くすべての割込みの許可
+  */
+ static void
+ enaint( void )
+ {
+   __asm__("setpsw	I");
+ }
+ 
+ 
+ /*
+  *  エンディアン変換 16bit
+  */
+ static uint16_t
+ rev_endian_uint16( uint16_t data )
+ {
+   __asm__("revw	%0, %1":"=r"(data):"r"(data));
+   return data;
+ }
+ 
+ /*
+  *  エンディアン変換 32bit
+  */
+ static uint32_t
+ rev_endian_uint32( uint32_t data )
+ {
+   __asm__("revl	%1, %0":"=r"(data):"r"(data));
+   return data;
+ }
+ 
+ 
+ #endif /* TOPPERS_PRC_INSN_H */
diff -cr --new-file asp/arch/rx_gcc/rx_common/prc_kernel.h 1.9.1_update/arch/rx_gcc/rx_common/prc_kernel.h
*** asp/arch/rx_gcc/rx_common/prc_kernel.h	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/arch/rx_gcc/rx_common/prc_kernel.h	Thu Dec 15 13:53:29 2022
***************
*** 0 ****
--- 1,92 ----
+ /*
+  *  TOPPERS/ASP Kernel
+  *      Toyohashi Open Platform for Embedded Real-Time Systems/
+  *      Advanced Standard Profile Kernel
+  * 
+  *  Copyright (C) 2008-2010 by Witz Corporation, JAPAN
+  *  Copyright (C) 2015- by Hisashi Hata, JAPAN
+  * 
+  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
+  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
+  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
+  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+  *      スコード中に含まれていること．
+  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
+  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
+  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
+  *      の無保証規定を掲載すること．
+  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
+  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
+  *      と．
+  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
+  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
+  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
+  *        報告すること．
+  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
+  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
+  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
+  *      免責すること．
+  * 
+  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
+  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
+  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
+  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
+  *  の責任を負わない．
+  * 
+  */
+ 
+ /*
+  *		kernel.hのプロセッサ依存部（RX用）
+  *
+  *  このインクルードファイルは，target_kernel.h（または，そこからインク
+  *  ルードされるファイル）のみからインクルードされる．他のファイルから
+  *  直接インクルードしてはならない．
+  */
+ 
+ #ifndef TOPPERS_PRC_KERNEL_H
+ #define TOPPERS_PRC_KERNEL_H
+ 
+ /*
+  *  サポートする機能の定義
+  */
+ #define TOPPERS_TARGET_SUPPORT_DIS_INT		/* dis_intをサポートする */
+ #define TOPPERS_TARGET_SUPPORT_ENA_INT		/* ena_intをサポートする */
+ 
+ 
+ /*
+  *  カーネル管理の割込み優先度の範囲
+  *
+  *  TMIN_INTPRIの定義を変更することで，どのレベルよりも高い割込み優先度
+  *  を持つものをカーネル管理外の割込みとするかを変更できる．
+  *
+  *  TMIN_INTPRIに設定できる値は，-15?-1の範囲である．例えばTMIN_INTPRI
+  *  を-14に設定すると，NMIに加えてレベル15の割込みがカーネル管理外となる．
+  *  TMIN_INTPRIを-7に設定すると，NMI以外にカーネル管理外の割込みを
+  *  設けないことになる．
+  */
+ #ifndef TMIN_INTPRI
+ #define TMIN_INTPRI		( -15 )		/* 割込み優先度の最小値（最高値）*/
+ #endif /* TMIN_INTPRI */
+ #define TMAX_INTPRI		( -1 )		/* 割込み優先度の最大値（最低値） */
+ 
+ 
+ /*
+  *  割込み属性の定義
+  */
+ #define	TA_POSEDGE		TA_EDGE			/* ポジティブエッジトリガ */
+ #define	TA_NEGEDGE		UINT_C( 0x04 )	/* ネガティブエッジトリガ */
+ #define	TA_BOTHEDGE		UINT_C( 0x08 )	/* 両エッジトリガ */
+ 
+ #define	TA_LOWLEVEL		UINT_C( 0x10 )	/* Lレベル */
+ 
+ 
+ /*
+  *  デフォルトの割込み/例外ハンドラの有無
+  */
+ /*#define	OMIT_DEFAULT_INT_HANDLER*/
+ /*#define	OMIT_DEFAULT_EXC_HANDLER*/
+ 
+ 
+ #endif /* TOPPERS_PRC_KERNEL_H */
diff -cr --new-file asp/arch/rx_gcc/rx_common/prc_rename.def 1.9.1_update/arch/rx_gcc/rx_common/prc_rename.def
*** asp/arch/rx_gcc/rx_common/prc_rename.def	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/arch/rx_gcc/rx_common/prc_rename.def	Thu Dec 15 13:49:08 2022
***************
*** 0 ****
--- 1,21 ----
+ # prc_config.c
+ intnest
+ lock_flag
+ saved_ipl
+ prc_initialize
+ prc_terminate
+ x_config_int
+ default_int_handler
+ default_exc_handler
+ 
+ # prc_support.src
+ dispatch
+ start_dispatch
+ exit_and_dispatch
+ call_exit_kernel
+ start_r
+ interrupt
+ exception
+ 
+ # kernel_cfg.c
+ cfg_int_table
diff -cr --new-file asp/arch/rx_gcc/rx_common/prc_rename.h 1.9.1_update/arch/rx_gcc/rx_common/prc_rename.h
*** asp/arch/rx_gcc/rx_common/prc_rename.h	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/arch/rx_gcc/rx_common/prc_rename.h	Thu Dec 15 13:49:08 2022
***************
*** 0 ****
--- 1,79 ----
+ /* This file is generated from prc_rename.def by genrename. */
+ 
+ #ifndef TOPPERS_PRC_RENAME_H
+ #define TOPPERS_PRC_RENAME_H
+ 
+ /*
+  *  prc_config.c
+  */
+ #define intnest						_kernel_intnest
+ #define lock_flag					_kernel_lock_flag
+ #define saved_ipl					_kernel_saved_ipl
+ #define saved_psw					_kernel_saved_psw
+ #define prc_initialize				_kernel_prc_initialize
+ #define prc_terminate				_kernel_prc_terminate
+ #define x_config_int				_kernel_x_config_int
+ #define default_int_handler			_kernel_default_int_handler
+ #define default_exc_handler			_kernel_default_exc_handler
+ 
+ /*
+  *  prc_support.src
+  */
+ #define dispatch					_kernel_dispatch
+ #define start_dispatch				_kernel_start_dispatch
+ #define exit_and_dispatch			_kernel_exit_and_dispatch
+ #define call_exit_kernel			_kernel_call_exit_kernel
+ #define start_r						_kernel_start_r
+ #define interrupt					_kernel_interrupt
+ #define exception					_kernel_exception
+ 
+ /*
+  *  kernel_cfg.c
+  */
+ #define cfg_int_table				_kernel_cfg_int_table
+ 
+ #ifdef TOPPERS_LABEL_ASM
+ 
+ /*
+  *  prc_config.c
+  */
+ #define _intnest					__kernel_intnest
+ #define _lock_flag					__kernel_lock_flag
+ #define _saved_ipl					__kernel_saved_ipl
+ #define _saved_psw					__kernel_saved_psw
+ 
+ #define _prc_initialize				__kernel_prc_initialize
+ #define _prc_terminate				__kernel_prc_terminate
+ #define _x_config_int				__kernel_x_config_int
+ #define _default_int_handler		__kernel_default_int_handler
+ #define _default_exc_handler		__kernel_default_exc_handler
+ 
+ /*
+  *  prc_support.src
+  */
+ #define _dispatch					__kernel_dispatch
+ #define _start_dispatch				__kernel_start_dispatch
+ #define _exit_and_dispatch			__kernel_exit_and_dispatch
+ #define _call_exit_kernel			__kernel_call_exit_kernel
+ #define _start_r					__kernel_start_r
+ #define _interrupt					__kernel_interrupt
+ #define _exception					__kernel_exception
+ 
+ 
+ /*
+  *  rx63n_config.c
+  */
+ #define _ipr_reg_addr				__kernel_ipr_reg_addr
+ #define _ier_reg_addr				__kernel_ier_reg_addr
+ #define _ir_reg_addr				__kernel_ir_reg_addr
+ #define _irqcr_reg_addr				__kernel_irqcr_reg_addr
+ 
+ /*
+  *  kernel_cfg.c
+  */
+ #define _cfg_int_table				__kernel_cfg_int_table
+ 
+ #endif /* TOPPERS_LABEL_ASM */
+ 
+ 
+ #endif /* TOPPERS_PRC_RENAME_H */
diff -cr --new-file asp/arch/rx_gcc/rx_common/prc_sil.h 1.9.1_update/arch/rx_gcc/rx_common/prc_sil.h
*** asp/arch/rx_gcc/rx_common/prc_sil.h	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/arch/rx_gcc/rx_common/prc_sil.h	Thu Dec 15 13:53:29 2022
***************
*** 0 ****
--- 1,112 ----
+ /*
+  *  TOPPERS Software
+  *      Toyohashi Open Platform for Embedded Real-Time Systems
+  * 
+  *  Copyright (C) 2008-2010 by Witz Corporation, JAPAN
+  *  Copyright (C) 2015 by Hisashi Hata, JAPAN
+  * 
+  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
+  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
+  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
+  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+  *      スコード中に含まれていること．
+  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
+  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
+  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
+  *      の無保証規定を掲載すること．
+  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
+  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
+  *      と．
+  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
+  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
+  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
+  *        報告すること．
+  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
+  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
+  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
+  *      免責すること．
+  * 
+  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
+  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
+  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
+  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
+  *  の責任を負わない．
+  * 
+  */
+ 
+ /*
+  *		sil.hのプロセッサ依存部（RX用）
+  */
+ 
+ #ifndef TOPPERS_PRC_SIL_H
+ #define TOPPERS_PRC_SIL_H
+ 
+ 
+ #ifndef TOPPERS_MACRO_ONLY
+ #include "prc_insn.h"
+ 
+ 
+ /*
+  *  全割込み禁止
+  */
+ Inline uint32_t
+ TOPPERS_disint( void )
+ {
+ 	volatile uint32_t	TOPPERS_psw;
+ 
+ 	TOPPERS_psw = current_psw();
+ 	disint();
+ 
+ 	return( TOPPERS_psw );
+ }
+ 
+ 
+ /*
+  *  全割込み許可
+  */
+ Inline void
+ TOPPERS_enaint( uint32_t TOPPERS_psw )
+ {
+ 	if( TOPPERS_psw & PSW_I_MASK ){
+ 		enaint();
+ 	}
+ }
+ 
+ 
+ /*
+  *  全割込みロック状態の制御
+  */
+ #define SIL_PRE_LOC		uint32_t TOPPERS_i_psw;
+ #define SIL_LOC_INT()	( ( void )( TOPPERS_i_psw = TOPPERS_disint() ) )
+ #define SIL_UNL_INT()	( TOPPERS_enaint( TOPPERS_i_psw ) )
+ 
+ 
+ /*
+  *  エンディアンの反転
+  *
+  *  本開発環境ではエンディアン変換命令が存在するため,
+  *  アーキテクチャ依存部にてマクロを上書きする.
+  */
+ #define TOPPERS_SIL_REV_ENDIAN_UINT16( data )	\
+  								rev_endian_uint16( data )
+ #define TOPPERS_SIL_REV_ENDIAN_UINT32( data )	\
+  								rev_endian_uint32( data )
+ 
+ 
+ /*
+  *  微少時間待ち
+  */
+ extern void sil_dly_nse( ulong_t dlytim );
+ 
+ #endif /* TOPPERS_MACRO_ONLY */
+ 
+ 
+ /*
+  *  プロセッサのエンディアン
+  */
+ #define SIL_ENDIAN_LITTLE			/* リトルエンディアン */
+ 
+ 
+ #endif /* TOPPERS_PRC_SIL_H */
diff -cr --new-file asp/arch/rx_gcc/rx_common/prc_support.S 1.9.1_update/arch/rx_gcc/rx_common/prc_support.S
*** asp/arch/rx_gcc/rx_common/prc_support.S	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/arch/rx_gcc/rx_common/prc_support.S	Thu Dec 15 13:53:29 2022
***************
*** 0 ****
--- 1,878 ----
+ ;
+ ;   TOPPERS/ASP Kernel
+ ;       Toyohashi Open Platform for Embedded Real-Time Systems/
+ ;       Advanced Standard Profile Kernel
+ ;
+ ;   Copyright (C) 2000-2003 by Embedded and Real-Time Systems Laboratory
+ ;                               Toyohashi Univ. of Technology, JAPAN
+ ;   Copyright (C) 2007      by Embedded and Real-Time Systems Laboratory
+ ;               Graduate School of Information Science, Nagoya Univ., JAPAN
+ ;
+ ;   Copyright (C) 2010 by Witz Corporation, JAPAN
+ ;   Copyright (C) 2015-  by Hisashi Hata, JAPAN
+ ;   上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
+ ;   ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
+ ;   変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
+ ;   (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+ ;       権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+ ;       スコード中に含まれていること．
+ ;   (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
+ ;       用できる形で再配布する場合には，再配布に伴うドキュメント（利用
+ ;       者マニュアルなど）に，上記の著作権表示，この利用条件および下記
+ ;       の無保証規定を掲載すること．
+ ;   (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
+ ;       用できない形で再配布する場合には，次のいずれかの条件を満たすこ
+ ;       と．
+ ;     (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
+ ;         作権表示，この利用条件および下記の無保証規定を掲載すること．
+ ;     (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
+ ;         報告すること．
+ ;   (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+ ;       害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
+ ;       また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
+ ;       由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
+ ;       免責すること．
+ ;
+ ;   本ソフトウェアは，無保証で提供されているものである．上記著作権者お
+ ;   よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
+ ;   に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
+ ;   アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
+ ;   の責任を負わない．
+ ;
+ ;
+ 
+ ;
+ ;  プロセッサ依存モジュール アセンブリ言語部（RX用）
+ ;
+ 
+ ;
+ ;  ディスパッチャおよび割込み(CPU例外)出入り口のルール:
+ ;	動作モードを以下のように定義する.
+ ;		ディスパッチャモード:
+ ;			CPUロック状態, 割込み優先度マスク全解除状態,
+ ;			タスクコンテキスト(intnest = 0), タスクスタック
+ ;		割込み(CPU例外)処理モード
+ ;			全割込みロック状態(PSWレジスタIビット = 0),
+ ;			割込み優先度マスク全解除でない状態(IPL != 0)
+ ;			割込みコンテキスト(intnest != 0), 割込みスタック
+ ;
+ ;	カーネル管理外割込みのサポート有無と, CPUロック状態, 割込み優先度
+ ;	マスク全解除状態の関係は以下の通りである.
+ ;		カーネル管理外割込み未サポート時:
+ ;			CPUロック状態(PSWレジスタIビット = 0)
+ ;			割込み優先度マスク全解除状態(IPL = 0)
+ ;		カーネル管理外割込みサポート時:
+ ;			CPUロック状態
+ ;				(PSWレジスタIビット = 0, IPL = IPL_LOCK, lock_flag = true)
+ ;			割込み優先度マスク全解除状態(saved_ipl = 0)
+ ;
+ ;	各構造体ポインタを以下のように各レジスタにアサインする.
+ ;		r15 = p_runtsk	ただしディスパッチャの各出口では無効
+ ;		r14 = *p_runtsk	dispatcher の中では p_runtsk 確定時に再取得する
+ ;	各入り口から最初に変数アクセスするときに上記レジスタに保存する.
+ ;
+ ;	構造体アライメントへの対応
+ ;		構造体アライメントが4Byte(アンパック)の場合:
+ ;			一般的なレジスタ相対アドレッシングが可能
+ ;				例:	mov.l	#__kernel_p_runtsk, r15
+ ;					mov.l  	r0, TCB_sp[r15]
+ ;		構造体アライメントが4Byteではない(パック)の場合:
+ ;			mov.lのようにロングサイズ指定の場合、相対値は4の倍数のみ有効
+ ;			このため, 一度対象アドレスを求めてからアクセスする必要がある
+ ;				例:	mov.l	#__kernel_p_runtsk, r15
+ ;					add		#TCB_sp, r15, r5
+ ;					mov.l  	r0, [r5]
+ ;		各オフセット値を判断し, 条件アセンブルによりコードを切り替える
+ ;
+ 
+ ;
+ ;  構造体アクセスのオフセット定義
+ ;
+ #define TOPPERS_MACRO_ONLY
+ ; RENESAS RX72N BSP使用の場合
+ #define RENESAS_RX72N_BSP
+ 
+ #include "offset.h"
+ #include "asm_config.inc"
+ 
+ .text
+ .balign 4
+ ;
+ ;  各種EQU定義(Hファイルの#define定義)
+ ;
+ 
+ 	.extern	__kernel_istkpt
+     .extern _istack
+ 
+ 	.extern	__kernel_p_runtsk
+ 	.extern	__kernel_p_schedtsk
+ 	.extern	__kernel_reqflg
+ 	.extern	__kernel_dspflg
+ 
+ 	.global	__kernel_dispatch
+ 	.global	__exit_and_dispatch
+ 	.global	__kernel_start_r
+ 	.extern	__kernel_call_texrtn
+ 	.global	_kernel_interrupt
+ 	.global	_kernel_exception
+ 	.extern	__kernel_intnest
+ 	.global	__kernel_call_exit_kernel
+ 	.global	__kernel_start_dispatch
+ 
+ 	.extern	_ext_tsk
+ 	.extern	__kernel_exit_kernel
+ 
+ .if	TIPM_LOCK <> -15
+ 	.extern	__kernel_lock_flag
+ 	.extern	__kernel_saved_ipl
+ .endif
+ 
+ 	.global	_sil_dly_nse
+ 
+ .if LOG_INH_ENTER == 1
+ 	.extern	__kernel_log_inh_enter
+ .endif	; LOG_INH_ENTER == 1
+ .if LOG_INH_LEAVE == 1
+ 	.extern	__kernel_log_inh_leave
+ .endif	; LOG_INH_LEAVE == 1
+ .if LOG_EXC_ENTER == 1
+ 	.extern	__kernel_log_exc_enter
+ .endif	; LOG_EXC_ENTER == 1
+ .if LOG_EXC_LEAVE == 1
+ 	.extern	__kernel_log_exc_leave
+ .endif	; LOG_EXC_LEAVE == 1
+ .if LOG_DSP_ENTER == 1
+ 	.extern	__kernel_log_dsp_enter
+ .endif	; LOG_DSP_ENTER == 1
+ .if LOG_DSP_LEAVE == 1
+ 	.extern	__kernel_log_dsp_leave
+ .endif	; LOG_DSP_LEAVE == 1
+ 
+ ;
+ ;  TCB_sp への書込みマクロ
+ ;
+ .macro st_TCB_sp src, tcb, tmp
+ .if (TCB_sp % 4) == 0
+ 	mov.l	\src, TCB_sp[\tcb]
+ .else
+ 	add		#TCB_sp, \tcb, \tmp
+ 	mov.l	\src, [\tmp]
+ .endif
+ .endm
+ 
+ ;
+ ;  TCB_sp からの読出しマクロ
+ ;
+ .macro ld_TCB_sp dst, tcb, tmp
+ .if (TCB_sp % 4) == 0
+ 	mov.l	TCB_sp[\tcb], \dst
+ .else
+ 	add		#TCB_sp, \tcb, \tmp
+ 	mov.l	[\tmp], \dst
+ .endif
+ .endm
+ 
+ ;
+ ;  TCB_pc への書込みマクロ
+ ;
+ .macro st_TCB_pc src, tcb, tmp
+ .if (TCB_pc % 4) == 0
+ 	mov.l	\src, TCB_pc[\tcb]
+ .else
+ 	add		#TCB_pc, \tcb, \tmp
+ 	mov.l	\src, [\tmp]
+ .endif
+ .endm
+ 
+ ;
+ ;  TCB_pc からの読出しマクロ
+ ;
+ .macro ld_TCB_pc dst, tcb, tmp
+ .if (TCB_pc % 4) == 0
+ 	mov.l	TCB_pc[\tcb], \dst
+ .else
+ 	add		#TCB_pc, \tcb, \tmp
+ 	mov.l	[\tmp], \dst
+ .endif
+ .endm
+ 
+ ;
+ ;  TCB_texptn からの読出しマクロ
+ ;
+ .macro ld_TCB_texptn dst, tcb, tmp
+ .if (TCB_texptn % 4) == 0
+ 	mov.l	TCB_texptn[\tcb], \dst
+ .else
+ 	add		#TCB_texptn, \tcb, \tmp
+ 	mov.l	[\tmp], \dst
+ .endif
+ .endm
+ 
+ ;
+ ;  TCB_tinib からの読出しマクロ
+ ;
+ .macro ld_TCB_tinib dst, tcb, tmp
+ .if (TCB_tinib % 4) == 0
+ 	mov.l	TCB_tinib[\tcb], \dst
+ .else
+ 	add		#TCB_tinib, \tcb, \tmp
+ 	mov.l	[\tmp], \dst
+ .endif
+ .endm
+ 
+ ;
+ ;  TINIB_exinf からの読出しマクロ
+ ;
+ .macro ld_TINIB_exinf dst, tinib, tmp
+ .if (TINIB_exinf % 4) == 0
+ 	mov.l	TINIB_exinf[\tinib], \dst
+ .else
+ 	add		#TINIB_exinf, \tinib, \tmp
+ 	mov.l	[\tmp], \dst
+ .endif
+ .endm
+ 
+ ;
+ ;  TINIB_task からの読出しマクロ
+ ;
+ .macro ld_TINIB_task dst, tinib, tmp
+ .if (TINIB_task % 4) ==0
+ 	mov.l	TINIB_task[\tinib], \dst
+ .else
+ 	add		#TINIB_task, \tinib, \tmp
+ 	mov.l	[\tmp], \dst
+ .endif
+ .endm
+ 
+ 
+ ;
+ ;  APIからのタスクディスパッチャ入口
+ ;
+ ;  呼び出し条件:
+ ;	・ディスパッチャモード(ファイルヘッダ参照)
+ ;
+ ;  ここでは, コンテキストの退避と, 実行再開番地の設定をする.
+ ;
+ __kernel_dispatch:
+ 	pushm	r6-r13						; 非スクラッチレジスタ保存
+ 	mov.l	#__kernel_p_runtsk, r15
+ 	mov.l	[r15], r14
+ 	st_TCB_sp	r0, r14, r5				; スタックポインタをTCBに保存
+ 	st_TCB_pc	#dispatch_r, r14, r5	; 実行再開番地をTCBに保存
+ 	bra		dispatcher
+ 
+ ;
+ ;  APIへのタスクディスパッチャ出口
+ ;
+ ;  呼び出し条件:
+ ;	・ディスパッチャモード(ファイルヘッダ参照)
+ ;
+ ;  ここでは, タスク例外ハンドラ呼出しと, コンテキストの復帰をする.
+ ;
+ dispatch_r:
+ 	btst 	#TCB_enatex_bit, TCB_enatex[r14].B	; タスク例外処理許可
+ 	bz   	dispatch_r_rts
+ 	ld_TCB_texptn	r5, r14, r4			; 保留例外要因があるか？
+ 	cmp		#0, r5
+ 	bz   	dispatch_r_rts
+ 	bsr		__kernel_call_texrtn		; タスク例外ハンドラ呼出し処理実行
+ dispatch_r_rts:
+ 	popm 	r6-r13						; 非スクラッチレジスタ復帰
+ 	rts  	                        	; dispatch 呼び出し元へ戻る.
+ 
+ ;
+ ;  タスク起動処理(タスク先頭へのタスクディスパッチャ出口)
+ ;
+ ;  呼び出し条件:
+ ;	・ディスパッチャモード(ファイルヘッダ参照)
+ ;
+ ;  ここでは, CPUロック解除状態にし, タスクを起動する.
+ ;
+ __kernel_start_r:
+ 	mov.l 	#_ext_tsk, r5
+ 	push.l	r5							; 戻り番地をスタックに積む
+ 	ld_TCB_tinib	r5, r14, r4
+ 	ld_TINIB_exinf	r1, r5, r4			; 拡張情報を第一引数に設定
+ 	ld_TINIB_task	r5, r5, r4			; タスクの起動番地を取得
+ .if TIPM_LOCK == -15
+     setpsw i
+ .else
+     mov.l	#__kernel_lock_flag, r4		; CPUロック解除状態へ
+ 	mov.l	#0, [r4]					; ここに来るときは必ず saved_ipl の
+ 	mvtc	#0x00010000, psw				; 値は 0 のため, 直値を設定する.
+ 								; 全割込みロック解除状態( I = 1 )
+ 								; 割込み優先度マスク全解除状態( IPL = 0 )
+ .endif
+ 	jmp		r5
+ 
+ ;
+ ;  カーネル起動からのタスクディスパッチャ入口
+ ;
+ ;  このルーチンは，カーネル起動時に，すべての割込みを禁止した状態
+ ; （割込みロック状態と同等）で呼び出される．また，割込みモード（非
+ ;  タスクコンテキストと同等）で呼び出されることを想定している．
+ ;
+ ;  呼び出し条件:
+ ;	・割込み(CPU例外)処理モード(ファイルヘッダ参照)
+ ;
+ ;  ここでは, ディスパッチャモードに変更する.
+ ;
+ __kernel_start_dispatch:
+ 	mov.l	#__kernel_intnest, r5
+ 	mov.w	#0, [r5]					; タスクコンテキストに切換え
+ .if	TIPM_LOCK <> -15
+ 	mvtc	#(IPL_LOCK | 0x00010000), psw	; 全割込みロック解除状態
+ 										; 割込み優先度マスク全解除でない状態
+ .endif
+ 
+ ;
+ ; タスク終了(現在のコンテキストを捨てる)からのタスクディスパッチャ入口
+ ;
+ ;  呼び出し条件:
+ ;	・ディスパッチャモード(ファイルヘッダ参照)
+ ;
+ ;  ここでは, 何もすることはない.
+ ;  なお, p_runtsk のアドレス取得だけは行なう.
+ ;
+ __exit_and_dispatch:
+ 	mov.l	#__kernel_p_runtsk, r15
+ 
+ ;
+ ; ディスパッチャ本体
+ ;
+ ;  呼び出し条件:
+ ;	・すべてのタスクのコンテキストは保存されている.
+ ;
+ ;  dispatcher 呼出時のスタック:
+ ;	・__kernel_dispatch からきた場合			: タスクスタック
+ ;	・exit_and_dispatch からきた場合:
+ ;		exit_task からきた場合					: タスクスタック
+ ;		カーネル起動時(__kernel_start_dispatch)	: 割込みスタック
+ ;	・ret_int からきた場合						: タスクスタック
+ ;	・dispatcher_idle_loop からきた場合			: 割込みスタック
+ ;
+ dispatcher:
+ .if LOG_DSP_ENTER == 1
+ 	push.l	r15
+ 	mov.l	r14, r1						; 引数(ディスパッチ元TCB)を設定
+ 	bsr		__kernel_log_dsp_enter
+ 	pop	    r15
+ .endif
+ 	mov.l	#__kernel_p_schedtsk, r5
+ 	mov.l	[r5], [r15]					; p_schedtsk を p_runtsk に
+ 	mov.l	[r15], r14
+ 	cmp		#0, r14
+ 	bz		dispatcher_pre_idle			; schedtsk がなければアイドルループへ
+ 	ld_TCB_sp	r0, r14, r5				; タスクスタックポインタを復帰
+ .if LOG_DSP_LEAVE == 1
+ 	push.l	r14
+ 	mov.l	r14, r1						; 引数(ディスパッチ先TCB)を設定
+ 	bsr		__kernel_log_dsp_leave
+ 	pop     r14
+ .endif
+ 	ld_TCB_pc	r5, r14, r4
+ 	jmp		r5					; 実行再開番地へジャンプ
+ 
+ ;
+ ;  schdedtskがNULLの場合はアイドルループに入る
+ ;  アイドルループは割込み処理モードで動作させる
+ ;
+ ;  ここで割込みモードに切り換えるのは，ここで発生する割込み処理に
+ ;  どのスタックを使うかという問題の解決と，割込みハンドラ内でのタ
+ ;  スクディスパッチの防止という2つの意味がある．
+ ;
+ dispatcher_pre_idle:
+ #ifdef RENESAS_RX72N_BSP
+     mov.l   #_istack,r0
+ #else
+ 	mov.l	#__kernel_istkpt,r5
+ 	mov.l	[r5], r0					; 割込み用のスタックへ切替え
+ #endif
+ 	mov.l	#__kernel_intnest, r5
+ 	mov.w	#1, [r5]					; 非タスクコンテキストに切換え
+ .if	TIPM_LOCK <> -15
+ 	mov.l	#__kernel_lock_flag, r5		; CPUロック解除状態へ
+ 	mov.l	#0, [r5]
+ 	mvtc	#0, psw						; 優先度0の割込み処理中を偽装
+ .endif
+ 
+ dispatcher_idle_loop:
+ 	setpsw	i							; 全割込み許可
+ 	clrpsw	i							; 全割込み禁止
+ 
+ 	mov.l	#__kernel_reqflg, r5		; reqflg が FALSE なら
+ 	mov.l	[r5], r4
+ 	cmp		#0, r4
+ 	bz   	dispatcher_idle_loop		; アイドルループを繰り返す
+ 	mov.l	#0, [r5]					; reqflgがtrueならfalseにする
+ 	mov.l	#__kernel_intnest, r5
+ 	mov.w	#0, [r5]					; タスクコンテキストに切換え
+ .if	TIPM_LOCK <> -15
+ 	mov.l	#__kernel_lock_flag, r5		; CPUロック状態へ
+ 	mov.l	#1, [r5]
+ 	mov.l	#__kernel_saved_ipl, r5
+ 	mov.l	#0, [r5]
+ 	mvtc	#(IPL_LOCK | PSW_I_MASK), psw	; 全割込みロック解除状態
+ 										; 割込み優先度マスク全解除でない状態
+ .endif
+ 	bra		dispatcher					; dispatcher へ戻る
+ 
+ 
+ ;
+ ; カーネルの終了処理の呼出し
+ ;
+ ; モードとスタックを非タスクコンテキスト用に切り替え．
+ ;
+ __kernel_call_exit_kernel:
+ .if	TIPM_LOCK <> -15
+ 	clrpsw	i							; 全割込み禁止
+ 	mov.l	#__kernel_lock_flag, r5		; CPUロック解除状態へ
+ 	mov.l	#0, [r5]
+ .endif
+ #ifdef RENESAS_RX72N_BSP
+     mov.l   #_istack,r0
+ #else
+ 	mov.l	#__kernel_istkpt,r5
+ 	mov.l	[r5], r0					; 割込み用のスタックへ切替え
+ #endif
+ 
+ 	mov.l	#__kernel_intnest, r5
+ 	mov.w	#1, [r5]					; 非タスクコンテキストに切換え
+ 	bsr		__kernel_exit_kernel
+ 	bra		__kernel_call_exit_kernel
+ 
+ 
+ ;
+ ;  割込み(CPU例外)からのタスクディスパッチャ入口
+ ;
+ ;	呼出し条件:
+ ;	・全割込みロック状態(PSWレジスタIビット = 0)
+ ;	・割込み優先度マスク全解除でない状態(IPL != 0)
+ ;	・タスクコンテキスト(intnest=0)
+ ;	・使用スタックはタスクスタック
+ ;	・reqflg = true
+ ;
+ ;  ここでは, ディスパッチャモードに変更し, reqflgをOFFにしてから,
+ ;  遅延ディスパッチの有無を判断する.
+ ;
+ 
+ ;
+ ;  ret_int先頭でスタックに積まれているPSWレジスタへのオフセット
+ ;  ACC + FPSW + R14--R15 + R1--R5 + PC
+ ;
+ .equ RET_INT_GET_PSW_OFFSET, (8+4+28+4)
+ 
+ ret_int:
+ .if	TIPM_LOCK == -15
+ 	mov.l	RET_INT_GET_PSW_OFFSET[r0], r5	; 割込み/CPU例外発生前のIPL値取得
+ 	and		#PSW_IPL_MASK, r5
+ 	mvtc	r5, psw						; 全割込みロック(CPUロック)状態
+ 										; 割込み/CPU例外発生前の割込み優先度
+ .else
+ 	mov.l	#__kernel_lock_flag, r5		; CPUロック状態へ
+ 	mov.l	#1, [r5]
+ 	mov.l	RET_INT_GET_PSW_OFFSET[r0], r5	; 割込み/CPU例外発生前のIPL値取得
+ 	and		#PSW_IPL_MASK, r5
+ 	mov.l	#__kernel_saved_ipl, r4
+ 	mov.l	r5, [r4]
+ 	mvtc	#(IPL_LOCK | PSW_I_MASK), psw	; 全割込みロック解除状態
+ 										; 割込み優先度マスク全解除でない状態
+ .endif
+ 	mov.l	#__kernel_reqflg, r5
+ 	mov.l	#0, [r5]					; reqflg <--- FALSE
+ 	mov.l	#__kernel_p_runtsk, r15
+ 	mov.l	[r15], r14
+ 	mov.l	#__kernel_dspflg, r5		; dspflg が FALSE なら ret_int_r へ
+ 	mov.l	[r5], r5
+ 	cmp		#0, r5
+ 	bz   	ret_int_r_call_tex
+ 	mov.l	#__kernel_p_schedtsk, r5
+ 	mov.l	[r5], r5
+ 	cmp		r5, r14						; p_schedtsk と p_runtsk が同じなら
+ 	beq  	ret_int_r_call_tex			; ret_int_r_call_tex へ
+ 	pushm	r6-r13						; 非スクラッチレジスタ保存
+ 	st_TCB_sp	r0, r14, r5				; スタックポインタをTCBに保存
+ 	st_TCB_pc	#ret_int_r, r14, r5		; 実行再開番地をTCBに保存
+ 	bra		dispatcher
+ 
+ ;
+ ;  割込み(CPU例外)へのタスクディスパッチャ出口
+ ;
+ ;  呼び出し条件:
+ ;	・ディスパッチャモード(ファイルヘッダ参照)
+ ;
+ ;  ここでは, タスク例外ハンドラ呼出しと, 割込み(CPU例外)処理モードへの
+ ;  変更と, コンテキストの復帰を行い, 割込み(CUP例外)発生元へ戻る.
+ ;
+ ret_int_r:
+ 	popm 	r6-r13						; 非スクラッチレジスタ復帰
+ ret_int_r_call_tex:
+ 	btst 	#TCB_enatex_bit, TCB_enatex[r14].B	; タスク例外処理許可
+ 	bz   	ret_int_r_rte
+ 	ld_TCB_texptn	r5, r14, r4			; 保留例外要因があるか？
+ 	cmp		#0, r5
+ 	bz   	ret_int_r_rte
+ 	bsr		__kernel_call_texrtn		; タスク例外ハンドラ呼出し処理実行
+ ret_int_r_rte:
+ .if	TIPM_LOCK <> -15
+ 	clrpsw	i							; 全割込み禁止
+ 	mov.l	#__kernel_lock_flag, r5		; CPUロック解除状態へ
+ 	mov.l	#0, [r5]
+ .endif
+ 	popm	r4-r5						; アキュムレータ復帰
+ 	mvtaclo	r5							; ACC最下位16bitは0で復帰
+ 	mvtachi	r4
+ 	popc	fpsw						; FPUステータスレジスタ復帰
+ 	popm	r14-r15						; レジスタ復帰
+ 	popm	r1-r5
+ 	rte									; 割込み前の処理に戻る
+ 
+ 
+ ;
+ ;  割込みの出入口処理(アセンブリ言語記述部分)
+ ;
+ ;  呼出し条件:
+ ;  ・割込み発生時のH/W処理により, PSWレジスタのIビット=0, IPLは受付け
+ ;    た割込みのIPL.
+ ;  ・スタックは多重割り込みなら割込みスタック, そうでなければ
+ ;    タスクスタック
+ ;  ・割込み発生時のH/W処理により,スタックに割込みからの復帰PCとPSWが
+ ;    保存されている.
+ ;  ・ベクタテーブルに登録された個別の入り口処理により, スタックに
+ ;    スクラッチレジスタ(R1-R5)が保存されている.
+ ;
+ ;  引数:
+ ;  ・r1:割込み要因番号
+ ;  ・r2:割込みハンドラのアドレス
+ ;
+ ;  レジスタがスタック上にどのように保存されているかを以下に示す.
+ ;  この図では上が低位, 下が高位のアドレスで, スタックは下から
+ ;  上方向に向かって積み上げられるものとする.
+ ;
+ ;	-------------------------
+ ;	|       ACC-HI(4byte)   |
+ ;	-------------------------(SP + 0)
+ ;	|       ACC-LO(4byte)   |
+ ;	-------------------------(SP + 4)
+ ;	|       FPSW(4byte)     |
+ ;	-------------------------(SP + 8)
+ ;	|       R14(4byte)      |
+ ;	-------------------------(SP + 12)
+ ;	|       R15(4byte)      |
+ ;	-------------------------(SP + 16)
+ ;	|       R1(4byte)       |
+ ;	-------------------------(SP + 20)
+ ;	|       R2(4byte)       |
+ ;	-------------------------(SP + 24)
+ ;	|       R3(4byte)       |
+ ;	-------------------------(SP + 28)
+ ;	|       R4(4byte)       |
+ ;	-------------------------(SP + 32)
+ ;	|       R5(4byte)       |
+ ;	-------------------------(SP + 36)
+ ;	|       PC(4byte)       |
+ ;	-------------------------(SP + 40)
+ ;	|       PSW(4byte)      |
+ ;	-------------------------(SP + 44)
+ ;
+ ;  ここでは, 割込み処理モードに変更してハンドラを実行する.
+ ;
+ ;  ハンドラからリターンした後は, 多重割込みでなく, かつ reqflg が
+ ;  TRUE になった時に，ret_int へ分岐(遅延ディスパッチ)する．
+ ;
+ ;  多重割込みかどうかは割込みネストカウンタの値で判定する.
+ ;  intnest != 0 ならば多重割込みであると判定する.
+ ;
+ ;  reqflg はCPUロック状態でチェックする. そうでないと，
+ ;  reqflg チェック後に起動された割込みハンドラ内で
+ ;  ディスパッチが要求された場合に，ディスパッチされない.
+ ;
+ _kernel_interrupt:
+ 	pushm	r14-r15						; スクラッチレジスタを退避
+ 	pushc	fpsw						; FPUステータスレジスタ退避
+ 	mvfacmi	r5
+ 	shll	#16, r5						; ACC最下位16bitは0とする
+ 	mvfachi	r4
+ 	pushm	r4-r5						; アキュムレータ退避
+ 	mov.l	#__kernel_intnest, r5
+ 	mov.w	[r5], r4
+ 	add		#1, r4						; ネスト回数をインクリメント
+ 	mov.w	r4, [r5]
+ 	cmp		#1, r4						; 多重割り込みかどうか
+ 	bnz		interrupt_from_int			; 加算前が0でなければ多重割込み
+ 						; 初段の割込み
+ 	mov.l	r0, r3						; スタックポインタを取り出し
+ #ifdef RENESAS_RX72N_BSP
+     mov.l   #_istack,r0
+ #else
+ 	mov.l	#__kernel_istkpt,r5
+ 	mov.l	[r5], r0					; 割込み用のスタックへ切替え
+ #endif
+ 
+ 	push.l	r3							; タスクスタックを保持
+ interrupt_from_int:		; 多重割込み
+ 	setpsw	i							; 割込み許可(CPUロック解除状態)
+ 
+ .if LOG_INH_LEAVE == 1
+ 	push.l	r1							; ログトレースの引数を保持
+ .endif
+ 
+ .if	LOG_INH_ENTER == 1
+ 	push.l	r2
+ 	bsr		__kernel_log_inh_enter		; ログトレース関数の呼出し
+ 							; 引数の割込み要因番号は既にr1に入っている
+ 	pop		r2
+ .endif
+ 
+ 	jsr  	r2							; Cルーチン呼び出し
+ 
+ .if	LOG_INH_LEAVE == 1
+ 	pop		r1							; 引数に割込み要因番号を設定
+ 	bsr		__kernel_log_inh_leave		; ログトレース関数の呼出し
+ .endif
+ 
+ 	clrpsw	i							; 割込み禁止(CPUロック状態)
+ 	mov.l	#__kernel_intnest, r5
+ 	mov.w	[r5], r4
+ 	sub		#1, r4						; ネスト回数をデクリメント
+ 	mov.w	r4, [r5]
+ 	cmp		#0, r4						; 多重割り込みかどうか
+ 	bnz		interrupt_return			; 多重割り込みならリターン
+ 	; 初段の割込み
+ 	pop		r0							; タスクのスタックに戻す
+ 	mov.l	#__kernel_reqflg, r5		; ディスパッチ要求がないか?
+ 	mov.l	[r5], r5
+ 	cmp		#1, r5
+ 	bz		ret_int						; あれば ret_int へジャンプ
+ interrupt_return:
+ 	popm	r4-r5						; アキュムレータ復帰
+ 	mvtaclo	r5							; ACC最下位16bitは0で復帰
+ 	mvtachi	r4
+ 	popc	fpsw						; FPUステータスレジスタ復帰
+ 	popm	r14-r15						; レジスタ復帰
+ 	popm	r1-r5
+ 	rte									; 割込み前の処理に戻る
+ 
+ 
+ ;
+ ;  CPU例外の出入口処理(アセンブリ言語記述部分)
+ ;
+ ;  呼出し条件:
+ ;  ・CPU例外発生時のH/W処理により, PSWレジスタのIビット=0, IPL=0.
+ ;  ・スタックは多重割り込みなら割込みスタック, そうでなければ
+ ;    タスクスタック
+ ;  ・CPU例外発生時のH/W処理により,スタックにCPU例外からの復帰PCと
+ ;    PSWが保存されている.
+ ;  ・ベクタテーブルに登録された個別の入り口処理により, スタックに
+ ;    スクラッチレジスタ(R1-R5)が保存されている.
+ ;
+ ;  引数:
+ ;  ・r1:CPU例外要因番号
+ ;  ・r2:CPU例外ハンドラのアドレス
+ ;
+ ;  レジスタがスタック上にどのように保存されているかを以下に示す.
+ ;  この図では上が低位, 下が高位のアドレスで, スタックは下から
+ ;  上方向に向かって積み上げられるものとする.
+ ;  なお, CPU例外要因番号とR6-R13はCPU例外ハンドラ内で情報を取得
+ ;  する目的で退避しており, 出口処理では保存内容を破棄すればよい.
+ ;
+ ;	-------------------------
+ ;	|    CPU例外要因番号    | <----- p_excinf
+ ;	------------------------- (intptr_t)(p_excinf + 0)
+ ;	|       R6(4byte)       |
+ ;	------------------------- (intptr_t)(p_excinf + 4)
+ ;	|       R7(4byte)       |
+ ;	------------------------- (intptr_t)(p_excinf + 8)
+ ;	|       R8(4byte)       |
+ ;	------------------------- (intptr_t)(p_excinf + 12)
+ ;	|       R9(4byte)       |
+ ;	------------------------- (intptr_t)(p_excinf + 16)
+ ;	|       R10(4byte)      |
+ ;	------------------------- (intptr_t)(p_excinf + 20)
+ ;	|       R11(4byte)      |
+ ;	------------------------- (intptr_t)(p_excinf + 24)
+ ;	|       R12(4byte)      |
+ ;	------------------------- (intptr_t)(p_excinf + 28)
+ ;	|       R13(4byte)      |
+ ;	------------------------- (intptr_t)(p_excinf + 32)
+ ;	|       ACC-HI(4byte)   |
+ ;	------------------------- (intptr_t)(p_excinf + 36)
+ ;	|       ACC-LO(4byte)   |
+ ;	------------------------- (intptr_t)(p_excinf + 40)
+ ;	|       FPSW(4byte)     |
+ ;	------------------------- (intptr_t)(p_excinf + 44)
+ ;	|       R14(4byte)      |
+ ;	------------------------- (intptr_t)(p_excinf + 48)
+ ;	|       R15(4byte)      |
+ ;	------------------------- (intptr_t)(p_excinf + 52)
+ ;	|       R1(4byte)       |
+ ;	------------------------- (intptr_t)(p_excinf + 56)
+ ;	|       R2(4byte)       |
+ ;	------------------------- (intptr_t)(p_excinf + 60)
+ ;	|       R3(4byte)       |
+ ;	------------------------- (intptr_t)(p_excinf + 64)
+ ;	|       R4(4byte)       |
+ ;	------------------------- (intptr_t)(p_excinf + 68)
+ ;	|       R5(4byte)       |
+ ;	------------------------- (intptr_t)(p_excinf + 72)
+ ;	|       PC(4byte)       |
+ ;	------------------------- (intptr_t)(p_excinf + 76)
+ ;	|       PSW(4byte)      |
+ ;	------------------------- (intptr_t)(p_excinf + 80)
+ ;
+ ;  ここでは, 割込み処理モードに変更してハンドラを実行する.
+ ;  CPU例外ハンドラに渡すVP型の変数 p_excinf としてISPの値渡す．
+ ;
+ ;  ハンドラからリターンした後は, 多重割込みでなく, かつ reqflg が
+ ;  TRUE になった時に，ret_int へ分岐(遅延ディスパッチ)する．
+ ;
+ ;  多重割込みかどうかは割込みネストカウンタの値で判定する.
+ ;  intnest != 0 ならば多重割込みであると判定する.
+ ;
+ ;  reqflg はCPUロック状態でチェックする. そうでないと，
+ ;  reqflg チェック後に起動された割込みハンドラ内で
+ ;  ディスパッチが要求された場合に，ディスパッチされない.
+ ;
+ ;
+ ;  CPU例外入口処理
+ ;
+ ;  ここでは, 割込み処理モードに変更してハンドラを実行する.
+ ;
+ 
+ ;
+ ;  CPU例外ハンドラ呼出し後に不要となるスタック情報のサイズ
+ ;  EXCNO + R6--R13
+ ;
+ 	.equ EXCINF_REG_SIZE, (4+32)
+ 
+ _kernel_exception:
+ 	pushm	r14-r15						; スクラッチレジスタを退避
+ 	pushc	fpsw
+ 	mvfacmi	r5
+ 	shll	#16, r5						; ACC最下位16bitは0とする
+ 	mvfachi	r4
+ 	pushm	r4-r5						; アキュムレータ退避
+ 	pushm	r6-r13						; 非スクラッチレジスタ保存
+ 	push.l	r1							; CPU例外要因番号を保持
+ 	mov.l	r0, r3						; スタックポインタを取り出し
+ 	mov.l	EXC_GET_PSW_OFFSET[r3], r5
+ 	and		#PSW_I_MASK, r5
+ 	bz		exception_nonkernel			; 全割込み禁止(CPUロック)状態なら管理外
+ .if	TIPM_LOCK <> -15
+ 	mov.l	EXC_GET_PSW_OFFSET[r3], r5
+ 	and		#PSW_IPL_MASK, r5
+ 	cmp		#IPL_LOCK, r5
+ 	bgt	exception_nonkernel			; IPLがCPUロックレベル以上なら管理外
+ .endif
+ 	mov.l	#__kernel_intnest, r5
+ 	mov.w	[r5], r4
+ 	add		#1, r4						; ネスト回数をインクリメント
+ 	mov.w	r4, [r5]
+ 	cmp		#1, r4						; 多重割り込みかどうか
+ 	bnz		exception_from_int			; 加算前が0でなければ多重割込み
+ 						; 初段の割込み
+ #ifdef RENESAS_RX72N_BSP
+     mov.l   #_istack,r0
+ #else
+ 	mov.l	#__kernel_istkpt,r5
+ 	mov.l	[r5], r0					; 割込み用のスタックへ切替え
+ #endif
+ 
+ 	push.l	r3							; タスクスタックを保持
+ exception_from_int:		; 多重割込み
+ 	mov.l	EXC_GET_PSW_OFFSET[r3], r5
+ 	mvtc	r5, psw						; CPU例外発生前の状態に戻す
+ .if	LOG_EXC_LEAVE == 1
+ 	push.l	r1							; ログトレースの引数を保持
+ .endif
+ 
+ .if LOG_EXC_ENTER == 1
+ 	pushm	r2-r3
+ 	bsr		__kernel_log_exc_enter		; ログトレース関数の呼出し
+ 							; 引数の割込み要因番号は既にr1に入っている
+ 	popm	r2-r3
+ .endif
+ 
+ 	mov.l	r3, r1						; 引数のp_excinfを設定
+ 	jsr  	r2							; Cルーチン呼び出し
+ 
+ .if	LOG_EXC_LEAVE == 1
+ 	pop		r1							; 引数に割込み要因番号を設定
+ 	bsr		__kernel_log_exc_leave		; ログトレース関数の呼出し
+ .endif
+ 
+ 	clrpsw	i							; ここからは必ず割込み禁止
+ 	mov.l	#__kernel_intnest, r5
+ 	mov.w	[r5], r4
+ 	sub		#1, r4						; ネスト回数をデクリメント
+ 	mov.w	r4, [r5]
+ 	cmp		#0, r4						; 多重割り込みかどうか
+ 	bnz		exception_return			; 多重割り込みならリターン
+ 	; 初段の割込み
+ 	pop		r0							; タスクのスタックに戻す
+ 	mov.l	#__kernel_reqflg, r5		; ディスパッチ要求がないか?
+ 	mov.l	[r5], r5
+ 	cmp		#1, r5
+ 	bnz		exception_return			; なければリターン
+ 	add		#EXCINF_REG_SIZE, r0		; CPU例外情報の破棄
+ 	bra		ret_int						; あれば ret_int へジャンプ
+ 
+ exception_nonkernel:
+ 	mov.l	#__kernel_intnest, r5
+ 	mov.w	[r5], r4
+ 	add		#1, r4						; ネスト回数をインクリメント
+ 	mov.w	r4, [r5]
+ 	cmp		#1, r4						; 多重割り込みかどうか
+ 	bnz		exception_from_nonkernelint	; 加算前が0でなければ多重割込み
+ 						; 初段の割込み
+ #ifdef RENESAS_RX72N_BSP
+     mov.l   #_istack,r0
+ #else
+ 	mov.l	#__kernel_istkpt,r5
+ 	mov.l	[r5], r0					; 割込み用のスタックへ切替え
+ #endif
+ 
+ 	push.l	r3							; タスクスタックを保持
+ exception_from_nonkernelint:	; 多重割込み
+ 	mov.l	EXC_GET_PSW_OFFSET[r3], r5
+ 	mvtc	r5, psw						; CPU例外発生前の状態に戻す
+ 
+ 	mov.l	r3, r1						; 引数のp_excinfを設定
+ 	jsr  	r2							; Cルーチン呼び出し
+ 
+ 	clrpsw	i							; ここからは必ず割込み禁止
+ 	mov.l	#__kernel_intnest, r5
+ 	mov.w	[r5], r4
+ 	sub		#1, r4						; ネスト回数をデクリメント
+ 	mov.w	r4, [r5]
+ 	cmp		#0, r4						; 多重割り込みかどうか
+ 	bnz		exception_return			; 多重割り込みならリターン
+ 	; 初段の割込み
+ 	pop		r0							; タスクのスタックに戻す
+ 
+ exception_return:
+ 	add		#EXCINF_REG_SIZE, r0		; CPU例外情報の破棄
+ 	popm	r4-r5						; アキュムレータ復帰
+ 	mvtaclo	r5							; ACC最下位16bitは0で復帰
+ 	mvtachi	r4
+ 	popc	fpsw						; FPUステータスレジスタ復帰
+ 	popm	r14-r15						; レジスタ復帰
+ 	popm	r1-r5
+ 	rte									; 割込み前の処理に戻る
+ 
+ 
+ ;
+ ;  微少時間待ち
+ ;
+ _sil_dly_nse:
+ 	mov.l	#SIL_DLY_TIM1, r5
+ 	sub		r5, r1
+ 	ble		sil_dly_nse_ret
+ sil_dly_nse_loop:
+ 	mov.l	#SIL_DLY_TIM2, r5
+ 	sub		r5, r1
+ 	bgt		sil_dly_nse_loop
+ sil_dly_nse_ret:
+ 	rts
+ 
+ 	.end
diff -cr --new-file asp/arch/rx_gcc/rx_common/prc_test.S 1.9.1_update/arch/rx_gcc/rx_common/prc_test.S
*** asp/arch/rx_gcc/rx_common/prc_test.S	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/arch/rx_gcc/rx_common/prc_test.S	Thu Dec 15 13:53:29 2022
***************
*** 0 ****
--- 1,53 ----
+ ;*
+ ;*  TOPPERS/ASP Kernel
+ ;*      Toyohashi Open Platform for Embedded Real-Time Systems/
+ ;*      Advanced Standard Profile Kernel
+ ;* 
+ ;*  Copyright (C) 2010 by Witz Corporation, JAPAN
+ ;* 
+ ;*  上記著作権者は，Free Software Foundation によって公表されている 
+ ;*  GNU General Public License の Version 2 に記述されている条件か，以
+ ;*  下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェア（本ソフトウェ
+ ;*  アを改変したものを含む．以下同じ）を使用・複製・改変・再配布（以下，
+ ;*  利用と呼ぶ）することを無償で許諾する．
+ ;*  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+ ;*      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+ ;*      スコード中に含まれていること．
+ ;*  (2) 本ソフトウェアを再利用可能なバイナリコード（リロケータブルオブ
+ ;*      ジェクトファイルやライブラリなど）の形で利用する場合には，利用
+ ;*      に伴うドキュメント（利用者マニュアルなど）に，上記の著作権表示，
+ ;*      この利用条件および下記の無保証規定を掲載すること．
+ ;*  (3) 本ソフトウェアを再利用不可能なバイナリコードの形または機器に組
+ ;*      み込んだ形で利用する場合には，次のいずれかの条件を満たすこと．
+ ;*    (a) 利用に伴うドキュメント（利用者マニュアルなど）に，上記の著作
+ ;*        権表示，この利用条件および下記の無保証規定を掲載すること．
+ ;*    (b) 利用の形態を，別に定める方法によって，上記著作権者に報告する
+ ;*        こと．
+ ;*  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+ ;*      害からも，上記著作権者を免責すること．
+ ;* 
+ ;*  本ソフトウェアは，無保証で提供されているものである．上記著作権者は，
+ ;*  本ソフトウェアに関して，その適用可能性も含めて，いかなる保証も行わ
+ ;*  ない．また，本ソフトウェアの利用により直接的または間接的に生じたい
+ ;*  かなる損害に関しても，その責任を負わない．
+ ;* 
+ 
+    .text
+ 
+ 	.global	_trigger_cpu_exception
+ 
+ _trigger_cpu_exception:
+ 	;
+ 	;  CPU例外の発生
+ 	;
+ 	;  ゼロ割り算を行うことで, 浮動小数点例外を
+ 	;  発生させる.
+ 	;
+ 	mvtc	#0x00001000, fpsw
+ 	mov.l	#1, r5
+ 	fdiv	#0, r5
+ 	mvtc	#0x00000000, fpsw
+ 	rts
+ 
+ 	.end
+ 
diff -cr --new-file asp/arch/rx_gcc/rx_common/prc_test.h 1.9.1_update/arch/rx_gcc/rx_common/prc_test.h
*** asp/arch/rx_gcc/rx_common/prc_test.h	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/arch/rx_gcc/rx_common/prc_test.h	Thu Dec 15 18:37:38 2022
***************
*** 0 ****
--- 1,51 ----
+ /*
+  *  TOPPERS/ASP Kernel
+  *      Toyohashi Open Platform for Embedded Real-Time Systems/
+  *      Advanced Standard Profile Kernel
+  * 
+  *  Copyright (C) 2008-2010 by Witz Corporation, JAPAN
+  * 
+  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
+  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
+  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
+  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+  *      スコード中に含まれていること．
+  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
+  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
+  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
+  *      の無保証規定を掲載すること．
+  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
+  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
+  *      と．
+  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
+  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
+  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
+  *        報告すること．
+  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
+  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
+  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
+  *      免責すること．
+  * 
+  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
+  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
+  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
+  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
+  *  の責任を負わない．
+  * 
+  */
+ 
+ /*
+  *		テストプログラムのターゲット依存定義（RX72N用）
+  */
+ 
+ #ifndef TOPPERS_PRC_TEST_H
+ #define TOPPERS_PRC_TEST_H
+ 
+ #define CPUEXC1					25		/* 浮動小数点例外 */
+ #define RAISE_CPU_EXCEPTION		trigger_cpu_exception()
+ 
+ extern void trigger_cpu_exception( void );
+ 
+ #endif /* TOPPERS_PRC_TEST_H */
diff -cr --new-file asp/arch/rx_gcc/rx_common/prc_unrename.h 1.9.1_update/arch/rx_gcc/rx_common/prc_unrename.h
*** asp/arch/rx_gcc/rx_common/prc_unrename.h	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/arch/rx_gcc/rx_common/prc_unrename.h	Thu Dec 15 13:49:08 2022
***************
*** 0 ****
--- 1,87 ----
+ /* This file is generated from prc_rename.def by genrename. */
+ 
+ #ifndef TOPPERS_PRC_RENAME_H
+ #define TOPPERS_PRC_RENAME_H
+ 
+ /*
+  *  prc_config.c
+  */
+ #undef intnest
+ #undef lock_flag
+ #undef saved_ipl
+ #undef saved_psw
+ 
+ #undef prc_initialize
+ #undef prc_terminate
+ #undef x_config_int
+ #undef default_int_handler
+ #undef default_exc_handler
+ 
+ /*
+  *  prc_support.src
+  */
+ #undef dispatch
+ #undef start_dispatch
+ #undef exit_and_dispatch
+ #undef call_exit_kernel
+ #undef start_r
+ #undef interrupt
+ #undef exception
+ 
+ /*
+  *  rx_config
+  */
+ #undef ipr_reg_addr
+ #undef ier_reg_addr
+ #undef ir_reg_addr
+ #undef irqcr_reg_addr
+ 
+ /*
+  *  kernel_cfg.c
+  */
+ #undef cfg_int_table
+ 
+ #ifdef TOPPERS_LABEL_ASM
+ 
+ /*
+  *  prc_config.c
+  */
+ #undef _intnest
+ #undef _lock_flag
+ #undef _saved_ipl
+ #undef _saved_psw
+ 
+ #undef _prc_initialize
+ #undef _prc_terminate
+ #undef _x_config_int
+ #undef _default_int_handler
+ #undef _default_exc_handler
+ 
+ /*
+  *  prc_support.src
+  */
+ #undef _dispatch
+ #undef _start_dispatch
+ #undef _exit_and_dispatch
+ #undef _call_exit_kernel
+ #undef _start_r
+ #undef _interrupt
+ #undef _exception
+ 
+ /*
+  *  rx63n_config.c
+  */
+ #undef _ipr_reg_addr
+ #undef _ier_reg_addr
+ #undef _ir_reg_addr
+ #undef _irqcr_reg_addr
+ 
+ /*
+  *  kernel_cfg.c
+  */
+ #undef _cfg_int_table
+ 
+ #endif /* TOPPERS_LABEL_ASM */
+ 
+ 
+ #endif /* TOPPERS_PRC_RENAME_H */
Binary files asp/cfg/cfg/cfg.exe and 1.9.1_update/cfg/cfg/cfg.exe differ
diff -cr --new-file asp/configure 1.9.1_update/configure
*** asp/configure	Sun Nov 11 17:23:28 2012
--- 1.9.1_update/configure	Thu Jan  1 09:00:00 1970
***************
*** 1,273 ****
- #! /usr/bin/perl
- #
- #  TOPPERS Software
- #      Toyohashi Open Platform for Embedded Real-Time Systems
- # 
- #  Copyright (C) 2001-2003 by Embedded and Real-Time Systems Laboratory
- #                              Toyohashi Univ. of Technology, JAPAN
- #  Copyright (C) 2006-2012 by Embedded and Real-Time Systems Laboratory
- #              Graduate School of Information Science, Nagoya Univ., JAPAN
- # 
- #  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
- #  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
- #  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
- #  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
- #      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
- #      スコード中に含まれていること．
- #  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
- #      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
- #      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
- #      の無保証規定を掲載すること．
- #  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
- #      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
- #      と．
- #    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
- #        作権表示，この利用条件および下記の無保証規定を掲載すること．
- #    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
- #        報告すること．
- #  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
- #      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
- #      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
- #      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
- #      免責すること．
- # 
- #  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
- #  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
- #  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
- #  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
- #  の責任を負わない．
- # 
- #  @(#) $Id: configure 2424 2012-11-11 08:23:22Z ertl-hiro $
- # 
- 
- use Getopt::Std;
- 
- #  オプションの定義
- #
- #  -T <target>			ターゲット名（必須）
- #  -A <applname>		アプリケーションプログラム名（デフォルトはsample1）
- #  -a <appldir>			アプリケーションのディレクトリ名
- #  -U <applobjs>		他のアプリケーションプログラムファイル
- #						（.oファイル名で指定．複数指定可）
- #  -S <syssvcobjs>		システムサービスのプログラムファイル
- #						（.oファイル名で指定．複数指定可）
- #  -L <kernel_lib>		カーネルライブラリ（libkernel.a）のディレクトリ名
- #						（省略した場合，カーネルライブラリもmakeする）
- #  -f					カーネルを関数単位でコンパイルするかどうかの指定
- #  -D <srcdir>			カーネル等のソースの置かれているディレクトリ
- #  -l <srclang>			プログラミング言語（現時点ではcとc++のみサポート）
- #  -t <templatedir>		テンプレートディレクトリの指定（デフォルトはsample）
- #  -m <makefile>		テンプレートMakefile名の指定（デフォルトはMakefile）
- #  -d <dbgenv>			実行環境の名称
- #  -r					トレースログ記録のサンプルコードを使用するかどうか
- #						の指定
- #  -p <perl>			perlのパス名（明示的に指定する場合）
- #  -g <cfg>				コンフィギュレータ（cfg）のパス名
- #  -P <num>				プロセッサ数（マルチプロセッサ対応カーネルの場合）
- #  -o <options>			共通コンパイルオプション（COPTSに追加）
- #  -O <options>			共通シンボル定義オプション（CDEFSに追加）
- #  -k <options>			共通リンカオプション（LDFLAGS等に追加）
- 
- #  使用例(1)
- #
- #  % ../configure -T dve68k_gcc -D GDB_STUB -A perf1 -a ../test -U histogram.o
- #
- #  使用例(2)
- #
- #  % ../configure -T macosx_gcc -L .
- #	アプリケーションプログラムは sample1 になる．
- 
- #
- #  オプションの処理
- #
- getopt("TAaUSLDltmdpgPoOk");
- 
- #
- #  変数の初期化
- #
- 
- $target = $opt_T;
- $applname = $opt_A ? $opt_A : "sample1";
- $appldir = $opt_a ? $opt_a : "";
- $applobjs = $opt_U ? $opt_U : "";
- $syssvcobjs = $opt_S ? $opt_S : "";
- $kernel_lib = $opt_L ? $opt_L : "";
- $kernel_funcobjs = $opt_f ? "true" : "";
- $srclang = $opt_l ? $opt_l : "c";
- $makefile = $opt_m ? $opt_m : "Makefile";
- $dbgenv = $opt_d ? "TOPPERS_".$opt_d : "";
- $enable_trace = $opt_r ? "true" : "";
- $prc_num = $opt_P ? $opt_P : "";
- $copts = $opt_o ? $opt_o : "";
- $cdefs = $opt_O ? $opt_O : "";
- $ldflags = $opt_k ? $opt_k : "";
- 
- #
- #  オブジェクトファイル名の拡張子を返す
- #
- sub get_objext {
- 	if ($^O eq 'cygwin') {
- 		return("exe");
- 	}
- 	else {
- 		return("");
- 	}
- }
- 
- #
- #  プログラムの場所を検索する
- #
- sub get_path {
- 	my($progname, @pathlist) = @_;
- 	my($path);
- 
- 	foreach $path (@pathlist) {
- 		if (-x $path."/".$progname) {
- 			return($path."/".$progname);
- 		}
- 	}
- 	return("");
- }
- 
- #
- #  ファイルを変換する
- #
- sub convert {
- 	my($infile, $outfile) = @_;
- 	my($line);
- 
- 	print STDERR "configure: Generating $outfile from $infile.\n";
- 	if (-f $outfile) {
- 		print STDERR "configure: $outfile exists.",
- 						"  Save as $outfile.bak.\n";
- 		rename($outfile, $outfile.".bak");
- 	}
- 	unless (open(INFILE, $infile)) {
- 		print STDERR "configure: can't open $infile\n";
- 		exit(1);
- 	}
- 	unless (open(OUTFILE, "> ".$outfile)) {
- 		print STDERR "configure: can't open $outfile\n";
- 		exit(1);
- 	}
- 
- 	while ($line = <INFILE>) {
- 		chop $line;
- 		while ($line =~ /^(.*)\@\(([A-Za-z_]+)\)(.*)$/) {
- 			$line = $1.$vartable{$2}.$3;
- 		}
- 		print OUTFILE $line,"\n";
- 	}
- 
- 	close(INFILE);
- 	close(OUTFILE);
- }
- 
- #
- #  サンプルを見つけてファイルを生成する
- #
- sub generate {
- 	my($file, $mandatory) = @_;
- 	my($path);
- 
- 	$path = $templatedir."/".$file.".".$target;
- 	if (-f $path) {
- 		convert($path, $file);
- 		return;
- 	}	
- 
- 	$path = $templatedir."/".$file;
- 	if ($mandatory || -f $path) {
- 		convert($path, $file);
- 	}	
- }
- 
- #
- #  ソースディレクトリ名を取り出す
- #
- $pwd = `pwd`; chop $pwd;
- if ($opt_D) {
- 	$srcabsdir = $srcdir = $opt_D;
- }
- elsif ($0 =~ /(.*)\/configure/) {
- 	$srcdir = $1;
- 	if ($srcdir =~ /^\//) {
- 		$srcabsdir = $srcdir;
- 	}
- 	else {
- 		$srcabsdir = $pwd."/".$srcdir;
- 	}
- }
- else {
- 	$srcabsdir = $srcdir = $pwd;
- }
- 
- $perl = $opt_p ? $opt_p : get_path("perl", ("/usr/local/bin", "/usr/bin"));
- $cfg = $opt_g ? $opt_g : "\$(SRCDIR)/cfg/cfg/cfg";
- $cfgfile = $opt_g ? $opt_g : $srcdir."/cfg/cfg/cfg";
- $templatedir = $opt_t ? $opt_t : $srcdir."/sample";
- 
- #
- #  -Tオプションの確認
- #
- unless ($opt_T) {
- 	print STDERR "configure: -T option is mandatory\n";
- 	print STDERR "Installed targets are:\n";
- 	foreach $targetname (<$srcdir/target/[a-zA-Z0-9]*>) {
- 		$targetname =~ s|$srcdir/target/||;
- 		print STDERR "\t$targetname\n";
- 	}
- 	exit(1);
- }
- 
- #
- #  変数テーブルの作成
- #
- %vartable = ();
- $vartable{"TARGET"} = $target;
- $vartable{"APPLNAME"} = $applname;
- $vartable{"APPLDIR"} = $appldir;
- $vartable{"APPLOBJS"} = $applobjs;
- $vartable{"SYSSVCOBJS"} = $syssvcobjs;
- $vartable{"KERNEL_LIB"} = $kernel_lib;
- $vartable{"KERNEL_FUNCOBJS"} = $kernel_funcobjs;
- $vartable{"SRCDIR"} = $srcdir;
- $vartable{"SRCABSDIR"} = $srcabsdir;
- $vartable{"SRCLANG"} = $srclang;
- $vartable{"DBGENV"} = $dbgenv;
- $vartable{"ENABLE_TRACE"} = $enable_trace;
- $vartable{"PERL"} = $perl;
- $vartable{"CFG"} = $cfg;
- $objext = get_objext();
- $vartable{"OBJEXT"} = $objext;
- $vartable{"PRC_NUM"} = $prc_num;
- $vartable{"COPTS"} = $copts;
- $vartable{"CDEFS"} = $cdefs;
- $vartable{"LDFLAGS"} = $ldflags;
- 
- #
- #  ターゲットディレクトリのチェック
- #
- 
- if (! -d $srcdir."/target/".$target) {
- 	print STDERR "configure: $srcdir/target/$target not exist\n";
- 	exit(1);
- }
- 
- #
- #  Makefile とアプリケーションファイルの生成
- #
- 
- generate($makefile, 1);
- generate($applname.".c", 0);
- generate($applname.".cpp", 0);
- generate($applname.".h", 0);
- generate($applname.".cfg", 0);
- 
- #
- #  cfg ができているかのチェック
- #
- 
- if (!(-x ($objext eq "" ? $cfgfile : $cfgfile.".".$objext))) {
- 	print STDERR "Executable file of the configurator (cfg) is not found.\n";
- }
--- 0 ----
diff -cr --new-file asp/kernel/interrupt.c 1.9.1_update/kernel/interrupt.c
*** asp/kernel/interrupt.c	Sun Jun 26 12:14:58 2011
--- 1.9.1_update/kernel/interrupt.c	Thu Dec 15 13:53:34 2022
***************
*** 1,254 ****
! /*
!  *  TOPPERS/ASP Kernel
!  *      Toyohashi Open Platform for Embedded Real-Time Systems/
!  *      Advanced Standard Profile Kernel
!  * 
!  *  Copyright (C) 2000-2003 by Embedded and Real-Time Systems Laboratory
!  *                              Toyohashi Univ. of Technology, JAPAN
!  *  Copyright (C) 2005-2011 by Embedded and Real-Time Systems Laboratory
!  *              Graduate School of Information Science, Nagoya Univ., JAPAN
!  * 
!  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
!  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
!  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
!  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
!  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
!  *      スコード中に含まれていること．
!  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
!  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
!  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
!  *      の無保証規定を掲載すること．
!  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
!  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
!  *      と．
!  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
!  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
!  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
!  *        報告すること．
!  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
!  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
!  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
!  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
!  *      免責すること．
!  * 
!  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
!  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
!  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
!  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
!  *  の責任を負わない．
!  * 
!  *  @(#) $Id: interrupt.c 2133 2011-06-26 03:14:51Z ertl-hiro $
!  */
! 
! /*
!  *		割込み管理機能
!  */
! 
! #include "kernel_impl.h"
! #include "check.h"
! #include "task.h"
! #include "interrupt.h"
! 
! /*
!  *  トレースログマクロのデフォルト定義
!  */
! #ifndef LOG_DIS_INT_ENTER
! #define LOG_DIS_INT_ENTER(intno)
! #endif /* LOG_DIS_INT_ENTER */
! 
! #ifndef LOG_DIS_INT_LEAVE
! #define LOG_DIS_INT_LEAVE(ercd)
! #endif /* LOG_DIS_INT_LEAVE */
! 
! #ifndef LOG_ENA_INT_ENTER
! #define LOG_ENA_INT_ENTER(intno)
! #endif /* LOG_ENA_INT_ENTER */
! 
! #ifndef LOG_ENA_INT_LEAVE
! #define LOG_ENA_INT_LEAVE(ercd)
! #endif /* LOG_ENA_INT_LEAVE */
! 
! #ifndef LOG_CHG_IPM_ENTER
! #define LOG_CHG_IPM_ENTER(intpri)
! #endif /* LOG_CHG_IPM_ENTER */
! 
! #ifndef LOG_CHG_IPM_LEAVE
! #define LOG_CHG_IPM_LEAVE(ercd)
! #endif /* LOG_CHG_IPM_LEAVE */
! 
! #ifndef LOG_GET_IPM_ENTER
! #define LOG_GET_IPM_ENTER(p_intpri)
! #endif /* LOG_GET_IPM_ENTER */
! 
! #ifndef LOG_GET_IPM_LEAVE
! #define LOG_GET_IPM_LEAVE(ercd, intpri)
! #endif /* LOG_GET_IPM_LEAVE */
! 
! /* 
!  *  割込み管理機能の初期化
!  */
! #ifdef TOPPERS_intini
! #ifndef OMIT_INITIALIZE_INTERRUPT
! 
! void
! initialize_interrupt(void)
! {
! 	uint_t			i;
! 	const INHINIB	*p_inhinib;
! 	const INTINIB	*p_intinib;
! 
! 	for (i = 0; i < tnum_inhno; i++) {
! 		p_inhinib = &(inhinib_table[i]);
! 		x_define_inh(p_inhinib->inhno, p_inhinib->int_entry);
! 	}
! 	for (i = 0; i < tnum_intno; i++) {
! 		p_intinib = &(intinib_table[i]);
! 		x_config_int(p_intinib->intno, p_intinib->intatr, p_intinib->intpri);
! 	}
! }
! 
! #endif /* OMIT_INITIALIZE_INTERRUPT */
! #endif /* TOPPERS_intini */
! 
! /*
!  *  割込みの禁止
!  */
! #ifdef TOPPERS_dis_int
! #ifdef TOPPERS_SUPPORT_DIS_INT
! 
! ER
! dis_int(INTNO intno)
! {
! 	bool_t	locked;
! 	ER		ercd;
! 
! 	LOG_DIS_INT_ENTER(intno);
! 	CHECK_TSKCTX();
! 	CHECK_INTNO_DISINT(intno);
! 
! 	locked = t_sense_lock();
! 	if (!locked) {
! 		t_lock_cpu();
! 	}
! 	if (t_disable_int(intno)) {
! 		ercd = E_OK;
! 	}
! 	else {
! 		ercd = E_OBJ;
! 	}
! 	if (!locked) {
! 		t_unlock_cpu();
! 	}
! 
!   error_exit:
! 	LOG_DIS_INT_LEAVE(ercd);
! 	return(ercd);
! }
! 
! #endif /* TOPPERS_SUPPORT_DIS_INT */
! #endif /* TOPPERS_dis_int */
! 
! /*
!  *  割込みの許可
!  */
! #ifdef TOPPERS_ena_int
! #ifdef TOPPERS_SUPPORT_ENA_INT
! 
! ER
! ena_int(INTNO intno)
! {
! 	bool_t	locked;
! 	ER		ercd;
! 
! 	LOG_ENA_INT_ENTER(intno);
! 	CHECK_TSKCTX();
! 	CHECK_INTNO_DISINT(intno);
! 
! 	locked = t_sense_lock();
! 	if (!locked) {
! 		t_lock_cpu();
! 	}
! 	if (t_enable_int(intno)) {
! 		ercd = E_OK;
! 	}
! 	else {
! 		ercd = E_OBJ;
! 	}
! 	if (!locked) {
! 		t_unlock_cpu();
! 	}
! 
!   error_exit:
! 	LOG_ENA_INT_LEAVE(ercd);
! 	return(ercd);
! }
! 
! #endif /* TOPPERS_SUPPORT_ENA_INT */
! #endif /* TOPPERS_ena_int */
! 
! /*
!  *  割込み優先度マスクの変更
!  */
! #ifdef TOPPERS_chg_ipm
! 
! ER
! chg_ipm(PRI intpri)
! {
! 	ER		ercd;
! 
! 	LOG_CHG_IPM_ENTER(intpri);
! 	CHECK_TSKCTX_UNL();
! 	CHECK_INTPRI_CHGIPM(intpri);
! 
! 	t_lock_cpu();
! 	t_set_ipm(intpri);
! 	if (intpri == TIPM_ENAALL) {
! 		ipmflg = true;
! 		if (!disdsp) {
! 			dspflg = true;
! 			if (p_runtsk != p_schedtsk) {
! 				dispatch();
! 			}
! 		}
! 		if (p_runtsk->enatex && p_runtsk->texptn != 0U) {
! 			call_texrtn();
! 		}
! 	}
! 	else {
! 		ipmflg = false;
! 		dspflg = false;
! 	}
! 	ercd = E_OK;
! 	t_unlock_cpu();
! 
!   error_exit:
! 	LOG_CHG_IPM_LEAVE(ercd);
! 	return(ercd);
! }
! 
! #endif /* TOPPERS_chg_ipm */
! 
! /*
!  *  割込み優先度マスクの参照
!  */
! #ifdef TOPPERS_get_ipm
! 
! ER
! get_ipm(PRI *p_intpri)
! {
! 	ER		ercd;
! 
! 	LOG_GET_IPM_ENTER(p_intpri);
! 	CHECK_TSKCTX_UNL();
! 
! 	t_lock_cpu();
! 	*p_intpri = t_get_ipm();
! 	ercd = E_OK;
! 	t_unlock_cpu();
! 
!   error_exit:
! 	LOG_GET_IPM_LEAVE(ercd, *p_intpri);
! 	return(ercd);
! }
! 
! #endif /* TOPPERS_get_ipm */
--- 1,256 ----
! /*
!  *  TOPPERS/ASP Kernel
!  *      Toyohashi Open Platform for Embedded Real-Time Systems/
!  *      Advanced Standard Profile Kernel
!  * 
!  *  Copyright (C) 2000-2003 by Embedded and Real-Time Systems Laboratory
!  *                              Toyohashi Univ. of Technology, JAPAN
!  *  Copyright (C) 2005-2011 by Embedded and Real-Time Systems Laboratory
!  *              Graduate School of Information Science, Nagoya Univ., JAPAN
!  * 
!  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
!  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
!  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
!  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
!  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
!  *      スコード中に含まれていること．
!  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
!  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
!  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
!  *      の無保証規定を掲載すること．
!  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
!  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
!  *      と．
!  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
!  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
!  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
!  *        報告すること．
!  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
!  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
!  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
!  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
!  *      免責すること．
!  * 
!  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
!  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
!  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
!  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
!  *  の責任を負わない．
!  * 
!  *  @(#) $Id: interrupt.c 2133 2011-06-26 03:14:51Z ertl-hiro $
!  */
! 
! /*
!  *		割込み管理機能
!  */
! 
! #include "kernel_impl.h"
! #include "check.h"
! #include "task.h"
! #include "interrupt.h"
! 
! /*
!  *  トレースログマクロのデフォルト定義
!  */
! #ifndef LOG_DIS_INT_ENTER
! #define LOG_DIS_INT_ENTER(intno)
! #endif /* LOG_DIS_INT_ENTER */
! 
! #ifndef LOG_DIS_INT_LEAVE
! #define LOG_DIS_INT_LEAVE(ercd)
! #endif /* LOG_DIS_INT_LEAVE */
! 
! #ifndef LOG_ENA_INT_ENTER
! #define LOG_ENA_INT_ENTER(intno)
! #endif /* LOG_ENA_INT_ENTER */
! 
! #ifndef LOG_ENA_INT_LEAVE
! #define LOG_ENA_INT_LEAVE(ercd)
! #endif /* LOG_ENA_INT_LEAVE */
! 
! #ifndef LOG_CHG_IPM_ENTER
! #define LOG_CHG_IPM_ENTER(intpri)
! #endif /* LOG_CHG_IPM_ENTER */
! 
! #ifndef LOG_CHG_IPM_LEAVE
! #define LOG_CHG_IPM_LEAVE(ercd)
! #endif /* LOG_CHG_IPM_LEAVE */
! 
! #ifndef LOG_GET_IPM_ENTER
! #define LOG_GET_IPM_ENTER(p_intpri)
! #endif /* LOG_GET_IPM_ENTER */
! 
! #ifndef LOG_GET_IPM_LEAVE
! #define LOG_GET_IPM_LEAVE(ercd, intpri)
! #endif /* LOG_GET_IPM_LEAVE */
! 
! /* 
!  *  割込み管理機能の初期化
!  */
! #ifdef TOPPERS_intini
! #ifndef OMIT_INITIALIZE_INTERRUPT
! 
! void
! initialize_interrupt(void)
! {
! 	uint_t			i;
! 	const INHINIB	*p_inhinib;
! 	const INTINIB	*p_intinib;
! 
! 	for (i = 0; i < tnum_inhno; i++) {
! 		p_inhinib = &(inhinib_table[i]);
! 		x_define_inh(p_inhinib->inhno, p_inhinib->int_entry);
! 	}
! 	for (i = 0; i < tnum_intno; i++) {
! 		p_intinib = &(intinib_table[i]);
! 		x_config_int(p_intinib->intno, p_intinib->intatr, p_intinib->intpri);
! 	}
! }
! 
! #endif /* OMIT_INITIALIZE_INTERRUPT */
! #endif /* TOPPERS_intini */
! 
! /*
!  *  割込みの禁止
!  */
! #undef TOPPERS_dis_int
! #ifdef TOPPERS_dis_int
! #ifdef TOPPERS_SUPPORT_DIS_INT
! 
! ER
! dis_int(INTNO intno)
! {
! 	bool_t	locked;
! 	ER		ercd;
! 
! 	LOG_DIS_INT_ENTER(intno);
! 	CHECK_TSKCTX();
! 	CHECK_INTNO_DISINT(intno);
! 
! 	locked = t_sense_lock();
! 	if (!locked) {
! 		t_lock_cpu();
! 	}
! 	if (t_disable_int(intno)) {
! 		ercd = E_OK;
! 	}
! 	else {
! 		ercd = E_OBJ;
! 	}
! 	if (!locked) {
! 		t_unlock_cpu();
! 	}
! 
!   error_exit:
! 	LOG_DIS_INT_LEAVE(ercd);
! 	return(ercd);
! }
! 
! #endif /* TOPPERS_SUPPORT_DIS_INT */
! #endif /* TOPPERS_dis_int */
! 
! /*
!  *  割込みの許可
!  */
! #undef TOPPERS_ena_int
! #ifdef TOPPERS_ena_int
! #ifdef TOPPERS_SUPPORT_ENA_INT
! 
! ER
! ena_int(INTNO intno)
! {
! 	bool_t	locked;
! 	ER		ercd;
! 
! 	LOG_ENA_INT_ENTER(intno);
! 	CHECK_TSKCTX();
! 	CHECK_INTNO_DISINT(intno);
! 
! 	locked = t_sense_lock();
! 	if (!locked) {
! 		t_lock_cpu();
! 	}
! 	if (t_enable_int(intno)) {
! 		ercd = E_OK;
! 	}
! 	else {
! 		ercd = E_OBJ;
! 	}
! 	if (!locked) {
! 		t_unlock_cpu();
! 	}
! 
!   error_exit:
! 	LOG_ENA_INT_LEAVE(ercd);
! 	return(ercd);
! }
! 
! #endif /* TOPPERS_SUPPORT_ENA_INT */
! #endif /* TOPPERS_ena_int */
! 
! /*
!  *  割込み優先度マスクの変更
!  */
! #ifdef TOPPERS_chg_ipm
! 
! ER
! chg_ipm(PRI intpri)
! {
! 	ER		ercd;
! 
! 	LOG_CHG_IPM_ENTER(intpri);
! 	CHECK_TSKCTX_UNL();
! 	CHECK_INTPRI_CHGIPM(intpri);
! 
! 	t_lock_cpu();
! 	t_set_ipm(intpri);
! 	if (intpri == TIPM_ENAALL) {
! 		ipmflg = true;
! 		if (!disdsp) {
! 			dspflg = true;
! 			if (p_runtsk != p_schedtsk) {
! 				dispatch();
! 			}
! 		}
! 		if (p_runtsk->enatex && p_runtsk->texptn != 0U) {
! 			call_texrtn();
! 		}
! 	}
! 	else {
! 		ipmflg = false;
! 		dspflg = false;
! 	}
! 	ercd = E_OK;
! 	t_unlock_cpu();
! 
!   error_exit:
! 	LOG_CHG_IPM_LEAVE(ercd);
! 	return(ercd);
! }
! 
! #endif /* TOPPERS_chg_ipm */
! 
! /*
!  *  割込み優先度マスクの参照
!  */
! #ifdef TOPPERS_get_ipm
! 
! ER
! get_ipm(PRI *p_intpri)
! {
! 	ER		ercd;
! 
! 	LOG_GET_IPM_ENTER(p_intpri);
! 	CHECK_TSKCTX_UNL();
! 
! 	t_lock_cpu();
! 	*p_intpri = t_get_ipm();
! 	ercd = E_OK;
! 	t_unlock_cpu();
! 
!   error_exit:
! 	LOG_GET_IPM_LEAVE(ercd, *p_intpri);
! 	return(ercd);
! }
! 
! #endif /* TOPPERS_get_ipm */
diff -cr --new-file asp/kernel/kernel_impl.h 1.9.1_update/kernel/kernel_impl.h
*** asp/kernel/kernel_impl.h	Wed Jan 27 22:24:12 2010
--- 1.9.1_update/kernel/kernel_impl.h	Thu Dec 15 13:53:34 2022
***************
*** 1,180 ****
! /*
!  *  TOPPERS/ASP Kernel
!  *      Toyohashi Open Platform for Embedded Real-Time Systems/
!  *      Advanced Standard Profile Kernel
!  * 
!  *  Copyright (C) 2000-2003 by Embedded and Real-Time Systems Laboratory
!  *                              Toyohashi Univ. of Technology, JAPAN
!  *  Copyright (C) 2004-2010 by Embedded and Real-Time Systems Laboratory
!  *              Graduate School of Information Science, Nagoya Univ., JAPAN
!  * 
!  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
!  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
!  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
!  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
!  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
!  *      スコード中に含まれていること．
!  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
!  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
!  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
!  *      の無保証規定を掲載すること．
!  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
!  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
!  *      と．
!  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
!  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
!  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
!  *        報告すること．
!  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
!  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
!  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
!  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
!  *      免責すること．
!  * 
!  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
!  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
!  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
!  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
!  *  の責任を負わない．
!  * 
!  *  @(#) $Id: kernel_impl.h 1713 2010-01-27 13:23:29Z ertl-hiro $
!  */
! 
! /*
!  *		TOPPERS/ASPカーネル内部向け標準ヘッダファイル
!  *
!  *  このヘッダファイルは，カーネルを構成するプログラムのソースファイル
!  *  で必ずインクルードするべき標準ヘッダファイルである．
!  *
!  *  アセンブリ言語のソースファイルからこのファイルをインクルードする時
!  *  は，TOPPERS_MACRO_ONLYを定義しておく．これにより，マクロ定義以外を
!  *  除くようになっている．
!  */
! 
! #ifndef TOPPERS_KERNEL_IMPL_H
! #define TOPPERS_KERNEL_IMPL_H
! 
! /*
!  *  カーネルの内部識別名のリネーム
!  */
! #include "kernel_rename.h"
! 
! /*
!  *  アプリケーションと共通のヘッダファイル
!  */
! #include <kernel.h>
! 
! /*
!  *  システムログ機能のための定義
!  */
! #include <t_syslog.h>
! 
! /*
!  *  型キャストを行うマクロの定義
!  */
! #ifndef CAST
! #define CAST(type, val)		((type)(val))
! #endif /* CAST */
! 
! /*
!  *  ターゲット依存情報の定義
!  */
! #include "target_config.h"
! 
! /*
!  *  すべての関数をコンパイルするための定義
!  */
! #ifdef ALLFUNC
! #include "allfunc.h"
! #endif /* ALLFUNC */
! 
! /*
!  *  ビットフィールドでの符号無し整数型
!  *
!  *  8ビット以下の幅のビットフィールドで，符号無し整数値を保持したい場合
!  *  に用いるべきデータ型．ANSI Cでは，ビットフィールドのデータ型には
!  *  intとunsigned intしか許されないため，デフォルトの定義はunsigned
!  *  intとしているが，ターゲットおよびツール依存で，unsigned charまたは
!  *  unsigned shortに定義した方が効率が良い場合がある．
!  */
! #ifndef BIT_FIELD_UINT
! #define BIT_FIELD_UINT		unsigned int
! #endif /* BIT_FIELD_UINT */
! 
! /*
!  *  ビットフィールドでのブール型
!  *
!  *  1ビット幅のビットフィールドで，ブール値を保持したい場合に用いるべき
!  *  データ型．デフォルトではBIT_FIELD_UINTと同一に定義しているが，ブー
!  *  ル値を保持することを明示するために別の名称としている．
!  */
! #ifndef BIT_FIELD_BOOL
! #define BIT_FIELD_BOOL		BIT_FIELD_UINT
! #endif /* BIT_FIELD_BOOL */
! 
! /*
!  *  オブジェクトIDの最小値の定義
!  */
! #define TMIN_TSKID		1		/* タスクIDの最小値 */
! #define TMIN_SEMID		1		/* セマフォIDの最小値 */
! #define TMIN_FLGID		1		/* フラグIDの最小値 */
! #define TMIN_DTQID		1		/* データキューIDの最小値 */
! #define TMIN_PDQID		1		/* 優先度データキューIDの最小値 */
! #define TMIN_MBXID		1		/* メールボックスIDの最小値 */
! #define TMIN_MPFID		1		/* 固定長メモリプールIDの最小値 */
! #define TMIN_CYCID		1		/* 周期ハンドラIDの最小値 */
! #define TMIN_ALMID		1		/* アラームハンドラIDの最小値 */
! 
! /*
!  *  優先度の段階数の定義
!  */
! #define TNUM_TPRI		(TMAX_TPRI - TMIN_TPRI + 1)
! #define TNUM_MPRI		(TMAX_MPRI - TMIN_MPRI + 1)
! #define TNUM_INTPRI		(TMAX_INTPRI - TMIN_INTPRI + 1)
! 
! /*
!  *  ヘッダファイルを持たないモジュールの関数・変数の宣言
!  */
! #ifndef TOPPERS_MACRO_ONLY
! 
! /*
!  *  各モジュールの初期化（kernel_cfg.c）
!  */
! extern void	initialize_object(void);
! 
! /*
!  *  初期化ルーチンの実行（kernel_cfg.c）
!  */
! extern void	call_inirtn(void);
! 
! /*
!  *  終了処理ルーチンの実行（kernel_cfg.c）
!  */
! extern void	call_terrtn(void);
! 
! /*
!  *  非タスクコンテキスト用のスタック領域（kernel_cfg.c）
!  */
! extern const SIZE	istksz;		/* スタック領域のサイズ（丸めた値） */
! extern STK_T *const	istk;		/* スタック領域の先頭番地 */
! #ifdef TOPPERS_ISTKPT
! extern STK_T *const	istkpt;		/* スタックポインタの初期値 */
! #endif /* TOPPERS_ISTKPT */
! 
! /*
!  *  カーネル動作状態フラグ（startup.c）
!  */
! extern bool_t	kerflg;
! 
! /*
!  *  カーネルの起動（startup.c）
!  */
! extern void	sta_ker(void);
! 
! /*
!  *  カーネルの終了処理（startup.c）
!  */
! extern void	exit_kernel(void);
! 
! #endif /* TOPPERS_MACRO_ONLY */
! #endif /* TOPPERS_KERNEL_IMPL_H */
--- 1,181 ----
! /*
!  *  TOPPERS/ASP Kernel
!  *      Toyohashi Open Platform for Embedded Real-Time Systems/
!  *      Advanced Standard Profile Kernel
!  * 
!  *  Copyright (C) 2000-2003 by Embedded and Real-Time Systems Laboratory
!  *                              Toyohashi Univ. of Technology, JAPAN
!  *  Copyright (C) 2004-2010 by Embedded and Real-Time Systems Laboratory
!  *              Graduate School of Information Science, Nagoya Univ., JAPAN
!  * 
!  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
!  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
!  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
!  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
!  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
!  *      スコード中に含まれていること．
!  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
!  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
!  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
!  *      の無保証規定を掲載すること．
!  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
!  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
!  *      と．
!  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
!  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
!  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
!  *        報告すること．
!  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
!  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
!  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
!  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
!  *      免責すること．
!  * 
!  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
!  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
!  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
!  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
!  *  の責任を負わない．
!  * 
!  *  @(#) $Id: kernel_impl.h 1713 2010-01-27 13:23:29Z ertl-hiro $
!  */
! 
! /*
!  *		TOPPERS/ASPカーネル内部向け標準ヘッダファイル
!  *
!  *  このヘッダファイルは，カーネルを構成するプログラムのソースファイル
!  *  で必ずインクルードするべき標準ヘッダファイルである．
!  *
!  *  アセンブリ言語のソースファイルからこのファイルをインクルードする時
!  *  は，TOPPERS_MACRO_ONLYを定義しておく．これにより，マクロ定義以外を
!  *  除くようになっている．
!  */
! 
! #ifndef TOPPERS_KERNEL_IMPL_H
! #define TOPPERS_KERNEL_IMPL_H
! 
! /*
!  *  カーネルの内部識別名のリネーム
!  */
! #include "kernel_rename.h"
! 
! /*
!  *  アプリケーションと共通のヘッダファイル
!  */
! #include <kernel.h>
! 
! /*
!  *  システムログ機能のための定義
!  */
! #include <t_syslog.h>
! 
! /*
!  *  型キャストを行うマクロの定義
!  */
! #ifndef CAST
! #define CAST(type, val)		((type)(val))
! #endif /* CAST */
! 
! /*
!  *  ターゲット依存情報の定義
!  */
! #include "target_config.h"
! 
! /*
!  *  すべての関数をコンパイルするための定義
!  */
! #ifdef ALLFUNC
! #include "allfunc.h"
! #endif /* ALLFUNC */
! 
! /*
!  *  ビットフィールドでの符号無し整数型
!  *
!  *  8ビット以下の幅のビットフィールドで，符号無し整数値を保持したい場合
!  *  に用いるべきデータ型．ANSI Cでは，ビットフィールドのデータ型には
!  *  intとunsigned intしか許されないため，デフォルトの定義はunsigned
!  *  intとしているが，ターゲットおよびツール依存で，unsigned charまたは
!  *  unsigned shortに定義した方が効率が良い場合がある．
!  */
! #ifndef BIT_FIELD_UINT
! #define BIT_FIELD_UINT		unsigned int
! #endif /* BIT_FIELD_UINT */
! 
! /*
!  *  ビットフィールドでのブール型
!  *
!  *  1ビット幅のビットフィールドで，ブール値を保持したい場合に用いるべき
!  *  データ型．デフォルトではBIT_FIELD_UINTと同一に定義しているが，ブー
!  *  ル値を保持することを明示するために別の名称としている．
!  */
! #ifndef BIT_FIELD_BOOL
! #define BIT_FIELD_BOOL		BIT_FIELD_UINT
! #endif /* BIT_FIELD_BOOL */
! 
! /*
!  *  オブジェクトIDの最小値の定義
!  */
! #define TMIN_TSKID		1		/* タスクIDの最小値 */
! #define TMIN_SEMID		1		/* セマフォIDの最小値 */
! #define TMIN_FLGID		1		/* フラグIDの最小値 */
! #define TMIN_DTQID		1		/* データキューIDの最小値 */
! #define TMIN_PDQID		1		/* 優先度データキューIDの最小値 */
! #define TMIN_MBXID		1		/* メールボックスIDの最小値 */
! #define TMIN_MPFID		1		/* 固定長メモリプールIDの最小値 */
! #define TMIN_CYCID		1		/* 周期ハンドラIDの最小値 */
! #define TMIN_ALMID		1		/* アラームハンドラIDの最小値 */
! 
! #define EXTERNAL_INIT
! /*
!  *  優先度の段階数の定義
!  */
! #define TNUM_TPRI		(TMAX_TPRI - TMIN_TPRI + 1)
! #define TNUM_MPRI		(TMAX_MPRI - TMIN_MPRI + 1)
! #define TNUM_INTPRI		(TMAX_INTPRI - TMIN_INTPRI + 1)
! 
! /*
!  *  ヘッダファイルを持たないモジュールの関数・変数の宣言
!  */
! #ifndef TOPPERS_MACRO_ONLY
! 
! /*
!  *  各モジュールの初期化（kernel_cfg.c）
!  */
! extern void	initialize_object(void);
! 
! /*
!  *  初期化ルーチンの実行（kernel_cfg.c）
!  */
! extern void	call_inirtn(void);
! 
! /*
!  *  終了処理ルーチンの実行（kernel_cfg.c）
!  */
! extern void	call_terrtn(void);
! 
! /*
!  *  非タスクコンテキスト用のスタック領域（kernel_cfg.c）
!  */
! extern const SIZE	istksz;		/* スタック領域のサイズ（丸めた値） */
! extern STK_T *const	istk;		/* スタック領域の先頭番地 */
! #ifdef TOPPERS_ISTKPT
! extern STK_T *const	istkpt;		/* スタックポインタの初期値 */
! #endif /* TOPPERS_ISTKPT */
! 
! /*
!  *  カーネル動作状態フラグ（startup.c）
!  */
! extern bool_t	kerflg;
! 
! /*
!  *  カーネルの起動（startup.c）
!  */
! extern void	sta_ker(void);
! 
! /*
!  *  カーネルの終了処理（startup.c）
!  */
! extern void	exit_kernel(void);
! 
! #endif /* TOPPERS_MACRO_ONLY */
! #endif /* TOPPERS_KERNEL_IMPL_H */
diff -cr --new-file asp/kernel/startup.c 1.9.1_update/kernel/startup.c
*** asp/kernel/startup.c	Thu May  5 09:46:29 2011
--- 1.9.1_update/kernel/startup.c	Thu Dec 15 13:53:35 2022
***************
*** 1,172 ****
! /*
!  *  TOPPERS/ASP Kernel
!  *      Toyohashi Open Platform for Embedded Real-Time Systems/
!  *      Advanced Standard Profile Kernel
!  * 
!  *  Copyright (C) 2000-2003 by Embedded and Real-Time Systems Laboratory
!  *                              Toyohashi Univ. of Technology, JAPAN
!  *  Copyright (C) 2005-2009 by Embedded and Real-Time Systems Laboratory
!  *              Graduate School of Information Science, Nagoya Univ., JAPAN
!  * 
!  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
!  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
!  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
!  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
!  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
!  *      スコード中に含まれていること．
!  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
!  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
!  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
!  *      の無保証規定を掲載すること．
!  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
!  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
!  *      と．
!  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
!  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
!  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
!  *        報告すること．
!  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
!  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
!  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
!  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
!  *      免責すること．
!  * 
!  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
!  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
!  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
!  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
!  *  の責任を負わない．
!  * 
!  *  @(#) $Id: startup.c 2067 2011-05-05 00:46:29Z ertl-hiro $
!  */
! 
! /*
!  *		カーネルの初期化と終了処理
!  */
! 
! #include "kernel_impl.h"
! #include "time_event.h"
! #include <sil.h>
! 
! /*
!  *  トレースログマクロのデフォルト定義
!  */
! #ifndef LOG_KER_ENTER
! #define LOG_KER_ENTER()
! #endif /* LOG_KER_ENTER */
! 
! #ifndef LOG_KER_LEAVE
! #define LOG_KER_LEAVE()
! #endif /* LOG_KER_LEAVE */
! 
! #ifndef LOG_EXT_KER_ENTER
! #define LOG_EXT_KER_ENTER()
! #endif /* LOG_EXT_KER_ENTER */
! 
! #ifndef LOG_EXT_KER_LEAVE
! #define LOG_EXT_KER_LEAVE(ercd)
! #endif /* LOG_EXT_KER_LEAVE */
! 
! #ifdef TOPPERS_sta_ker
! 
! /*
!  *  カーネル動作状態フラグ
!  *
!  *  スタートアップルーチンで，false（＝0）に初期化されることを期待して
!  *  いる．
!  */
! bool_t	kerflg = false;
! 
! /*
!  *  カーネルの起動
!  */
! void
! sta_ker(void)
! {
! 	/*
! 	 *  ターゲット依存の初期化
! 	 */
! 	target_initialize();
! 
! 	/*
! 	 *  各モジュールの初期化
! 	 *
! 	 *  タイムイベント管理モジュールは他のモジュールより先に初期化
! 	 *  する必要がある．
! 	 */
! 	initialize_tmevt();
! 	initialize_object();
! 
! 	/*
! 	 *  初期化ルーチンの実行
! 	 */ 
! 	call_inirtn();
! 
! 	/*
! 	 *  カーネル動作の開始
! 	 */
! 	kerflg = true;
! 	LOG_KER_ENTER();
! 	start_dispatch();
! 	assert(0);
! }
! 
! #endif /* TOPPERS_sta_ker */
! 
! /*
!  *  カーネルの終了
!  */
! #ifdef TOPPERS_ext_ker
! 
! ER
! ext_ker(void)
! {
! 	SIL_PRE_LOC;
! 
! 	LOG_EXT_KER_ENTER();
! 
! 	/*
! 	 *  割込みロック状態に移行
! 	 */
! 	SIL_LOC_INT();
! 
! 	/*
! 	 *  カーネル動作の終了
! 	 */
! 	LOG_KER_LEAVE();
! 	kerflg = false;
! 
! 	/*
! 	 *  カーネルの終了処理の呼出し
! 	 *
! 	 *  非タスクコンテキストに切り換えて，exit_kernelを呼び出す．
! 	 */
! 	call_exit_kernel();
! 
! 	/*
! 	 *  コンパイラの警告対策（ここへ来ることはないはず）
! 	 */
! 	SIL_UNL_INT();
! 	LOG_EXT_KER_LEAVE(E_SYS);
! 	return(E_SYS);
! }
! 
! /*
!  *  カーネルの終了処理
!  */
! void
! exit_kernel(void)
! {
! 	/*
! 	 *  終了処理ルーチンの実行
! 	 */
! 	call_terrtn();
! 
! 	/*
! 	 *  ターゲット依存の終了処理
! 	 */
! 	target_exit();
! 	assert(0);
! }
! 
! #endif /* TOPPERS_ext_ker */
--- 1,173 ----
! /*
!  *  TOPPERS/ASP Kernel
!  *      Toyohashi Open Platform for Embedded Real-Time Systems/
!  *      Advanced Standard Profile Kernel
!  * 
!  *  Copyright (C) 2000-2003 by Embedded and Real-Time Systems Laboratory
!  *                              Toyohashi Univ. of Technology, JAPAN
!  *  Copyright (C) 2005-2009 by Embedded and Real-Time Systems Laboratory
!  *              Graduate School of Information Science, Nagoya Univ., JAPAN
!  * 
!  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
!  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
!  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
!  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
!  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
!  *      スコード中に含まれていること．
!  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
!  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
!  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
!  *      の無保証規定を掲載すること．
!  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
!  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
!  *      と．
!  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
!  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
!  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
!  *        報告すること．
!  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
!  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
!  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
!  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
!  *      免責すること．
!  * 
!  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
!  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
!  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
!  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
!  *  の責任を負わない．
!  * 
!  *  @(#) $Id: startup.c 2067 2011-05-05 00:46:29Z ertl-hiro $
!  */
! 
! /*
!  *		カーネルの初期化と終了処理
!  */
! 
! #include "kernel_impl.h"
! #include "time_event.h"
! #include <sil.h>
! 
! /*
!  *  トレースログマクロのデフォルト定義
!  */
! #ifndef LOG_KER_ENTER
! #define LOG_KER_ENTER()
! #endif /* LOG_KER_ENTER */
! 
! #ifndef LOG_KER_LEAVE
! #define LOG_KER_LEAVE()
! #endif /* LOG_KER_LEAVE */
! 
! #ifndef LOG_EXT_KER_ENTER
! #define LOG_EXT_KER_ENTER()
! #endif /* LOG_EXT_KER_ENTER */
! 
! #ifndef LOG_EXT_KER_LEAVE
! #define LOG_EXT_KER_LEAVE(ercd)
! #endif /* LOG_EXT_KER_LEAVE */
! 
! #ifdef TOPPERS_sta_ker
! 
! /*
!  *  カーネル動作状態フラグ
!  *
!  *  スタートアップルーチンで，false（＝0）に初期化されることを期待して
!  *  いる．
!  */
! bool_t	kerflg = false;
! 
! /*
!  *  カーネルの起動
!  */
! void
! sta_ker(void)
! {
! 	/*
! 	 *  ターゲット依存の初期化
! 	 */
! #ifndef EXTERNAL_INIT
! 	target_initialize();
! #endif
! 	/*
! 	 *  各モジュールの初期化
! 	 *
! 	 *  タイムイベント管理モジュールは他のモジュールより先に初期化
! 	 *  する必要がある．
! 	 */
! 	initialize_tmevt();
! 	initialize_object();
! 
! 	/*
! 	 *  初期化ルーチンの実行
! 	 */ 
! 	call_inirtn();
! 
! 	/*
! 	 *  カーネル動作の開始
! 	 */
! 	kerflg = true;
! 	LOG_KER_ENTER();
! 	start_dispatch();
! 	assert(0);
! }
! 
! #endif /* TOPPERS_sta_ker */
! 
! /*
!  *  カーネルの終了
!  */
! #ifdef TOPPERS_ext_ker
! 
! ER
! ext_ker(void)
! {
! 	SIL_PRE_LOC;
! 
! 	LOG_EXT_KER_ENTER();
! 
! 	/*
! 	 *  割込みロック状態に移行
! 	 */
! 	SIL_LOC_INT();
! 
! 	/*
! 	 *  カーネル動作の終了
! 	 */
! 	LOG_KER_LEAVE();
! 	kerflg = false;
! 
! 	/*
! 	 *  カーネルの終了処理の呼出し
! 	 *
! 	 *  非タスクコンテキストに切り換えて，exit_kernelを呼び出す．
! 	 */
! 	call_exit_kernel();
! 
! 	/*
! 	 *  コンパイラの警告対策（ここへ来ることはないはず）
! 	 */
! 	SIL_UNL_INT();
! 	LOG_EXT_KER_LEAVE(E_SYS);
! 	return(E_SYS);
! }
! 
! /*
!  *  カーネルの終了処理
!  */
! void
! exit_kernel(void)
! {
! 	/*
! 	 *  終了処理ルーチンの実行
! 	 */
! 	call_terrtn();
! 
! 	/*
! 	 *  ターゲット依存の終了処理
! 	 */
! 	target_exit();
! 	assert(0);
! }
! 
! #endif /* TOPPERS_ext_ker */
diff -cr --new-file asp/kernel/task.h 1.9.1_update/kernel/task.h
*** asp/kernel/task.h	Mon Jul  4 08:40:20 2011
--- 1.9.1_update/kernel/task.h	Thu Dec 15 13:53:35 2022
***************
*** 1,480 ****
! /*
!  *  TOPPERS/ASP Kernel
!  *      Toyohashi Open Platform for Embedded Real-Time Systems/
!  *      Advanced Standard Profile Kernel
!  * 
!  *  Copyright (C) 2000-2003 by Embedded and Real-Time Systems Laboratory
!  *                              Toyohashi Univ. of Technology, JAPAN
!  *  Copyright (C) 2005-2010 by Embedded and Real-Time Systems Laboratory
!  *              Graduate School of Information Science, Nagoya Univ., JAPAN
!  * 
!  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
!  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
!  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
!  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
!  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
!  *      スコード中に含まれていること．
!  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
!  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
!  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
!  *      の無保証規定を掲載すること．
!  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
!  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
!  *      と．
!  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
!  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
!  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
!  *        報告すること．
!  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
!  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
!  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
!  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
!  *      免責すること．
!  * 
!  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
!  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
!  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
!  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
!  *  の責任を負わない．
!  * 
!  *  $Id: task.h 2146 2011-07-03 23:40:01Z ertl-hiro $
!  */
! 
! /*
!  *		タスク管理モジュール
!  */
! 
! #ifndef TOPPERS_TASK_H
! #define TOPPERS_TASK_H
! 
! #include <queue.h>
! #include "time_event.h"
! 
! /*
!  *  トレースログマクロのデフォルト定義
!  */
! #ifndef LOG_TSKSTAT
! #define LOG_TSKSTAT(p_tcb)
! #endif /* LOG_TSKSTAT */
! 
! /*
!  *  タスク優先度の内部表現・外部表現変換マクロ
!  */
! #define INT_PRIORITY(x)		((uint_t)((x) - TMIN_TPRI))
! #define EXT_TSKPRI(x)		((PRI)(x) + TMIN_TPRI)
! 
! /*
!  *  タスク状態の内部表現
!  *
!  *  TCB中のタスク状態では，実行状態（RUNNING）と実行可能状態（READY）
!  *  は区別しない．両状態を総称して，実行できる状態（RUNNABLE）と呼ぶ．
!  *  二重待ち状態は，(TS_WAITING | TS_SUSPENDED)で表す．TS_WAIT_???は待
!  *  ち要因を表し，待ち状態（二重待ち状態を含む）の場合にのみ設定する．
!  */
! #define TS_DORMANT		0x00U			/* 休止状態 */
! #define TS_RUNNABLE		0x01U			/* 実行できる状態 */
! #define TS_WAITING		0x02U			/* 待ち状態 */
! #define TS_SUSPENDED	0x04U			/* 強制待ち状態 */
! 
! #define TS_WAIT_DLY		(0x00U << 3)	/* 時間経過待ち */
! #define TS_WAIT_SLP		(0x01U << 3)	/* 起床待ち */
! #define TS_WAIT_RDTQ	(0x02U << 3)	/* データキューからの受信待ち */
! #define TS_WAIT_RPDQ	(0x03U << 3)	/* 優先度データキューからの受信待ち */
! #define TS_WAIT_SEM		(0x04U << 3)	/* セマフォ資源の獲得待ち */
! #define TS_WAIT_FLG		(0x05U << 3)	/* イベントフラグ待ち */
! #define TS_WAIT_SDTQ	(0x06U << 3)	/* データキューへの送信待ち */
! #define TS_WAIT_SPDQ	(0x07U << 3)	/* 優先度データキューへの送信待ち */
! #define TS_WAIT_MBX		(0x08U << 3)	/* メールボックスからの受信待ち */
! #define TS_WAIT_MPF		(0x09U << 3)	/* 固定長メモリブロックの獲得待ち */
! 
! /*
!  *  タスク状態判別マクロ
!  *
!  *  TSTAT_DORMANTはタスクが休止状態であるかどうかを，TSTAT_RUNNABLEは
!  *  タスクが実行できる状態であるかどうかを判別する．TSTAT_WAITINGは待
!  *  ち状態と二重待ち状態のいずれかであるかどうかを，TSTAT_SUSPENDEDは
!  *  強制待ち状態と二重待ち状態のいずれかであるかどうかを判別する．
!  */
! #define TSTAT_DORMANT(tstat)	((tstat) == TS_DORMANT)
! #define TSTAT_RUNNABLE(tstat)	(((tstat) & TS_RUNNABLE) != 0U)
! #define TSTAT_WAITING(tstat)	(((tstat) & TS_WAITING) != 0U)
! #define TSTAT_SUSPENDED(tstat)	(((tstat) & TS_SUSPENDED) != 0U)
! 
! /*
!  *  タスク待ち要因判別マクロ
!  *
!  *  TSTAT_WAIT_SLPはタスクが起床待ちであるかどうかを，TSTAT_WAIT_WOBJ
!  *  はタスクが同期・通信オブジェクトに対する待ちであるか（言い換えると，
!  *  同期通信オブジェクトの待ちキューにつながれているか）どうかを判別す
!  *  る．また，TSTAT_WAIT_WOBJCBはタスクが同期・通信オブジェクトの管理
!  *  ブロックの共通部分（WOBJCB）の待ちキューにつながれているかどうかを
!  *  判別する．
!  *
!  *  TSTAT_WAIT_SLPは，任意のタスク状態の中から，タスクが起床待ちである
!  *  ことを判別できる．すなわち，TSTAT_WAITINGにより待ち状態であることを
!  *  判別せずに，TSTAT_SLPだけを用いて起床待ち状態であることを判別できる．
!  *  これを効率的に実現するために，TS_WAIT_SLPの値を，(0x00U << 3)ではな
!  *  く(0x01U << 3)としている．そのため，タスクが時間経過待ち状態である
!  *  ことを判別するためのTSTAT_WAIT_DLYを，TSTAT_WAIT_SLPと同様の方法で
!  *  実現することはできない．
!  */
! #define TS_WAIT_MASK	(0x0fU << 3)	/* 待ち要因の取出しマスク */
! 
! #define TSTAT_WAIT_SLP(tstat)		(((tstat) & TS_WAIT_MASK) == TS_WAIT_SLP)
! #define TSTAT_WAIT_WOBJ(tstat)		(((tstat) & TS_WAIT_MASK) >= TS_WAIT_RDTQ)
! #define TSTAT_WAIT_WOBJCB(tstat)	(((tstat) & TS_WAIT_MASK) >= TS_WAIT_SEM)
! 
! /*
!  *  待ち情報ブロック（WINFO）の定義
!  *
!  *  タスクが待ち状態の間は，TCBおよびそのp_winfoで指されるWINFOを次の
!  *  ように設定しなければならない．
!  *
!  *  (a) TCBのタスク状態を待ち状態（TS_WAITING）にする．その際に，待ち
!  *  要因（TS_WAIT_???）も設定する．
!  *
!  *  (b) タイムアウトを監視するために，タイムイベントブロックを登録する．
!  *  登録するタイムイベントブロックは，待ちに入るサービスコール処理関数
!  *  のローカル変数として確保し，それへのポインタをWINFOのp_tmevtbに記
!  *  憶する．タイムアウトの監視が必要ない場合（永久待ちの場合）には，
!  *  p_tmevtbをNULLにする．
!  *
!  *  同期・通信オブジェクトに対する待ち状態の場合には，標準のWINFOに
!  *  p_wobjcbフィールドを追加した構造体（WINFO_WOBJ，wait.hで定義）を使
!  *  う．また，以下の(c)〜(e)の設定を行う必要がある．同期・通信オブジェ
!  *  クトに関係しない待ち（起床待ち，時間経過待ち）の場合には，(c)〜(e)
!  *  は必要ない．
!  *
!  *  (c) TCBを待ち対象の同期・通信オブジェクトの待ちキューにつなぐ．待
!  *  ちキューにつなぐために，task_queueを使う．
!  *
!  *  (d) 待ち対象の同期・通信オブジェクトの管理ブロックへのポインタを，
!  *  WINFO_WOBJのp_wobjcbに記憶する．
!  *
!  *  (e) 待ち対象の同期・通信オブジェクトに依存して記憶することが必要な
!  *  情報がある場合には，WINFO_WOBJに必要な情報のためのフィールドを追加
!  *  した構造体を定義し，WINFO_WOBJの代わりに用いる．
!  *
!  *  待ち状態を解除する際には，待ち解除したタスクに対する返値をWINFOの
!  *  wercdに設定する．wercdが必要なのは待ち解除以降であるのに対して，
!  *  p_tmevtbは待ち解除後は必要ないため，メモリ節約のために共用体を使っ
!  *  ている．そのため，wercdへエラーコードを設定するのは，タイムイベント
!  *  ブロックを登録解除した後にしなければならない．
!  */
! typedef union waiting_information {
! 	ER		wercd;			/* 待ち解除時のエラーコード */
! 	TMEVTB	*p_tmevtb;		/* 待ち状態用のタイムイベントブロック */
! } WINFO;
! 
! /*
!  *  タスク初期化ブロック
!  *
!  *  タスクに関する情報を，値が変わらないためにROMに置ける部分（タスク
!  *  初期化ブロック）と，値が変化するためにRAMに置かなければならない部
!  *  分（タスク管理ブロック，TCB）に分離し，TCB内に対応するタスク初期化
!  *  ブロックを指すポインタを入れる．タスク初期化ブロック内に対応する
!  *  TCBを指すポインタを入れる方法の方が，RAMの節約の観点からは望ましい
!  *  が，実行効率が悪くなるために採用していない．他のオブジェクトについ
!  *  ても同様に扱う．
!  *
!  *  タスク初期化ブロックには，DEF_TEXで定義されるタスク例外処理ルーチ
!  *  ンに関する情報も含む．
!  */
! typedef struct task_initialization_block {
! 	ATR			tskatr;			/* タスク属性 */
! 	intptr_t	exinf;			/* タスクの拡張情報 */
! 	TASK		task;			/* タスクの起動番地 */
! 	uint_t		ipriority;		/* タスクの起動時優先度（内部表現） */
! 
! #ifdef USE_TSKINICTXB
! 	TSKINICTXB	tskinictxb;		/* タスク初期化コンテキストブロック */
! #else /* USE_TSKINICTXB */
! 	SIZE		stksz;			/* スタック領域のサイズ（丸めた値） */
! 	void		*stk;			/* スタック領域の先頭番地 */
! #endif /* USE_TSKINICTXB */
! 
! 	ATR			texatr;			/* タスク例外処理ルーチン属性 */
! 	TEXRTN		texrtn;			/* タスク例外処理ルーチンの起動番地 */
! } TINIB;
! 
! /*
!  *  TCB中のフィールドのビット幅の定義
!  *
!  *  プロセッサによっては，TCB中のフィールドのビット幅でメモリ使用量と
!  *  性能がトレードオフになるため，ターゲット依存にフィールドのビット幅
!  *  を変更することを許している．
!  */
! #ifndef TBIT_TCB_PRIORITY
! #define	TBIT_TCB_PRIORITY		8		/* priorityフィールドのビット幅 */
! #endif /* TBIT_TCB_PRIORITY */
! 
! /*
!  *  タスク管理ブロック（TCB）
!  *
!  *  ASPカーネルでは，タスクの起動要求キューイング数の最大値（TMAX_ACTCNT）
!  *  と起床要求キューイング数の最大値（TMAX_WUPCNT）は1に固定されている
!  *  ため，キューイングされているかどうかの真偽値で表現することができる．
!  *  また，強制待ち要求ネスト数の最大値（TMAX_SUSCNT）が1に固定されてい
!  *  るので，強制待ち要求ネスト数（suscnt）は必要ない．
!  *
!  *  TCBのいくつかのフィールドは，特定のタスク状態でのみ有効な値を保持し，
!  *  それ以外の場合は値が保証されない（よって，参照してはならない）．各
!  *  フィールドが有効な値を保持する条件は次の通り．
!  *
!  *  ・初期化後は常に有効：
!  *  		p_tinib，tstat，actque
!  *  ・休止状態以外で有効（休止状態では初期値になっている）：
!  *  		priority，wupque，enatex，texptn
!  *  ・待ち状態（二重待ち状態を含む）で有効：
!  *  		p_winfo
!  *  ・実行できる状態と同期・通信オブジェクトに対する待ち状態で有効：
!  *  		task_queue
!  *  ・実行可能状態，待ち状態，強制待ち状態，二重待ち状態で有効：
!  *  		tskctxb
!  */
! typedef struct task_control_block {
! 	QUEUE			task_queue;		/* タスクキュー */
! 	const TINIB		*p_tinib;		/* 初期化ブロックへのポインタ */
! 
! #ifdef UINT8_MAX
! 	uint8_t			tstat;			/* タスク状態（内部表現）*/
! #else /* UINT8_MAX */
! 	BIT_FIELD_UINT	tstat : 8;		/* タスク状態（内部表現）*/
! #endif /* UINT8_MAX */
! #if defined(UINT8_MAX) && (TBIT_TCB_PRIORITY == 8)
! 	uint8_t			priority;		/* 現在の優先度（内部表現）*/
! #else /* defined(UINT8_MAX) && (TBIT_TCB_PRIORITY == 8) */
! 	BIT_FIELD_UINT	priority : TBIT_TCB_PRIORITY;
! 									/* 現在の優先度（内部表現）*/
! #endif /* defined(UINT8_MAX) && (TBIT_TCB_PRIORITY == 8) */
! 	BIT_FIELD_BOOL	actque : 1;		/* 起動要求キューイング */
! 	BIT_FIELD_BOOL	wupque : 1;		/* 起床要求キューイング */
! 	BIT_FIELD_BOOL	enatex : 1;		/* タスク例外処理許可状態 */
! 
! 	TEXPTN			texptn;			/* 保留例外要因 */
! 	WINFO			*p_winfo;		/* 待ち情報ブロックへのポインタ */
! 	TSKCTXB			tskctxb;		/* タスクコンテキストブロック */
! } TCB;
! 
! /*
!  *  実行状態のタスク
!  *
!  *  実行状態のタスク（＝プロセッサがコンテキストを持っているタスク）の
!  *  TCBを指すポインタ．実行状態のタスクがない場合はNULLにする．
!  *
!  *  サービスコールの処理中で，自タスク（サービスコールを呼び出したタス
!  *  ク）に関する情報を参照する場合はp_runtskを使う．p_runtskを書き換え
!  *  るのは，ディスパッチャ（と初期化処理）のみである．
!  */
! extern TCB	*p_runtsk;
! 
! /*
!  *  最高優先順位のタスク
!  *
!  *  実行できるタスクの中で最高優先順位のタスクのTCBを指すポインタ．実
!  *  行できるタスクがない場合はNULLにする．
!  *
!  *  ディスパッチ禁止状態など，ディスパッチが保留されている間はp_runtsk
!  *  と一致しているとは限らない．
!  */
! extern TCB	*p_schedtsk;
! 
! /*
!  *  ディスパッチ／タスク例外処理ルーチン起動要求フラグ
!  *
!  *  割込みハンドラ／CPU例外ハンドラの出口処理に，ディスパッチまたは
!  *  タスク例外処理ルーチンの起動を要求することを示すフラグ．
!  */
! extern bool_t	reqflg;
! 
! /*
!  *  割込み優先度マスク全解除状態
!  *
!  *  割込み優先度マスク全解除状態であることを示すフラグ．
!  */
! extern bool_t	ipmflg;
! 
! /*
!  *  ディスパッチ禁止状態
!  *
!  *  ディスパッチ禁止状態であることを示すフラグ．
!  */
! extern bool_t	disdsp;
! 
! /*
!  *  タスクディスパッチ可能状態
!  *
!  *  割込み優先度マスク全解除状態であり，ディスパッチ許可状態である（ディ
!  *  スパッチ禁止状態でない）ことを示すフラグ．
!  */
! extern bool_t	dspflg;
! 
! /*
!  *  レディキュー
!  *
!  *  レディキューは，実行できる状態のタスクを管理するためのキューである．
!  *  実行状態のタスクも管理しているため，レディ（実行可能）キューという
!  *  名称は正確ではないが，レディキューという名称が定着しているため，こ
!  *  の名称で呼ぶことにする．
!  *
!  *  レディキューは，優先度ごとのタスクキューで構成されている．タスクの
!  *  TCBは，該当する優先度のキューに登録される．
!  */
! extern QUEUE	ready_queue[TNUM_TPRI];
! 
! /*
!  *  レディキューサーチのためのビットマップ
!  *
!  *  レディキューのサーチを効率よく行うために，優先度ごとのタスクキュー
!  *  にタスクが入っているかどうかを示すビットマップを用意している．ビッ
!  *  トマップを使うことで，メモリアクセスの回数を減らすことができるが，
!  *  ビット操作命令が充実していないプロセッサで，優先度の段階数が少ない
!  *  場合には，ビットマップ操作のオーバーヘッドのために，逆に効率が落ち
!  *  る可能性もある．
!  *
!  *  優先度が16段階であることを仮定しているため，uint16_t型としている．
!  */
! extern uint16_t	ready_primap;
! 
! /*
!  *  タスクIDの最大値（kernel_cfg.c）
!  */
! extern const ID	tmax_tskid;
! 
! /*
!  *  タスク初期化ブロックのエリア（kernel_cfg.c）
!  */
! extern const TINIB	tinib_table[];
! 
! /*
!  *  タスク生成順序テーブル（kernel_cfg.c）
!  */
! extern const ID	torder_table[];
! 
! /*
!  *  TCBのエリア（kernel_cfg.c）
!  */
! extern TCB	tcb_table[];
! 
! /*
!  *  タスクの数
!  */
! #define tnum_tsk	((uint_t)(tmax_tskid - TMIN_TSKID + 1))
! 
! /*
!  *  タスクIDからTCBを取り出すためのマクロ
!  */
! #define INDEX_TSK(tskid)	((uint_t)((tskid) - TMIN_TSKID))
! #define get_tcb(tskid)		(&(tcb_table[INDEX_TSK(tskid)]))
! #define get_tcb_self(tskid)	((tskid) == TSK_SELF ? p_runtsk : get_tcb(tskid))
! 
! /*
!  *  TCBからタスクIDを取り出すためのマクロ
!  */
! #define	TSKID(p_tcb)	((ID)(((p_tcb) - tcb_table) + TMIN_TSKID))
! 
! /*
!  *  タスク管理モジュールの初期化
!  */
! extern void	initialize_task(void);
! 
! /*
!  *  最高優先順位タスクのサーチ
!  *
!  *  レディキュー中の最高優先順位のタスクをサーチし，そのTCBへのポインタ
!  *  を返す．レディキューが空の場合には，この関数を呼び出してはならない．
!  */
! extern TCB	*search_schedtsk(void);
! 
! /*
!  *  実行できる状態への遷移
!  *
!  *  p_tcbで指定されるタスクをレディキューに挿入する．レディキューに挿入
!  *  したタスクの優先度が，最高優先順位のタスクの優先度よりも高い場合は，
!  *  最高優先順位のタスクを更新し，ディスパッチ許可状態であればtrueを返
!  *  す．そうでない場合はfalseを返す．
!  */
! extern bool_t	make_runnable(TCB *p_tcb);
! 
! /*
!  *  実行できる状態から他の状態への遷移
!  *
!  *  p_tcbで指定されるタスクをレディキューから削除する．p_tcbで指定した
!  *  タスクが最高優先順位のタスクであった場合には，最高優先順位のタスク
!  *  を設定しなおし，ディスパッチ許可状態であればtrueを返す．そうでない
!  *  場合はfalseを返す．タスクの状態は更新しない．
!  */
! extern bool_t	make_non_runnable(TCB *p_tcb);
! 
! /*
!  *  休止状態への遷移
!  *
!  *  p_tcbで指定されるタスクの状態を休止状態とする．また，タスクの起動
!  *  時に初期化すべき変数の初期化と，タスク起動のためのコンテキストを設
!  *  定する．
!  */
! extern void	make_dormant(TCB *p_tcb);
! 
! /*
!  *  休止状態から実行できる状態への遷移
!  *
!  *  p_tcbで指定されるタスクの状態を休止状態から実行できる状態とする．
!  *  実行できる状態に遷移したタスクへのディスパッチが必要な場合はtrue，
!  *  そうでない場合はfalseを返す．
!  */
! extern bool_t	make_active(TCB *p_tcb);
! 
! /*
!  *  タスクの優先度の変更
!  *
!  *  p_tcbで指定されるタスクの優先度をnewpri（内部表現）に変更する．また，
!  *  必要な場合には最高優先順位のタスクを更新し，ディスパッチ許可状態で
!  *  あればtrueを返す．そうでない場合はfalseを返す．
!  */
! extern bool_t	change_priority(TCB *p_tcb, uint_t newpri);
! 
! /*
!  *  レディキューの回転
!  *
!  *  レディキュー中の，priで指定される優先度のタスクキューを回転させる．
!  *  また，必要な場合には最高優先順位のタスクを変更し，ディスパッチが保
!  *  留されていなければtrueを返す．そうでない場合はfalseを返す．
!  */
! extern bool_t	rotate_ready_queue(uint_t pri);
! 
! /*
!  *  タスク例外処理ルーチンの呼出し
!  *
!  *  タスク例外処理ルーチンを呼び出す．呼び出す前に，実行状態のタスクの
!  *  保留例外要因をクリアし，タスク例外処理禁止状態にし，CPUロックを解
!  *  除する．
!  *
!  *  タスク例外処理ルーチンから戻ると，まずCPUロック状態に戻し，その間
!  *  に保留例外要因が0でなくなっていれば，再びタスク例外処理ルーチンを
!  *  呼び出す．保留例外要因が0の場合には，例外処理許可状態にして関数か
!  *  らリターンする．
!  *
!  *  この関数は，実行状態のタスクが，タスク例外処理許可状態（enatexが
!  *  true）で，保留例外要因が0でない（texptnが0でない）場合に呼び出すこ
!  *  とを想定している．この関数は，CPUロック状態で呼び出さなければなら
!  *  ない．
!  */
! extern void	call_texrtn(void);
! 
! /*
!  *  タスク例外処理ルーチンの起動
!  *
!  *  実行状態のタスクがタスク例外処理ルーチンの起動条件を満たしていれば，
!  *  タスク例外処理ルーチンを呼び出す．CPU例外処理ルーチンを呼び出す時
!  *  は，一時的にCPUロックを解除する．
!  *
!  *  この関数は，ディスパッチャや割込みハンドラ／CPU例外ハンドラの出口
!  *  処理から呼び出されることを想定している．この関数は，CPUロック状態
!  *  で呼び出さなければならない．
!  *
!  *  実行効率を上げるために，この関数をターゲット依存部で記述してもよい．
!  *  その場合には，OMIT_CALLTEXをマクロ定義する．
!  */
! extern void	calltex(void);
! 
! #endif /* TOPPERS_TASK_H */
--- 1,480 ----
! /*
!  *  TOPPERS/ASP Kernel
!  *      Toyohashi Open Platform for Embedded Real-Time Systems/
!  *      Advanced Standard Profile Kernel
!  * 
!  *  Copyright (C) 2000-2003 by Embedded and Real-Time Systems Laboratory
!  *                              Toyohashi Univ. of Technology, JAPAN
!  *  Copyright (C) 2005-2010 by Embedded and Real-Time Systems Laboratory
!  *              Graduate School of Information Science, Nagoya Univ., JAPAN
!  * 
!  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
!  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
!  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
!  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
!  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
!  *      スコード中に含まれていること．
!  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
!  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
!  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
!  *      の無保証規定を掲載すること．
!  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
!  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
!  *      と．
!  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
!  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
!  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
!  *        報告すること．
!  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
!  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
!  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
!  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
!  *      免責すること．
!  * 
!  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
!  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
!  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
!  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
!  *  の責任を負わない．
!  * 
!  *  $Id: task.h 2146 2011-07-03 23:40:01Z ertl-hiro $
!  */
! 
! /*
!  *		タスク管理モジュール
!  */
! 
! #ifndef TOPPERS_TASK_H
! #define TOPPERS_TASK_H
! 
! #include <queue.h>
! #include "time_event.h"
! 
! /*
!  *  トレースログマクロのデフォルト定義
!  */
! #ifndef LOG_TSKSTAT
! #define LOG_TSKSTAT(p_tcb)
! #endif /* LOG_TSKSTAT */
! 
! /*
!  *  タスク優先度の内部表現・外部表現変換マクロ
!  */
! #define INT_PRIORITY(x)		((uint_t)((x) - TMIN_TPRI))
! #define EXT_TSKPRI(x)		((PRI)(x) + TMIN_TPRI)
! 
! /*
!  *  タスク状態の内部表現
!  *
!  *  TCB中のタスク状態では，実行状態（RUNNING）と実行可能状態（READY）
!  *  は区別しない．両状態を総称して，実行できる状態（RUNNABLE）と呼ぶ．
!  *  二重待ち状態は，(TS_WAITING | TS_SUSPENDED)で表す．TS_WAIT_???は待
!  *  ち要因を表し，待ち状態（二重待ち状態を含む）の場合にのみ設定する．
!  */
! #define TS_DORMANT		0x00U			/* 休止状態 */
! #define TS_RUNNABLE		0x01U			/* 実行できる状態 */
! #define TS_WAITING		0x02U			/* 待ち状態 */
! #define TS_SUSPENDED	0x04U			/* 強制待ち状態 */
! 
! #define TS_WAIT_DLY		(0x00U << 3)	/* 時間経過待ち */
! #define TS_WAIT_SLP		(0x01U << 3)	/* 起床待ち */
! #define TS_WAIT_RDTQ	(0x02U << 3)	/* データキューからの受信待ち */
! #define TS_WAIT_RPDQ	(0x03U << 3)	/* 優先度データキューからの受信待ち */
! #define TS_WAIT_SEM		(0x04U << 3)	/* セマフォ資源の獲得待ち */
! #define TS_WAIT_FLG		(0x05U << 3)	/* イベントフラグ待ち */
! #define TS_WAIT_SDTQ	(0x06U << 3)	/* データキューへの送信待ち */
! #define TS_WAIT_SPDQ	(0x07U << 3)	/* 優先度データキューへの送信待ち */
! #define TS_WAIT_MBX		(0x08U << 3)	/* メールボックスからの受信待ち */
! #define TS_WAIT_MPF		(0x09U << 3)	/* 固定長メモリブロックの獲得待ち */
! 
! /*
!  *  タスク状態判別マクロ
!  *
!  *  TSTAT_DORMANTはタスクが休止状態であるかどうかを，TSTAT_RUNNABLEは
!  *  タスクが実行できる状態であるかどうかを判別する．TSTAT_WAITINGは待
!  *  ち状態と二重待ち状態のいずれかであるかどうかを，TSTAT_SUSPENDEDは
!  *  強制待ち状態と二重待ち状態のいずれかであるかどうかを判別する．
!  */
! #define TSTAT_DORMANT(tstat)	((tstat) == TS_DORMANT)
! #define TSTAT_RUNNABLE(tstat)	(((tstat) & TS_RUNNABLE) != 0U)
! #define TSTAT_WAITING(tstat)	(((tstat) & TS_WAITING) != 0U)
! #define TSTAT_SUSPENDED(tstat)	(((tstat) & TS_SUSPENDED) != 0U)
! 
! /*
!  *  タスク待ち要因判別マクロ
!  *
!  *  TSTAT_WAIT_SLPはタスクが起床待ちであるかどうかを，TSTAT_WAIT_WOBJ
!  *  はタスクが同期・通信オブジェクトに対する待ちであるか（言い換えると，
!  *  同期通信オブジェクトの待ちキューにつながれているか）どうかを判別す
!  *  る．また，TSTAT_WAIT_WOBJCBはタスクが同期・通信オブジェクトの管理
!  *  ブロックの共通部分（WOBJCB）の待ちキューにつながれているかどうかを
!  *  判別する．
!  *
!  *  TSTAT_WAIT_SLPは，任意のタスク状態の中から，タスクが起床待ちである
!  *  ことを判別できる．すなわち，TSTAT_WAITINGにより待ち状態であることを
!  *  判別せずに，TSTAT_SLPだけを用いて起床待ち状態であることを判別できる．
!  *  これを効率的に実現するために，TS_WAIT_SLPの値を，(0x00U << 3)ではな
!  *  く(0x01U << 3)としている．そのため，タスクが時間経過待ち状態である
!  *  ことを判別するためのTSTAT_WAIT_DLYを，TSTAT_WAIT_SLPと同様の方法で
!  *  実現することはできない．
!  */
! #define TS_WAIT_MASK	(0x0fU << 3)	/* 待ち要因の取出しマスク */
! 
! #define TSTAT_WAIT_SLP(tstat)		(((tstat) & TS_WAIT_MASK) == TS_WAIT_SLP)
! #define TSTAT_WAIT_WOBJ(tstat)		(((tstat) & TS_WAIT_MASK) >= TS_WAIT_RDTQ)
! #define TSTAT_WAIT_WOBJCB(tstat)	(((tstat) & TS_WAIT_MASK) >= TS_WAIT_SEM)
! 
! /*
!  *  待ち情報ブロック（WINFO）の定義
!  *
!  *  タスクが待ち状態の間は，TCBおよびそのp_winfoで指されるWINFOを次の
!  *  ように設定しなければならない．
!  *
!  *  (a) TCBのタスク状態を待ち状態（TS_WAITING）にする．その際に，待ち
!  *  要因（TS_WAIT_???）も設定する．
!  *
!  *  (b) タイムアウトを監視するために，タイムイベントブロックを登録する．
!  *  登録するタイムイベントブロックは，待ちに入るサービスコール処理関数
!  *  のローカル変数として確保し，それへのポインタをWINFOのp_tmevtbに記
!  *  憶する．タイムアウトの監視が必要ない場合（永久待ちの場合）には，
!  *  p_tmevtbをNULLにする．
!  *
!  *  同期・通信オブジェクトに対する待ち状態の場合には，標準のWINFOに
!  *  p_wobjcbフィールドを追加した構造体（WINFO_WOBJ，wait.hで定義）を使
!  *  う．また，以下の(c)?(e)の設定を行う必要がある．同期・通信オブジェ
!  *  クトに関係しない待ち（起床待ち，時間経過待ち）の場合には，(c)?(e)
!  *  は必要ない．
!  *
!  *  (c) TCBを待ち対象の同期・通信オブジェクトの待ちキューにつなぐ．待
!  *  ちキューにつなぐために，task_queueを使う．
!  *
!  *  (d) 待ち対象の同期・通信オブジェクトの管理ブロックへのポインタを，
!  *  WINFO_WOBJのp_wobjcbに記憶する．
!  *
!  *  (e) 待ち対象の同期・通信オブジェクトに依存して記憶することが必要な
!  *  情報がある場合には，WINFO_WOBJに必要な情報のためのフィールドを追加
!  *  した構造体を定義し，WINFO_WOBJの代わりに用いる．
!  *
!  *  待ち状態を解除する際には，待ち解除したタスクに対する返値をWINFOの
!  *  wercdに設定する．wercdが必要なのは待ち解除以降であるのに対して，
!  *  p_tmevtbは待ち解除後は必要ないため，メモリ節約のために共用体を使っ
!  *  ている．そのため，wercdへエラーコードを設定するのは，タイムイベント
!  *  ブロックを登録解除した後にしなければならない．
!  */
! typedef union waiting_information {
! 	ER		wercd;			/* 待ち解除時のエラーコード */
! 	TMEVTB	*p_tmevtb;		/* 待ち状態用のタイムイベントブロック */
! } WINFO;
! 
! /*
!  *  タスク初期化ブロック
!  *
!  *  タスクに関する情報を，値が変わらないためにROMに置ける部分（タスク
!  *  初期化ブロック）と，値が変化するためにRAMに置かなければならない部
!  *  分（タスク管理ブロック，TCB）に分離し，TCB内に対応するタスク初期化
!  *  ブロックを指すポインタを入れる．タスク初期化ブロック内に対応する
!  *  TCBを指すポインタを入れる方法の方が，RAMの節約の観点からは望ましい
!  *  が，実行効率が悪くなるために採用していない．他のオブジェクトについ
!  *  ても同様に扱う．
!  *
!  *  タスク初期化ブロックには，DEF_TEXで定義されるタスク例外処理ルーチ
!  *  ンに関する情報も含む．
!  */
! typedef struct task_initialization_block {
! 	ATR			tskatr;			/* タスク属性 */
! 	intptr_t	exinf;			/* タスクの拡張情報 */
! 	TASK		task;			/* タスクの起動番地 */
! 	uint_t		ipriority;		/* タスクの起動時優先度（内部表現） */
! 
! #ifdef USE_TSKINICTXB
! 	TSKINICTXB	tskinictxb;		/* タスク初期化コンテキストブロック */
! #else /* USE_TSKINICTXB */
! 	SIZE		stksz;			/* スタック領域のサイズ（丸めた値） */
! 	void		*stk;			/* スタック領域の先頭番地 */
! #endif /* USE_TSKINICTXB */
! 
! 	ATR			texatr;			/* タスク例外処理ルーチン属性 */
! 	TEXRTN		texrtn;			/* タスク例外処理ルーチンの起動番地 */
! } TINIB;
! 
! /*
!  *  TCB中のフィールドのビット幅の定義
!  *
!  *  プロセッサによっては，TCB中のフィールドのビット幅でメモリ使用量と
!  *  性能がトレードオフになるため，ターゲット依存にフィールドのビット幅
!  *  を変更することを許している．
!  */
! #ifndef TBIT_TCB_PRIORITY
! #define	TBIT_TCB_PRIORITY		8		/* priorityフィールドのビット幅 */
! #endif /* TBIT_TCB_PRIORITY */
! 
! /*
!  *  タスク管理ブロック（TCB）
!  *
!  *  ASPカーネルでは，タスクの起動要求キューイング数の最大値（TMAX_ACTCNT）
!  *  と起床要求キューイング数の最大値（TMAX_WUPCNT）は1に固定されている
!  *  ため，キューイングされているかどうかの真偽値で表現することができる．
!  *  また，強制待ち要求ネスト数の最大値（TMAX_SUSCNT）が1に固定されてい
!  *  るので，強制待ち要求ネスト数（suscnt）は必要ない．
!  *
!  *  TCBのいくつかのフィールドは，特定のタスク状態でのみ有効な値を保持し，
!  *  それ以外の場合は値が保証されない（よって，参照してはならない）．各
!  *  フィールドが有効な値を保持する条件は次の通り．
!  *
!  *  ・初期化後は常に有効：
!  *  		p_tinib，tstat，actque
!  *  ・休止状態以外で有効（休止状態では初期値になっている）：
!  *  		priority，wupque，enatex，texptn
!  *  ・待ち状態（二重待ち状態を含む）で有効：
!  *  		p_winfo
!  *  ・実行できる状態と同期・通信オブジェクトに対する待ち状態で有効：
!  *  		task_queue
!  *  ・実行可能状態，待ち状態，強制待ち状態，二重待ち状態で有効：
!  *  		tskctxb
!  */
! typedef struct task_control_block {
! 	QUEUE			task_queue;		/* タスクキュー */
! 	const TINIB		*p_tinib;		/* 初期化ブロックへのポインタ */
! 
! #ifdef UINT8_MAX
! 	uint8_t			tstat;			/* タスク状態（内部表現）*/
! #else /* UINT8_MAX */
! 	BIT_FIELD_UINT	tstat : 8;		/* タスク状態（内部表現）*/
! #endif /* UINT8_MAX */
! #if defined(UINT8_MAX) && (TBIT_TCB_PRIORITY == 8)
! 	uint8_t			priority;		/* 現在の優先度（内部表現）*/
! #else /* defined(UINT8_MAX) && (TBIT_TCB_PRIORITY == 8) */
! 	BIT_FIELD_UINT	priority : TBIT_TCB_PRIORITY;
! 									/* 現在の優先度（内部表現）*/
! #endif /* defined(UINT8_MAX) && (TBIT_TCB_PRIORITY == 8) */
! 	BIT_FIELD_BOOL	actque : 1;		/* 起動要求キューイング */
! 	BIT_FIELD_BOOL	wupque : 1;		/* 起床要求キューイング */
! 	BIT_FIELD_BOOL	enatex : 1;		/* タスク例外処理許可状態 */
! 
! 	TEXPTN			texptn;			/* 保留例外要因 */
! 	WINFO			*p_winfo;		/* 待ち情報ブロックへのポインタ */
! 	TSKCTXB			tskctxb;		/* タスクコンテキストブロック */
! } TCB;
! 
! /*
!  *  実行状態のタスク
!  *
!  *  実行状態のタスク（＝プロセッサがコンテキストを持っているタスク）の
!  *  TCBを指すポインタ．実行状態のタスクがない場合はNULLにする．
!  *
!  *  サービスコールの処理中で，自タスク（サービスコールを呼び出したタス
!  *  ク）に関する情報を参照する場合はp_runtskを使う．p_runtskを書き換え
!  *  るのは，ディスパッチャ（と初期化処理）のみである．
!  */
! extern TCB	*p_runtsk;
! 
! /*
!  *  最高優先順位のタスク
!  *
!  *  実行できるタスクの中で最高優先順位のタスクのTCBを指すポインタ．実
!  *  行できるタスクがない場合はNULLにする．
!  *
!  *  ディスパッチ禁止状態など，ディスパッチが保留されている間はp_runtsk
!  *  と一致しているとは限らない．
!  */
! extern TCB	*p_schedtsk;
! 
! /*
!  *  ディスパッチ／タスク例外処理ルーチン起動要求フラグ
!  *
!  *  割込みハンドラ／CPU例外ハンドラの出口処理に，ディスパッチまたは
!  *  タスク例外処理ルーチンの起動を要求することを示すフラグ．
!  */
! extern bool_t	reqflg;
! 
! /*
!  *  割込み優先度マスク全解除状態
!  *
!  *  割込み優先度マスク全解除状態であることを示すフラグ．
!  */
! extern bool_t	ipmflg;
! 
! /*
!  *  ディスパッチ禁止状態
!  *
!  *  ディスパッチ禁止状態であることを示すフラグ．
!  */
! extern bool_t	disdsp;
! 
! /*
!  *  タスクディスパッチ可能状態
!  *
!  *  割込み優先度マスク全解除状態であり，ディスパッチ許可状態である（ディ
!  *  スパッチ禁止状態でない）ことを示すフラグ．
!  */
! extern bool_t	dspflg;
! 
! /*
!  *  レディキュー
!  *
!  *  レディキューは，実行できる状態のタスクを管理するためのキューである．
!  *  実行状態のタスクも管理しているため，レディ（実行可能）キューという
!  *  名称は正確ではないが，レディキューという名称が定着しているため，こ
!  *  の名称で呼ぶことにする．
!  *
!  *  レディキューは，優先度ごとのタスクキューで構成されている．タスクの
!  *  TCBは，該当する優先度のキューに登録される．
!  */
! extern QUEUE	ready_queue[TNUM_TPRI];
! 
! /*
!  *  レディキューサーチのためのビットマップ
!  *
!  *  レディキューのサーチを効率よく行うために，優先度ごとのタスクキュー
!  *  にタスクが入っているかどうかを示すビットマップを用意している．ビッ
!  *  トマップを使うことで，メモリアクセスの回数を減らすことができるが，
!  *  ビット操作命令が充実していないプロセッサで，優先度の段階数が少ない
!  *  場合には，ビットマップ操作のオーバーヘッドのために，逆に効率が落ち
!  *  る可能性もある．
!  *
!  *  優先度が16段階であることを仮定しているため，uint16_t型としている．
!  */
! extern uint16_t	ready_primap;
! 
! /*
!  *  タスクIDの最大値（kernel_cfg.c）
!  */
! extern const ID	tmax_tskid;
! 
! /*
!  *  タスク初期化ブロックのエリア（kernel_cfg.c）
!  */
! extern const TINIB	tinib_table[];
! 
! /*
!  *  タスク生成順序テーブル（kernel_cfg.c）
!  */
! extern const ID	torder_table[];
! 
! /*
!  *  TCBのエリア（kernel_cfg.c）
!  */
! extern TCB	tcb_table[];
! 
! /*
!  *  タスクの数
!  */
! #define tnum_tsk	((uint_t)(tmax_tskid - TMIN_TSKID + 1))
! 
! /*
!  *  タスクIDからTCBを取り出すためのマクロ
!  */
! #define INDEX_TSK(tskid)	((uint_t)((tskid) - TMIN_TSKID))
! #define get_tcb(tskid)		(&(tcb_table[INDEX_TSK(tskid)]))
! #define get_tcb_self(tskid)	((tskid) == TSK_SELF ? p_runtsk : get_tcb(tskid))
! 
! /*
!  *  TCBからタスクIDを取り出すためのマクロ
!  */
! #define	TSKID(p_tcb)	((ID)(((p_tcb) - tcb_table) + TMIN_TSKID))
! 
! /*
!  *  タスク管理モジュールの初期化
!  */
! extern void	initialize_task(void);
! 
! /*
!  *  最高優先順位タスクのサーチ
!  *
!  *  レディキュー中の最高優先順位のタスクをサーチし，そのTCBへのポインタ
!  *  を返す．レディキューが空の場合には，この関数を呼び出してはならない．
!  */
! extern TCB	*search_schedtsk(void);
! 
! /*
!  *  実行できる状態への遷移
!  *
!  *  p_tcbで指定されるタスクをレディキューに挿入する．レディキューに挿入
!  *  したタスクの優先度が，最高優先順位のタスクの優先度よりも高い場合は，
!  *  最高優先順位のタスクを更新し，ディスパッチ許可状態であればtrueを返
!  *  す．そうでない場合はfalseを返す．
!  */
! extern bool_t	make_runnable(TCB *p_tcb);
! 
! /*
!  *  実行できる状態から他の状態への遷移
!  *
!  *  p_tcbで指定されるタスクをレディキューから削除する．p_tcbで指定した
!  *  タスクが最高優先順位のタスクであった場合には，最高優先順位のタスク
!  *  を設定しなおし，ディスパッチ許可状態であればtrueを返す．そうでない
!  *  場合はfalseを返す．タスクの状態は更新しない．
!  */
! extern bool_t	make_non_runnable(TCB *p_tcb);
! 
! /*
!  *  休止状態への遷移
!  *
!  *  p_tcbで指定されるタスクの状態を休止状態とする．また，タスクの起動
!  *  時に初期化すべき変数の初期化と，タスク起動のためのコンテキストを設
!  *  定する．
!  */
! extern void	make_dormant(TCB *p_tcb);
! 
! /*
!  *  休止状態から実行できる状態への遷移
!  *
!  *  p_tcbで指定されるタスクの状態を休止状態から実行できる状態とする．
!  *  実行できる状態に遷移したタスクへのディスパッチが必要な場合はtrue，
!  *  そうでない場合はfalseを返す．
!  */
! extern bool_t	make_active(TCB *p_tcb);
! 
! /*
!  *  タスクの優先度の変更
!  *
!  *  p_tcbで指定されるタスクの優先度をnewpri（内部表現）に変更する．また，
!  *  必要な場合には最高優先順位のタスクを更新し，ディスパッチ許可状態で
!  *  あればtrueを返す．そうでない場合はfalseを返す．
!  */
! extern bool_t	change_priority(TCB *p_tcb, uint_t newpri);
! 
! /*
!  *  レディキューの回転
!  *
!  *  レディキュー中の，priで指定される優先度のタスクキューを回転させる．
!  *  また，必要な場合には最高優先順位のタスクを変更し，ディスパッチが保
!  *  留されていなければtrueを返す．そうでない場合はfalseを返す．
!  */
! extern bool_t	rotate_ready_queue(uint_t pri);
! 
! /*
!  *  タスク例外処理ルーチンの呼出し
!  *
!  *  タスク例外処理ルーチンを呼び出す．呼び出す前に，実行状態のタスクの
!  *  保留例外要因をクリアし，タスク例外処理禁止状態にし，CPUロックを解
!  *  除する．
!  *
!  *  タスク例外処理ルーチンから戻ると，まずCPUロック状態に戻し，その間
!  *  に保留例外要因が0でなくなっていれば，再びタスク例外処理ルーチンを
!  *  呼び出す．保留例外要因が0の場合には，例外処理許可状態にして関数か
!  *  らリターンする．
!  *
!  *  この関数は，実行状態のタスクが，タスク例外処理許可状態（enatexが
!  *  true）で，保留例外要因が0でない（texptnが0でない）場合に呼び出すこ
!  *  とを想定している．この関数は，CPUロック状態で呼び出さなければなら
!  *  ない．
!  */
! extern void	call_texrtn(void);
! 
! /*
!  *  タスク例外処理ルーチンの起動
!  *
!  *  実行状態のタスクがタスク例外処理ルーチンの起動条件を満たしていれば，
!  *  タスク例外処理ルーチンを呼び出す．CPU例外処理ルーチンを呼び出す時
!  *  は，一時的にCPUロックを解除する．
!  *
!  *  この関数は，ディスパッチャや割込みハンドラ／CPU例外ハンドラの出口
!  *  処理から呼び出されることを想定している．この関数は，CPUロック状態
!  *  で呼び出さなければならない．
!  *
!  *  実行効率を上げるために，この関数をターゲット依存部で記述してもよい．
!  *  その場合には，OMIT_CALLTEXをマクロ定義する．
!  */
! extern void	calltex(void);
! 
! #endif /* TOPPERS_TASK_H */
diff -cr --new-file asp/sample/Makefile 1.9.1_update/sample/Makefile
*** asp/sample/Makefile	Thu Jan  2 16:08:55 2014
--- 1.9.1_update/sample/Makefile	Thu Dec 15 13:53:35 2022
***************
*** 1,572 ****
! #
! #  TOPPERS/ASP Kernel
! #      Toyohashi Open Platform for Embedded Real-Time Systems/
! #      Advanced Standard Profile Kernel
! # 
! #  Copyright (C) 2000-2003 by Embedded and Real-Time Systems Laboratory
! #                              Toyohashi Univ. of Technology, JAPAN
! #  Copyright (C) 2006-2014 by Embedded and Real-Time Systems Laboratory
! #              Graduate School of Information Science, Nagoya Univ., JAPAN
! # 
! #  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
! #  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
! #  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
! #  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
! #      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
! #      スコード中に含まれていること．
! #  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
! #      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
! #      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
! #      の無保証規定を掲載すること．
! #  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
! #      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
! #      と．
! #    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
! #        作権表示，この利用条件および下記の無保証規定を掲載すること．
! #    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
! #        報告すること．
! #  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
! #      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
! #      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
! #      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
! #      免責すること．
! # 
! #  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
! #  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
! #  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
! #  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
! #  の責任を負わない．
! # 
! #  $Id: Makefile 2594 2014-01-02 07:08:54Z ertl-hiro $
! # 
! 
! #
! #  ターゲットの指定（Makefile.targetで上書きされるのを防ぐため）
! #
! all:
! 
! #
! #  ターゲット略称の定義
! #
! TARGET = @(TARGET)
! 
! #
! #  プログラミング言語の定義
! #
! SRCLANG = @(SRCLANG)
! ifeq ($(SRCLANG),c)
!   LIBS = -lc
! endif
! ifeq ($(SRCLANG),c++)
!   USE_CXX = true
!   CXXLIBS = -lstdc++ -lm -lc
!   CXXRTS = cxxrt.o newlibrt.o
! endif
! 
! #
! #  ソースファイルのディレクトリの定義
! #
! SRCDIR = @(SRCDIR)
! 
! #
! #  オブジェクトファイル名の拡張子の設定
! #
! OBJEXT = @(OBJEXT)
! 
! #
! #  実行環境の定義（ターゲット依存に上書きされる場合がある）
! #
! DBGENV := @(DBGENV)
! 
! #
! #  カーネルライブラリ（libkernel.a）のディレクトリ名
! #  （カーネルライブラリもmake対象にする時は，空に定義する）
! #
! KERNEL_LIB = @(KERNEL_LIB)
! 
! #
! #  カーネルを関数単位でコンパイルするかどうかの定義
! #
! KERNEL_FUNCOBJS = @(KERNEL_FUNCOBJS)
! 
! #
! #  トレースログを取得するかどうかの定義
! #
! ENABLE_TRACE = @(ENABLE_TRACE)
! 
! #
! #  ユーティリティプログラムの名称
! #
! PERL = @(PERL)
! CFG = @(CFG)
! 
! #
! #  オブジェクトファイル名の定義
! #
! OBJNAME = asp
! ifdef OBJEXT
!   OBJFILE = $(OBJNAME).$(OBJEXT)
!   CFG1_OUT = cfg1_out.$(OBJEXT)
! else
!   OBJFILE = $(OBJNAME)
!   CFG1_OUT = cfg1_out
! endif
! 
! #
! #  ターゲット依存部のディレクトリの定義
! #
! TARGETDIR = $(SRCDIR)/target/$(TARGET)
! 
! #
! #  ターゲット依存の定義のインクルード
! #
! include $(TARGETDIR)/Makefile.target
! 
! #
! #  コンフィギュレータ関係の変数の定義
! #
! CFG_TABS := --api-table $(SRCDIR)/kernel/kernel_api.csv \
! 			--cfg1-def-table $(SRCDIR)/kernel/kernel_def.csv $(CFG_TABS)
! 
! CFG_ASMOBJS := $(CFG_ASMOBJS)
! CFG_COBJS := kernel_cfg.o $(CFG_COBJS)
! CFG_OBJS := $(CFG_ASMOBJS) $(CFG_COBJS)
! CFG2_OUT_SRCS := kernel_cfg.h kernel_cfg.c $(CFG2_OUT_SRCS)
! 
! #
! #  共通コンパイルオプションの定義
! #
! COPTS := $(COPTS) -g @(COPTS)
! ifndef OMIT_WARNING_ALL
!   COPTS := $(COPTS) -Wall
! endif
! ifndef OMIT_OPTIMIZATION
!   COPTS := $(COPTS) -O2
! endif
! CDEFS := $(CDEFS) @(CDEFS)
! INCLUDES := -I. -I$(SRCDIR)/include -I$(SRCDIR)/arch -I$(SRCDIR) $(INCLUDES)
! LDFLAGS := $(LDFLAGS) @(LDFLAGS)
! CFG1_OUT_LDFLAGS := $(CFG1_OUT_LDFLAGS) @(LDFLAGS)
! LIBS := $(LIBS) $(CXXLIBS)
! CFLAGS = $(COPTS) $(CDEFS) $(INCLUDES)
! 
! #
! #  アプリケーションプログラムに関する定義
! #
! APPLNAME = @(APPLNAME)
! APPLDIR = @(APPLDIR)
! APPL_CFG = $(APPLNAME).cfg
! 
! APPL_DIR = $(APPLDIR) $(SRCDIR)/library
! APPL_ASMOBJS =
! ifdef USE_CXX
!   APPL_CXXOBJS = $(APPLNAME).o @(APPLOBJS)
!   APPL_COBJS =
! else
!   APPL_COBJS = $(APPLNAME).o @(APPLOBJS)
! endif
! APPL_COBJS := $(APPL_COBJS) log_output.o vasyslog.o t_perror.o strerror.o
! APPL_CFLAGS =
! APPL_LIBS =
! ifdef APPLDIR
!   INCLUDES := $(INCLUDES) $(foreach dir,$(APPLDIR),-I$(dir))
! endif
! 
! #
! #  システムサービスに関する定義
! #
! SYSSVC_DIR := $(SYSSVC_DIR) $(SRCDIR)/syssvc $(SRCDIR)/library
! SYSSVC_ASMOBJS := $(SYSSVC_ASMOBJS)
! SYSSVC_COBJS := $(SYSSVC_COBJS) banner.o syslog.o serial.o logtask.o \
! 				@(SYSSVCOBJS) $(CXXRTS)
! SYSSVC_CFLAGS := $(SYSSVC_CFLAGS)
! SYSSVC_LIBS := $(SYSSVC_LIBS)
! INCLUDES := $(INCLUDES)
! 
! #
! #  カーネルに関する定義
! #
! #  KERNEL_ASMOBJS: カーネルライブラリに含める，ソースがアセンブリ言語の
! #				   オブジェクトファイル．
! #  KERNEL_COBJS: カーネルのライブラリに含める，ソースがC言語で，ソース
! #				 ファイルと1対1に対応するオブジェクトファイル．
! #  KERNEL_LCSRCS: カーネルのライブラリに含めるC言語のソースファイルで，
! #				  1つのソースファイルから複数のオブジェクトファイルを生
! #				  成するもの．
! #  KERNEL_LCOBJS: 上のソースファイルから生成されるオブジェクトファイル．
! #  KERNEL_AUX_COBJS: ロードモジュールに含めないが，カーネルのソースファ
! #					 イルと同じオプションを適用してコンパイルすべき，ソー
! #					 スがC言語のオブジェクトファイル．
! #
! KERNEL_DIR := $(KERNEL_DIR) $(SRCDIR)/kernel
! KERNEL_ASMOBJS := $(KERNEL_ASMOBJS)
! KERNEL_COBJS := $(KERNEL_COBJS)
! KERNEL_CFLAGS := $(KERNEL_CFLAGS) -I$(SRCDIR)/kernel
! ifdef OMIT_MAKEOFFSET
!   OFFSET_H =
! else
!   OFFSET_H = offset.h
! ifndef OFFSET_TF
!   KERNEL_AUX_COBJS := $(KERNEL_AUX_COBJS) makeoffset.o
! endif
! endif
! 
! #
! #  ターゲットファイル（複数を同時に選択してはならない）
! #
! all: $(OBJFILE)
! #all: $(OBJNAME).bin
! #all: $(OBJNAME).srec
! 
! ##### 以下は編集しないこと #####
! 
! #
! #  環境に依存するコンパイルオプションの定義
! #
! ifdef DBGENV
!   CDEFS := $(CDEFS) -D$(DBGENV)
! endif
! 
! #
! #  カーネルのファイル構成の定義
! #
! include $(SRCDIR)/kernel/Makefile.kernel
! ifdef KERNEL_FUNCOBJS
!   KERNEL_LCSRCS := $(KERNEL_FCSRCS)
!   KERNEL_LCOBJS := $(foreach file,$(KERNEL_FCSRCS),$($(file:.c=)))
! else
!   KERNEL_CFLAGS := -DALLFUNC $(KERNEL_CFLAGS)
!   KERNEL_COBJS := $(KERNEL_COBJS) \
! 					$(foreach file,$(KERNEL_FCSRCS),$(file:.c=.o))
! endif
! 
! #
! #  ソースファイルのあるディレクトリに関する定義
! #
! vpath %.c $(KERNEL_DIR) $(SYSSVC_DIR) $(APPL_DIR)
! vpath %.S $(KERNEL_DIR) $(SYSSVC_DIR) $(APPL_DIR)
! vpath %.cfg $(APPL_DIR)
! 
! #
! #  コンパイルのための変数の定義
! #
! KERNEL_LIB_OBJS = $(KERNEL_ASMOBJS) $(KERNEL_COBJS) $(KERNEL_LCOBJS)
! SYSSVC_OBJS = $(SYSSVC_ASMOBJS) $(SYSSVC_COBJS)
! APPL_OBJS = $(APPL_ASMOBJS) $(APPL_COBJS) $(APPL_CXXOBJS)
! ALL_OBJS = $(START_OBJS) $(APPL_OBJS) $(SYSSVC_OBJS) $(CFG_OBJS) \
! 											$(END_OBJS) $(HIDDEN_OBJS)
! ifdef KERNEL_LIB
!   ALL_LIBS = $(APPL_LIBS) $(SYSSVC_LIBS) -lkernel $(LIBS)
!   LIBS_DEP = $(filter %.a,$(ALL_LIBS)) $(KERNEL_LIB)/libkernel.a
!   LDFLAGS := $(LDFLAGS) -L$(KERNEL_LIB)
!   REALCLEAN_FILES := libkernel.a $(REALCLEAN_FILES)
! else
!   ALL_LIBS = $(APPL_LIBS) $(SYSSVC_LIBS) libkernel.a $(LIBS)
!   LIBS_DEP = $(filter %.a,$(ALL_LIBS))
! endif
! 
! ifdef TEXT_START_ADDRESS
!   LDFLAGS := $(LDFLAGS) -Wl,-Ttext,$(TEXT_START_ADDRESS)
!   CFG1_OUT_LDFLAGS := $(CFG1_OUT_LDFLAGS) -Wl,-Ttext,$(TEXT_START_ADDRESS)
! endif
! ifdef DATA_START_ADDRESS
!   LDFLAGS := $(LDFLAGS) -Wl,-Tdata,$(DATA_START_ADDRESS)
!   CFG1_OUT_LDFLAGS := $(CFG1_OUT_LDFLAGS) -Wl,-Tdata,$(DATA_START_ADDRESS)
! endif
! ifdef LDSCRIPT
!   LDFLAGS := $(LDFLAGS) -T $(LDSCRIPT)
!   CFG1_OUT_LDFLAGS := $(CFG1_OUT_LDFLAGS) -T $(LDSCRIPT)
! endif
! 
! #
! #  オフセットファイル（offset.h）の生成規則
! #
! ifdef OFFSET_TF
! offset.h: $(APPL_CFG) kernel_cfg.timestamp
! 	$(CFG) --pass 3 --kernel asp $(INCLUDES) \
! 				--rom-image cfg1_out.srec --symbol-table cfg1_out.syms \
! 				-T $(OFFSET_TF) $(CFG_TABS) $<
! else
! offset.h: makeoffset.s $(SRCDIR)/utils/genoffset
! 	$(PERL) $(SRCDIR)/utils/genoffset makeoffset.s > offset.h
! endif
! 
! #
! #  カーネルのコンフィギュレーションファイルの生成
! #
! cfg1_out.c: $(APPL_CFG)
! 	$(CFG) --pass 1 --kernel asp $(INCLUDES) $(CFG_TABS) $<
! 
! $(CFG2_OUT_SRCS): kernel_cfg.timestamp
! kernel_cfg.timestamp: $(APPL_CFG) \
! 						$(START_OBJS) cfg1_out.o $(END_OBJS) $(HIDDEN_OBJS)
! 	$(LINK) $(CFLAGS) $(CFG1_OUT_LDFLAGS) -o $(CFG1_OUT) \
! 						$(START_OBJS) cfg1_out.o $(END_OBJS)
! 	$(NM) -n $(CFG1_OUT) > cfg1_out.syms
! 	$(OBJCOPY) -O srec -S $(CFG1_OUT) cfg1_out.srec
! 	$(CFG) --pass 2 --kernel asp $(INCLUDES) \
! 				-T $(TARGETDIR)/target.tf $(CFG_TABS) $<
! 	touch -r kernel_cfg.c kernel_cfg.timestamp
! 
! #
! #  カーネルライブラリファイルの生成
! #
! libkernel.a: $(OFFSET_H) $(KERNEL_LIB_OBJS)
! 	rm -f libkernel.a
! 	$(AR) -rcs libkernel.a $(KERNEL_LIB_OBJS)
! 	$(RANLIB) libkernel.a
! 
! #
! #  特別な依存関係の定義
! #
! banner.o: kernel_cfg.timestamp $(filter-out banner.o,$(ALL_OBJS)) $(LIBS_DEP)
! 
! #
! #  全体のリンク
! #
! $(OBJFILE): $(APPL_CFG) kernel_cfg.timestamp $(ALL_OBJS) $(LIBS_DEP)
! 	$(LINK) $(CFLAGS) $(LDFLAGS) -o $(OBJFILE) $(START_OBJS) \
! 			$(APPL_OBJS) $(SYSSVC_OBJS) $(CFG_OBJS) $(ALL_LIBS) $(END_OBJS)
! 	$(NM) -n $(OBJFILE) > $(OBJNAME).syms
! 	$(OBJCOPY) -O srec -S $(OBJFILE) $(OBJNAME).srec
! 	$(CFG) --pass 3 --kernel asp $(INCLUDES) \
! 				--rom-image $(OBJNAME).srec --symbol-table $(OBJNAME).syms \
! 				-T $(TARGETDIR)/target_check.tf $(CFG_TABS) $<
! 
! #
! #  バイナリファイルの生成
! #
! $(OBJNAME).bin: $(OBJFILE)
! 	$(OBJCOPY) -O binary -S $(OBJFILE) $(OBJNAME).bin
! 
! #
! #  Sレコードファイルの生成
! #
! $(OBJNAME).srec: $(OBJFILE)
! 	$(OBJCOPY) -O srec -S $(OBJFILE) $(OBJNAME).srec
! 
! #
! #  コンパイル結果の消去
! #
! .PHONY: clean
! clean:
! 	rm -f \#* *~ *.o $(CLEAN_FILES)
! 	rm -f $(OBJFILE) $(OBJNAME).syms $(OBJNAME).srec $(OBJNAME).bin
! 	rm -f kernel_cfg.timestamp $(CFG2_OUT_SRCS)
! 	rm -f cfg1_out.c $(CFG1_OUT) cfg1_out.syms cfg1_out.srec
! ifndef KERNEL_LIB
! 	rm -f libkernel.a
! endif
! 	rm -f makeoffset.s offset.h
! 
! .PHONY: cleankernel
! cleankernel:
! 	rm -rf $(KERNEL_LIB_OBJS)
! 	rm -f makeoffset.s offset.h
! 
! .PHONY: cleandep
! cleandep:
! 	if ! [ -f Makefile.depend ]; then \
! 		rm -f kernel_cfg.timestamp $(CFG2_OUT_SRCS); \
! 		rm -f cfg1_out.c cfg1_out.o $(CFG1_OUT) cfg1_out.syms cfg1_out.srec; \
! 		rm -f makeoffset.s offset.h; \
! 	fi
! 	rm -f Makefile.depend
! 
! .PHONY: realclean
! realclean: cleandep clean
! 	rm -f $(REALCLEAN_FILES)
! 
! #
! #  コンフィギュレータが生成したファイルのコンパイルルールと依存関係作成
! #  ルールの定義
! #
! #  コンフィギュレータが生成したファイルは，アプリケーションプログラム用，
! #  システムサービス用，カーネル用のすべてのオプションを付けてコンパイル
! #  する．
! #
! ALL_CFG_COBJS = $(CFG_COBJS) cfg1_out.o
! ALL_CFG_ASMOBJS = $(CFG_ASMOBJS)
! CFG_CFLAGS = $(APPL_CFLAGS) $(SYSSVC_CFLAGS) $(KERNEL_CFLAGS)
! 
! $(ALL_CFG_COBJS): %.o: %.c
! 	$(CC) -c $(CFLAGS) $(CFG_CFLAGS) $<
! 
! $(ALL_CFG_COBJS:.o=.s): %.s: %.c
! 	$(CC) -S $(CFLAGS) $(CFG_CFLAGS) $<
! 
! $(ALL_CFG_COBJS:.o=.d): %.d: %.c
! 	@$(PERL) $(SRCDIR)/utils/makedep -C $(CC) $(MAKEDEP_OPTS) \
! 		-O "$(CFLAGS) $(CFG_CFLAGS)" $< >> Makefile.depend
! 
! $(ALL_CFG_ASMOBJS): %.o: %.S
! 	$(CC) -c $(CFLAGS) $(CFG_CFLAGS) $<
! 
! $(ALL_CFG_ASMOBJS:.o=.d): %.d: %.S
! 	@$(PERL) $(SRCDIR)/utils/makedep -C $(CC) $(MAKEDEP_OPTS) \
! 		-O "$(CFLAGS) $(CFG_CFLAGS)" $< >> Makefile.depend
! 
! #
! #  特殊な依存関係作成ルールの定義
! #
! cfg1_out.depend: $(APPL_CFG)
! 	@$(CFG) -M cfg1_out.c $(INCLUDES) $< >> Makefile.depend
! 
! makeoffset.d: makeoffset.c
! 	@$(PERL) $(SRCDIR)/utils/makedep -C $(CC) $(MAKEDEP_OPTS) \
! 		-T "makeoffset.s" -O "$(CFLAGS) $(KERNEL_CFLAGS)" $< >> Makefile.depend
! 
! #
! #  依存関係ファイルの生成
! #
! .PHONY: gendepend
! gendepend:
! 	@echo "Generating Makefile.depend."
! 
! .PHONY: depend
! ifdef KERNEL_LIB
! depend: cleandep kernel_cfg.timestamp gendepend \
! 		cfg1_out.depend cfg1_out.d \
! 		$(ALL_OBJS:.o=.d)
! else
! depend: cleandep $(OFFSET_H) kernel_cfg.timestamp gendepend \
! 		cfg1_out.depend cfg1_out.d \
! 		$(KERNEL_AUX_COBJS:.o=.d) $(KERNEL_ASMOBJS:.o=.d) \
! 		$(KERNEL_COBJS:.o=.d) $(KERNEL_LCSRCS:.c=.d) $(ALL_OBJS:.o=.d)
! endif
! 
! #
! #  依存関係ファイルをインクルード
! #
! -include Makefile.depend
! 
! #
! #  開発ツールのコマンド名の定義
! #
! ifeq ($(TOOL),gcc)
!   #
!   #  GNU開発環境用
!   #
!   ifdef GCC_TARGET
!     GCC_TARGET_PREFIX = $(GCC_TARGET)-
!   else
!     GCC_TARGET_PREFIX =
!   endif
!   CC = $(GCC_TARGET_PREFIX)gcc
!   CXX = $(GCC_TARGET_PREFIX)g++
!   AS = $(GCC_TARGET_PREFIX)as
!   LD = $(GCC_TARGET_PREFIX)ld
!   AR = $(GCC_TARGET_PREFIX)ar
!   NM = $(GCC_TARGET_PREFIX)nm
!   RANLIB = $(GCC_TARGET_PREFIX)ranlib
!   OBJCOPY = $(GCC_TARGET_PREFIX)objcopy
!   OBJDUMP = $(GCC_TARGET_PREFIX)objdump
! endif
! 
! ifdef USE_CXX
!   LINK = $(CXX)
! else
!   LINK = $(CC)
! endif
! 
! #
! #  コンパイルルールの定義
! #
! KERNEL_ALL_COBJS = $(KERNEL_COBJS) $(KERNEL_AUX_COBJS)
! 
! $(KERNEL_ALL_COBJS): %.o: %.c
! 	$(CC) -c $(CFLAGS) $(KERNEL_CFLAGS) $<
! 
! $(KERNEL_ALL_COBJS:.o=.s): %.s: %.c
! 	$(CC) -S $(CFLAGS) $(KERNEL_CFLAGS) $<
! 
! $(KERNEL_LCOBJS): %.o:
! 	$(CC) -DTOPPERS_$(*F) -o $@ -c $(CFLAGS) $(KERNEL_CFLAGS) $<
! 
! $(KERNEL_LCOBJS:.o=.s): %.s:
! 	$(CC) -DTOPPERS_$(*F) -o $@ -S $(CFLAGS) $(KERNEL_CFLAGS) $<
! 
! $(KERNEL_ASMOBJS): %.o: %.S
! 	$(CC) -c $(CFLAGS) $(KERNEL_CFLAGS) $<
! 
! $(SYSSVC_COBJS): %.o: %.c
! 	$(CC) -c $(CFLAGS) $(SYSSVC_CFLAGS) $<
! 
! $(SYSSVC_COBJS:.o=.s): %.s: %.c
! 	$(CC) -S $(CFLAGS) $(SYSSVC_CFLAGS) $<
! 
! $(SYSSVC_ASMOBJS): %.o: %.S
! 	$(CC) -c $(CFLAGS) $(SYSSVC_CFLAGS) $<
! 
! $(APPL_COBJS): %.o: %.c
! 	$(CC) -c $(CFLAGS) $(APPL_CFLAGS) $<
! 
! $(APPL_COBJS:.o=.s): %.s: %.c
! 	$(CC) -S $(CFLAGS) $(APPL_CFLAGS) $<
! 
! $(APPL_CXXOBJS): %.o: %.cpp
! 	$(CXX) -c $(CFLAGS) $(APPL_CFLAGS) $<
! 
! $(APPL_CXXOBJS:.o=.s): %.s: %.cpp
! 	$(CXX) -S $(CFLAGS) $(APPL_CFLAGS) $<
! 
! $(APPL_ASMOBJS): %.o: %.S
! 	$(CC) -c $(CFLAGS) $(APPL_CFLAGS) $<
! 
! #
! #  依存関係作成ルールの定義
! #
! $(KERNEL_COBJS:.o=.d): %.d: %.c
! 	@$(PERL) $(SRCDIR)/utils/makedep -C $(CC) $(MAKEDEP_OPTS) \
! 		-O "$(CFLAGS) $(KERNEL_CFLAGS)" $< >> Makefile.depend
! 
! $(KERNEL_LCSRCS:.c=.d): %.d: %.c
! 	@$(PERL) $(SRCDIR)/utils/makedep -C $(CC) $(MAKEDEP_OPTS) -T "$($*)" \
! 		-O "-DALLFUNC $(CFLAGS) $(KERNEL_CFLAGS)" $< >> Makefile.depend
! 
! $(KERNEL_ASMOBJS:.o=.d): %.d: %.S
! 	@$(PERL) $(SRCDIR)/utils/makedep -C $(CC) $(MAKEDEP_OPTS) \
! 		-O "$(CFLAGS) $(KERNEL_CFLAGS)" $< >> Makefile.depend
! 
! $(SYSSVC_COBJS:.o=.d): %.d: %.c
! 	@$(PERL) $(SRCDIR)/utils/makedep -C $(CC) $(MAKEDEP_OPTS) \
! 		-O "$(CFLAGS) $(SYSSVC_CFLAGS)" $< >> Makefile.depend
! 
! $(SYSSVC_ASMOBJS:.o=.d): %.d: %.S
! 	@$(PERL) $(SRCDIR)/utils/makedep -C $(CC) $(MAKEDEP_OPTS) \
! 		-O "$(CFLAGS) $(SYSSVC_CFLAGS)" $< >> Makefile.depend
! 
! $(APPL_COBJS:.o=.d): %.d: %.c
! 	@$(PERL) $(SRCDIR)/utils/makedep -C $(CC) $(MAKEDEP_OPTS) \
! 		-O "$(CFLAGS) $(APPL_CFLAGS)" $< >> Makefile.depend
! 
! $(APPL_CXXOBJS:.o=.d): %.d: %.cpp
! 	@$(PERL) $(SRCDIR)/utils/makedep -C $(CXX) $(MAKEDEP_OPTS) \
! 		-O "$(CFLAGS) $(APPL_CFLAGS)" $< >> Makefile.depend
! 
! $(APPL_ASMOBJS:.o=.d): %.d: %.S
! 	@$(PERL) $(SRCDIR)/utils/makedep -C $(CC) $(MAKEDEP_OPTS) \
! 		-O "$(CFLAGS) $(APPL_CFLAGS)" $< >> Makefile.depend
! 
! #
! #  デフォルトコンパイルルールを上書き
! #
! %.o: %.c
! 	@echo "*** Default compile rules should not be used."
! 	$(CC) -c $(CFLAGS) $<
! 
! %.s: %.c
! 	@echo "*** Default compile rules should not be used."
! 	$(CC) -S $(CFLAGS) $<
! 
! %.o: %.cpp
! 	@echo "*** Default compile rules should not be used."
! 	$(CXX) -c $(CFLAGS) $<
! 
! %.s: %.cpp
! 	@echo "*** Default compile rules should not be used."
! 	$(CXX) -S $(CFLAGS) $<
! 
! %.o: %.S
! 	@echo "*** Default compile rules should not be used."
! 	$(CC) -c $(CFLAGS) $<
--- 1,581 ----
! #
! #  TOPPERS/ASP Kernel
! #      Toyohashi Open Platform for Embedded Real-Time Systems/
! #      Advanced Standard Profile Kernel
! # 
! #  Copyright (C) 2000-2003 by Embedded and Real-Time Systems Laboratory
! #                              Toyohashi Univ. of Technology, JAPAN
! #  Copyright (C) 2006-2014 by Embedded and Real-Time Systems Laboratory
! #              Graduate School of Information Science, Nagoya Univ., JAPAN
! # 
! #  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
! #  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
! #  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
! #  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
! #      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
! #      スコード中に含まれていること．
! #  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
! #      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
! #      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
! #      の無保証規定を掲載すること．
! #  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
! #      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
! #      と．
! #    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
! #        作権表示，この利用条件および下記の無保証規定を掲載すること．
! #    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
! #        報告すること．
! #  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
! #      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
! #      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
! #      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
! #      免責すること．
! # 
! #  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
! #  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
! #  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
! #  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
! #  の責任を負わない．
! # 
! #  $Id: Makefile 2594 2014-01-02 07:08:54Z ertl-hiro $
! # 
! 
! #
! #  ターゲットの指定（Makefile.targetで上書きされるのを防ぐため）
! #
! all:
! 
! #
! #  ターゲット略称の定義
! #
! TARGET = @(TARGET)
! 
! #
! #  プログラミング言語の定義
! #
! SRCLANG = @(SRCLANG)
! ifeq ($(SRCLANG),c)
!   LIBS = -lc
! endif
! ifeq ($(SRCLANG),c++)
!   USE_CXX = true
!   CXXLIBS = -lstdc++ -lm -lc
!   CXXRTS = cxxrt.o newlibrt.o
! endif
! 
! #
! #  ソースファイルのディレクトリの定義
! #
! SRCDIR = @(SRCDIR)
! 
! #
! #  オブジェクトファイル名の拡張子の設定
! #
! OBJEXT = @(OBJEXT)
! 
! #
! #  実行環境の定義（ターゲット依存に上書きされる場合がある）
! #
! DBGENV := @(DBGENV)
! 
! #
! #  カーネルライブラリ（libkernel.a）のディレクトリ名
! #  （カーネルライブラリもmake対象にする時は，空に定義する）
! #
! KERNEL_LIB = @(KERNEL_LIB)
! 
! #
! #  カーネルを関数単位でコンパイルするかどうかの定義
! #
! KERNEL_FUNCOBJS = @(KERNEL_FUNCOBJS)
! 
! #
! #  トレースログを取得するかどうかの定義
! #
! ENABLE_TRACE = @(ENABLE_TRACE)
! 
! #
! #  ユーティリティプログラムの名称
! #
! PERL = @(PERL)
! CFG = @(CFG)
! 
! #
! #  オブジェクトファイル名の定義
! #
! OBJNAME = asp
! ifdef OBJEXT
!   OBJFILE = $(OBJNAME).$(OBJEXT)
!   CFG1_OUT = cfg1_out.$(OBJEXT)
! else
!   OBJFILE = $(OBJNAME)
!   CFG1_OUT = cfg1_out
! endif
! 
! #
! #  ターゲット依存部のディレクトリの定義
! #
! TARGETDIR = $(SRCDIR)/target/$(TARGET)
! 
! #
! #  ターゲット依存の定義のインクルード
! #
! include $(TARGETDIR)/Makefile.target
! 
! #
! #  コンフィギュレータ関係の変数の定義
! #
! CFG_TABS := --api-table $(SRCDIR)/kernel/kernel_api.csv \
! 			--cfg1-def-table $(SRCDIR)/kernel/kernel_def.csv $(CFG_TABS)
! 
! CFG_ASMOBJS := $(CFG_ASMOBJS)
! CFG_COBJS := kernel_cfg.o $(CFG_COBJS)
! CFG_OBJS := $(CFG_ASMOBJS) $(CFG_COBJS)
! CFG2_OUT_SRCS := kernel_cfg.h kernel_cfg.c $(CFG2_OUT_SRCS)
! 
! #
! #  共通コンパイルオプションの定義
! #
! COPTS := $(COPTS)  -g @(COPTS)
! ifndef OMIT_WARNING_ALL
!   COPTS := $(COPTS) -Wall
! endif
! ifndef OMIT_OPTIMIZATION
!   COPTS := $(COPTS) -O2
! endif
! CDEFS := $(CDEFS) @(CDEFS)
! INCLUDES := -I. -I$(SRCDIR)/include -I$(SRCDIR)/arch -I$(SRCDIR) $(INCLUDES)
! LDFLAGS := $(LDFLAGS) @(LDFLAGS)
! CFG1_OUT_LDFLAGS := $(CFG1_OUT_LDFLAGS) @(LDFLAGS)
! LIBS := $(LIBS) $(CXXLIBS)
! CFLAGS = $(COPTS) $(CDEFS) $(INCLUDES)
! 
! #
! #  アプリケーションプログラムに関する定義
! #
! APPLNAME = @(APPLNAME)
! APPLDIR = @(APPLDIR)
! APPL_CFG = $(APPLNAME).cfg
! 
! APPL_DIR = $(APPLDIR) $(SRCDIR)/library
! APPL_ASMOBJS =
! ifdef USE_CXX
!   APPL_CXXOBJS = $(APPLNAME).o @(APPLOBJS)
!   APPL_COBJS =
! else
!   APPL_COBJS = $(APPLNAME).o @(APPLOBJS)
! endif
! APPL_COBJS := $(APPL_COBJS) log_output.o vasyslog.o t_perror.o strerror.o
! APPL_CFLAGS =
! APPL_LIBS =
! ifdef APPLDIR
!   INCLUDES := $(INCLUDES) $(foreach dir,$(APPLDIR),-I$(dir))
! endif
! 
! #
! #  システムサービスに関する定義
! #
! SYSSVC_DIR := $(SYSSVC_DIR) $(SRCDIR)/syssvc $(SRCDIR)/library
! SYSSVC_ASMOBJS := $(SYSSVC_ASMOBJS)
! SYSSVC_COBJS := $(SYSSVC_COBJS) banner.o syslog.o logtask.o \
! 				@(SYSSVCOBJS) $(CXXRTS)
! SYSSVC_CFLAGS := $(SYSSVC_CFLAGS)
! SYSSVC_LIBS := $(SYSSVC_LIBS)
! INCLUDES := $(INCLUDES)
! 
! #
! #  カーネルに関する定義
! #
! #  KERNEL_ASMOBJS: カーネルライブラリに含める，ソースがアセンブリ言語の
! #				   オブジェクトファイル．
! #  KERNEL_COBJS: カーネルのライブラリに含める，ソースがC言語で，ソース
! #				 ファイルと1対1に対応するオブジェクトファイル．
! #  KERNEL_LCSRCS: カーネルのライブラリに含めるC言語のソースファイルで，
! #				  1つのソースファイルから複数のオブジェクトファイルを生
! #				  成するもの．
! #  KERNEL_LCOBJS: 上のソースファイルから生成されるオブジェクトファイル．
! #  KERNEL_AUX_COBJS: ロードモジュールに含めないが，カーネルのソースファ
! #					 イルと同じオプションを適用してコンパイルすべき，ソー
! #					 スがC言語のオブジェクトファイル．
! #
! KERNEL_DIR := $(KERNEL_DIR) $(SRCDIR)/kernel
! KERNEL_ASMOBJS := $(KERNEL_ASMOBJS)
! KERNEL_COBJS := $(KERNEL_COBJS)
! KERNEL_CFLAGS := $(KERNEL_CFLAGS) -I$(SRCDIR)/kernel
! ifdef OMIT_MAKEOFFSET
!   OFFSET_H =
! else
!   OFFSET_H = offset.h
! ifndef OFFSET_TF
!   KERNEL_AUX_COBJS := $(KERNEL_AUX_COBJS) makeoffset.o
! endif
! endif
! 
! #
! #  ターゲットファイル（複数を同時に選択してはならない）
! #
! all: $(OBJFILE)
! #all: $(OBJNAME).bin
! #all: $(OBJNAME).srec
! 
! ##### 以下は編集しないこと #####
! 
! #
! #  環境に依存するコンパイルオプションの定義
! #
! ifdef DBGENV
!   CDEFS := $(CDEFS) -D$(DBGENV)
! endif
! 
! #
! #  カーネルのファイル構成の定義
! #
! include $(SRCDIR)/kernel/Makefile.kernel
! ifdef KERNEL_FUNCOBJS
!   KERNEL_LCSRCS := $(KERNEL_FCSRCS)
!   KERNEL_LCOBJS := $(foreach file,$(KERNEL_FCSRCS),$($(file:.c=)))
! else
!   KERNEL_CFLAGS := -DALLFUNC $(KERNEL_CFLAGS)
!   KERNEL_COBJS := $(KERNEL_COBJS) \
! 					$(foreach file,$(KERNEL_FCSRCS),$(file:.c=.o))
! endif
! 
! #
! #  ソースファイルのあるディレクトリに関する定義
! #
! vpath %.c $(KERNEL_DIR) $(SYSSVC_DIR) $(APPL_DIR)
! vpath %.S $(KERNEL_DIR) $(SYSSVC_DIR) $(APPL_DIR)
! vpath %.cfg $(APPL_DIR)
! 
! #
! #  コンパイルのための変数の定義
! #
! KERNEL_LIB_OBJS = $(KERNEL_ASMOBJS) $(KERNEL_COBJS) $(KERNEL_LCOBJS)
! SYSSVC_OBJS = $(SYSSVC_ASMOBJS) $(SYSSVC_COBJS)
! APPL_OBJS = $(APPL_ASMOBJS) $(APPL_COBJS) $(APPL_CXXOBJS)
! ALL_OBJS = $(START_OBJS) $(APPL_OBJS) $(SYSSVC_OBJS) $(CFG_OBJS) \
! 											$(END_OBJS) $(HIDDEN_OBJS)
! ifdef KERNEL_LIB
!   ALL_LIBS = $(APPL_LIBS) $(SYSSVC_LIBS) -lkernel $(LIBS)
!   LIBS_DEP = $(filter %.a,$(ALL_LIBS)) $(KERNEL_LIB)/libkernel.a
!   LDFLAGS := $(LDFLAGS) -L$(KERNEL_LIB)
!   REALCLEAN_FILES := libkernel.a $(REALCLEAN_FILES)
! else
!   ALL_LIBS = $(APPL_LIBS) $(SYSSVC_LIBS) libkernel.a $(LIBS)
!   LIBS_DEP = $(filter %.a,$(ALL_LIBS))
! endif
! 
! ifdef TEXT_START_ADDRESS
!   LDFLAGS := $(LDFLAGS) -Wl,-Ttext,$(TEXT_START_ADDRESS)
!   CFG1_OUT_LDFLAGS := $(CFG1_OUT_LDFLAGS) -Wl,-Ttext,$(TEXT_START_ADDRESS)
! endif
! ifdef DATA_START_ADDRESS
!   LDFLAGS := $(LDFLAGS) -Wl,-Tdata,$(DATA_START_ADDRESS)
!   CFG1_OUT_LDFLAGS := $(CFG1_OUT_LDFLAGS) -Wl,-Tdata,$(DATA_START_ADDRESS)
! endif
! ifdef LDSCRIPT
!   LDFLAGS := $(LDFLAGS) -T $(LDSCRIPT)
!   CFG1_OUT_LDFLAGS := $(CFG1_OUT_LDFLAGS) -T $(LDSCRIPT)
! endif
! 
! #
! #  オフセットファイル（offset.h）の生成規則
! #
! ifdef OFFSET_TF
! offset.h: $(APPL_CFG) kernel_cfg.timestamp
! 	$(CFG) --pass 3 --kernel asp $(INCLUDES) \
! 				--rom-image cfg1_out.srec --symbol-table cfg1_out.syms \
! 				-T $(OFFSET_TF) $(CFG_TABS) $<
! else
! offset.h: makeoffset.s $(SRCDIR)/utils/genoffset
! 	$(PERL) $(SRCDIR)/utils/genoffset makeoffset.s > offset.h
! endif
! 
! #
! #  カーネルのコンフィギュレーションファイルの生成
! #
! cfg1_out.c: $(APPL_CFG)
! 	$(CFG) --pass 1 --kernel asp $(INCLUDES) $(CFG_TABS) $<
! 
! $(CFG2_OUT_SRCS): kernel_cfg.timestamp
! kernel_cfg.timestamp: $(APPL_CFG) \
! 						$(START_OBJS) cfg1_out.o $(END_OBJS) $(HIDDEN_OBJS)
! 	$(LINK) $(CFLAGS) $(CFG1_OUT_LDFLAGS) -o $(CFG1_OUT) \
! 						$(START_OBJS) cfg1_out.o $(END_OBJS)
! 	$(NM) -n $(CFG1_OUT) > cfg1_out.syms
! 	$(OBJCOPY) -O srec -S $(CFG1_OUT) cfg1_out.srec
! 	$(CFG) --pass 2 --kernel asp $(INCLUDES) \
! 				-T $(TARGETDIR)/target.tf $(CFG_TABS) $<
! 	touch -r kernel_cfg.c kernel_cfg.timestamp
! 
! #
! #  カーネルライブラリファイルの生成
! #
! libkernel.a: $(OFFSET_H) $(KERNEL_LIB_OBJS)
! 	rm -f libkernel.a
! 	$(AR) -rcs libkernel.a $(KERNEL_LIB_OBJS)
! 	$(RANLIB) libkernel.a
! 
! #
! #  特別な依存関係の定義
! #
! banner.o: kernel_cfg.timestamp $(filter-out banner.o,$(ALL_OBJS)) $(LIBS_DEP)
! 
! #
! #  全体のリンク
! #
! $(OBJFILE): $(APPL_CFG) kernel_cfg.timestamp $(ALL_OBJS) $(LIBS_DEP) 
! 	
! 	$(LINK) $(CFLAGS) $(LDFLAGS) -o '${C_PROJECT}'/toppers_rx/$(OBJFILE) $(START_OBJS) \
! 			$(APPL_OBJS) $(SYSSVC_OBJS) $(CFG_OBJS) $(ALL_LIBS) $(END_OBJS)
! 	
! 		rm -f '${C_PROJECT}'/toppers_rx/libasp.a
! 		
! 	$(AR) -rcs '${C_PROJECT}'/toppers_rx/libasp.a $(ALL_OBJS) $(KERNEL_LIB_OBJS)
! 	$(AR) -d  '${C_PROJECT}'/toppers_rx/libasp.a dummy.o 				
! 	$(NM) -n '${C_PROJECT}'/toppers_rx/$(OBJFILE) > $(OBJNAME).syms
! 	
! 	$(OBJCOPY) -O srec -S '${C_PROJECT}'/toppers_rx/$(OBJFILE) $(OBJNAME).srec
! 	
! 	$(CFG) --pass 3 --kernel asp $(INCLUDES) \
! 				--rom-image $(OBJNAME).srec --symbol-table $(OBJNAME).syms \
! 				-T $(TARGETDIR)/target_check.tf $(CFG_TABS) $<
! 
! #
! #  バイナリファイルの生成
! #
! $(OBJNAME).bin: $(OBJFILE)
! 	$(OBJCOPY) -O binary -S '${C_PROJECT}'/toppers_rx/$(OBJFILE) $(OBJNAME).bin
! 
! #
! #  Sレコードファイルの生成
! #
! $(OBJNAME).srec: $(OBJFILE)
! 	$(OBJCOPY) -O srec -S '${C_PROJECT}'/toppers_rx/$(OBJFILE) $(OBJNAME).srec
! 
! #
! #  コンパイル結果の消去
! #
! .PHONY: clean
! clean:
! 	rm -f \#* *~ *.o ../*.o $(CLEAN_FILES)
! 	rm -f '${C_PROJECT}'/toppers_rx/$(OBJFILE) $(OBJNAME).syms $(OBJNAME).srec $(OBJNAME).bin
! 	rm -f kernel_cfg.timestamp $(CFG2_OUT_SRCS)
! 	rm -f ${C_PROJECT}'/toppers_rx/$(OBJFILE)/libasp.a
! 	rm -f cfg1_out.c $(CFG1_OUT) cfg1_out.syms cfg1_out.srec
! ifndef KERNEL_LIB
! 	rm -f libkernel.a
! endif
! 	rm -f makeoffset.s offset.h
! 
! .PHONY: cleankernel
! cleankernel:
! 	rm -rf $(KERNEL_LIB_OBJS)
! 	rm -f makeoffset.s offset.h
! 
! .PHONY: cleandep
! cleandep:
! 	if ! [ -f Makefile.depend ]; then \
! 		rm -f kernel_cfg.timestamp $(CFG2_OUT_SRCS); \
! 		rm -f cfg1_out.c cfg1_out.o $(CFG1_OUT) cfg1_out.syms cfg1_out.srec; \
! 		rm -f makeoffset.s offset.h; \
! 	fi
! 	rm -f Makefile.depend
! 
! .PHONY: realclean
! realclean: cleandep clean
! 	rm -f $(REALCLEAN_FILES)
! 
! #
! #  コンフィギュレータが生成したファイルのコンパイルルールと依存関係作成
! #  ルールの定義
! #
! #  コンフィギュレータが生成したファイルは，アプリケーションプログラム用，
! #  システムサービス用，カーネル用のすべてのオプションを付けてコンパイル
! #  する．
! #
! ALL_CFG_COBJS = $(CFG_COBJS) cfg1_out.o
! ALL_CFG_ASMOBJS = $(CFG_ASMOBJS)
! CFG_CFLAGS = $(APPL_CFLAGS) $(SYSSVC_CFLAGS) $(KERNEL_CFLAGS)
! 
! $(ALL_CFG_COBJS): %.o: %.c
! 	$(CC) -c $(CFLAGS) $(CFG_CFLAGS) $<
! 
! $(ALL_CFG_COBJS:.o=.s): %.s: %.c
! 	$(CC) -S $(CFLAGS) $(CFG_CFLAGS) $<
! 
! $(ALL_CFG_COBJS:.o=.d): %.d: %.c
! 	@$(PERL) $(SRCDIR)/utils/makedep -C $(CC) $(MAKEDEP_OPTS) \
! 		-O "$(CFLAGS) $(CFG_CFLAGS)" $< >> Makefile.depend
! 
! $(ALL_CFG_ASMOBJS): %.o: %.S
! 	$(CC) -c $(CFLAGS) $(CFG_CFLAGS) $<
! 
! $(ALL_CFG_ASMOBJS:.o=.d): %.d: %.S
! 	@$(PERL) $(SRCDIR)/utils/makedep -C $(CC) $(MAKEDEP_OPTS) \
! 		-O "$(CFLAGS) $(CFG_CFLAGS)" $< >> Makefile.depend
! 
! #
! #  特殊な依存関係作成ルールの定義
! #
! cfg1_out.depend: $(APPL_CFG)
! 	@$(CFG) -M cfg1_out.c $(INCLUDES) $< >> Makefile.depend
! 
! makeoffset.d: makeoffset.c
! 	@$(PERL) $(SRCDIR)/utils/makedep -C $(CC) $(MAKEDEP_OPTS) \
! 		-T "makeoffset.s" -O "$(CFLAGS) $(KERNEL_CFLAGS)" $< >> Makefile.depend
! 
! #
! #  依存関係ファイルの生成
! #
! .PHONY: gendepend
! gendepend:
! 	@echo "Generating Makefile.depend."
! 
! .PHONY: depend
! ifdef KERNEL_LIB
! depend: cleandep kernel_cfg.timestamp gendepend \
! 		cfg1_out.depend cfg1_out.d \
! 		$(ALL_OBJS:.o=.d)
! else
! depend: cleandep $(OFFSET_H) kernel_cfg.timestamp gendepend \
! 		cfg1_out.depend cfg1_out.d \
! 		$(KERNEL_AUX_COBJS:.o=.d) $(KERNEL_ASMOBJS:.o=.d) \
! 		$(KERNEL_COBJS:.o=.d) $(KERNEL_LCSRCS:.c=.d) $(ALL_OBJS:.o=.d)
! endif
! 
! #
! #  依存関係ファイルをインクルード
! #
! -include Makefile.depend
! 
! #
! #  開発ツールのコマンド名の定義
! #
! ifeq ($(TOOL),gcc)
!   #
!   #  GNU開発環境用
!   #
!   ifdef GCC_TARGET
!     GCC_TARGET_PREFIX = $(GCC_TARGET)-
!   else
!     GCC_TARGET_PREFIX =
!   endif
!   CC = $(GCC_TARGET_PREFIX)gcc
!   CXX = $(GCC_TARGET_PREFIX)g++
!   AS = $(GCC_TARGET_PREFIX)as
!   LD = $(GCC_TARGET_PREFIX)ld
!   AR = $(GCC_TARGET_PREFIX)ar
!   NM = $(GCC_TARGET_PREFIX)nm
!   RANLIB = $(GCC_TARGET_PREFIX)ranlib
!   OBJCOPY = $(GCC_TARGET_PREFIX)objcopy
!   OBJDUMP = $(GCC_TARGET_PREFIX)objdump
! endif
! 
! ifdef USE_CXX
!   LINK = $(CXX)
! else
!   LINK = $(CC)
! endif
! 
! #
! #  コンパイルルールの定義
! #
! KERNEL_ALL_COBJS = $(KERNEL_COBJS) $(KERNEL_AUX_COBJS)
! 
! $(KERNEL_ALL_COBJS): %.o: %.c
! 	$(CC) -c $(CFLAGS) $(KERNEL_CFLAGS) $<
! 
! $(KERNEL_ALL_COBJS:.o=.s): %.s: %.c
! 	$(CC) -S $(CFLAGS) $(KERNEL_CFLAGS) $<
! 
! $(KERNEL_LCOBJS): %.o:
! 	$(CC) -DTOPPERS_$(*F) -o $@ -c $(CFLAGS) $(KERNEL_CFLAGS) $<
! 
! $(KERNEL_LCOBJS:.o=.s): %.s:
! 	$(CC) -DTOPPERS_$(*F) -o $@ -S $(CFLAGS) $(KERNEL_CFLAGS) $<
! 
! $(KERNEL_ASMOBJS): %.o: %.S
! 	$(CC) -c $(CFLAGS) $(KERNEL_CFLAGS) $<
! 
! $(SYSSVC_COBJS): %.o: %.c
! 	$(CC) -c $(CFLAGS) $(SYSSVC_CFLAGS) $<
! 
! $(SYSSVC_COBJS:.o=.s): %.s: %.c
! 	$(CC) -S $(CFLAGS) $(SYSSVC_CFLAGS) $<
! 
! $(SYSSVC_ASMOBJS): %.o: %.S
! 	$(CC) -c $(CFLAGS) $(SYSSVC_CFLAGS) $<
! 
! $(APPL_COBJS): %.o: %.c
! 	$(CC) -c $(CFLAGS) $(APPL_CFLAGS) $<
! 
! $(APPL_COBJS:.o=.s): %.s: %.c
! 	$(CC) -S $(CFLAGS) $(APPL_CFLAGS) $<
! 
! $(APPL_CXXOBJS): %.o: %.cpp
! 	$(CXX) -c $(CFLAGS) $(APPL_CFLAGS) $<
! 
! $(APPL_CXXOBJS:.o=.s): %.s: %.cpp
! 	$(CXX) -S $(CFLAGS) $(APPL_CFLAGS) $<
! 
! $(APPL_ASMOBJS): %.o: %.S
! 	$(CC) -c $(CFLAGS) $(APPL_CFLAGS) $<
! 
! #
! #  依存関係作成ルールの定義
! #
! $(KERNEL_COBJS:.o=.d): %.d: %.c
! 	@$(PERL) $(SRCDIR)/utils/makedep -C $(CC) $(MAKEDEP_OPTS) \
! 		-O "$(CFLAGS) $(KERNEL_CFLAGS)" $< >> Makefile.depend
! 
! $(KERNEL_LCSRCS:.c=.d): %.d: %.c
! 	@$(PERL) $(SRCDIR)/utils/makedep -C $(CC) $(MAKEDEP_OPTS) -T "$($*)" \
! 		-O "-DALLFUNC $(CFLAGS) $(KERNEL_CFLAGS)" $< >> Makefile.depend
! 
! $(KERNEL_ASMOBJS:.o=.d): %.d: %.S
! 	@$(PERL) $(SRCDIR)/utils/makedep -C $(CC) $(MAKEDEP_OPTS) \
! 		-O "$(CFLAGS) $(KERNEL_CFLAGS)" $< >> Makefile.depend
! 
! $(SYSSVC_COBJS:.o=.d): %.d: %.c
! 	@$(PERL) $(SRCDIR)/utils/makedep -C $(CC) $(MAKEDEP_OPTS) \
! 		-O "$(CFLAGS) $(SYSSVC_CFLAGS)" $< >> Makefile.depend
! 
! $(SYSSVC_ASMOBJS:.o=.d): %.d: %.S
! 	@$(PERL) $(SRCDIR)/utils/makedep -C $(CC) $(MAKEDEP_OPTS) \
! 		-O "$(CFLAGS) $(SYSSVC_CFLAGS)" $< >> Makefile.depend
! 
! $(APPL_COBJS:.o=.d): %.d: %.c
! 	@$(PERL) $(SRCDIR)/utils/makedep -C $(CC) $(MAKEDEP_OPTS) \
! 		-O "$(CFLAGS) $(APPL_CFLAGS)" $< >> Makefile.depend
! 
! $(APPL_CXXOBJS:.o=.d): %.d: %.cpp
! 	@$(PERL) $(SRCDIR)/utils/makedep -C $(CXX) $(MAKEDEP_OPTS) \
! 		-O "$(CFLAGS) $(APPL_CFLAGS)" $< >> Makefile.depend
! 
! $(APPL_ASMOBJS:.o=.d): %.d: %.S
! 	@$(PERL) $(SRCDIR)/utils/makedep -C $(CC) $(MAKEDEP_OPTS) \
! 		-O "$(CFLAGS) $(APPL_CFLAGS)" $< >> Makefile.depend
! 
! #
! #  デフォルトコンパイルルールを上書き
! #
! %.o: %.c
! 	@echo "*** Default compile rules should not be used."
! 	$(CC) -c $(CFLAGS) $<
! 
! %.s: %.c
! 	@echo "*** Default compile rules should not be used."
! 	$(CC) -S $(CFLAGS) $<
! 
! %.o: %.cpp
! 	@echo "*** Default compile rules should not be used."
! 	$(CXX) -c $(CFLAGS) $<
! 
! %.s: %.cpp
! 	@echo "*** Default compile rules should not be used."
! 	$(CXX) -S $(CFLAGS) $<
! 
! %.o: %.S
! 	@echo "*** Default compile rules should not be used."
! 	$(CC) -c $(CFLAGS) $<
diff -cr --new-file asp/sample/sample1.c 1.9.1_update/sample/sample1.c
*** asp/sample/sample1.c	Fri Sep  7 17:06:21 2012
--- 1.9.1_update/sample/sample1.c	Thu Dec 15 13:53:35 2022
***************
*** 1,534 ****
! /*
!  *  TOPPERS/ASP Kernel
!  *      Toyohashi Open Platform for Embedded Real-Time Systems/
!  *      Advanced Standard Profile Kernel
!  * 
!  *  Copyright (C) 2000-2003 by Embedded and Real-Time Systems Laboratory
!  *                              Toyohashi Univ. of Technology, JAPAN
!  *  Copyright (C) 2004-2012 by Embedded and Real-Time Systems Laboratory
!  *              Graduate School of Information Science, Nagoya Univ., JAPAN
!  * 
!  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
!  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
!  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
!  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
!  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
!  *      スコード中に含まれていること．
!  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
!  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
!  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
!  *      の無保証規定を掲載すること．
!  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
!  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
!  *      と．
!  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
!  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
!  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
!  *        報告すること．
!  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
!  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
!  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
!  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
!  *      免責すること．
!  * 
!  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
!  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
!  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
!  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
!  *  の責任を負わない．
!  * 
!  *  $Id: sample1.c 2416 2012-09-07 08:06:20Z ertl-hiro $
!  */
! 
! /* 
!  *  サンプルプログラム(1)の本体
!  *
!  *  ASPカーネルの基本的な動作を確認するためのサンプルプログラム．
!  *
!  *  プログラムの概要:
!  *
!  *  ユーザインタフェースを受け持つメインタスク（タスクID: MAIN_TASK，優
!  *  先度: MAIN_PRIORITY）と，3つの並行実行されるタスク（タスクID:
!  *  TASK1〜TASK3，初期優先度: MID_PRIORITY）で構成される．また，起動周
!  *  期が2秒の周期ハンドラ（周期ハンドラID: CYCHDR1）を用いる．
!  *
!  *  並行実行されるタスクは，task_loop回空ループを実行する度に，タスクが
!  *  実行中であることをあらわすメッセージを表示する．空ループを実行する
!  *  のは，空ループなしでメッセージを出力すると，多量のメッセージが出力
!  *  され，プログラムの動作が確認しずらくなるためである．また，低速なシ
!  *  リアルポートを用いてメッセージを出力する場合に，すべてのメッセージ
!  *  が出力できるように，メッセージの量を制限するという理由もある．
!  *
!  *  周期ハンドラは，三つの優先度（HIGH_PRIORITY，MID_PRIORITY，
!  *  LOW_PRIORITY）のレディキューを回転させる．プログラムの起動直後は，
!  *  周期ハンドラは停止状態になっている．
!  *
!  *  メインタスクは，シリアルI/Oポートからの文字入力を行い（文字入力を
!  *  待っている間は，並行実行されるタスクが実行されている），入力された
!  *  文字に対応した処理を実行する．入力された文字と処理の関係は次の通り．
!  *  Control-Cまたは'Q'が入力されると，プログラムを終了する．
!  *
!  *  '1' : 対象タスクをTASK1に切り換える（初期設定）．
!  *  '2' : 対象タスクをTASK2に切り換える．
!  *  '3' : 対象タスクをTASK3に切り換える．
!  *  'a' : 対象タスクをact_tskにより起動する．
!  *  'A' : 対象タスクに対する起動要求をcan_actによりキャンセルする．
!  *  'e' : 対象タスクにext_tskを呼び出させ，終了させる．
!  *  't' : 対象タスクをter_tskにより強制終了する．
!  *  '>' : 対象タスクの優先度をHIGH_PRIORITYにする．
!  *  '=' : 対象タスクの優先度をMID_PRIORITYにする．
!  *  '<' : 対象タスクの優先度をLOW_PRIORITYにする．
!  *  'G' : 対象タスクの優先度をget_priで読み出す．
!  *  's' : 対象タスクにslp_tskを呼び出させ，起床待ちにさせる．
!  *  'S' : 対象タスクにtslp_tsk(10秒)を呼び出させ，起床待ちにさせる．
!  *  'w' : 対象タスクをwup_tskにより起床する．
!  *  'W' : 対象タスクに対する起床要求をcan_wupによりキャンセルする．
!  *  'l' : 対象タスクをrel_waiにより強制的に待ち解除にする．
!  *  'u' : 対象タスクをsus_tskにより強制待ち状態にする．
!  *  'm' : 対象タスクの強制待ち状態をrsm_tskにより解除する．
!  *  'd' : 対象タスクにdly_tsk(10秒)を呼び出させ，時間経過待ちにさせる．
!  *  'x' : 対象タスクに例外パターン0x0001の例外処理を要求する．
!  *  'X' : 対象タスクに例外パターン0x0002の例外処理を要求する．
!  *  'y' : 対象タスクにdis_texを呼び出させ，タスク例外を禁止する．
!  *  'Y' : 対象タスクにena_texを呼び出させ，タスク例外を許可する．
!  *  'r' : 3つの優先度（HIGH_PRIORITY，MID_PRIORITY，LOW_PRIORITY）のレ
!  *        ディキューを回転させる．
!  *  'c' : 周期ハンドラを動作開始させる．
!  *  'C' : 周期ハンドラを動作停止させる．
!  *  'b' : アラームハンドラを5秒後に起動するよう動作開始させる．
!  *  'B' : アラームハンドラを動作停止させる．
!  *  'z' : 対象タスクにCPU例外を発生させる（タスクを終了させる）．
!  *  'Z' : 対象タスクにCPUロック状態でCPU例外を発生させる（プログラムを
!  *        終了する）．
!  *  'V' : get_utmで性能評価用システム時刻を2回読む．
!  *  'v' : 発行したシステムコールを表示する（デフォルト）．
!  *  'q' : 発行したシステムコールを表示しない．
!  */
! 
! #include <kernel.h>
! #include <t_syslog.h>
! #include <t_stdlib.h>
! #include "syssvc/serial.h"
! #include "syssvc/syslog.h"
! #include "kernel_cfg.h"
! #include "sample1.h"
! 
! /*
!  *  サービスコールのエラーのログ出力
!  */
! Inline void
! svc_perror(const char *file, int_t line, const char *expr, ER ercd)
! {
! 	if (ercd < 0) {
! 		t_perror(LOG_ERROR, file, line, expr, ercd);
! 	}
! }
! 
! #define	SVC_PERROR(expr)	svc_perror(__FILE__, __LINE__, #expr, (expr))
! 
! /*
!  *  並行実行されるタスクへのメッセージ領域
!  */
! char	message[3];
! 
! /*
!  *  ループ回数
!  */
! ulong_t	task_loop;		/* タスク内でのループ回数 */
! ulong_t	tex_loop;		/* 例外処理ルーチン内でのループ回数 */
! 
! /*
!  *  並行実行されるタスク
!  */
! void task(intptr_t exinf)
! {
! 	volatile ulong_t	i;
! 	int_t		n = 0;
! 	int_t		tskno = (int_t) exinf;
! 	const char	*graph[] = { "|", "  +", "    *" };
! 	char		c;
! 
! 	SVC_PERROR(ena_tex());
! 	while (true) {
! 		syslog(LOG_NOTICE, "task%d is running (%03d).   %s",
! 										tskno, ++n, graph[tskno-1]);
! 		for (i = 0; i < task_loop; i++);
! 		c = message[tskno-1];
! 		message[tskno-1] = 0;
! 		switch (c) {
! 		case 'e':
! 			syslog(LOG_INFO, "#%d#ext_tsk()", tskno);
! 			SVC_PERROR(ext_tsk());
! 			assert(0);
! 		case 's':
! 			syslog(LOG_INFO, "#%d#slp_tsk()", tskno);
! 			SVC_PERROR(slp_tsk());
! 			break;
! 		case 'S':
! 			syslog(LOG_INFO, "#%d#tslp_tsk(10000)", tskno);
! 			SVC_PERROR(tslp_tsk(10000));
! 			break;
! 		case 'd':
! 			syslog(LOG_INFO, "#%d#dly_tsk(10000)", tskno);
! 			SVC_PERROR(dly_tsk(10000));
! 			break;
! 		case 'y':
! 			syslog(LOG_INFO, "#%d#dis_tex()", tskno);
! 			SVC_PERROR(dis_tex());
! 			break;
! 		case 'Y':
! 			syslog(LOG_INFO, "#%d#ena_tex()", tskno);
! 			SVC_PERROR(ena_tex());
! 			break;
! #ifdef CPUEXC1
! 		case 'z':
! 			syslog(LOG_NOTICE, "#%d#raise CPU exception", tskno);
! 			RAISE_CPU_EXCEPTION;
! 			break;
! 		case 'Z':
! 			SVC_PERROR(loc_cpu());
! 			syslog(LOG_NOTICE, "#%d#raise CPU exception", tskno);
! 			RAISE_CPU_EXCEPTION;
! 			SVC_PERROR(unl_cpu());
! 			break;
! #endif /* CPUEXC1 */
! 		default:
! 			break;
! 		}
! 	}
! }
! 
! /*
!  *  並行して実行されるタスク用のタスク例外処理ルーチン
!  */
! void tex_routine(TEXPTN texptn, intptr_t exinf)
! {
! 	volatile ulong_t	i;
! 	int_t	tskno = (int_t) exinf;
! 
! 	syslog(LOG_NOTICE, "task%d receives exception 0x%04x.", tskno, texptn);
! 	for (i = 0; i < tex_loop; i++);
! 
! 	if ((texptn & 0x8000U) != 0U) {
! 		syslog(LOG_INFO, "#%d#ext_tsk()", tskno);
! 		SVC_PERROR(ext_tsk());
! 		assert(0);
! 	}
! }
! 
! /*
!  *  CPU例外ハンドラ
!  */
! #ifdef CPUEXC1
! 
! void
! cpuexc_handler(void *p_excinf)
! {
! 	ID		tskid;
! 
! 	syslog(LOG_NOTICE, "CPU exception handler (p_excinf = %08p).", p_excinf);
! 	if (sns_ctx() != true) {
! 		syslog(LOG_WARNING,
! 					"sns_ctx() is not true in CPU exception handler.");
! 	}
! 	if (sns_dpn() != true) {
! 		syslog(LOG_WARNING,
! 					"sns_dpn() is not true in CPU exception handler.");
! 	}
! 	syslog(LOG_INFO, "sns_loc = %d sns_dsp = %d sns_tex = %d",
! 									sns_loc(), sns_dsp(), sns_tex());
! 	syslog(LOG_INFO, "xsns_dpn = %d xsns_xpn = %d",
! 									xsns_dpn(p_excinf), xsns_xpn(p_excinf));
! 
! 	if (xsns_xpn(p_excinf)) {
! 		syslog(LOG_NOTICE, "Sample program ends with exception.");
! 		SVC_PERROR(ext_ker());
! 		assert(0);
! 	}
! 
! 	SVC_PERROR(iget_tid(&tskid));
! 	SVC_PERROR(iras_tex(tskid, 0x8000U));
! }
! 
! #endif /* CPUEXC1 */
! 
! /*
!  *  周期ハンドラ
!  *
!  *  HIGH_PRIORITY，MID_PRIORITY，LOW_PRIORITY の各優先度のレディキュー
!  *  を回転させる．
!  */
! void cyclic_handler(intptr_t exinf)
! {
! 	SVC_PERROR(irot_rdq(HIGH_PRIORITY));
! 	SVC_PERROR(irot_rdq(MID_PRIORITY));
! 	SVC_PERROR(irot_rdq(LOW_PRIORITY));
! }
! 
! /*
!  *  アラームハンドラ
!  *
!  *  HIGH_PRIORITY，MID_PRIORITY，LOW_PRIORITY の各優先度のレディキュー
!  *  を回転させる．
!  */
! void alarm_handler(intptr_t exinf)
! {
! 	SVC_PERROR(irot_rdq(HIGH_PRIORITY));
! 	SVC_PERROR(irot_rdq(MID_PRIORITY));
! 	SVC_PERROR(irot_rdq(LOW_PRIORITY));
! }
! 
! /*
!  *  メインタスク
!  */
! void main_task(intptr_t exinf)
! {
! 	char	c;
! 	ID		tskid = TASK1;
! 	int_t	tskno = 1;
! 	ER_UINT	ercd;
! 	PRI		tskpri;
! #ifndef TASK_LOOP
! 	volatile ulong_t	i;
! 	SYSTIM	stime1, stime2;
! #endif /* TASK_LOOP */
! #ifdef TOPPERS_SUPPORT_GET_UTM
! 	SYSUTM	utime1, utime2;
! #endif /* TOPPERS_SUPPORT_GET_UTM */
! 
! 	SVC_PERROR(syslog_msk_log(LOG_UPTO(LOG_INFO), LOG_UPTO(LOG_EMERG)));
! 	syslog(LOG_NOTICE, "Sample program starts (exinf = %d).", (int_t) exinf);
! 
! 	/*
! 	 *  シリアルポートの初期化
! 	 *
! 	 *  システムログタスクと同じシリアルポートを使う場合など，シリアル
! 	 *  ポートがオープン済みの場合にはここでE_OBJエラーになるが，支障は
! 	 *  ない．
! 	 */
! 	ercd = serial_opn_por(TASK_PORTID);
! 	if (ercd < 0 && MERCD(ercd) != E_OBJ) {
! 		syslog(LOG_ERROR, "%s (%d) reported by `serial_opn_por'.",
! 									itron_strerror(ercd), SERCD(ercd));
! 	}
! 	SVC_PERROR(serial_ctl_por(TASK_PORTID,
! 							(IOCTL_CRLF | IOCTL_FCSND | IOCTL_FCRCV)));
! 
! 	/*
!  	 *  ループ回数の設定
! 	 *
! 	 *  並行実行されるタスク内での空ループの回数（task_loop）は，空ルー
! 	 *  プの実行時間が約0.4秒になるように設定する．この設定のために，
! 	 *  LOOP_REF回の空ループの実行時間を，その前後でget_timを呼ぶことで
! 	 *  測定し，その測定結果から空ループの実行時間が0.4秒になるループ回
! 	 *  数を求め，task_loopに設定する．
! 	 *
! 	 *  LOOP_REFは，デフォルトでは1,000,000に設定しているが，想定したよ
! 	 *  り遅いプロセッサでは，サンプルプログラムの実行開始に時間がかか
! 	 *  りすぎるという問題を生じる．逆に想定したより速いプロセッサでは，
! 	 *  LOOP_REF回の空ループの実行時間が短くなり，task_loopに設定する値
! 	 *  の誤差が大きくなるという問題がある．
! 	 *
! 	 *  そこで，そのようなターゲットでは，target_test.hで，LOOP_REFを適
! 	 *  切な値に定義するのが望ましい．
! 	 *
! 	 *  また，task_loopの値を固定したい場合には，その値をTASK_LOOPにマ
! 	 *  クロ定義する．TASK_LOOPがマクロ定義されている場合，上記の測定を
! 	 *  行わずに，TASK_LOOPに定義された値を空ループの回数とする．
! 	 *
! 	 * ターゲットによっては，空ループの実行時間の1回目の測定で，本来よ
! 	 * りも長めになるものがある．このようなターゲットでは，MEASURE_TWICE
! 	 * をマクロ定義することで，1回目の測定結果を捨てて，2回目の測定結果
! 	 * を使う．
! 	 *
! 	 *  タスク例外処理ルーチン内での空ループの回数（tex_loop）は，
! 	 *  task_loopの4分の1の値（空ループの実行時間が0.1秒になるループ回
! 	 *  数）に設定する．
! 	 */
! #ifdef TASK_LOOP
! 	task_loop = TASK_LOOP;
! #else /* TASK_LOOP */
! 
! #ifdef MEASURE_TWICE
! 	task_loop = LOOP_REF;
! 	SVC_PERROR(get_tim(&stime1));
! 	for (i = 0; i < task_loop; i++);
! 	SVC_PERROR(get_tim(&stime2));
! #endif /* MEASURE_TWICE */
! 
! 	task_loop = LOOP_REF;
! 	SVC_PERROR(get_tim(&stime1));
! 	for (i = 0; i < task_loop; i++);
! 	SVC_PERROR(get_tim(&stime2));
! 	task_loop = LOOP_REF * 400UL / (stime2 - stime1);
! 
! #endif /* TASK_LOOP */
! 	tex_loop = task_loop / 4;
! 
! 	/*
!  	 *  タスクの起動
! 	 */
! 	SVC_PERROR(act_tsk(TASK1));
! 	SVC_PERROR(act_tsk(TASK2));
! 	SVC_PERROR(act_tsk(TASK3));
! 
! 	/*
!  	 *  メインループ
! 	 */
! 	do {
! 		SVC_PERROR(serial_rea_dat(TASK_PORTID, &c, 1));
! 		switch (c) {
! 		case 'e':
! 		case 's':
! 		case 'S':
! 		case 'd':
! 		case 'y':
! 		case 'Y':
! 		case 'z':
! 		case 'Z':
! 			message[tskno-1] = c;
! 			break;
! 		case '1':
! 			tskno = 1;
! 			tskid = TASK1;
! 			break;
! 		case '2':
! 			tskno = 2;
! 			tskid = TASK2;
! 			break;
! 		case '3':
! 			tskno = 3;
! 			tskid = TASK3;
! 			break;
! 		case 'a':
! 			syslog(LOG_INFO, "#act_tsk(%d)", tskno);
! 			SVC_PERROR(act_tsk(tskid));
! 			break;
! 		case 'A':
! 			syslog(LOG_INFO, "#can_act(%d)", tskno);
! 			SVC_PERROR(ercd = can_act(tskid));
! 			if (ercd >= 0) {
! 				syslog(LOG_NOTICE, "can_act(%d) returns %d", tskno, ercd);
! 			}
! 			break;
! 		case 't':
! 			syslog(LOG_INFO, "#ter_tsk(%d)", tskno);
! 			SVC_PERROR(ter_tsk(tskid));
! 			break;
! 		case '>':
! 			syslog(LOG_INFO, "#chg_pri(%d, HIGH_PRIORITY)", tskno);
! 			SVC_PERROR(chg_pri(tskid, HIGH_PRIORITY));
! 			break;
! 		case '=':
! 			syslog(LOG_INFO, "#chg_pri(%d, MID_PRIORITY)", tskno);
! 			SVC_PERROR(chg_pri(tskid, MID_PRIORITY));
! 			break;
! 		case '<':
! 			syslog(LOG_INFO, "#chg_pri(%d, LOW_PRIORITY)", tskno);
! 			SVC_PERROR(chg_pri(tskid, LOW_PRIORITY));
! 			break;
! 		case 'G':
! 			syslog(LOG_INFO, "#get_pri(%d, &tskpri)", tskno);
! 			SVC_PERROR(ercd = get_pri(tskid, &tskpri));
! 			if (ercd >= 0) {
! 				syslog(LOG_NOTICE, "priority of task %d is %d", tskno, tskpri);
! 			}
! 			break;
! 		case 'w':
! 			syslog(LOG_INFO, "#wup_tsk(%d)", tskno);
! 			SVC_PERROR(wup_tsk(tskid));
! 			break;
! 		case 'W':
! 			syslog(LOG_INFO, "#can_wup(%d)", tskno);
! 			SVC_PERROR(ercd = can_wup(tskid));
! 			if (ercd >= 0) {
! 				syslog(LOG_NOTICE, "can_wup(%d) returns %d", tskno, ercd);
! 			}
! 			break;
! 		case 'l':
! 			syslog(LOG_INFO, "#rel_wai(%d)", tskno);
! 			SVC_PERROR(rel_wai(tskid));
! 			break;
! 		case 'u':
! 			syslog(LOG_INFO, "#sus_tsk(%d)", tskno);
! 			SVC_PERROR(sus_tsk(tskid));
! 			break;
! 		case 'm':
! 			syslog(LOG_INFO, "#rsm_tsk(%d)", tskno);
! 			SVC_PERROR(rsm_tsk(tskid));
! 			break;
! 		case 'x':
! 			syslog(LOG_INFO, "#ras_tex(%d, 0x0001U)", tskno);
! 			SVC_PERROR(ras_tex(tskid, 0x0001U));
! 			break;
! 		case 'X':
! 			syslog(LOG_INFO, "#ras_tex(%d, 0x0002U)", tskno);
! 			SVC_PERROR(ras_tex(tskid, 0x0002U));
! 			break;
! 		case 'r':
! 			syslog(LOG_INFO, "#rot_rdq(three priorities)");
! 			SVC_PERROR(rot_rdq(HIGH_PRIORITY));
! 			SVC_PERROR(rot_rdq(MID_PRIORITY));
! 			SVC_PERROR(rot_rdq(LOW_PRIORITY));
! 			break;
! 		case 'c':
! 			syslog(LOG_INFO, "#sta_cyc(1)");
! 			SVC_PERROR(sta_cyc(CYCHDR1));
! 			break;
! 		case 'C':
! 			syslog(LOG_INFO, "#stp_cyc(1)");
! 			SVC_PERROR(stp_cyc(CYCHDR1));
! 			break;
! 		case 'b':
! 			syslog(LOG_INFO, "#sta_alm(1, 5000)");
! 			SVC_PERROR(sta_alm(ALMHDR1, 5000));
! 			break;
! 		case 'B':
! 			syslog(LOG_INFO, "#stp_alm(1)");
! 			SVC_PERROR(stp_alm(ALMHDR1));
! 			break;
! 
! 		case 'V':
! #ifdef TOPPERS_SUPPORT_GET_UTM
! 			SVC_PERROR(get_utm(&utime1));
! 			SVC_PERROR(get_utm(&utime2));
! 			syslog(LOG_NOTICE, "utime1 = %ld, utime2 = %ld",
! 										(ulong_t) utime1, (ulong_t) utime2);
! #else /* TOPPERS_SUPPORT_GET_UTM */
! 			syslog(LOG_NOTICE, "get_utm is not supported.");
! #endif /* TOPPERS_SUPPORT_GET_UTM */
! 			break;
! 
! 		case 'v':
! 			SVC_PERROR(syslog_msk_log(LOG_UPTO(LOG_INFO),
! 										LOG_UPTO(LOG_EMERG)));
! 			break;
! 		case 'q':
! 			SVC_PERROR(syslog_msk_log(LOG_UPTO(LOG_NOTICE),
! 										LOG_UPTO(LOG_EMERG)));
! 			break;
! 
! #ifdef BIT_KERNEL
! 		case ' ':
! 			SVC_PERROR(loc_cpu());
! 			{
! 				extern ER	bit_kernel(void);
! 
! 				SVC_PERROR(ercd = bit_kernel());
! 				if (ercd >= 0) {
! 					syslog(LOG_NOTICE, "bit_kernel passed.");
! 				}
! 			}
! 			SVC_PERROR(unl_cpu());
! 			break;
! #endif /* BIT_KERNEL */
! 
! 		default:
! 			break;
! 		}
! 	} while (c != '\003' && c != 'Q');
! 
! 	syslog(LOG_NOTICE, "Sample program ends.");
! 	SVC_PERROR(ext_ker());
! 	assert(0);
! }
--- 1,348 ----
! /*
!  *  TOPPERS/ASP Kernel
!  *      Toyohashi Open Platform for Embedded Real-Time Systems/
!  *      Advanced Standard Profile Kernel
!  * 
!  *  Copyright (C) 2000-2003 by Embedded and Real-Time Systems Laboratory
!  *                              Toyohashi Univ. of Technology, JAPAN
!  *  Copyright (C) 2004-2012 by Embedded and Real-Time Systems Laboratory
!  *              Graduate School of Information Science, Nagoya Univ., JAPAN
!  * 
!  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
!  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
!  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
!  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
!  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
!  *      スコード中に含まれていること．
!  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
!  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
!  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
!  *      の無保証規定を掲載すること．
!  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
!  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
!  *      と．
!  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
!  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
!  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
!  *        報告すること．
!  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
!  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
!  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
!  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
!  *      免責すること．
!  * 
!  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
!  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
!  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
!  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
!  *  の責任を負わない．
!  * 
!  *  $Id: sample1.c 2416 2012-09-07 08:06:20Z ertl-hiro $
!  */
! 
! /* 
!  *  サンプルプログラム(1)の本体
!  *
!  *  ASPカーネルの基本的な動作を確認するためのサンプルプログラム．
!  *
!  *  プログラムの概要:
!  *
!  *  ユーザインタフェースを受け持つメインタスク（タスクID: MAIN_TASK，優
!  *  先度: MAIN_PRIORITY）と，3つの並行実行されるタスク（タスクID:
!  *  TASK1?TASK3，初期優先度: MID_PRIORITY）で構成される．また，起動周
!  *  期が2秒の周期ハンドラ（周期ハンドラID: CYCHDR1）を用いる．
!  *
!  *  並行実行されるタスクは，task_loop回空ループを実行する度に，タスクが
!  *  実行中であることをあらわすメッセージを表示する．空ループを実行する
!  *  のは，空ループなしでメッセージを出力すると，多量のメッセージが出力
!  *  され，プログラムの動作が確認しずらくなるためである．また，低速なシ
!  *  リアルポートを用いてメッセージを出力する場合に，すべてのメッセージ
!  *  が出力できるように，メッセージの量を制限するという理由もある．
!  *
!  *  周期ハンドラは，三つの優先度（HIGH_PRIORITY，MID_PRIORITY，
!  *  LOW_PRIORITY）のレディキューを回転させる．プログラムの起動直後は，
!  *  周期ハンドラは停止状態になっている．
!  *
!  *  メインタスクは，シリアルI/Oポートからの文字入力を行い（文字入力を
!  *  待っている間は，並行実行されるタスクが実行されている），入力された
!  *  文字に対応した処理を実行する．入力された文字と処理の関係は次の通り．
!  *  Control-Cまたは'Q'が入力されると，プログラムを終了する．
!  *
!  *  '1' : 対象タスクをTASK1に切り換える（初期設定）．
!  *  '2' : 対象タスクをTASK2に切り換える．
!  *  '3' : 対象タスクをTASK3に切り換える．
!  *  'a' : 対象タスクをact_tskにより起動する．
!  *  'A' : 対象タスクに対する起動要求をcan_actによりキャンセルする．
!  *  'e' : 対象タスクにext_tskを呼び出させ，終了させる．
!  *  't' : 対象タスクをter_tskにより強制終了する．
!  *  '>' : 対象タスクの優先度をHIGH_PRIORITYにする．
!  *  '=' : 対象タスクの優先度をMID_PRIORITYにする．
!  *  '<' : 対象タスクの優先度をLOW_PRIORITYにする．
!  *  'G' : 対象タスクの優先度をget_priで読み出す．
!  *  's' : 対象タスクにslp_tskを呼び出させ，起床待ちにさせる．
!  *  'S' : 対象タスクにtslp_tsk(10秒)を呼び出させ，起床待ちにさせる．
!  *  'w' : 対象タスクをwup_tskにより起床する．
!  *  'W' : 対象タスクに対する起床要求をcan_wupによりキャンセルする．
!  *  'l' : 対象タスクをrel_waiにより強制的に待ち解除にする．
!  *  'u' : 対象タスクをsus_tskにより強制待ち状態にする．
!  *  'm' : 対象タスクの強制待ち状態をrsm_tskにより解除する．
!  *  'd' : 対象タスクにdly_tsk(10秒)を呼び出させ，時間経過待ちにさせる．
!  *  'x' : 対象タスクに例外パターン0x0001の例外処理を要求する．
!  *  'X' : 対象タスクに例外パターン0x0002の例外処理を要求する．
!  *  'y' : 対象タスクにdis_texを呼び出させ，タスク例外を禁止する．
!  *  'Y' : 対象タスクにena_texを呼び出させ，タスク例外を許可する．
!  *  'r' : 3つの優先度（HIGH_PRIORITY，MID_PRIORITY，LOW_PRIORITY）のレ
!  *        ディキューを回転させる．
!  *  'c' : 周期ハンドラを動作開始させる．
!  *  'C' : 周期ハンドラを動作停止させる．
!  *  'b' : アラームハンドラを5秒後に起動するよう動作開始させる．
!  *  'B' : アラームハンドラを動作停止させる．
!  *  'z' : 対象タスクにCPU例外を発生させる（タスクを終了させる）．
!  *  'Z' : 対象タスクにCPUロック状態でCPU例外を発生させる（プログラムを
!  *        終了する）．
!  *  'V' : get_utmで性能評価用システム時刻を2回読む．
!  *  'v' : 発行したシステムコールを表示する（デフォルト）．
!  *  'q' : 発行したシステムコールを表示しない．
!  */
! 
! #include <kernel.h>
! #include <t_syslog.h>
! #include <t_stdlib.h>
! #include "syssvc/serial.h"
! #include "syssvc/syslog.h"
! #include "kernel_cfg.h"
! #include "sample1.h"
! 
! /*
!  *  サービスコールのエラーのログ出力
!  */
! Inline void
! svc_perror(const char *file, int_t line, const char *expr, ER ercd)
! {
! 	if (ercd < 0) {
! 		t_perror(LOG_ERROR, file, line, expr, ercd);
! 	}
! }
! 
! #define	SVC_PERROR(expr)	svc_perror(__FILE__, __LINE__, #expr, (expr))
! 
! /*
!  *  並行実行されるタスクへのメッセージ領域
!  */
! char	message[3];
! 
! /*
!  *  ループ回数
!  */
! ulong_t	task_loop;		/* タスク内でのループ回数 */
! ulong_t	tex_loop;		/* 例外処理ルーチン内でのループ回数 */
! //Wrapper
! void waisem_ether_wrapper() {
! 	wai_sem(ETHER_START_SEM);
! 
! }
! void sigsem_ether_wrapper() {
! 	sig_sem(ETHER_START_SEM);
! }
! 
! /*
!  *  並行実行されるタスク
!  */
! void task(intptr_t exinf)
! {
! 
! 	volatile ulong_t	i;
! 	int_t		n = 0;
! 	int_t		tskno = (int_t) exinf;
! 	const char	*graph[] = { "|", "  +", "    *" };
! 	char		c;
! 	SVC_PERROR(ena_tex());
! 
! 	while (true) {
! 		tslp_tsk(500);
! 		syslog(LOG_NOTICE, "task%d is running (%03d).   %s",
! 					tskno, ++n, graph[tskno-1]);
! 
! 	}
! }
! 
! /*
!  *  並行して実行されるタスク用のタスク例外処理ルーチン
!  */
! void tex_routine(TEXPTN texptn, intptr_t exinf)
! {
! 	volatile ulong_t	i;
! 	int_t	tskno = (int_t) exinf;
! 
! 	syslog(LOG_NOTICE, "task%d receives exception 0x%04x.", tskno, texptn);
! //	for (i = 0; i < tex_loop; i++);
! 
! 	if ((texptn & 0x8000U) != 0U) {
! 		syslog(LOG_INFO, "#%d#ext_tsk()", tskno);
! 		SVC_PERROR(ext_tsk());
! 		assert(0);
! 	}
! }
! 
! /*
!  *  CPU例外ハンドラ
!  */
! #ifdef CPUEXC1
! 
! void
! cpuexc_handler(void *p_excinf)
! {
! 	ID		tskid;
! 
! 	syslog(LOG_NOTICE, "CPU exception handler (p_excinf = %08p).", p_excinf);
! 	if (sns_ctx() != true) {
! 		syslog(LOG_WARNING,
! 					"sns_ctx() is not true in CPU exception handler.");
! 	}
! 	if (sns_dpn() != true) {
! 		syslog(LOG_WARNING,
! 					"sns_dpn() is not true in CPU exception handler.");
! 	}
! 	syslog(LOG_INFO, "sns_loc = %d sns_dsp = %d sns_tex = %d",
! 									sns_loc(), sns_dsp(), sns_tex());
! 	syslog(LOG_INFO, "xsns_dpn = %d xsns_xpn = %d",
! 									xsns_dpn(p_excinf), xsns_xpn(p_excinf));
! 
! 	if (xsns_xpn(p_excinf)) {
! 		syslog(LOG_NOTICE, "Sample program ends with exception.");
! 		SVC_PERROR(ext_ker());
! 		assert(0);
! 	}
! 
! 	SVC_PERROR(iget_tid(&tskid));
! 	SVC_PERROR(iras_tex(tskid, 0x8000U));
! }
! 
! #endif /* CPUEXC1 */
! 
! /*
!  *  周期ハンドラ
!  *
!  *  HIGH_PRIORITY，MID_PRIORITY，LOW_PRIORITY の各優先度のレディキュー
!  *  を回転させる．
!  */
! void cyclic_handler(intptr_t exinf)
! {
! 	SVC_PERROR(irot_rdq(HIGH_PRIORITY));
! 	SVC_PERROR(irot_rdq(MID_PRIORITY));
! 	SVC_PERROR(irot_rdq(LOW_PRIORITY));
! }
! 
! /*
!  *  アラームハンドラ
!  *
!  *  HIGH_PRIORITY，MID_PRIORITY，LOW_PRIORITY の各優先度のレディキュー
!  *  を回転させる．
!  */
! void alarm_handler(intptr_t exinf)
! {
! 	SVC_PERROR(irot_rdq(HIGH_PRIORITY));
! 	SVC_PERROR(irot_rdq(MID_PRIORITY));
! 	SVC_PERROR(irot_rdq(LOW_PRIORITY));
! }
! 
! /*
!  *  メインタスク
!  */
! void main_task(intptr_t exinf)
! {
! 	char	c;
! 	ID		tskid = TASK1;
! 	int_t	tskno = 1;
! 	ER_UINT	ercd;
! 	PRI		tskpri;
! #ifndef TASK_LOOP
! 	volatile ulong_t	i;
! 	SYSTIM	stime1, stime2;
! #endif /* TASK_LOOP */
! #ifdef TOPPERS_SUPPORT_GET_UTM
! 	SYSUTM	utime1, utime2;
! #endif /* TOPPERS_SUPPORT_GET_UTM */
! 
! 	SVC_PERROR(syslog_msk_log(LOG_UPTO(LOG_INFO), LOG_UPTO(LOG_EMERG)));
! 	syslog(LOG_NOTICE, "Sample program starts (exinf = %d).", (int_t) exinf);
! 
! 	/*
! 	 *  シリアルポートの初期化
! 	 *
! 	 *  システムログタスクと同じシリアルポートを使う場合など，シリアル
! 	 *  ポートがオープン済みの場合にはここでE_OBJエラーになるが，支障は
! 	 *  ない．
! 	 */
! 
! 	/*
!  	 *  ループ回数の設定
! 	 *
! 	 *  並行実行されるタスク内での空ループの回数（task_loop）は，空ルー
! 	 *  プの実行時間が約0.4秒になるように設定する．この設定のために，
! 	 *  LOOP_REF回の空ループの実行時間を，その前後でget_timを呼ぶことで
! 	 *  測定し，その測定結果から空ループの実行時間が0.4秒になるループ回
! 	 *  数を求め，task_loopに設定する．
! 	 *
! 	 *  LOOP_REFは，デフォルトでは1,000,000に設定しているが，想定したよ
! 	 *  り遅いプロセッサでは，サンプルプログラムの実行開始に時間がかか
! 	 *  りすぎるという問題を生じる．逆に想定したより速いプロセッサでは，
! 	 *  LOOP_REF回の空ループの実行時間が短くなり，task_loopに設定する値
! 	 *  の誤差が大きくなるという問題がある．
! 	 *
! 	 *  そこで，そのようなターゲットでは，target_test.hで，LOOP_REFを適
! 	 *  切な値に定義するのが望ましい．
! 	 *
! 	 *  また，task_loopの値を固定したい場合には，その値をTASK_LOOPにマ
! 	 *  クロ定義する．TASK_LOOPがマクロ定義されている場合，上記の測定を
! 	 *  行わずに，TASK_LOOPに定義された値を空ループの回数とする．
! 	 *
! 	 * ターゲットによっては，空ループの実行時間の1回目の測定で，本来よ
! 	 * りも長めになるものがある．このようなターゲットでは，MEASURE_TWICE
! 	 * をマクロ定義することで，1回目の測定結果を捨てて，2回目の測定結果
! 	 * を使う．
! 	 *
! 	 *  タスク例外処理ルーチン内での空ループの回数（tex_loop）は，
! 	 *  task_loopの4分の1の値（空ループの実行時間が0.1秒になるループ回
! 	 *  数）に設定する．
! 	 */
! #ifdef TASK_LOOP
! 	task_loop = TASK_LOOP;
! #else /* TASK_LOOP */
! 
! #ifdef MEASURE_TWICE
! 	task_loop = LOOP_REF;
! 	SVC_PERROR(get_tim(&stime1));
! 	for (i = 0; i < task_loop; i++);
! 	SVC_PERROR(get_tim(&stime2));
! #endif /* MEASURE_TWICE */
! 
! 	task_loop = LOOP_REF;
! 	SVC_PERROR(get_tim(&stime1));
! 	for (i = 0; i < task_loop; i++);
! 	SVC_PERROR(get_tim(&stime2));
! 	task_loop = LOOP_REF * 400UL / (stime2 - stime1);
! 
! #endif /* TASK_LOOP */
! 	tex_loop = task_loop / 4;
! 
! 	/*
!  	 *  タスクの起動
! 	 */
! 	SVC_PERROR(act_tsk(TASK1));
! 	SVC_PERROR(act_tsk(TASK2));
! 	SVC_PERROR(act_tsk(TASK3));
! 	SVC_PERROR(act_tsk(TASK4));
! 
! 	/*
!  	 *  メインループ
! 	 */
! 	do {
! 		slp_tsk();
! 
! 	} while (1);
! 
! 	syslog(LOG_NOTICE, "Sample program ends.");
! 	SVC_PERROR(ext_ker());
! 	assert(0);
! }
diff -cr --new-file asp/sample/sample1.cfg 1.9.1_update/sample/sample1.cfg
*** asp/sample/sample1.cfg	Fri Sep  7 17:06:21 2012
--- 1.9.1_update/sample/sample1.cfg	Thu Dec 15 13:49:12 2022
***************
*** 1,26 ****
! /*
!  *  $Id: sample1.cfg 2416 2012-09-07 08:06:20Z ertl-hiro $
!  */
! 
! /*
!  *  サンプルプログラム(1)のシステムコンフィギュレーションファイル
!  */
! INCLUDE("target_timer.cfg");
! INCLUDE("syssvc/syslog.cfg");
! INCLUDE("syssvc/banner.cfg");
! INCLUDE("syssvc/serial.cfg");
! INCLUDE("syssvc/logtask.cfg");
! 
! #include "sample1.h"
! CRE_TSK(TASK1, { TA_NULL, 1, task, MID_PRIORITY, STACK_SIZE, NULL });
! CRE_TSK(TASK2, { TA_NULL, 2, task, MID_PRIORITY, STACK_SIZE, NULL });
! CRE_TSK(TASK3, { TA_NULL, 3, task, MID_PRIORITY, STACK_SIZE, NULL });
! CRE_TSK(MAIN_TASK, { TA_ACT, 0, main_task, MAIN_PRIORITY, STACK_SIZE, NULL });
! DEF_TEX(TASK1, { TA_NULL, tex_routine });
! DEF_TEX(TASK2, { TA_NULL, tex_routine });
! DEF_TEX(TASK3, { TA_NULL, tex_routine });
! CRE_CYC(CYCHDR1, { TA_NULL, 0, cyclic_handler, 2000, 0 });
! CRE_ALM(ALMHDR1, { TA_NULL, 0, alarm_handler });
! #ifdef CPUEXC1
! DEF_EXC(CPUEXC1, { TA_NULL, cpuexc_handler });
! #endif /* CPUEXC1 */
--- 1,31 ----
! /*
!  *  $Id: sample1.cfg 2416 2012-09-07 08:06:20Z ertl-hiro $
!  */
! 
! /*
!  *  サンプルプログラム(1)のシステムコンフィギュレーションファイル
!  */
! INCLUDE("target_timer.cfg");
! INCLUDE("target_edmac.cfg");
! INCLUDE("syssvc/syslog.cfg");
! INCLUDE("syssvc/banner.cfg");
! INCLUDE("syssvc/logtask.cfg");
! 
! #include "sample1.h"
! CRE_TSK(TASK1, { TA_NULL, 1, task, MID_PRIORITY, STACK_SIZE, NULL });
! CRE_TSK(TASK2, { TA_NULL, 2, taskEther, MID_PRIORITY, NET_STACK_SIZE , NULL });
! CRE_TSK(TASK3, { TA_NULL, 3, taskDemoWolf, MID_PRIORITY, NET_STACK_SIZE, NULL });
! CRE_TSK(TASK4, { TA_NULL, 4, taskNetWork, MID_PRIORITY, NET_STACK_SIZE, NULL });
! 
! CRE_TSK(MAIN_TASK, { TA_ACT, 0, main_task, MAIN_PRIORITY, STACK_SIZE, NULL });
! DEF_TEX(TASK1, { TA_NULL, tex_routine });
! DEF_TEX(TASK2, { TA_NULL, tex_routine });
! DEF_TEX(TASK3, { TA_NULL, tex_routine });
! DEF_TEX(TASK4, { TA_NULL, tex_routine });
! 
! CRE_CYC(CYCHDR1, { TA_NULL, 0, cyclic_handler, 2000, 0 });
! CRE_ALM(ALMHDR1, { TA_NULL, 0, alarm_handler });
! #ifdef CPUEXC1
! DEF_EXC(CPUEXC1, { TA_NULL, cpuexc_handler });
! 
! #endif /* CPUEXC1 */
diff -cr --new-file asp/sample/sample1.h 1.9.1_update/sample/sample1.h
*** asp/sample/sample1.h	Sun Nov 11 16:14:24 2012
--- 1.9.1_update/sample/sample1.h	Thu Dec 15 13:53:35 2022
***************
*** 1,93 ****
! /*
!  *  TOPPERS/ASP Kernel
!  *      Toyohashi Open Platform for Embedded Real-Time Systems/
!  *      Advanced Standard Profile Kernel
!  *
!  *  Copyright (C) 2000-2003 by Embedded and Real-Time Systems Laboratory
!  *                              Toyohashi Univ. of Technology, JAPAN
!  *  Copyright (C) 2004-2010 by Embedded and Real-Time Systems Laboratory
!  *              Graduate School of Information Science, Nagoya Univ., JAPAN
!  *
!  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
!  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
!  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
!  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
!  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
!  *      スコード中に含まれていること．
!  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
!  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
!  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
!  *      の無保証規定を掲載すること．
!  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
!  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
!  *      と．
!  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
!  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
!  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
!  *        報告すること．
!  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
!  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
!  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
!  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
!  *      免責すること．
!  * 
!  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
!  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
!  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
!  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
!  *  の責任を負わない．
!  *
!  *  $Id: sample1.h 2416 2012-09-07 08:06:20Z ertl-hiro $
!  */
! 
! /*
!  *		サンプルプログラム(1)のヘッダファイル
!  */
! 
! /*
!  *  ターゲット依存の定義
!  */
! #include "target_test.h"
! 
! /*
!  *  各タスクの優先度の定義
!  */
! 
! #define MAIN_PRIORITY	5		/* メインタスクの優先度 */
! 								/* HIGH_PRIORITYより高くすること */
! 
! #define HIGH_PRIORITY	9		/* 並行実行されるタスクの優先度 */
! #define MID_PRIORITY	10
! #define LOW_PRIORITY	11
! 
! /*
!  *  ターゲットに依存する可能性のある定数の定義
!  */
! 
! #ifndef TASK_PORTID
! #define	TASK_PORTID		1			/* 文字入力するシリアルポートID */
! #endif /* TASK_PORTID */
! 
! #ifndef STACK_SIZE
! #define	STACK_SIZE		4096		/* タスクのスタックサイズ */
! #endif /* STACK_SIZE */
! 
! #ifndef LOOP_REF
! #define LOOP_REF		ULONG_C(1000000)	/* 速度計測用のループ回数 */
! #endif /* LOOP_REF */
! 
! /*
!  *  関数のプロトタイプ宣言
!  */
! #ifndef TOPPERS_MACRO_ONLY
! 
! extern void	task(intptr_t exinf);
! extern void	main_task(intptr_t exinf);
! extern void	tex_routine(TEXPTN texptn, intptr_t exinf);
! #ifdef CPUEXC1
! extern void	cpuexc_handler(void *p_excinf);
! #endif /* CPUEXC1 */
! extern void	cyclic_handler(intptr_t exinf);
! extern void	alarm_handler(intptr_t exinf);
! 
! #endif /* TOPPERS_MACRO_ONLY */
--- 1,101 ----
! /*
!  *  TOPPERS/ASP Kernel
!  *      Toyohashi Open Platform for Embedded Real-Time Systems/
!  *      Advanced Standard Profile Kernel
!  *
!  *  Copyright (C) 2000-2003 by Embedded and Real-Time Systems Laboratory
!  *                              Toyohashi Univ. of Technology, JAPAN
!  *  Copyright (C) 2004-2010 by Embedded and Real-Time Systems Laboratory
!  *              Graduate School of Information Science, Nagoya Univ., JAPAN
!  *
!  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
!  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
!  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
!  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
!  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
!  *      スコード中に含まれていること．
!  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
!  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
!  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
!  *      の無保証規定を掲載すること．
!  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
!  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
!  *      と．
!  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
!  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
!  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
!  *        報告すること．
!  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
!  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
!  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
!  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
!  *      免責すること．
!  * 
!  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
!  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
!  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
!  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
!  *  の責任を負わない．
!  *
!  *  $Id: sample1.h 2416 2012-09-07 08:06:20Z ertl-hiro $
!  */
! 
! /*
!  *		サンプルプログラム(1)のヘッダファイル
!  */
! 
! /*
!  *  ターゲット依存の定義
!  */
! #include "target_test.h"
! 
! /*
!  *  各タスクの優先度の定義
!  */
! 
! #define MAIN_PRIORITY	5		/* メインタスクの優先度 */
! 								/* HIGH_PRIORITYより高くすること */
! 
! #define HIGH_PRIORITY	9		/* 並行実行されるタスクの優先度 */
! #define MID_PRIORITY	10
! #define LOW_PRIORITY	11
! 
! /*
!  *  ターゲットに依存する可能性のある定数の定義
!  */
! 
! #ifndef TASK_PORTID
! #define	TASK_PORTID		1			/* 文字入力するシリアルポートID */
! #endif /* TASK_PORTID */
! 
! #ifndef STACK_SIZE
! #define	STACK_SIZE		(4096 * 4)		/* タスクのスタックサイズ */
! #endif /* STACK_SIZE */
! #ifndef NET_STACK_SIZE
! #define	NET_STACK_SIZE		(1024 * 24) 		/* タスクのスタックサイズ */
! #endif /* STACK_SIZE */
! 
! #ifndef LOOP_REF
! #define LOOP_REF		ULONG_C(1000000)	/* 速度計測用のループ回数 */
! #endif /* LOOP_REF */
! 
! /*
!  *  関数のプロトタイプ宣言
!  */
! #ifndef TOPPERS_MACRO_ONLY
! 
! extern void	task(intptr_t exinf);
! extern void	taskEther(intptr_t exinf);
! extern void	taskDemoWolf(intptr_t exinf);
! extern void	taskNetWork(intptr_t exinf);
! 
! extern void	main_task(intptr_t exinf);
! 
! extern void	tex_routine(TEXPTN texptn, intptr_t exinf);
! #ifdef CPUEXC1
! extern void	cpuexc_handler(void *p_excinf);
! #endif /* CPUEXC1 */
! extern void	cyclic_handler(intptr_t exinf);
! extern void	alarm_handler(intptr_t exinf);
! 
! #endif /* TOPPERS_MACRO_ONLY */
diff -cr --new-file asp/syssvc/logtask.c 1.9.1_update/syssvc/logtask.c
*** asp/syssvc/logtask.c	Sat Aug 27 07:39:16 2011
--- 1.9.1_update/syssvc/logtask.c	Thu Dec 15 16:58:29 2022
***************
*** 8,47 ****
   *  Copyright (C) 2005-2011 by Embedded and Real-Time Systems Laboratory
   *              Graduate School of Information Science, Nagoya Univ., JAPAN
   * 
!  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
!  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
!  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
!  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
!  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
!  *      スコード中に含まれていること．
!  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
!  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
!  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
!  *      の無保証規定を掲載すること．
!  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
!  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
!  *      と．
!  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
!  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
!  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
!  *        報告すること．
!  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
!  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
!  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
!  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
!  *      免責すること．
   * 
!  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
!  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
!  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
!  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
!  *  の責任を負わない．
   * 
   *  @(#) $Id: logtask.c 2246 2011-08-26 22:39:15Z ertl-hiro $
   */
  
  /*
!  *		システムログタスク
   */
  
  #include <kernel.h>
--- 8,47 ----
   *  Copyright (C) 2005-2011 by Embedded and Real-Time Systems Laboratory
   *              Graduate School of Information Science, Nagoya Univ., JAPAN
   * 
!  *  鐃遵記鐃緒申鐃庶権鐃峻は￥申鐃淑駕申鐃緒申(1)鐃緒申(4)鐃塾常申鐃緒申鐃緒申鐃緒申鐃緒申鐃緒申鐃祝限り，鐃旬ワ申鐃春トワ申鐃緒申
!  *  鐃緒申鐃緒申鐃旬ワ申鐃春トワ申鐃緒申鐃緒申鐃緒申鐃緒申僂鐃緒申鐃緒申鐃塾わ申泙燹ワ申焚鐃銃縁申鐃緒申砲鐃緒申鐃術￥申複鐃緒申鐃緒申鐃緒申
!  *  鐃術￥申鐃緒申鐃緒申鐃循（以駕申鐃緒申鐃緒申鐃術と呼ぶ）わ申鐃暑こ鐃夙わ申無鐃緒申鐃叔居申鐃緒申鐃緒申鐃暑．
!  *  (1) 鐃旬ワ申鐃春トワ申鐃緒申鐃緒申鐃薯ソ￥申鐃緒申鐃緒申鐃緒申鐃宿の件申鐃緒申鐃緒申鐃術わ申鐃緒申鐃緒申砲蓮鐃緒申綉鐃緒申鐃緒申鐃緒申
!  *      鐃緒申表鐃緒申鐃緒申鐃緒申鐃緒申鐃緒申鐃術常申錣鐃緒申啣鐃緒申鐃緒申鐃縮居申歉攀鐃緒申蠅鐃緒申鐃緒申鐃塾ままの件申鐃叔ワ申鐃緒申
!  *      鐃緒申鐃緒申鐃緒申鐃緒申鐃緒申亡泙泙鐃銃わ申鐃暑こ鐃夙￥申
!  *  (2) 鐃旬ワ申鐃春トワ申鐃緒申鐃緒申鐃薯，ライ鐃瞬ワ申鐃緒申鐃緒申鐃淑ど￥申他鐃塾ワ申鐃春トワ申鐃緒申鐃緒申鐃緒申発鐃祝誌申
!  *      鐃術でわ申鐃緒申鐃緒申悩鐃緒申鐃緒申曚鐃緒申鐃緒申鐃祝は￥申鐃緒申鐃緒申鐃循わ申伴鐃緒申鐃宿ワ申鐃緒申鐃緒申函鐃緒申鐃緒申鐃
!  *      鐃峻マニュア鐃緒申覆鼻砲法鐃緒申綉鐃緒申鐃緒申鐃庶権表鐃緒申鐃緒申鐃緒申鐃緒申鐃緒申鐃術常申錣鐃緒申啣鐃緒申鐃
!  *      鐃緒申無鐃楯証居申鐃緒申鐃叔載わ申鐃暑こ鐃夙￥申
!  *  (3) 鐃旬ワ申鐃春トワ申鐃緒申鐃緒申鐃薯，居申鐃緒申鐃緒申箸濆鐃緒申鐃淑ど￥申他鐃塾ワ申鐃春トワ申鐃緒申鐃緒申鐃緒申発鐃祝誌申
!  *      鐃術でわ申鐃淑わ申鐃緒申鐃叔削申鐃緒申鐃循わ申鐃緒申鐃緒申砲蓮鐃緒申鐃緒申里鐃緒申鐃緒申譴鐃塾常申鐃緒申鐃緒申鐃緒申鐃緒申鐃緒申
!  *      鐃夙￥申
!  *    (a) 鐃緒申鐃緒申鐃循わ申伴鐃緒申鐃宿ワ申鐃緒申鐃緒申函鐃緒申鐃緒申兌團泪縫絅鐃緒申覆鼻砲法鐃緒申綉鐃緒申鐃緒申
!  *        鐃庶権表鐃緒申鐃緒申鐃緒申鐃緒申鐃緒申鐃術常申錣鐃緒申啣鐃緒申鐃緒申鐃縮居申歉攀鐃緒申鐃緒申悩椶鐃緒申襪鰹申函鐃
!  *    (b) 鐃緒申鐃緒申鐃循の件申鐃瞬わ申鐃縮わ申鐃緒申鐃緒申鐃緒申法鐃祝わ申辰董鐃TOPPERS鐃竣ワ申鐃緒申鐃緒申鐃夙わ申
!  *        鐃緒申陲垢襪鰹申函鐃
!  *  (4) 鐃旬ワ申鐃春トワ申鐃緒申鐃緒申鐃緒申鐃緒申鐃術にわ申鐃縦常申鐃重鐃殉わ申鐃熟器申鐃緒申的鐃緒申鐃緒申鐃緒申鐃暑い鐃緒申鐃淑わ申損
!  *      鐃緒申鐃緒申鐃緒申癲わ申綉鐃緒申鐃庶権鐃峻わ申鐃緒申鐃TOPPERS鐃竣ワ申鐃緒申鐃緒申鐃夙わ申鐃緒申鐃春わ申鐃暑こ鐃夙￥申
!  *      鐃殉わ申鐃緒申鐃旬ワ申鐃春トワ申鐃緒申鐃緒申鐃塾ユー鐃緒申鐃殉わ申鐃熟ワ申鐃緒申疋罅種申鐃緒申鐃緒申鐃塾わ申鐃緒申鐃淑わ申鐃緒申
!  *      由鐃祝器申鼎鐃緒申鐃緒申瓩鐃緒申癲わ申綉鐃緒申鐃庶権鐃峻わ申鐃緒申鐃TOPPERS鐃竣ワ申鐃緒申鐃緒申鐃夙わ申
!  *      鐃緒申鐃春わ申鐃暑こ鐃夙￥申
   * 
!  *  鐃旬ワ申鐃春トワ申鐃緒申鐃緒申鐃熟￥申無鐃楯証わ申鐃藷供わ申鐃緒申討鐃緒申鐃緒申里任鐃緒申襦ワ申綉鐃緒申鐃庶権鐃峻わ申
!  *  鐃緒申鐃TOPPERS鐃竣ワ申鐃緒申鐃緒申鐃夙は￥申鐃旬ワ申鐃春トワ申鐃緒申鐃緒申鐃祝関わ申鐃銃￥申鐃緒申鐃緒申了鐃緒申鐃緒申鐃重
!  *  鐃緒申鐃出わ申鐃緒申適鐃緒申鐃緒申鐃緒申泙鐃銃￥申鐃緒申鐃緒申鐃淑わ申鐃楯証わ申圓鐃淑わ申鐃緒申鐃殉わ申鐃緒申鐃旬ワ申鐃春トワ申鐃緒申
!  *  鐃緒申鐃緒申鐃緒申鐃術にわ申鐃縦常申鐃重鐃殉わ申鐃熟器申鐃緒申的鐃緒申鐃緒申鐃緒申鐃緒申鐃緒申鐃緒申鐃淑わ申損鐃緒申鐃祝関わ申鐃銃も，鐃緒申
!  *  鐃緒申鐃緒申任鐃緒申鐃緒申鐃淑わ申鐃緒申
   * 
   *  @(#) $Id: logtask.c 2246 2011-08-26 22:39:15Z ertl-hiro $
   */
  
  /*
!  *		鐃緒申鐃緒申鐃銃ワ申鐃緒申鐃緒申鐃緒申鐃
   */
  
  #include <kernel.h>
***************
*** 52,72 ****
  #include "logtask.h"
  
  /*
!  *  システムログタスクの出力先のポートID
   */
  static ID	logtask_portid;
  
  /*
!  *  シリアルインタフェースへの1文字出力
   */
  static void
  logtask_putc(char c)
  {
! 	(void) serial_wri_dat(logtask_portid, &c, 1);
  }
  
  /*
!  *  システムログ出力の待ち合わせ
   */
  ER
  logtask_flush(uint_t count)
--- 52,72 ----
  #include "logtask.h"
  
  /*
!  *  鐃緒申鐃緒申鐃銃ワ申鐃緒申鐃緒申鐃緒申鐃緒申僚鐃緒申鐃緒申鐃塾ポ￥申鐃緒申ID
   */
  static ID	logtask_portid;
  
  /*
!  *  鐃緒申鐃所ア鐃暑イ鐃藷タフワ申鐃緒申鐃緒申鐃舜わ申1文鐃緒申鐃緒申鐃緒申
   */
  static void
  logtask_putc(char c)
  {
! //	(void) serial_wri_dat(logtask_portid, &c, 1);
  }
  
  /*
!  *  鐃緒申鐃緒申鐃銃ワ申鐃緒申鐃緒申呂鐃緒申圓鐃緒申鐃緒せ
   */
  ER
  logtask_flush(uint_t count)
***************
*** 87,99 ****
  			if (rlog.count <= count) {
  				if (count == 0U) {
  					/*
! 					 *  countが0の場合には，シリアルバッファが空かを確
! 					 *  認する．
  					 */
! 					if (serial_ref_por(logtask_portid, &rpor) < 0) {
! 						ercd = E_SYS;
! 						goto error_exit;
! 					}
  					if (rpor.wricnt == 0U) {
  						ercd = E_OK;
  						goto error_exit;
--- 87,99 ----
  			if (rlog.count <= count) {
  				if (count == 0U) {
  					/*
! 					 *  count鐃緒申0鐃塾常申鐃祝は￥申鐃緒申鐃所ア鐃緒申丱奪侫鐃緒申鐃緒申鐃緒申鐃緒申鐃緒申
! 					 *  認鐃緒申鐃暑．
  					 */
! 			//		if (serial_ref_por(logtask_portid, &rpor) < 0) {
! 			//			ercd = E_SYS;
! 			//			goto error_exit;
! 			//		}
  					if (rpor.wricnt == 0U) {
  						ercd = E_OK;
  						goto error_exit;
***************
*** 106,112 ****
  			}
  
  			/*
! 			 *  LOGTASK_FLUSH_WAITミリ秒待つ．
  			 */
  			rercd = dly_tsk(LOGTASK_FLUSH_WAIT);
  			if (rercd < 0) {
--- 106,112 ----
  			}
  
  			/*
! 			 *  LOGTASK_FLUSH_WAIT鐃淳ワ申鐃緒申鐃峻つ￥申
  			 */
  			rercd = dly_tsk(LOGTASK_FLUSH_WAIT);
  			if (rercd < 0) {
***************
*** 121,127 ****
  }
  
  /*
!  *  システムログタスクの本体
   */
  void
  logtask_main(intptr_t exinf)
--- 121,127 ----
  }
  
  /*
!  *  鐃緒申鐃緒申鐃銃ワ申鐃緒申鐃緒申鐃緒申鐃緒申鐃緒申鐃緒申鐃
   */
  void
  logtask_main(intptr_t exinf)
***************
*** 131,137 ****
  	ER_UINT	rercd;
  
  	logtask_portid = (ID) exinf;
! 	(void) serial_opn_por(logtask_portid);
  	(void) syslog_msk_log(LOG_UPTO(LOG_NOTICE), LOG_UPTO(LOG_EMERG));
  	syslog_1(LOG_NOTICE, "System logging task is started on port %d.",
  													logtask_portid);
--- 131,137 ----
  	ER_UINT	rercd;
  
  	logtask_portid = (ID) exinf;
! 	//(void) serial_opn_por(logtask_portid);
  	(void) syslog_msk_log(LOG_UPTO(LOG_NOTICE), LOG_UPTO(LOG_EMERG));
  	syslog_1(LOG_NOTICE, "System logging task is started on port %d.",
  													logtask_portid);
***************
*** 156,162 ****
  }
  
  /*
!  *  システムログタスクの終了処理
   */
  void
  logtask_terminate(intptr_t exinf)
--- 156,162 ----
  }
  
  /*
!  *  鐃緒申鐃緒申鐃銃ワ申鐃緒申鐃緒申鐃緒申鐃緒申僚鐃塾誌申鐃緒申鐃
   */
  void
  logtask_terminate(intptr_t exinf)
***************
*** 167,188 ****
  	ER_UINT	rercd;
  
  	/*
! 	 *  シリアルインタフェースドライバの送信バッファに蓄積されたデータ
! 	 *  を，低レベル出力機能を用いて出力する．
  	 */
! 	while (serial_get_chr(logtask_portid, &c)) {
! 		target_fput_log(c);
! 	}
  
  	/*
! 	 *  ログバッファに記録されたログ情報を，低レベル出力機能を用いて出
! 	 *  力する．
  	 */
  	while ((rercd = syslog_rea_log(&logbuf)) >= 0) {
  		if (!msgflg) {
  			/*
! 			 *  ログバッファに残ったログ情報であることを示す文字列を出
! 			 *  力する．
  			 */
  			syslog_printf("-- buffered messages --\n", NULL, target_fput_log);
  			msgflg = true;
--- 167,188 ----
  	ER_UINT	rercd;
  
  	/*
! 	 *  鐃緒申鐃所ア鐃暑イ鐃藷タフワ申鐃緒申鐃緒申鐃宿ライ鐃出わ申鐃緒申鐃緒申鐃出ッフワ申鐃緒申鐃緒申鐃術わ申鐃曙た鐃叔￥申鐃緒申
! 	 *  鐃緒申鐃緒申鐃駿ワ申鐃緒申狼鐃叔緒申鐃緒申僂鐃緒申峠鐃緒申呂鐃緒申襦
  	 */
! //	while (serial_get_chr(logtask_portid, &c)) {
! //		target_fput_log(c);
! //	}
  
  	/*
! 	 *  鐃緒申鐃出ッフワ申鐃祝居申録鐃緒申鐃曙た鐃緒申鐃緒申鐃緒申鐃緒申鐃緒申戰鐃緒申鐃熟居申能鐃緒申鐃術わ申鐃銃緒申
! 	 *  鐃熟わ申鐃暑．
  	 */
  	while ((rercd = syslog_rea_log(&logbuf)) >= 0) {
  		if (!msgflg) {
  			/*
! 			 *  鐃緒申鐃出ッフワ申鐃祝残っわ申鐃緒申鐃緒申鐃緒申任鐃緒申襪鰹申箸鮗┐鐃淑醐申鐃緒申鐃緒申鐃
! 			 *  鐃熟わ申鐃暑．
  			 */
  			syslog_printf("-- buffered messages --\n", NULL, target_fput_log);
  			msgflg = true;
diff -cr --new-file asp/target/rx72n_gcc/E_PACKAGE 1.9.1_update/target/rx72n_gcc/E_PACKAGE
*** asp/target/rx72n_gcc/E_PACKAGE	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/E_PACKAGE	Thu Dec 15 13:49:15 2022
***************
*** 0 ****
--- 1,6 ----
+ E_PACKAGE asp_rsk_rx_hew
+ VERSION %date
+ 
+ INCLUDE ../../MANIFEST
+ INCLUDE ../../arch/rx_rxc/MANIFEST
+ INCLUDE ../../cfg/MANIFEST
diff -cr --new-file asp/target/rx72n_gcc/MANIFEST 1.9.1_update/target/rx72n_gcc/MANIFEST
*** asp/target/rx72n_gcc/MANIFEST	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/MANIFEST	Thu Dec 15 13:49:15 2022
***************
*** 0 ****
--- 1,31 ----
+ PACKAGE asp_target_rsk_rx_hew
+ VERSION 1.6.0
+ 
+ sample_workspace
+ E_PACKAGE
+ MANIFEST
+ asm_config.cfg
+ asm_config_pass1.bat
+ asm_config_pass2.bat
+ sectrx.inc
+ starter_kit.h
+ target.tf
+ target_asm_config.tf
+ target_cfg1_out.h
+ target_check.tf
+ target_config.c
+ target_config.h
+ target_def.csv
+ target_kernel.h
+ target_rename.def
+ target_rename.h
+ target_sil.h
+ target_stddef.h
+ target_support.src
+ target_syssvc.h
+ target_test.h
+ target_timer.c
+ target_timer.cfg
+ target_timer.h
+ target_unrename.h
+ target_user.txt
diff -cr --new-file asp/target/rx72n_gcc/Makefile.target 1.9.1_update/target/rx72n_gcc/Makefile.target
*** asp/target/rx72n_gcc/Makefile.target	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/Makefile.target	Thu Dec 15 13:49:15 2022
***************
*** 0 ****
--- 1,88 ----
+ #
+ #		Makefileのターゲット依存部（RX用）
+ #
+ 
+ #
+ #  ボード名，プロセッサ名，開発環境名の定義
+ #
+ BOARD = RX72N
+ PRC = rx72n
+ TOOL = gcc
+ 
+ # gcc target prefix
+ GCC_TARGET = rx-elf
+ 
+ #
+ #  コンパイルオプション
+ #
+ INCLUDES := $(INCLUDES) -I$(TARGETDIR)
+ #COPTS :=
+ #CDEFS :=
+ #LDFLAGS :=
+ #LIBS :=
+ 
+ #
+ #  Driver Setting
+ #
+ 
+ DRIVERDIR = $(SRCDIR)/driver/rx_gcc
+ 
+ 
+ #
+ #  カーネルに関する定義
+ #
+ KERNEL_DIR := $(KERNEL_DIR) $(TARGETDIR) $(DRIVERDIR)
+ KERNEL_ASMOBJS := $(KERNEL_ASMOBJS) target_support.o
+ KERNEL_COBJS := $(KERNEL_COBJS)  target_config.o target_timer.o target_edmac.o dummy.o$(DRIVER_COBJS)
+ 
+ 
+ #
+ #  コンフィギュレータ関係の変数の定義
+ #
+ CFG_TABS := $(CFG_TABS) --cfg1-def-table $(TARGETDIR)/target_def.csv
+ 
+ #
+ #  各セグメントの開始アドレスの定義
+ #
+ TEXT_START_ADDRESS =
+ DATA_START_ADDRESS =
+ 
+ #
+ #  リンカスクリプトの定義
+ #
+ LDSCRIPT = $(TARGETDIR)/rx72n_gcc.ld
+ 
+ #
+ #  スタートアップモジュールに関する定義
+ #
+ #  rxelf.ldに「STARTUP(start.o)」を記述したため，スタートアップモジュー
+ #  ルの名前をHIDDEN_OBJSに定義する．また，LDFLAGSに-nostdlibを追加している．
+ #
+ 
+ HIDDEN_OBJS = start.o
+ 
+ $(HIDDEN_OBJS): %.o: %.S
+ 	$(CC) -c $(CFLAGS) $(KERNEL_CFLAGS) $<
+ 
+ $(HIDDEN_OBJS:.o=.d): %.d: %.S
+ 	@$(PERL) $(SRCDIR)/utils/makedep -C $(CC) $(MAKEDEP_OPTS) \
+ 		-O "$(CFLAGS) $(KERNEL_CFLAGS)" $< >> Makefile.depend
+ 
+ LDFLAGS := -nostdlib $(LDFLAGS)
+ CFG1_OUT_LDFLAGS := -nostdlib $(CFG1_OUT_LDFLAGS)
+ LIBS := $(LIBS) -lgcc
+ 
+ 
+ CFG_ASMOBJS := $(CFG_ASMOBJS) kernel_cfg_asm.o  sectrx.o
+ 
+ #
+ #  依存関係の定義
+ #
+ cfg1_out.c: $(TARGETDIR)/target_def.csv
+ kernel_cfg.timestamp: $(TARGETDIR)/target.tf
+ $(OBJFILE): $(TARGETDIR)/target_check.tf
+ 
+ #
+ #  プロセッサ依存部のインクルード
+ #
+ include $(SRCDIR)/arch/rx_$(TOOL)/$(PRC)/Makefile.prc 
diff -cr --new-file asp/target/rx72n_gcc/asm_config.cfg 1.9.1_update/target/rx72n_gcc/asm_config.cfg
*** asp/target/rx72n_gcc/asm_config.cfg	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/asm_config.cfg	Thu Dec 15 13:49:15 2022
***************
*** 0 ****
--- 1,6 ----
+ /*
+  *  asm_config.inc 生成プロジェクト用コンフィギュレーションファイル
+  *
+  *  コンフィギュレーションは行なわないため空ファイルとする.
+  */
+ 
diff -cr --new-file asp/target/rx72n_gcc/dummy.c 1.9.1_update/target/rx72n_gcc/dummy.c
*** asp/target/rx72n_gcc/dummy.c	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/dummy.c	Thu Dec 15 13:49:15 2022
***************
*** 0 ****
--- 1,23 ----
+ /*
+  * dummy.c
+  *
+  *  Created on: 2022/10/16
+  *      Author: nekom
+  */
+ #include "kernel.h"
+ 
+  STK_T *const	istack;		/* スタックポインタの初期値 */
+ 
+  void ether_int_Wrapper() {
+ 
+  }
+  void taskDemoWolf(intptr_t exinf) {
+ }
+  void taskNetWork(intptr_t exinf) {
+  }
+  void taskEther(intptr_t exinf) {
+ }
+  void timer_int_Wrapper() {
+  }
+  void timer_cm2_int_Wrapper() {
+   }
diff -cr --new-file asp/target/rx72n_gcc/rx72n_gcc.ld 1.9.1_update/target/rx72n_gcc/rx72n_gcc.ld
*** asp/target/rx72n_gcc/rx72n_gcc.ld	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/rx72n_gcc.ld	Thu Dec 15 13:49:15 2022
***************
*** 0 ****
--- 1,82 ----
+ MEMORY
+ {
+ 	RAM : ORIGIN = 0x4, LENGTH = 0x7fffc
+ 	RAM2 : ORIGIN = 0x00800000, LENGTH = 524288
+ 	ROM : ORIGIN = 0xFFE00000, LENGTH = 2097152
+ 
+ }
+ 
+ PROVIDE(hardware_init_hook = 0);
+ PROVIDE(software_init_hook = 0);
+ PROVIDE(software_term_hook = 0);
+ STARTUP(start.o)
+ 
+ SECTIONS
+ {
+ 
+ 	.text :
+ 	{
+ 		__text = .;
+ 		*(.vector)
+ 		*(.text)
+ 		*(.text.*)
+ 		*(P)
+ 	} > ROM
+ 	_etext = .;
+ 	PROVIDE(etext = .);
+ 
+ 	.rodata :
+ 	{
+ 		*(.rodata)
+ 		*(.rodata.*)
+ 		*(C_1)
+ 		*(C_2)
+ 		*(C)
+ 		*(C$VECT)
+ 	} > ROM
+     __rodata_end = .;
+ 	__exidx_start = .;
+ 	__exidx_end = .;
+ 
+ 	. = 0x0; /*RAM START ADDRES*/
+ 	.bss : 
+ 	{
+ 		__bss_start  = .;
+         *(DTCA_VECTOR_SEC)
+         __dtca_start = .;
+ 		*(.bss)
+ 		*(.bss.*)
+ 		*(COMMON)
+ 		*(B)
+ 		*(B_1)
+ 		*(B_2)
+ 		*(SI) /* SI is kernel stack section*/
+ 	    __bss_end = .;
+ 	} > RAM
+ 
+     . = __rodata_end;
+ 	. = ALIGN(4);
+ 	__idata_start = .;
+ 	.data : 
+ 	{
+ 		__data_start = .;
+ 		*(.data)
+ 		*(.data.*)
+ 		*(D)
+ 		*(D_1)
+ 		*(D_2)
+ 	    __data_end = .;
+ 	} > RAM AT> ROM
+     
+ 	__idata_end = __idata_start + SIZEOF(.data);
+ 	_edata = .;
+ 	PROVIDE(edata = .);
+     
+ 	. = ALIGN(4);
+     .fvectors 0xFFFFFF80 :
+    {
+       *(.fvect)
+     } > ROM
+ 	_end = .;
+ 	PROVIDE(end = .);
+ }
diff -cr --new-file asp/target/rx72n_gcc/sectrx.S 1.9.1_update/target/rx72n_gcc/sectrx.S
*** asp/target/rx72n_gcc/sectrx.S	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/sectrx.S	Thu Dec 15 13:49:15 2022
***************
*** 0 ****
--- 1,58 ----
+ ;*
+ ;*  TOPPERS/ASP Kernel
+ ;*      Toyohashi Open Platform for Embedded Real-Time Systems/
+ ;*      Advanced Standard Profile Kernel
+ ;* 
+ ;*  Copyright (C) 2008-2010 by Witz Corporation, JAPAN
+ ;* 
+ ;*  ??L???????CFree Software Foundation ????????\???????? 
+ ;*  GNU General Public License ?? Version 2 ??L?q??????????????C??
+ ;*  ????(1)?`(4)??????桙スススス鼾ソスノ鯉ソスススCス{ス\スtスgスEスFスAスiス{ス\スtスgスEスF
+ ;*  スAスススススマゑソススススススフゑソススワむ．スネ会ソススススススjスススgスpスEスススススEスススマ・スト配スzスiスネ会ソススC
+ ;*  スススpスニ呼ぶ）ススス驍アスニを無擾ソススナ具ソスススススススD
+ ;*  (1) ス{ス\スtスgスEスFスAススス\ス[スXスRス[スhスフ形スナ暦ソススpスススス鼾ソスノは，ススLスフ抵ソススス
+ ;*      ススス\スススCスススフ暦ソススpススススススススム会ソススLスフ厄ソススロ証規ス閧ェスCスススブまの形スナソス[
+ ;*      スXスRス[スhスススノ含まゑソストゑソスス驍アスニ．
+ ;*  (2) ス{ス\スtスgスEスFスAスススト暦ソススpスツ能スネバスCスiスススRス[スhスiスススススPス[ズスuスススIスu
+ ;*      スWスFスNスgスtス@スCススス窿会ソスCスuスススススネど）スフ形スナ暦ソススpスススス鼾ソスノは，スススp
+ ;*      スノ費ソススススhスLスススススススgスiスススpスメマスjスススAスススネど）スノ，ススLスフ抵ソスス申\???C
+ ;*      ??????p????????щ??L??????K????f????邱??D
+ ;*  (3) ?{?\?t?g?E?F?A??????p?s??\??o?C?i???R?[?h??`?????@???g
+ ;*      ????`????p????????C??????????????????????D
+ ;*    (a) ???p??????h?L???????g?i???p??}?j???A?????j??C??L?????
+ ;*        ???\???C??????p????????щ??L??????K????f????邱??D
+ ;*    (b) ???p??`????C????????@??????C??L??????????
+ ;*        ????D
+ ;*  (4) ?{?\?t?g?E?F?A????p???蒼??I???????I????????????
+ ;*      ?Q??????C??L???????????邱??D
+ ;* 
+ ;*  ?{?\?t?g?E?F?A??C??????氓ススストゑソスススススフでゑソスススDススLススス申??C
+ ;*  ?{?\?t?g?E?F?A??????C????K?p??\????????C???????????s??
+ ;*  ????D????C?{?\?t?g?E?F?A????p???蒼??I???????I?????????
+ ;*  ??????Q????????C?????C?奄スネゑソススD
+ ;*
+ 
+ 
+ ;
+ ;  ズス[スQスbスgスVスXスeスススヒ托ソススZスNスVスススススス`スtス@スCスス(スXズス[ズス[スLスbスgスp)
+ ;
+ 
+ ;
+ ;  スZスNスVスススススフ抵ソス`
+ ;
+ ;  スZスNスVスススススフアスhスススXスス`ススHEWススフ最適スススススススJスス
+ ;  スIスvスVスススススノて趣ソスス{スススス.
+ ;
+ 
+ 	.section	SI,"aw",@nobits
+ 	.balign 4
+ 	.glb _DEFAULT_ISTACK
+ _DEFAULT_ISTACK:
+ 	.blkb		0x10000
+ 	.glb DEFAULT_ISTACK_TOP
+ DEFAULT_ISTACK_TOP:
+ 
+ 
+ 
+ 
+ 
diff -cr --new-file asp/target/rx72n_gcc/target.tf 1.9.1_update/target/rx72n_gcc/target.tf
*** asp/target/rx72n_gcc/target.tf	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/target.tf	Thu Dec 15 13:53:39 2022
***************
*** 0 ****
--- 1,56 ----
+ $ 
+ $  TOPPERS/ASP Kernel
+ $      Toyohashi Open Platform for Embedded Real-Time Systems/
+ $      Advanced Standard Profile Kernel
+ $ 
+ $  Copyright (C) 2008-2010 by Witz Corporation, JAPAN
+ $ 
+ $  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
+ $  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
+ $  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
+ $  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+ $      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+ $      スコード中に含まれていること．
+ $  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
+ $      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
+ $      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
+ $      の無保証規定を掲載すること．
+ $  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
+ $      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
+ $      と．
+ $    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
+ $        作権表示，この利用条件および下記の無保証規定を掲載すること．
+ $    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
+ $        報告すること．
+ $  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+ $      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
+ $      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
+ $      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
+ $      免責すること．
+ $ 
+ $  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
+ $  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
+ $  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
+ $  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
+ $  の責任を負わない．
+ $ 
+ $ 
+ 
+ $ 
+ $  ターゲット依存テンプレート（RX72N用）
+ $ 
+ 
+ 
+ /*$NL$
+ $SPC$*  Target-dependent Definitions (RX72N)$NL$
+ $SPC$*/$NL$
+ $NL$
+ 
+ $INCLUDE "target_asm_config.tf"$
+ 
+ 
+ $ 
+ $  RX72n依存部の読み込み
+ $ 
+ $INCLUDE "rx_gcc/rx72n/rx72n.tf"$
+ 
diff -cr --new-file asp/target/rx72n_gcc/target_asm_config.tf 1.9.1_update/target/rx72n_gcc/target_asm_config.tf
*** asp/target/rx72n_gcc/target_asm_config.tf	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/target_asm_config.tf	Thu Dec 15 13:49:15 2022
***************
*** 0 ****
--- 1,20 ----
+ $
+ $     asm_config.inc 生成用
+ $     パス2のターゲット依存テンプレート（kaede_gcc用）
+ $
+ $     Copyright (C) 2010 by Witz Corporation, JAPAN
+ $     Copyright (C) 2016- by Hisashi Hata, JAPAN
+ 
+ $
+ 
+ $
+ $  プロセッサ依存のテンプレートファイルのインクルード
+ $
+ $INCLUDE"prc_asm_config.tf"$
+ 
+ $FILE "asm_config.inc"$
+ 
+ $NL$
+ 
+ #define SIL_DLY_TIM1 $TAB$ $TAB$ $+SIL_DLY_TIM1$ $NL$
+ #define SIL_DLY_TIM2 $TAB$ $TAB$ $+SIL_DLY_TIM2$ $NL$
diff -cr --new-file asp/target/rx72n_gcc/target_board.h 1.9.1_update/target/rx72n_gcc/target_board.h
*** asp/target/rx72n_gcc/target_board.h	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/target_board.h	Thu Dec 15 13:53:39 2022
***************
*** 0 ****
--- 1,54 ----
+ /*
+  *  TOPPERS/ASP Kernel
+  *      Toyohashi Open Platform for Embedded Real-Time Systems/
+  *      Advanced Standard Profile Kernel
+  * 
+  *  Copyright (C) 2010 by Witz Corporation, JAPAN
+  * 
+  *  上記著作権者は，以下の (1)〜(4) の条件か，Free Software Foundation 
+  *  によって公表されている GNU General Public License の Version 2 に記
+  *  述されている条件を満たす場合に限り，本ソフトウェア（本ソフトウェア
+  *  を改変したものを含む．以下同じ）を使用・複製・改変・再配布（以下，
+  *  利用と呼ぶ）することを無償で許諾する．
+  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+  *      スコード中に含まれていること．
+  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
+  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
+  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
+  *      の無保証規定を掲載すること．
+  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
+  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
+  *      と．
+  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
+  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
+  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
+  *        報告すること．
+  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
+  * 
+  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
+  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，その適用可能性も
+  *  含めて，いかなる保証も行わない．また，本ソフトウェアの利用により直
+  *  接的または間接的に生じたいかなる損害に関しても，その責任を負わない．
+  * 
+  */
+ 
+ #ifndef	TOPPERS_STARTER_KIT_H
+ #define	TOPPERS_STARTER_KIT_H
+ 
+ 
+ /*
+  *  MCU依存情報の読み込み
+  */
+ #include <rx72n.h>
+ 
+ 
+ 
+ #define F_PCLKA		96000000UL	/* PCLKA frequency (configured by SCKCR.PCK) */
+ #define F_PCLKB		48000000UL	/* PCLKB frequency (configured by SCKCR.PCK) */
+ 
+ 
+ #endif	/* TOPPERS_STARTER_KIT_H */
+ 
+  
diff -cr --new-file asp/target/rx72n_gcc/target_cfg1_out.h 1.9.1_update/target/rx72n_gcc/target_cfg1_out.h
*** asp/target/rx72n_gcc/target_cfg1_out.h	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/target_cfg1_out.h	Thu Dec 15 13:49:15 2022
***************
*** 0 ****
--- 1,7 ----
+ /*
+  *		cfg1_out.cのリンクに必要なスタブの定義
+  */
+ 
+ #include "prc_cfg1_out.h"
+ #include "sil.h"
+ 
diff -cr --new-file asp/target/rx72n_gcc/target_check.tf 1.9.1_update/target/rx72n_gcc/target_check.tf
*** asp/target/rx72n_gcc/target_check.tf	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/target_check.tf	Thu Dec 15 13:53:39 2022
***************
*** 0 ****
--- 1,45 ----
+ $ 
+ $  TOPPERS/ASP Kernel
+ $      Toyohashi Open Platform for Embedded Real-Time Systems/
+ $      Advanced Standard Profile Kernel
+ $ 
+ $  Copyright (C) 2008-2010 by Witz Corporation, JAPAN
+ $ 
+ $  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
+ $  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
+ $  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
+ $  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+ $      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+ $      スコード中に含まれていること．
+ $  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
+ $      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
+ $      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
+ $      の無保証規定を掲載すること．
+ $  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
+ $      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
+ $      と．
+ $    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
+ $        作権表示，この利用条件および下記の無保証規定を掲載すること．
+ $    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
+ $        報告すること．
+ $  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+ $      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
+ $      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
+ $      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
+ $      免責すること．
+ $ 
+ $  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
+ $  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
+ $  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
+ $  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
+ $  の責任を負わない．
+ $ 
+ 
+ $ 
+ $     パス3のターゲット依存テンプレート（RX72N用）
+ $ 
+ 
+ $ 
+ $  パス3のSH4A依存のテンプレートのインクルード
+ $ 
+ $INCLUDE"prc_check.tf"$
diff -cr --new-file asp/target/rx72n_gcc/target_config.c 1.9.1_update/target/rx72n_gcc/target_config.c
*** asp/target/rx72n_gcc/target_config.c	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/target_config.c	Thu Dec 15 13:53:39 2022
***************
*** 0 ****
--- 1,83 ----
+ /*
+  *  TOPPERS/ASP Kernel
+  *      Toyohashi Open Platform for Embedded Real-Time Systems/
+  *      Advanced Standard Profile Kernel
+  * 
+  *  Copyright (C) 2010 by Witz Corporation, JAPAN
+  * 
+  *  上記著作権者は，以下の (1)〜(4) の条件か，Free Software Foundation 
+  *  によって公表されている GNU General Public License の Version 2 に記
+  *  述されている条件を満たす場合に限り，本ソフトウェア（本ソフトウェア
+  *  を改変したものを含む．以下同じ）を使用・複製・改変・再配布（以下，
+  *  利用と呼ぶ）することを無償で許諾する．
+  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+  *      スコード中に含まれていること．
+  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
+  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
+  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
+  *      の無保証規定を掲載すること．
+  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
+  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
+  *      と．
+  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
+  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
+  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
+  *        報告すること．
+  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
+  * 
+  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
+  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，その適用可能性も
+  *  含めて，いかなる保証も行わない．また，本ソフトウェアの利用により直
+  *  接的または間接的に生じたいかなる損害に関しても，その責任を負わない．
+  * 
+  */
+ 
+ 
+ /*
+  *	ターゲットシステム依存モジュール（RX72N用）
+  */
+ 
+ 
+ #include "kernel_impl.h"
+ #include <sil.h>
+ #include "target_board.h"
+ 
+ 
+ 
+ void
+ target_initialize( void )
+ {
+ 
+ 	/*
+ 	 *  プロセッサ依存の初期化
+ 	 */
+ 
+   prc_initialize();
+ 
+ }
+ 
+ /*
+  *  ターゲットシステムの終了ルーチン
+  */
+ void
+ target_exit( void )
+ {
+ 	/*
+ 	 *	プロセッサ依存の終了処理
+ 	 */
+ 	prc_terminate();
+ 
+ 	while ( 1 );
+ }
+ 
+ /*
+  *  システムログの低レベル出力のための文字出力
+  */
+ void
+ target_fput_log( char c )
+ {
+ 
+ }
+ 
diff -cr --new-file asp/target/rx72n_gcc/target_config.h 1.9.1_update/target/rx72n_gcc/target_config.h
*** asp/target/rx72n_gcc/target_config.h	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/target_config.h	Thu Dec 15 13:53:39 2022
***************
*** 0 ****
--- 1,134 ----
+ /*
+  *  TOPPERS/ASP Kernel
+  *      Toyohashi Open Platform for Embedded Real-Time Systems/
+  *      Advanced Standard Profile Kernel
+  *
+  *  Copyright (C) 2000-2003 by Embedded and Real-Time Systems Laboratory
+  *                              Toyohashi Univ. of Technology, JAPAN
+  *  Copyright (C) 2005-2007 by Embedded and Real-Time Systems Laboratory
+  *              Graduate School of Information Science, Nagoya Univ., JAPAN
+  *  Copyright (C) 2008-2010 by Witz Corporation, JAPAN
+  *
+  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
+  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
+  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
+  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+  *      スコード中に含まれていること．
+  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
+  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
+  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
+  *      の無保証規定を掲載すること．
+  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
+  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
+  *      と．
+  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
+  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
+  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
+  *        報告すること．
+  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
+  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
+  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
+  *      免責すること．
+  *
+  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
+  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
+  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
+  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
+  *  の責任を負わない．
+  *
+  */
+ 
+ /*
+  *		ターゲット依存モジュール（TX72N用）
+  *
+  *  カーネルのターゲット依存部のインクルードファイル．kernel_impl.hのター
+  *  ゲット依存部の位置付けとなる．
+  */
+ 
+ #ifndef TOPPERS_TARGET_CONFIG_H
+ #define TOPPERS_TARGET_CONFIG_H
+ 
+ /*
+  *  ターゲットシステムのハードウェア資源の定義
+  */
+ #include "target_board.h"
+ 
+ 
+ /*
+  *  デフォルトの非タスクコンテキスト用のスタック領域の定義
+  *
+  *  スタックサイズを変更する場合は, sectrx.incの_DEFAULT_ISTACK
+  *  ラベルの位置にある.blkb命令のサイズと, 以下DEFAULT_ISTKSZの
+  *  サイズを合わせて同じ値に変更すること.
+  */
+ 
+ #ifndef TOPPERS_MACRO_ONLY
+ extern uint32_t	DEFAULT_ISTACK[];
+ #endif
+ 
+ #define DEFAULT_ISTKSZ		(0x1000U) //( 0x1e00CU ) //wata
+ #define DEFAULT_ISTK		( (void *)&DEFAULT_ISTACK[0] )
+ 
+ 
+ /*
+  *  ターゲット依存の文字出力に使用するポートの定義
+  */
+ #define TARGET_PUTC_PORTID	( 1 )
+ 
+ 
+ #ifndef TOPPERS_MACRO_ONLY
+ 
+ /*
+  *  ターゲットシステム依存の初期化
+  */
+ extern void	target_initialize( void );
+ 
+ /*
+  *  ターゲットシステムの終了
+  *
+  *  システムを終了する時に使う．
+  */
+ extern void	target_exit( void )	NoReturn;
+ 
+ #endif /* TOPPERS_MACRO_ONLY */
+ 
+ 
+ /*
+  *  プロセッサ依存モジュール（RX63n用）
+  */
+ #include "rx72n_config.h"
+ 
+ 
+ /*
+  *  トレースログに関する設定
+  */
+ #define TCNT_TRACE_BUFFER	( 32 )
+ 
+ /*
+  *  トレースログ出力する箇所の選択
+  *    ログ出力する箇所を1で定義
+  *    ログ出力しない箇所を0で定義
+  */
+ #ifdef TOPPERS_ENABLE_TRACE
+ #define LOG_DSP_ENTER	( 1 )
+ #define LOG_DSP_LEAVE	( 1 )
+ #define LOG_INH_ENTER	( 0 )
+ #define LOG_INH_LEAVE	( 0 )
+ #define LOG_EXC_ENTER	( 0 )
+ #define LOG_EXC_LEAVE	( 0 )
+ #else
+ #define LOG_DSP_ENTER	( 0 )
+ #define LOG_DSP_LEAVE	( 0 )
+ #define LOG_INH_ENTER	( 0 )
+ #define LOG_INH_LEAVE	( 0 )
+ #define LOG_EXC_ENTER	( 0 )
+ #define LOG_EXC_LEAVE	( 0 )
+ #endif
+ 
+ #ifdef TOPPERS_ENABLE_TRACE
+ #include "logtrace/trace_config.h"
+ #endif /* TOPPERS_ENABLE_TRACE */
+ 
+ #endif /* TOPPERS_TARGET_CONFIG_H */
diff -cr --new-file asp/target/rx72n_gcc/target_def.csv 1.9.1_update/target/rx72n_gcc/target_def.csv
*** asp/target/rx72n_gcc/target_def.csv	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/target_def.csv	Thu Dec 15 13:49:15 2022
***************
*** 0 ****
--- 1,2 ----
+ SIL_DLY_TIM1,SIL_DLY_TIM1
+ SIL_DLY_TIM2,SIL_DLY_TIM2
diff -cr --new-file asp/target/rx72n_gcc/target_edmac.c 1.9.1_update/target/rx72n_gcc/target_edmac.c
*** asp/target/rx72n_gcc/target_edmac.c	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/target_edmac.c	Thu Dec 15 13:53:39 2022
***************
*** 0 ****
--- 1,62 ----
+ /*
+ 
+ 
+  *  TOPPERS/ASP Kernel
+  *      Toyohashi Open Platform for Embedded Real-Time Systems/
+  *      Advanced Standard Profile Kernel
+  *
+  *  Copyright (C) 2010 by Witz Corporation, JAPAN
+  *
+  *  上記著作権者は，以下の (1)〜(4) の条件か，Free Software Foundation
+  *  によって公表されている GNU General Public License の Version 2 に記
+  *  述されている条件を満たす場合に限り，本ソフトウェア（本ソフトウェア
+  *  を改変したものを含む．以下同じ）を使用・複製・改変・再配布（以下，
+  *  利用と呼ぶ）することを無償で許諾する．
+  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+  *      スコード中に含まれていること．
+  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
+  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
+  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
+  *      の無保証規定を掲載すること．
+  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
+  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
+  *      と．
+  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
+  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
+  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
+  *        報告すること．
+  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
+  *
+  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
+  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，その適用可能性も
+  *  含めて，いかなる保証も行わない．また，本ソフトウェアの利用により直
+  *  接的または間接的に生じたいかなる損害に関しても，その責任を負わない．
+  *
+  */
+ 
+ #include "kernel_impl.h"
+ #include <sil.h>
+ #include "target_edmac.h"
+ 
+ extern void ether_int_Wrapper();
+ /*
+  *	ターゲットシステム依存モジュール（RX72N用 EDMAC Wrapper）
+  */
+ 
+ void
+ rx72n_edmac_interrput_wrapper(void){
+ 	i_begin_int(INTNO_EDMAC_0);
+ 
+ 	ether_int_Wrapper();
+ 
+ 	i_end_int(INTNO_EDMAC_0);
+ 
+ }
+ void
+ rx72n_edmac_interrput_wrapper_term(void){
+ 
+ }
+ 
+ 
diff -cr --new-file asp/target/rx72n_gcc/target_edmac.cfg 1.9.1_update/target/rx72n_gcc/target_edmac.cfg
*** asp/target/rx72n_gcc/target_edmac.cfg	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/target_edmac.cfg	Thu Dec 15 18:32:00 2022
***************
*** 0 ****
--- 1,8 ----
+ /*
+  *  タイマドライバ（RX72N用）のコンフィギュレーションファイル
+  */
+ 
+ #include "target_edmac.h"
+ DEF_INH(INHNO_EDMAC_0, { TA_NULL, rx72n_edmac_interrput_wrapper });
+ CFG_INT(INTNO_EDMAC_0, { INTATR_EDMAC_0, INTPRI_EDMAC_0 });
+ CRE_SEM(ETHER_START_SEM, {TA_TPRI, 0, 1 });
diff -cr --new-file asp/target/rx72n_gcc/target_edmac.h 1.9.1_update/target/rx72n_gcc/target_edmac.h
*** asp/target/rx72n_gcc/target_edmac.h	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/target_edmac.h	Thu Dec 15 13:53:39 2022
***************
*** 0 ****
--- 1,69 ----
+ /*
+  *  TOPPERS/ASP Kernel
+  *      Toyohashi Open Platform for Embedded Real-Time Systems/
+  *      Advanced Standard Profile Kernel
+  *
+  *  Copyright (C) 2000-2003 by Embedded and Real-Time Systems Laboratory
+  *                              Toyohashi Univ. of Technology, JAPAN
+  *  Copyright (C) 2005-2007 by Embedded and Real-Time Systems Laboratory
+  *              Graduate School of Information Science, Nagoya Univ., JAPAN
+  *  Copyright (C) 2008-2010 by Witz Corporation, JAPAN
+  *
+  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
+  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
+  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
+  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+  *      スコード中に含まれていること．
+  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
+  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
+  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
+  *      の無保証規定を掲載すること．
+  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
+  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
+  *      と．
+  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
+  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
+  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
+  *        報告すること．
+  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
+  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
+  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
+  *      免責すること．
+  *
+  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
+  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
+  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
+  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
+  *  の責任を負わない．
+  *
+  */
+ 
+ /*
+  *		ターゲット依存モジュール（RX72N用）
+  *
+  *  カーネルのターゲット依存部のインクルードファイル．kernel_impl.hのター
+  *  ゲット依存部の位置付けとなる．
+  */
+ 
+ #ifndef TOPPERS_TARGET_72N_EDMAC_H
+ #define TOPPERS_TARGET_72N_EDMAC_H
+ #include <sil.h>
+ #include "target_board.h"
+ #include "prc_kernel.h"
+ 
+ //#define INTNO_EDMAC_0	113			/* 割込み番号 */
+ 
+ #define INHNO_EDMAC_0		INT_EDMAC0		/* 割込みハンドラ番号 */
+ #define INTNO_EDMAC_0		INT_EDMAC0		/* 割込み番号 */
+ #define INTPRI_EDMAC_0	-5					/* 割込み優先度 */
+ #define INTATR_EDMAC_0	TA_ENAINT | TA_EDGE	/* 割込み属性 */
+ #ifndef TOPPERS_MACRO_ONLY
+ 
+ extern void	rx72n_edmac_interrput_wrapper(void);
+ 
+ #endif
+ #endif /* TOPPERS_TARGET_72N_EDMAC_H */
+ 
+ 
diff -cr --new-file asp/target/rx72n_gcc/target_kernel.h 1.9.1_update/target/rx72n_gcc/target_kernel.h
*** asp/target/rx72n_gcc/target_kernel.h	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/target_kernel.h	Thu Dec 15 13:53:39 2022
***************
*** 0 ****
--- 1,74 ----
+ /*
+  *  TOPPERS/ASP Kernel
+  *      Toyohashi Open Platform for Embedded Real-Time Systems/
+  *      Advanced Standard Profile Kernel
+  * 
+  *  Copyright (C) 2000-2003 by Embedded and Real-Time Systems Laboratory
+  *                              Toyohashi Univ. of Technology, JAPAN
+  *  Copyright (C) 2003-2004 by Naoki Saito
+  *             Nagoya Municipal Industrial Research Institute, JAPAN
+  *  Copyright (C) 2003-2004 by Platform Development Center
+  *                                          RICOH COMPANY,LTD. JAPAN
+  *  Copyright (C) 2008-2010 by Witz Corporation, JAPAN
+  * 
+  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
+  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
+  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
+  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+  *      スコード中に含まれていること．
+  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
+  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
+  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
+  *      の無保証規定を掲載すること．
+  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
+  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
+  *      と．
+  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
+  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
+  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
+  *        報告すること．
+  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
+  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
+  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
+  *      免責すること．
+  * 
+  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
+  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
+  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
+  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
+  *  の責任を負わない．
+  * 
+  */
+ 
+ /*
+  *  このインクルードファイルは，kernel.hでインクルードされる．他のファ
+  *  イルから直接インクルードすることはない．このファイルをインクルード
+  *  する前に，t_stddef.hがインクルードされるので，それらに依存してもよ
+  *  い．
+  */
+ 
+ #ifndef TOPPERS_TARGET_KERNEL_H
+ #define TOPPERS_TARGET_KERNEL_H
+ 
+ 
+ /*
+  *  プロセッサで共通な定義
+  */
+ #include "prc_kernel.h"
+ 
+ 
+ /*
+  *  サポートする機能の定義
+  */
+ #define	TOPPERS_TARGET_SUPPORT_GET_UTM		/* get_utmをサポートする */
+ 
+ 
+ /*
+  *  タイムティックの定義
+  */
+ #define	TIC_NUME		( 1U )		/* タイムティックの周期の分子 */
+ #define	TIC_DENO		( 1U )		/* タイムティックの周期の分母 */
+ 
+ #endif /* TOPPERS_TARGET_KERNEL_H */
diff -cr --new-file asp/target/rx72n_gcc/target_offset.tf 1.9.1_update/target/rx72n_gcc/target_offset.tf
*** asp/target/rx72n_gcc/target_offset.tf	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/target_offset.tf	Thu Dec 15 13:49:16 2022
***************
*** 0 ****
--- 1,13 ----
+ $
+ $       オフセットファイル生成用テンプレートファイル（Rx用）
+ $
+ 
+ $
+ $  標準テンプレートファイルのインクルード
+ $
+ $INCLUDE "kernel/genoffset.tf"$
+ 
+ $ 
+ $  コア依存テンプレートのインクルード（Rx用）
+ $ 
+ $INCLUDE "core_offset.tf"$
diff -cr --new-file asp/target/rx72n_gcc/target_rename.def 1.9.1_update/target/rx72n_gcc/target_rename.def
*** asp/target/rx72n_gcc/target_rename.def	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/target_rename.def	Thu Dec 15 13:49:16 2022
***************
*** 0 ****
--- 1,13 ----
+ # target_config.c
+ target_initialize
+ target_exit
+ 
+ #trace_config.c
+ log_dsp_enter
+ log_dsp_leave
+ log_inh_enter
+ log_inh_leave
+ log_exc_enter
+ log_exc_leave
+ 
+ INCLUDE "prc"
diff -cr --new-file asp/target/rx72n_gcc/target_rename.h 1.9.1_update/target/rx72n_gcc/target_rename.h
*** asp/target/rx72n_gcc/target_rename.h	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/target_rename.h	Thu Dec 15 13:49:16 2022
***************
*** 0 ****
--- 1,49 ----
+ /* This file is generated from target_rename.def by genrename. */
+ 
+ #ifndef TOPPERS_TARGET_RENAME_H
+ #define TOPPERS_TARGET_RENAME_H
+ 
+ /*
+  *  target_config.c
+  */
+ #define target_initialize			_kernel_target_initialize
+ #define target_exit					_kernel_target_exit
+ 
+ /*
+  *  trace_config.c
+  */
+ #define log_dsp_enter				_kernel_log_dsp_enter
+ #define log_dsp_leave				_kernel_log_dsp_leave
+ #define log_inh_enter				_kernel_log_inh_enter
+ #define log_inh_leave				_kernel_log_inh_leave
+ #define log_exc_enter				_kernel_log_exc_enter
+ #define log_exc_leave				_kernel_log_exc_leave
+ 
+ 
+ #ifdef TOPPERS_LABEL_ASM
+ 
+ /*
+  *  target_config.c
+  */
+ #define _board_id					__kernel_board_id
+ #define _board_addr					__kernel_board_addr
+ #define _target_initialize			__kernel_target_initialize
+ #define _target_exit				__kernel_target_exit
+ #define _x_config_int				__kernel_x_config_int
+ 
+ /*
+  *  trace_config.c
+  */
+ #define _log_dsp_enter				__kernel_log_dsp_enter
+ #define _log_dsp_leave				__kernel_log_dsp_leave
+ #define _log_inh_enter				__kernel_log_inh_enter
+ #define _log_inh_leave				__kernel_log_inh_leave
+ #define _log_exc_enter				__kernel_log_exc_enter
+ #define _log_exc_leave				__kernel_log_exc_leave
+ 
+ 
+ #endif /* TOPPERS_LABEL_ASM */
+ 
+ #include "prc_rename.h"
+ 
+ #endif /* TOPPERS_TARGET_RENAME_H */
diff -cr --new-file asp/target/rx72n_gcc/target_sil.h 1.9.1_update/target/rx72n_gcc/target_sil.h
*** asp/target/rx72n_gcc/target_sil.h	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/target_sil.h	Thu Dec 15 13:53:39 2022
***************
*** 0 ****
--- 1,61 ----
+ /*
+  *  TOPPERS Software
+  *      Toyohashi Open Platform for Embedded Real-Time Systems
+  * 
+  *  Copyright (C) 2008-2010 by Witz Corporation, JAPAN
+  * 
+  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
+  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
+  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
+  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+  *      スコード中に含まれていること．
+  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
+  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
+  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
+  *      の無保証規定を掲載すること．
+  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
+  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
+  *      と．
+  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
+  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
+  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
+  *        報告すること．
+  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
+  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
+  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
+  *      免責すること．
+  * 
+  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
+  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
+  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
+  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
+  *  の責任を負わない．
+  * 
+  */
+ 
+ /*
+  *		sil.hのターゲット依存部（RX72N用）
+  *
+  *  このインクルードファイルは，sil.hの先頭でインクルードされる．他のファ
+  *  イルからは直接インクルードすることはない．このファイルをインクルー
+  *  ドする前に，t_stddef.hがインクルードされるので，それらに依存しても
+  *  よい．
+  */
+ 
+ #ifndef TOPPERS_TARGET_SIL_H
+ #define TOPPERS_TARGET_SIL_H
+ 
+ /*
+  *  微少時間待ちのための定義
+  */
+ #define SIL_DLY_TIM1     69
+ #define SIL_DLY_TIM2     50
+ 
+ /*
+  *  プロセッサで共通な定義
+  */
+ #include "prc_sil.h"
+ 
+ #endif /* TOPPERS_TARGET_SIL_H */
diff -cr --new-file asp/target/rx72n_gcc/target_stddef.h 1.9.1_update/target/rx72n_gcc/target_stddef.h
*** asp/target/rx72n_gcc/target_stddef.h	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/target_stddef.h	Thu Dec 15 13:53:40 2022
***************
*** 0 ****
--- 1,97 ----
+ /*
+  *  TOPPERS Software
+  *      Toyohashi Open Platform for Embedded Real-Time Systems
+  * 
+  *  Copyright (C) 2000-2003 by Embedded and Real-Time Systems Laboratory
+  *                              Toyohashi Univ. of Technology, JAPAN
+  *  Copyright (C) 2003-2004 by Naoki Saito
+  *             Nagoya Municipal Industrial Research Institute, JAPAN
+  *  Copyright (C) 2003-2004 by Platform Development Center
+  *                                          RICOH COMPANY,LTD. JAPAN
+  *  Copyright (C) 2008-2010 by Witz Corporation, JAPAN
+  * 
+  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
+  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
+  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
+  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+  *      スコード中に含まれていること．
+  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
+  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
+  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
+  *      の無保証規定を掲載すること．
+  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
+  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
+  *      と．
+  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
+  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
+  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
+  *        報告すること．
+  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
+  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
+  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
+  *      免責すること．
+  * 
+  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
+  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
+  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
+  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
+  *  の責任を負わない．
+  * 
+  */
+ 
+ /*
+  *  t_stddef.hのターゲット依存部（Starter_Kit用）
+  *
+  *  このインクルードファイルは，t_stddef.hの先頭でインクルードされる．
+  *  他のファイルからは直接インクルードすることはない．他のインクルード
+  *  ファイルに先立って処理されるため，他のインクルードファイルに依存し
+  *  てはならない．
+  */
+ 
+ #ifndef TOPPERS_TARGET_STDDEF_H
+ #define TOPPERS_TARGET_STDDEF_H
+ 
+ /*
+  *  ターゲットを識別するためのマクロの定義
+  */
+ #define TOPPERS_STARTER_KIT			/* システム略称 */
+ 
+ 
+ /*
+  *  開発環境で共通な定義
+  */
+ #define TOPPERS_STDINT_TYPE1
+ #define TOPPERS_STDFLOAT_TYPE1
+ #include "gcc/tool_stddef.h"
+ 
+ 
+ /*
+  *  プロセッサで共通な定義
+  */
+ #include "prc_stddef.h"
+ 
+ 
+ /*
+  *  アサーションの失敗時の実行中断処理
+  */
+ #ifndef TOPPERS_MACRO_ONLY
+ 
+ Inline void
+ TOPPERS_assert_abort( void )
+ {
+ }
+ 
+ 
+ /*
+  *  構造体メンバのアライメント数指定
+  *
+  *  本拡張機能を使用することで, 構造体メンバの
+  *  アライメントを1バイトアライメントにする.
+  */
+ //#pragma pack
+ 
+ #endif /* TOPPERS_MACRO_ONLY */
+ 
+ #endif /* TOPPERS_TARGET_STDDEF_H */
diff -cr --new-file asp/target/rx72n_gcc/target_support.S 1.9.1_update/target/rx72n_gcc/target_support.S
*** asp/target/rx72n_gcc/target_support.S	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/target_support.S	Thu Dec 15 13:53:40 2022
***************
*** 0 ****
--- 1,94 ----
+ ;*
+ ;*  TOPPERS/ASP Kernel
+ ;*      Toyohashi Open Platform for Embedded Real-Time Systems/
+ ;*      Advanced Standard Profile Kernel
+ ;* 
+ ;*  Copyright (C) 2000-2003 by Embedded and Real-Time Systems Laboratory
+ ;*                              Toyohashi Univ. of Technology, JAPAN
+ ;*  Copyright (C) 2001 by OAKS16KIT support
+ ;*  Copyright (C) 2003-2004 by Naoki Saito
+ ;*             Nagoya Municipal Industrial Research Institute, JAPAN
+ ;*  Copyright (C) 2003-2004 by Ryosuke Takeuchi
+ ;*               Platform Development Center RICOH COMPANY,LTD. JAPAN
+ ;*  Copyright (C) 2008-2010 by Witz Corporation, JAPAN
+ ;* 
+ ;*  上記著作権者は，Free Software Foundation によって公表されている 
+ ;*  GNU General Public License の Version 2 に記述されている条件か，以
+ ;*  下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェア（本ソフトウェ
+ ;*  アを改変したものを含む．以下同じ）を使用・複製・改変・再配布（以下，
+ ;*  利用と呼ぶ）することを無償で許諾する．
+ ;*  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+ ;*      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+ ;*      スコード中に含まれていること．
+ ;*  (2) 本ソフトウェアを再利用可能なバイナリコード（リロケータブルオブ
+ ;*      ジェクトファイルやライブラリなど）の形で利用する場合には，利用
+ ;*      に伴うドキュメント（利用者マニュアルなど）に，上記の著作権表示，
+ ;*      この利用条件および下記の無保証規定を掲載すること．
+ ;*  (3) 本ソフトウェアを再利用不可能なバイナリコードの形または機器に組
+ ;*      み込んだ形で利用する場合には，次のいずれかの条件を満たすこと．
+ ;*    (a) 利用に伴うドキュメント（利用者マニュアルなど）に，上記の著作
+ ;*        権表示，この利用条件および下記の無保証規定を掲載すること．
+ ;*    (b) 利用の形態を，別に定める方法によって，上記著作権者に報告する
+ ;*        こと．
+ ;*  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+ ;*      害からも，上記著作権者を免責すること．
+ ;* 
+ ;*  本ソフトウェアは，無保証で提供されているものである．上記著作権者は，
+ ;*  本ソフトウェアに関して，その適用可能性も含めて，いかなる保証も行わ
+ ;*  ない．また，本ソフトウェアの利用により直接的または間接的に生じたい
+ ;*  かなる損害に関しても，その責任を負わない．
+ 
+ .text
+ .balign 4
+ 	
+ 
+ ;
+ ;  レジスタ定義
+ ;
+ .equ SCKCR,	0x080020
+ 
+ ;
+ ;  定義値
+ ;
+ .equ CLOCK_VAL,	0x00020100
+ 
+ 
+ .global	_hardware_init_hook
+ .global	_software_init_hook
+ 
+ 
+ _hardware_init_hook:
+ 	;
+ 	;  動作モード設定
+ 	;
+ 	;  動作モードはボード上の端子によって決定されるため,
+ 	;  ここでは特別設定しない.
+ 	;  ただし, リトルエンディアン/シングルチップモード
+ 	;  であることを前提とする.
+ 	;
+ 	;  またリセット後, 内蔵ROM：有効, 内蔵RAM：有効, 外部バス：無効
+ 	;  である.
+ 	;
+ 
+ 	;
+ 	;  モジュールストップ
+ 	;
+ 	;  リセット後, 動作している内蔵周辺モジュールはDMAC, DTC,
+ 	;  内蔵RAMのみである.
+ 	;  それ以外の内蔵周辺モジュールに関しては使用する側で
+ 	;  設定すること.
+ 	;
+ 
+ 	rts
+ 
+ 
+ _software_init_hook:
+ 	;
+ 	;  本コンパイラではweak definitionの機能が無いため,
+ 	;  特に必要な処理はないが, 必ず呼び出すこととする.
+ 	;
+ 	rts
+ 
+ 
+ .end
+ 
diff -cr --new-file asp/target/rx72n_gcc/target_syssvc.h 1.9.1_update/target/rx72n_gcc/target_syssvc.h
*** asp/target/rx72n_gcc/target_syssvc.h	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/target_syssvc.h	Thu Dec 15 16:36:18 2022
***************
*** 0 ****
--- 1,116 ----
+ /*
+  *  TOPPERS/ASP Kernel
+  *      Toyohashi Open Platform for Embedded Real-Time Systems/
+  *      Advanced Standard Profile Kernel
+  * 
+  *  Copyright (C) 2000-2003 by Embedded and Real-Time Systems Laboratory
+  *                              Toyohashi Univ. of Technology, JAPAN
+  *  Copyright (C) 2003-2004 by Naoki Saito
+  *             Nagoya Municipal Industrial Research Institute, JAPAN
+  *  Copyright (C) 2003-2004 by Platform Development Center
+  *                                          RICOH COMPANY,LTD. JAPAN
+  *  Copyright (C) 2008-2010 by Witz Corporation, JAPAN
+  * 
+  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
+  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
+  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
+  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+  *      スコード中に含まれていること．
+  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
+  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
+  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
+  *      の無保証規定を掲載すること．
+  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
+  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
+  *      と．
+  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
+  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
+  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
+  *        報告すること．
+  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
+  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
+  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
+  *      免責すること．
+  * 
+  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
+  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
+  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
+  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
+  *  の責任を負わない．
+  * 
+  */
+ 
+ /*
+  *		システムサービスのターゲット依存部（RX72N用）
+  *
+  *  システムサービスのターゲット依存部のインクルードファイル．このファ
+  *  イルの内容は，コンポーネント記述ファイルに記述され，このファイルは
+  *  無くなる見込み．
+  */
+ 
+ #ifndef TOPPERS_TARGET_SYSSVC_H
+ #define TOPPERS_TARGET_SYSSVC_H
+ 
+ 
+ 
+ 
+ /*
+  *  トレースログに関する設定
+  */
+ #ifdef TOPPERS_ENABLE_TRACE
+ #include "logtrace/trace_config.h"
+ #endif /* TOPPERS_ENABLE_TRACE */
+ 
+ 
+ /*
+  *  ボード依存情報の読み込み
+  */
+ #include "target_board.h"
+ 
+ 
+ /*
+  *  起動メッセージのターゲットシステム名
+  */
+ #define	TARGET_NAME	"RX72N"
+ 
+ 
+ /*
+  *  システムログの低レベル出力のための文字出力
+  *
+  *  ターゲット依存の方法で，文字cを表示/出力/保存する．
+  */
+ extern void	target_fput_log( char c );
+ 
+ 
+ /*
+  *  起動メッセージにターゲット依存部の著作権表示を
+  *  追加するためのマクロ．
+  */
+ #ifdef PRC_COPYRIGHT
+ #define	TARGET_COPYRIGHT	PRC_COPYRIGHT
+ #endif /* PRC_COPYRIGHT */
+ 
+ 
+ /*
+  *  シリアルポート数の定義
+  */
+ #define	TNUM_PORT			UINT_C( 1 )
+ 
+ 
+ /*
+  *  使用するシリアルポートID
+  */
+ #define	SIO_PORTID			UINT_C( 1 )
+ 
+ #define LOGTASK_PORTID		SIO_PORTID
+ 
+ 
+ /*
+  *  システムログタスク関連の定数の定義
+  *
+  *  デフォルト値の通り．
+  */
+ 
+ #endif /* TOPPERS_TARGET_SYSSVC_H */
diff -cr --new-file asp/target/rx72n_gcc/target_test.h 1.9.1_update/target/rx72n_gcc/target_test.h
*** asp/target/rx72n_gcc/target_test.h	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/target_test.h	Thu Dec 15 13:53:40 2022
***************
*** 0 ****
--- 1,63 ----
+ /*
+  *  TOPPERS/ASP Kernel
+  *      Toyohashi Open Platform for Embedded Real-Time Systems/
+  *      Advanced Standard Profile Kernel
+  * 
+  *  Copyright (C) 2000-2003 by Embedded and Real-Time Systems Laboratory
+  *                              Toyohashi Univ. of Technology, JAPAN
+  *  Copyright (C) 2003-2004 by Naoki Saito
+  *             Nagoya Municipal Industrial Research Institute, JAPAN
+  *  Copyright (C) 2003-2004 by Platform Development Center
+  *                                          RICOH COMPANY,LTD. JAPAN
+  *  Copyright (C) 2008-2010 by Witz Corporation, JAPAN
+  * 
+  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
+  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
+  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
+  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+  *      スコード中に含まれていること．
+  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
+  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
+  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
+  *      の無保証規定を掲載すること．
+  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
+  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
+  *      と．
+  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
+  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
+  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
+  *        報告すること．
+  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
+  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
+  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
+  *      免責すること．
+  * 
+  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
+  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
+  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
+  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
+  *  の責任を負わない．
+  * 
+  */
+ 
+ /*
+  *		テストプログラムのターゲット依存定義（Starter Kit用）
+  */
+ 
+ #ifndef TOPPERS_TARGET_TEST_H
+ #define TOPPERS_TARGET_TEST_H
+ 
+ /*
+  *  プロセッサで共通な定義
+  */
+ #include "prc_test.h"
+ 
+ /*
+  *  タスクで使用するシリアルポートID
+  */
+ #define	TASK_PORTID		( 1 )
+ 
+ 
+ #endif /* TOPPERS_TARGET_TEST_H */
diff -cr --new-file asp/target/rx72n_gcc/target_timer.c 1.9.1_update/target/rx72n_gcc/target_timer.c
*** asp/target/rx72n_gcc/target_timer.c	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/target_timer.c	Thu Dec 15 13:53:40 2022
***************
*** 0 ****
--- 1,164 ----
+ /*
+  *  TOPPERS/ASP Kernel
+  *      Toyohashi Open Platform for Embedded Real-Time Systems/
+  *      Advanced Standard Profile Kernel
+  * 
+  *  Copyright (C) 2000-2003 by Embedded and Real-Time Systems Laboratory
+  *                              Toyohashi Univ. of Technology, JAPAN
+  *  Copyright (C) 2003-2004 by Naoki Saito
+  *             Nagoya Municipal Industrial Research Institute, JAPAN
+  *  Copyright (C) 2003-2004 by Platform Development Center
+  *                                          RICOH COMPANY,LTD. JAPAN
+  *  Copyright (C) 2008-2010 by Witz Corporation, JAPAN
+  *  Copyright (C) 2016- by Hisashi Hata, JAPAN
+  * 
+  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
+  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
+  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
+  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+  *      スコード中に含まれていること．
+  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
+  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
+  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
+  *      の無保証規定を掲載すること．
+  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
+  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
+  *      と．
+  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
+  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
+  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
+  *        報告すること．
+  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
+  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
+  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
+  *      免責すること．
+  * 
+  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
+  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
+  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
+  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
+  *  の責任を負わない．
+  * 
+  */
+ 
+ /*
+  *		タイマドライバ（RX63n 用）
+  */
+ 
+ #include "kernel_impl.h"
+ #include "time_event.h"
+ #include <sil.h>
+ #include "target_timer.h"
+ 
+ /*
+  *  タイマの初期化処理
+  */
+ void
+ target_timer_initialize(intptr_t exinf)
+ {
+   //unlock register access 
+   sil_wrh_mem((void *)(SYSTEM_PRCR_ADDR), SYSTEM_PRKEY | SYSTEM_PRC1);
+   /*
+    * モジュールストップ機能の設定(CMT)
+    */
+   *SYSTEM_MSTPCRA_ADDR &= ~(SYSTEM_MSTPCRA_MSTPA15_CMT_U0); /* CMT0_UNIT 0 */
+   //lock register access
+   sil_wrh_mem((void *)(SYSTEM_PRCR_ADDR), SYSTEM_PRKEY );
+ 
+   /* 
+    * タイマ停止 
+    */
+   *CMT_CMSTR0_ADDR &= ~CMT_CMSTR0_STR0_BIT;
+ 
+   /*
+    * カウントアップに用いられるクロック設定
+    * PCLKB/8を選択
+    */
+  // *CMT0_CMCR_ADDR = CMT_PCLK_DIV_8;
+   *CMT0_CMCR_ADDR = (0x0001U);
+   /* 
+    * コンペアマッチタイマカウンタ設定
+    */
+   *CMT0_CMCNT_ADDR = 0U;
+ 
+   /* 
+    * コンペアマッチタイマ周期設定
+    */
+   /* CMT0 Toppers Setting 10msec  */
+   *CMT0_CMCOR_ADDR = RX72N_CMCOR ;// CMCOR_PERIOD ;// 18749;//CMCOR_PERIOD;
+ 
+   /*
+    *  タイマ動作開始前の割込み要求をクリア
+    */
+ 	x_clear_int(INTNO_TIMER);
+ 
+   /* 
+    * コンペアマッチタイマ割り込みを許可
+    */
+    *CMT0_CMCR_ADDR |= CMT0_CMCR_CMIE_BIT;
+ 
+   /* 
+    * タイマ動作開始
+    */
+   *CMT_CMSTR0_ADDR |= CMT_CMSTR0_STR0_BIT;
+ }
+ void
+ target_timer_cmt1_initialize(intptr_t exinf)
+ {
+ 	//to BSP initialize
+ }
+ void
+ target_timer_cmt2_initialize(intptr_t exinf)
+ {
+ 	//to BSP initialize
+ }
+ /*
+  *  タイマの停止処理
+  */
+ void
+ target_timer_terminate(intptr_t exinf)
+ {
+ 	/* 
+ 	 * タイマ停止 
+ 	 */
+ 	*CMT_CMSTR0_ADDR &= ~CMT_CMSTR0_STR0_BIT;
+ }
+ void
+ target_timer_cmt1_terminate(intptr_t exinf)
+ {
+  // renesas bsp
+ }
+ void
+ target_timer_cmt2_terminate(intptr_t exinf)
+ {
+ // renesas bsp
+ }
+ 
+ /*
+  *  タイマ割込みハンドラ
+  */
+ void target_timer_handler(void)
+ {
+ 	i_begin_int(INTNO_TIMER);
+ 	
+ 	signal_time();				/* タイムティックの供給 */
+ 	i_end_int(INTNO_TIMER);
+ }
+ void target_timer_cmt1_handler(void)
+ {
+ 	i_begin_int(INHNO_TIMER_CMT1);
+ 
+ 	signal_time();				/* タイムティックの供給 */
+ 	timer_int_Wrapper();
+ 	i_end_int(INHNO_TIMER_CMT1);
+ }
+ void target_timer_cmt2_handler(void)
+ {
+ 	i_begin_int(INHNO_TIMER_CMT2);
+ 
+ 	signal_time();				/* タイムティックの供給 */
+ 	timer_cm2_int_Wrapper();
+ 	i_end_int(INHNO_TIMER_CMT2);
+ }
diff -cr --new-file asp/target/rx72n_gcc/target_timer.cfg 1.9.1_update/target/rx72n_gcc/target_timer.cfg
*** asp/target/rx72n_gcc/target_timer.cfg	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/target_timer.cfg	Thu Dec 15 13:49:16 2022
***************
*** 0 ****
--- 1,19 ----
+ /*
+  *  タイマドライバ（RX72N用）のコンフィギュレーションファイル
+  */
+ 
+ #include "target_timer.h"
+ ATT_INI({ TA_NULL, 0, target_timer_initialize });
+ ATT_TER({ TA_NULL, 0, target_timer_terminate });
+ DEF_INH(INHNO_TIMER, { TA_NULL, target_timer_handler });
+ CFG_INT(INTNO_TIMER, { INTATR_TIMER, INTPRI_TIMER });
+ 
+ ATT_INI({ TA_NULL, 0, target_timer_cmt1_initialize });
+ ATT_TER({ TA_NULL, 0, target_timer_cmt1_terminate });
+ DEF_INH(INHNO_TIMER_CMT1, { TA_NULL, target_timer_cmt1_handler });
+ CFG_INT(INTNO_TIMER_CMT1, { INTATR_TIMER, INTPRI_TIMER });
+ 
+ ATT_INI({ TA_NULL, 0, target_timer_cmt2_initialize });
+ ATT_TER({ TA_NULL, 0, target_timer_cmt2_terminate });
+ DEF_INH(INHNO_TIMER_CMT2, { TA_NULL, target_timer_cmt2_handler });
+ CFG_INT(INTNO_TIMER_CMT2, { INTATR_TIMER, INTPRI_TIMER });
diff -cr --new-file asp/target/rx72n_gcc/target_timer.h 1.9.1_update/target/rx72n_gcc/target_timer.h
*** asp/target/rx72n_gcc/target_timer.h	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/target_timer.h	Thu Dec 15 13:53:40 2022
***************
*** 0 ****
--- 1,199 ----
+ /*
+  *  TOPPERS/ASP Kernel
+  *      Toyohashi Open Platform for Embedded Real-Time Systems/
+  *      Advanced Standard Profile Kernel
+  * 
+  *  Copyright (C) 2000-2003 by Embedded and Real-Time Systems Laboratory
+  *                              Toyohashi Univ. of Technology, JAPAN
+  *  Copyright (C) 2003-2004 by Naoki Saito
+  *             Nagoya Municipal Industrial Research Institute, JAPAN
+  *  Copyright (C) 2003-2004 by Platform Development Center
+  *                                          RICOH COMPANY,LTD. JAPAN
+  *  Copyright (C) 2008-2010 by Witz Corporation, JAPAN
+  *  Copyright (C) 2016 by Hisashi Hata, JAPAN
+  * 
+  *  上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
+  *  ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
+  *  変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
+  *  (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
+  *      権表示，この利用条件および下記の無保証規定が，そのままの形でソー
+  *      スコード中に含まれていること．
+  *  (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
+  *      用できる形で再配布する場合には，再配布に伴うドキュメント（利用
+  *      者マニュアルなど）に，上記の著作権表示，この利用条件および下記
+  *      の無保証規定を掲載すること．
+  *  (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
+  *      用できない形で再配布する場合には，次のいずれかの条件を満たすこ
+  *      と．
+  *    (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
+  *        作権表示，この利用条件および下記の無保証規定を掲載すること．
+  *    (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
+  *        報告すること．
+  *  (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
+  *      害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
+  *      また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
+  *      由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
+  *      免責すること．
+  * 
+  *  本ソフトウェアは，無保証で提供されているものである．上記著作権者お
+  *  よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
+  *  に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
+  *  アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
+  *  の責任を負わない．
+  * 
+  */
+ 
+ /*
+  *		タイマドライバ（RX72n 用）
+  */
+  
+ #ifndef TOPPERS_TARGET_TIMER_H
+ #define TOPPERS_TARGET_TIMER_H
+ 
+ #include <sil.h>
+ #include "target_board.h"
+ #include "target_syssvc.h"
+ 
+ /*
+  *  タイマ割込みハンドラ登録のための定数
+  */
+ #define INHNO_TIMER		INT_CMT0_CMI0		/* 割込みハンドラ番号 */
+ #define INTNO_TIMER		INT_CMT0_CMI0		/* 割込み番号 */
+ #define INHNO_TIMER_CMT1		INT_CMT1_CMI1		/* 割込みハンドラ番号 */
+ #define INTNO_TIMER_CMT1		INT_CMT1_CMI1		/* 割込み番号 */
+ #define INHNO_TIMER_CMT2		INT_CMT2_CMI2		/* 割込みハンドラ番号 */
+ #define INTNO_TIMER_CMT2		INT_CMT2_CMI2		/* 割込み番号 */
+ 
+ #define INTPRI_TIMER	-5					/* 割込み優先度 */
+ #define INTATR_TIMER	TA_ENAINT | TA_EDGE	/* 割込み属性 */
+ 
+ #ifndef TOPPERS_MACRO_ONLY
+ 
+ /*
+  *  タイマ値の内部表現の型
+  */
+ typedef uint16_t	CLOCK;
+ 
+ /*
+  *  タイマ値の内部表現とミリ秒単位との変換
+  *
+  *  1msのタイマー割り込みを使用するのでそのクロックを定義する．
+  */
+ #define TIMER_CLOCK				(6000U)		/* 6.000MHz */
+ #define TO_CLOCK(nume, deno)	((CLOCK)(TIMER_CLOCK * (nume) / (deno)))
+ #define	TO_USEC(clock)			((SYSUTM)((clock) * 1000U / TIMER_CLOCK))
+ 
+ #define RX72N_PCLK 				(60000000) // Renesas BSP Setting PCLK
+ #define RX72N_PCLK_CKS 			(32) // Renesas BSP Setting PCLK CKS
+ #define RX72N_PCLK_DIV 			(100) // divide value (10msec)
+ 
+ #define RX72N_CMCOR			    ((unsigned short)(RX72N_PCLK / RX72N_PCLK_CKS / RX72N_PCLK_DIV) - 1)
+ /*
+  *  設定できる最大のタイマ周期（単位は内部表現）
+  */
+ #define	MAX_CLOCK	((CLOCK) 0xFFFFU)
+ 
+ /*
+  *  性能評価用システム時刻を取り出す際の処理時間の見積り値（単位は内部表現）
+  */
+ #define	GET_TOLERANCE	(100U)	/* 処理遅れの見積り値（単位は内部表現）*/
+ #define	BEFORE_IREQ(clock) \
+ 		((clock) >= (TO_CLOCK(TIC_NUME, TIC_DENO) - GET_TOLERANCE))
+ 
+ /*
+  *  コンペアマッチタイマコントロールレジスタの設定値
+  */
+ /*
+  *  クロック選択ビット
+  *
+  *  bit7は予約領域であり, 書込みは1固定
+  */
+ #define CMT_PCLK_DIV_8			(0x0080U)
+ #define CMT_PCLK_DIV_32			(0x0081U)
+ #define CMT_PCLK_DIV_128		(0x0082U)
+ #define CMT_PCLK_DIV_512		(0x0083U)
+ 
+ /*
+  *  コンペアマッチタイマコンスタントレジスタ（CMCOR）
+  *
+  *  コンペアマッチ周期を1msとする．
+  *  周辺モジュールクロック（PCLK）48MHzを8分周するので，
+  *  1周期あたり166.6nsecとなり，6000周期で1ms（タイムティックの周期）とする．
+  */
+ #define CMCOR_PERIOD			(6000U)
+ 
+ /*
+  * コンペアマッチタイマ割り込み要求先設定レジスタi（ISELRi）（i= 割り込みベクタ番号）
+  */
+ #define ICU_ISEL_CPU			(0x00U)
+ 
+ 
+ /*
+  *	ターゲットシステム依存モジュール（RX72N用 Timer (CMT0) Interrupt Wrapper）
+  */
+ 
+ extern void timer_int_Wrapper();
+ 
+ 
+ /*
+  *  タイマの起動処理
+  *
+  *  タイマを初期化し，周期的なタイマ割込み要求を発生させる．
+  */
+ extern void	target_timer_initialize(intptr_t exinf);
+ extern void	target_timer_cmt1_initialize(intptr_t exinf);
+ extern void	target_timer_cmt2_initialize(intptr_t exinf);
+ 
+ /*
+  *  タイマの停止処理
+  *
+  *  タイマの動作を停止させる．
+  */
+ extern void	target_timer_terminate(intptr_t exinf);
+ extern void	target_timer_cmt1_terminate(intptr_t exinf);
+ extern void	target_timer_cmt2_terminate(intptr_t exinf);
+ 
+ /*
+  *  タイマレジスタ値の読み出し
+  */
+ Inline uint16_t rx72n_cmt_getcount(void)
+ {
+ 	return *CMT0_CMCNT_ADDR;
+ }
+ 
+ /*
+  *  タイマレジスタ値の書き込み
+  */
+ Inline void rx72n_cmt_setcount(uint16_t count)
+ {
+ 	*CMT0_CMCNT_ADDR = count;
+ }
+ 
+ /*
+  *  タイマの現在値の読出し
+  */
+ Inline CLOCK
+ target_timer_get_current(void)
+ {
+ 	/* アップカウントのためタイマレジスタ値をそのまま返す	*/
+ 	return (rx72n_cmt_getcount());
+ }
+ 
+ /*
+  *  タイマ割込み要求のチェック
+  */
+ Inline bool_t
+ target_timer_probe_int(void)
+ {
+ 	return(x_probe_int(INTNO_TIMER));
+ }
+ 
+ /*
+  *  タイマ割込みハンドラ
+  */
+ extern void	target_timer_handler(void);
+ extern void	target_timer_cm1_handler(void);
+ extern void	target_timer_cm2_handler(void);
+ 
+ #endif /* TOPPERS_MACRO_ONLY */
+ #endif /* TOPPERS_TARGET_TIMER_H */
diff -cr --new-file asp/target/rx72n_gcc/target_unrename.h 1.9.1_update/target/rx72n_gcc/target_unrename.h
*** asp/target/rx72n_gcc/target_unrename.h	Thu Jan  1 09:00:00 1970
--- 1.9.1_update/target/rx72n_gcc/target_unrename.h	Thu Dec 15 13:49:16 2022
***************
*** 0 ****
--- 1,46 ----
+ /* This file is generated from target_rename.def by genrename. */
+ 
+ #ifndef TOPPERS_TARGET_RENAME_H
+ #define TOPPERS_TARGET_RENAME_H
+ 
+ /*
+  *  target_config.c
+  */
+ #undef target_initialize
+ #undef target_exit
+ 
+ /*
+  *  trace_config.c
+  */
+ #undef log_dsp_enter
+ #undef log_dsp_leave
+ #undef log_inh_enter
+ #undef log_inh_leave
+ #undef log_exc_enter
+ #undef log_exc_leave
+ 
+ 
+ #ifdef TOPPERS_LABEL_ASM
+ 
+ /*
+  *  target_config.c
+  */
+ #undef _target_initialize
+ #undef _target_exit
+ 
+ /*
+  *  trace_config.c
+  */
+ #undef _log_dsp_enter
+ #undef _log_dsp_leave
+ #undef _log_inh_enter
+ #undef _log_inh_leave
+ #undef _log_exc_enter
+ #undef _log_exc_leave
+ 
+ 
+ #endif /* TOPPERS_LABEL_ASM */
+ 
+ #include "prc_unrename.h"
+ 
+ #endif /* TOPPERS_TARGET_RENAME_H */
